I"²È<h2 id="-head">Â«Â«Â«&lt; HEAD</h2>
<p>layout:     post
title:      â€œSplashâ€
subtitle:   â€œâ€
date:       2019-11-25 10:02:20
author:     â€œBalboâ€
header-img: â€œimg/post-bg-2019.jpgâ€
tags:
    - reptile
â€”</p>
<h2 id="splash-çš„ä½¿ç”¨">Splash çš„ä½¿ç”¨</h2>
<h3 id="åŠŸèƒ½ä»‹ç»">åŠŸèƒ½ä»‹ç»</h3>

<ol>
  <li>å¼‚æ­¥æ–¹å¼å¤„ç†å¤šä¸ªç½‘é¡µæ¸²æŸ“è¿‡ç¨‹</li>
  <li>è·å–æ¸²æŸ“åçš„é¡µé¢çš„æºä»£ç æˆ–æˆªå›¾</li>
  <li>é€šè¿‡å…³é—­å›¾ç‰‡æ¸²æŸ“æˆ–è€…ä½¿ç”¨ Adblock è§„åˆ™æ¥åŠ å¿«é¡µé¢æ¸²æŸ“é€Ÿåº¦</li>
  <li>å¯æ‰§è¡Œç‰¹å®šçš„ JavaScript è„šæœ¬</li>
  <li>å¯é€šè¿‡ Lua è„šæœ¬æ¥æ§åˆ¶é¡µé¢æ¸²æŸ“è¿‡ç¨‹</li>
  <li>è·å–æ¸²æŸ“çš„è¯¦ç»†è¿‡ç¨‹å¹¶é€šè¿‡ HARï¼ˆHTTP Archiveï¼‰æ ¼å¼å‘ˆç°</li>
</ol>

<h3 id="ç¤ºä¾‹å¼•å…¥">ç¤ºä¾‹å¼•å…¥</h3>

<p>é¦–å…ˆï¼Œé€šè¿‡Splashæä¾›çš„Webé¡µé¢æ¥æµ‹è¯•å…¶æ¸²æŸ“è¿‡ç¨‹ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨æœ¬æœº8050ç«¯å£ä¸Šè¿è¡Œäº†SplashæœåŠ¡ï¼Œæ‰“å¼€http://localhost:8050/å³å¯çœ‹åˆ°å…¶Webé¡µé¢</p>

<p>åœ¨å›¾7-6å³ä¾§ï¼Œå‘ˆç°çš„æ˜¯ä¸€ä¸ªæ¸²æŸ“ç¤ºä¾‹ã€‚å¯ä»¥çœ‹åˆ°ï¼Œä¸Šæ–¹æœ‰ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œé»˜è®¤æ˜¯http://google.comï¼Œè¿™é‡Œæ¢æˆç™¾åº¦æµ‹è¯•ä¸€ä¸‹ï¼Œå°†å†…å®¹æ›´æ”¹ä¸ºhttps://www.baidu.comï¼Œç„¶åç‚¹å‡»Render meæŒ‰é’®å¼€å§‹æ¸²æŸ“</p>

<p>å¯ä»¥çœ‹åˆ°ï¼Œç½‘é¡µçš„è¿”å›ç»“æœå‘ˆç°äº†æ¸²æŸ“æˆªå›¾ã€HARåŠ è½½ç»Ÿè®¡æ•°æ®ã€ç½‘é¡µçš„æºä»£ç ã€‚</p>

<p>é€šè¿‡HARçš„ç»“æœå¯ä»¥çœ‹åˆ°ï¼ŒSplashæ‰§è¡Œäº†æ•´ä¸ªç½‘é¡µçš„æ¸²æŸ“è¿‡ç¨‹ï¼ŒåŒ…æ‹¬CSSã€JavaScriptçš„åŠ è½½ç­‰è¿‡ç¨‹ï¼Œå‘ˆç°çš„é¡µé¢å’Œæˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­å¾—åˆ°çš„ç»“æœå®Œå…¨ä¸€è‡´ã€‚</p>

<p>é‚£ä¹ˆï¼Œè¿™ä¸ªè¿‡ç¨‹ç”±ä»€ä¹ˆæ¥æ§åˆ¶å‘¢ï¼Ÿé‡æ–°è¿”å›é¦–é¡µï¼Œå¯ä»¥çœ‹åˆ°å®é™…ä¸Šæ˜¯æœ‰ä¸€æ®µè„šæœ¬ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
  <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">url</span><span class="p">))</span>
  <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">wait</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">html</span> <span class="o">=</span> <span class="na">splash</span><span class="p">:</span><span class="nx">html</span><span class="p">(),</span>
    <span class="nx">png</span> <span class="o">=</span> <span class="na">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">(),</span>
    <span class="nx">har</span> <span class="o">=</span> <span class="na">splash</span><span class="p">:</span><span class="nx">har</span><span class="p">(),</span>
  <span class="p">}</span>
<span class="nx">end</span>
</code></pre></div></div>
<p>è¿™ä¸ªè„šæœ¬å®é™…ä¸Šæ˜¯ç”¨Luaè¯­è¨€å†™çš„è„šæœ¬ã€‚å³ä½¿ä¸æ‡‚è¿™ä¸ªè¯­è¨€çš„è¯­æ³•ï¼Œä½†ä»è„šæœ¬çš„è¡¨é¢æ„æ€ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¤§è‡´äº†è§£åˆ°å®ƒé¦–å…ˆè°ƒç”¨go()æ–¹æ³•å»åŠ è½½é¡µé¢ï¼Œç„¶åè°ƒç”¨wait()æ–¹æ³•ç­‰å¾…äº†ä¸€å®šæ—¶é—´ï¼Œæœ€åè¿”å›äº†é¡µé¢çš„æºç ã€æˆªå›¾å’ŒHARä¿¡æ¯ã€‚</p>

<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¤§ä½“äº†è§£äº†Splashæ˜¯é€šè¿‡Luaè„šæœ¬æ¥æ§åˆ¶äº†é¡µé¢çš„åŠ è½½è¿‡ç¨‹çš„ï¼ŒåŠ è½½è¿‡ç¨‹å®Œå…¨æ¨¡æ‹Ÿæµè§ˆå™¨ï¼Œæœ€åå¯è¿”å›å„ç§æ ¼å¼çš„ç»“æœï¼Œå¦‚ç½‘é¡µæºç å’Œæˆªå›¾ç­‰ã€‚</p>

<h3 id="splash-luaè„šæœ¬">Splash Luaè„šæœ¬</h3>

<p>Splashå¯ä»¥é€šè¿‡Luaè„šæœ¬æ‰§è¡Œä¸€ç³»åˆ—æ¸²æŸ“æ“ä½œï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç”¨Splashæ¥æ¨¡æ‹Ÿç±»ä¼¼Chromeã€PhantomJSçš„æ“ä½œäº†ã€‚</p>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹Splash Luaè„šæœ¬çš„å…¥å£å’Œæ‰§è¡Œæ–¹å¼ã€‚</p>

<ul>
  <li>
    <p>äººå£åŠè¿”å›å€¼</p>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
  <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://www.baidu.com</span><span class="dl">"</span><span class="p">)</span>
  <span class="nx">splash</span><span class="p">:</span><span class="nx">wait</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
  <span class="nx">local</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">evaljs</span><span class="p">(</span><span class="dl">"</span><span class="s2">document.title</span><span class="dl">"</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">{</span><span class="nx">title</span><span class="o">=</span><span class="nx">title</span><span class="p">}</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>æˆ‘ä»¬å°†ä»£ç ç²˜è´´åˆ°åˆšæ‰æ‰“å¼€çš„http://localhost:8050/çš„ä»£ç ç¼–è¾‘åŒºåŸŸï¼Œç„¶åç‚¹å‡»Render me!æŒ‰é’®æ¥æµ‹è¯•ä¸€ä¸‹ã€‚</p>

    <p>æˆ‘ä»¬çœ‹åˆ°å®ƒè¿”å›äº†ç½‘é¡µçš„æ ‡é¢˜ï¼Œå¦‚å›¾7-8æ‰€ç¤ºã€‚è¿™é‡Œæˆ‘ä»¬é€šè¿‡evaljs()æ–¹æ³•ä¼ å…¥JavaScriptè„šæœ¬ï¼Œè€Œdocument.titleçš„æ‰§è¡Œç»“æœå°±æ˜¯è¿”å›ç½‘é¡µæ ‡é¢˜ï¼Œæ‰§è¡Œå®Œæ¯•åå°†å…¶èµ‹å€¼ç»™ä¸€ä¸ªtitleå˜é‡ï¼Œéšåå°†å…¶è¿”å›ã€‚</p>

    <p>æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå®šä¹‰çš„æ–¹æ³•åç§°å«ä½œmain()ã€‚è¿™ä¸ªåç§°å¿…é¡»æ˜¯å›ºå®šçš„ï¼ŒSplashä¼šé»˜è®¤è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p>

    <p>è¯¥æ–¹æ³•çš„è¿”å›å€¼æ—¢å¯ä»¥æ˜¯å­—å…¸å½¢å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²å½¢å¼ï¼Œæœ€åéƒ½ä¼šè½¬åŒ–ä¸ºSplash HTTP Response</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="k">return</span> <span class="p">{</span><span class="nx">hello</span><span class="o">=</span><span class="dl">"</span><span class="s2">world!</span><span class="dl">"</span><span class="p">}</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿”å›äº†ä¸€ä¸ªå­—å…¸å½¢å¼çš„å†…å®¹</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="k">return</span> <span class="dl">'</span><span class="s1">hello</span><span class="dl">'</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿”å›äº†ä¸€ä¸ªå­—ç¬¦ä¸²å½¢å¼çš„å†…å®¹</p>
  </li>
  <li>
    <p>å¼‚æ­¥å¤„ç†</p>

    <p>Splashæ”¯æŒå¼‚æ­¥å¤„ç†ï¼Œä½†æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰æ˜¾å¼æŒ‡æ˜å›è°ƒæ–¹æ³•ï¼Œå…¶å›è°ƒçš„è·³è½¬æ˜¯åœ¨Splashå†…éƒ¨å®Œæˆçš„</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">example_urls</span> <span class="o">=</span> <span class="p">{</span><span class="dl">"</span><span class="s2">www.baidu.com</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">www.taobao.com</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">www.zhihu.com</span><span class="dl">"</span><span class="p">}</span>
      <span class="nx">local</span> <span class="nx">urls</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">urls</span> <span class="nx">or</span> <span class="nx">example_urls</span>
      <span class="nx">local</span> <span class="nx">results</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="k">for</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">url</span> <span class="k">in</span> <span class="nx">ipairs</span><span class="p">(</span><span class="nx">urls</span><span class="p">)</span> <span class="k">do</span>
          <span class="nx">local</span> <span class="nx">ok</span><span class="p">,</span> <span class="nx">reason</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://</span><span class="dl">"</span> <span class="p">..</span> <span class="nx">url</span><span class="p">)</span>
          <span class="k">if</span> <span class="nx">ok</span> <span class="nx">then</span>
          <span class="nx">splash</span><span class="p">:</span><span class="nx">wait</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
          <span class="nx">results</span><span class="p">[</span><span class="nx">url</span><span class="p">]</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()</span>
          <span class="nx">end</span>
      <span class="nx">end</span>
      <span class="k">return</span> <span class="nx">results</span>
  <span class="nx">end</span>
</code></pre></div>    </div>

    <p>åœ¨è„šæœ¬å†…è°ƒç”¨çš„wait()æ–¹æ³•ç±»ä¼¼äºPythonä¸­çš„sleep()ï¼Œå…¶å‚æ•°ä¸ºç­‰å¾…çš„ç§’æ•°ã€‚å½“Splashæ‰§è¡Œåˆ°æ­¤æ–¹æ³•æ—¶ï¼Œå®ƒä¼šè½¬è€Œå»å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œç„¶ååœ¨æŒ‡å®šçš„æ—¶é—´è¿‡åå†å›æ¥ç»§ç»­å¤„ç†ã€‚</p>

    <p>è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒLuaè„šæœ¬ä¸­çš„å­—ç¬¦ä¸²æ‹¼æ¥å’ŒPythonä¸åŒï¼Œå®ƒä½¿ç”¨çš„æ˜¯..æ“ä½œç¬¦ï¼Œè€Œä¸æ˜¯+ã€‚å¦‚æœæœ‰å¿…è¦ï¼Œå¯ä»¥ç®€å•äº†è§£ä¸€ä¸‹Luaè„šæœ¬çš„è¯­æ³•ï¼Œè¯¦è§http://www.runoob.com/lua/lua-basic-syntax.htmlã€‚</p>

    <p>å¦å¤–ï¼Œè¿™é‡Œåšäº†åŠ è½½æ—¶çš„å¼‚å¸¸æ£€æµ‹ã€‚go()æ–¹æ³•ä¼šè¿”å›åŠ è½½é¡µé¢çš„ç»“æœçŠ¶æ€ï¼Œå¦‚æœé¡µé¢å‡ºç°4xxæˆ–5xxçŠ¶æ€ç ï¼Œokå˜é‡å°±ä¸ºç©ºï¼Œå°±ä¸ä¼šè¿”å›åŠ è½½åçš„å›¾ç‰‡</p>
  </li>
</ul>

<h3 id="splash-å¯¹è±¡å±æ€§">Splash å¯¹è±¡å±æ€§</h3>

<ul>
  <li>
    <p>args</p>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">url</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œç¬¬äºŒä¸ªå‚æ•°argså°±ç›¸å½“äºsplash.argså±æ€§ï¼Œä»¥ä¸Šä»£ç ç­‰ä»·äº:</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">url</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>js_enabled</p>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.baidu.com</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">.</span><span class="nx">js_enabled</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="nx">local</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">evaljs</span><span class="p">(</span><span class="dl">"</span><span class="s2">document.title</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="p">{</span><span class="nx">title</span><span class="o">=</span><span class="nx">title</span><span class="p">}</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>é‡æ–°è°ƒç”¨äº†evaljs()æ–¹æ³•æ‰§è¡ŒJavaScriptä»£ç ï¼Œæ­¤æ—¶è¿è¡Œç»“æœå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
      "error": 400,
      "type": "ScriptError",
      "info": {
          "type": "JS_ERROR",
          "js_error_message": null,
          "source": "[string \"function main(splash, args)\r...\"]",
          "message": "[string \"function main(splash, args)\r...\"]:4: unknown JS error: None",
          "line_number": 4,
          "error": "unknown JS error: None",
          "splash_method": "evaljs"
      },
      "description": "Error happened while executing Lua script"
  }
</code></pre></div>    </div>
    <p>ä¸€èˆ¬æ¥è¯´ï¼Œä¸ç”¨è®¾ç½®æ­¤å±æ€§ï¼Œé»˜è®¤å¼€å¯å³å¯ã€‚</p>
  </li>
  <li>
    <p>resource_timeout</p>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">.</span><span class="nx">resource_timeout</span> <span class="o">=</span> <span class="mf">0.1</span>
      <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://www.taobao.com</span><span class="dl">'</span><span class="p">))</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œå°†è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º0.1ç§’ã€‚å¦‚æœåœ¨0.1ç§’ä¹‹å†…æ²¡æœ‰å¾—åˆ°å“åº”ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
      "error": 400,
      "type": "ScriptError",
      "info": {
          "error": "network5",
          "type": "LUA_ERROR",
          "line_number": 3,
          "source": "[string \"function main(splash)\r...\"]",
          "message": "Lua error: [string \"function main(splash)\r...\"]:3: network5"
      },
      "description": "Error happened while executing Lua script"
  }
</code></pre></div>    </div>
    <p>æ­¤å±æ€§é€‚åˆåœ¨ç½‘é¡µåŠ è½½é€Ÿåº¦è¾ƒæ…¢çš„æƒ…å†µä¸‹è®¾ç½®ã€‚å¦‚æœè¶…è¿‡äº†æŸä¸ªæ—¶é—´æ— å“åº”ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸å¹¶å¿½ç•¥å³å¯ã€‚</p>
  </li>
  <li>
    <p>images_enable</p>

    <p>æ­¤å±æ€§å¯ä»¥è®¾ç½®å›¾ç‰‡æ˜¯å¦åŠ è½½ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯åŠ è½½çš„ã€‚ç¦ç”¨è¯¥å±æ€§åï¼Œå¯ä»¥èŠ‚çœç½‘ç»œæµé‡å¹¶æé«˜ç½‘é¡µåŠ è½½é€Ÿåº¦ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¦ç”¨å›¾ç‰‡åŠ è½½å¯èƒ½ä¼šå½±å“JavaScriptæ¸²æŸ“ã€‚å› ä¸ºç¦ç”¨å›¾ç‰‡ä¹‹åï¼Œå®ƒçš„å¤–å±‚DOMèŠ‚ç‚¹çš„é«˜åº¦ä¼šå—å½±å“ï¼Œè¿›è€Œå½±å“DOMèŠ‚ç‚¹çš„ä½ç½®ã€‚å› æ­¤ï¼Œå¦‚æœJavaScriptå¯¹å›¾ç‰‡èŠ‚ç‚¹æœ‰æ“ä½œçš„è¯ï¼Œå…¶æ‰§è¡Œå°±ä¼šå—åˆ°å½±å“ã€‚</p>

    <p>å¦å¤–å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒSplashä½¿ç”¨äº†ç¼“å­˜ã€‚å¦‚æœä¸€å¼€å§‹åŠ è½½å‡ºæ¥äº†ç½‘é¡µå›¾ç‰‡ï¼Œç„¶åç¦ç”¨äº†å›¾ç‰‡åŠ è½½ï¼Œå†é‡æ–°åŠ è½½é¡µé¢ï¼Œä¹‹å‰åŠ è½½å¥½çš„å›¾ç‰‡å¯èƒ½è¿˜ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œè¿™æ—¶ç›´æ¥é‡å¯Splashå³å¯ã€‚</p>

    <p>ç¦ç”¨å›¾ç‰‡åŠ è½½çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">.</span><span class="nx">images_enabled</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://www.jd.com</span><span class="dl">'</span><span class="p">))</span>
      <span class="k">return</span> <span class="p">{</span><span class="nx">png</span><span class="o">=</span><span class="na">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()}</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™æ ·è¿”å›çš„é¡µé¢æˆªå›¾å°±ä¸ä¼šå¸¦æœ‰ä»»ä½•å›¾ç‰‡ï¼ŒåŠ è½½é€Ÿåº¦ä¹Ÿä¼šå¿«å¾ˆå¤šã€‚</p>
  </li>
  <li>
    <p>plugins_enable</p>

    <p>æ­¤å±æ€§å¯ä»¥æ§åˆ¶æµè§ˆå™¨æ’ä»¶ï¼ˆå¦‚Flashæ’ä»¶ï¼‰æ˜¯å¦å¼€å¯ã€‚</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">splash</span><span class="p">.</span><span class="nx">plugins_enabled</span> <span class="o">=</span> <span class="kc">true</span><span class="o">/</span><span class="kc">false</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>scroll_position</p>

    <p>é€šè¿‡è®¾ç½®æ­¤å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶é¡µé¢ä¸Šä¸‹æˆ–å·¦å³æ»šåŠ¨</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://www.taobao.com</span><span class="dl">'</span><span class="p">))</span>
      <span class="nx">splash</span><span class="p">.</span><span class="nx">scroll_position</span> <span class="o">=</span> <span class="p">{</span><span class="nx">y</span><span class="o">=</span><span class="mi">400</span><span class="p">}</span>
      <span class="k">return</span> <span class="p">{</span><span class="nx">png</span><span class="o">=</span><span class="na">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()}</span>
  <span class="nx">end</span>
</code></pre></div>    </div>

    <p>å¦‚æœè¦è®©é¡µé¢å·¦å³æ»šåŠ¨ï¼Œå¯ä»¥ä¼ å…¥xå‚æ•°</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">splash</span><span class="p">.</span><span class="nx">scroll_position</span> <span class="o">=</span> <span class="p">{</span><span class="nx">x</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nx">y</span><span class="o">=</span><span class="mi">200</span><span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="splash-å¯¹è±¡çš„æ–¹æ³•">Splash å¯¹è±¡çš„æ–¹æ³•</h3>

<ul>
  <li>
    <p>go()</p>

    <p>è¯¥æ–¹æ³•ç”¨æ¥è¯·æ±‚æŸä¸ªé“¾æ¥ï¼Œè€Œä¸”å®ƒå¯ä»¥æ¨¡æ‹ŸGETå’ŒPOSTè¯·æ±‚ï¼ŒåŒæ—¶æ”¯æŒä¼ å…¥è¯·æ±‚å¤´ã€è¡¨å•ç­‰æ•°æ®</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">ok</span><span class="p">,</span> <span class="nx">reason</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">{</span><span class="nx">url</span><span class="p">,</span> <span class="nx">baseurl</span><span class="o">=</span><span class="nx">nil</span><span class="p">,</span> <span class="nx">headers</span><span class="o">=</span><span class="nx">nil</span><span class="p">,</span> <span class="nx">http_method</span><span class="o">=</span><span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">,</span> <span class="nx">body</span><span class="o">=</span><span class="nx">nil</span><span class="p">,</span> <span class="nx">formdata</span><span class="o">=</span><span class="nx">nil</span><span class="p">}</span>
</code></pre></div>    </div>

    <ul>
      <li>url: è¯·æ±‚çš„URL</li>
      <li>baseurl: å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºç©ºï¼Œè¡¨ç¤ºèµ„æºåŠ è½½ç›¸å¯¹è·¯å¾„</li>
      <li>headers: å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºç©ºï¼Œè¡¨ç¤ºè¯·æ±‚å¤´</li>
      <li>http_method: å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºGETï¼ŒåŒæ—¶æ”¯æŒPOST</li>
      <li>body: å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºç©ºï¼Œå‘POSTè¯·æ±‚æ—¶çš„è¡¨å•æ•°æ®ï¼Œä½¿ç”¨çš„Content-typeä¸ºapplication/json</li>
      <li>formdata: å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºç©ºï¼ŒPOSTçš„æ—¶å€™çš„è¡¨å•æ•°æ®ï¼Œä½¿ç”¨çš„Content-typeä¸ºapplication/x-www-form-urlencoded</li>
    </ul>

    <p>è¯¥æ–¹æ³•çš„è¿”å›ç»“æœæ˜¯ç»“æœokå’ŒåŸå› reasonçš„ç»„åˆï¼Œå¦‚æœokä¸ºç©ºï¼Œä»£è¡¨ç½‘é¡µåŠ è½½å‡ºç°äº†é”™è¯¯ï¼Œæ­¤æ—¶reasonå˜é‡ä¸­åŒ…å«äº†é”™è¯¯çš„åŸå› ï¼Œå¦åˆ™è¯æ˜é¡µé¢åŠ è½½æˆåŠŸ</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">ok</span><span class="p">,</span> <span class="nx">reason</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">{</span><span class="dl">"</span><span class="s2">http://httpbin.org/post</span><span class="dl">"</span><span class="p">,</span> <span class="nx">http_method</span><span class="o">=</span><span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span> <span class="nx">body</span><span class="o">=</span><span class="dl">"</span><span class="s2">name=Germey</span><span class="dl">"</span><span class="p">}</span>
      <span class="k">if</span> <span class="nx">ok</span> <span class="nx">then</span>
              <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">html</span><span class="p">()</span>
      <span class="nx">end</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿäº†ä¸€ä¸ªPOSTè¯·æ±‚ï¼Œå¹¶ä¼ å…¥äº†POSTçš„è¡¨å•æ•°æ®ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™è¿”å›é¡µé¢çš„æºä»£ç </p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;pre style="word-wrap: break-word; white-space: pre-wrap;"&gt;{
  "args": {}, 
  "data": "", 
  "files": {}, 
  "form": {
      "name": "Germey"
  }, 
  "headers": {
      "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", 
      "Accept-Encoding": "gzip, deflate", 
      "Accept-Language": "en,*", 
      "Connection": "close", 
      "Content-Length": "11", 
      "Content-Type": "application/x-www-form-urlencoded", 
      "Host": "httpbin.org", 
      "Origin": "null", 
      "User-Agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/602.1 (KHTML, like Gecko) splash Version/9.0 Safari/602.1"
  }, 
  "json": null, 
  "origin": "60.207.237.85", 
  "url": "http://httpbin.org/post"
  }
  &lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre></div>    </div>
  </li>
  <li>
    <p>wait()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥æ§åˆ¶é¡µé¢çš„ç­‰å¾…æ—¶é—´</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">ok</span><span class="p">,</span> <span class="nx">reason</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">wait</span><span class="p">{</span><span class="nx">time</span><span class="p">,</span> <span class="nx">cancel_on_redirect</span><span class="o">=</span><span class="kc">false</span><span class="p">,</span> <span class="nx">cancel_on_error</span><span class="o">=</span><span class="kc">true</span><span class="p">}</span>
</code></pre></div>    </div>

    <ul>
      <li>time: ç­‰å¾…çš„ç§’æ•°</li>
      <li>cancel_on_redirect: å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºfalseï¼Œè¡¨ç¤ºå¦‚æœå‘ç”Ÿäº†é‡å®šå‘å°±åœæ­¢ç­‰å¾…ï¼Œå¹¶è¿”å›é‡å®šå‘ç»“æœ</li>
      <li>cancel_on_error: å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºfalseï¼Œè¡¨ç¤ºå¦‚æœå‘ç”Ÿäº†åŠ è½½é”™è¯¯ï¼Œå°±åœæ­¢ç­‰å¾…</li>
    </ul>

    <p>è¿”å›ç»“æœåŒæ ·æ˜¯ç»“æœokå’ŒåŸå› reasonçš„ç»„åˆ</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.taobao.com</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">wait</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
      <span class="k">return</span> <span class="p">{</span><span class="nx">html</span><span class="o">=</span><span class="na">splash</span><span class="p">:</span><span class="nx">html</span><span class="p">()}</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>jsfunc()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥ç›´æ¥è°ƒç”¨JavaScriptå®šä¹‰çš„æ–¹æ³•ï¼Œä½†æ˜¯æ‰€è°ƒç”¨çš„æ–¹æ³•éœ€è¦ç”¨åŒä¸­æ‹¬å·åŒ…å›´ï¼Œè¿™ç›¸å½“äºå®ç°äº†JavaScriptæ–¹æ³•åˆ°Luaè„šæœ¬çš„è½¬æ¢</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">get_div_count</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">jsfunc</span><span class="p">([[</span>
      <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">divs</span> <span class="o">=</span> <span class="nx">body</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">divs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="p">]])</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.baidu.com</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="p">(</span><span class="dl">"</span><span class="s2">There are %s DIVs</span><span class="dl">"</span><span class="p">):</span><span class="nx">format</span><span class="p">(</span>
          <span class="nx">get_div_count</span><span class="p">())</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  There are 21 DIVs
</code></pre></div>    </div>
    <p>é¦–å…ˆï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªJavaScriptå®šä¹‰çš„æ–¹æ³•ï¼Œç„¶ååœ¨é¡µé¢åŠ è½½æˆåŠŸåè°ƒç”¨äº†æ­¤æ–¹æ³•è®¡ç®—å‡ºäº†é¡µé¢ä¸­divèŠ‚ç‚¹çš„ä¸ªæ•°ã€‚</p>

    <p>å…³äºJavaScriptåˆ°Luaè„šæœ¬çš„æ›´å¤šè½¬æ¢ç»†èŠ‚ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://splash.readthedocs.io/en/stable/scripting-ref.html#splash-jsfunc</p>
  </li>
  <li>
    <p>evaljs()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥æ‰§è¡ŒJavaScriptä»£ç å¹¶è¿”å›æœ€åä¸€æ¡JavaScriptè¯­å¥çš„è¿”å›ç»“æœ</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">result</span> <span class="o">=</span> <span class="n">splash</span><span class="p">:</span><span class="n">evaljs</span><span class="p">(</span><span class="n">js</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>æ¯”å¦‚</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">local</span> <span class="n">title</span> <span class="o">=</span> <span class="n">splash</span><span class="p">:</span><span class="n">evaljs</span><span class="p">(</span><span class="s">"document.title"</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>runjs()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥æ‰§è¡ŒJavaScriptä»£ç ï¼Œå®ƒä¸evaljs()çš„åŠŸèƒ½ç±»ä¼¼ï¼Œä½†æ˜¯æ›´åå‘äºæ‰§è¡ŒæŸäº›åŠ¨ä½œæˆ–å£°æ˜æŸäº›æ–¹æ³•</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.baidu.com</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">runjs</span><span class="p">(</span><span class="dl">"</span><span class="s2">foo = function() { return 'bar' }</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">evaljs</span><span class="p">(</span><span class="dl">"</span><span class="s2">foo()</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">result</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œæˆ‘ä»¬ç”¨runjs()å…ˆå£°æ˜äº†ä¸€ä¸ªJavaScriptå®šä¹‰çš„æ–¹æ³•ï¼Œç„¶åé€šè¿‡evaljs()æ¥è°ƒç”¨å¾—åˆ°çš„ç»“æœ</p>

    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  bar
</code></pre></div>    </div>
  </li>
  <li>
    <p>autoload()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥è®¾ç½®æ¯ä¸ªé¡µé¢è®¿é—®æ—¶è‡ªåŠ¨åŠ è½½çš„å¯¹è±¡</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">ok</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="n">splash</span><span class="p">:</span><span class="n">autoload</span><span class="p">{</span><span class="n">source_or_url</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">nil</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">nil</span><span class="p">}</span>
</code></pre></div>    </div>

    <ul>
      <li>source_or_url: JavaScriptä»£ç æˆ–è€…JavaScriptåº“é“¾æ¥</li>
      <li>source: JavaScriptä»£ç </li>
      <li>url: JavaScriptåº“é“¾æ¥</li>
    </ul>

    <p>ä½†æ˜¯æ­¤æ–¹æ³•åªè´Ÿè´£åŠ è½½JavaScriptä»£ç æˆ–åº“ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚å¦‚æœè¦æ‰§è¡Œæ“ä½œï¼Œå¯ä»¥è°ƒç”¨evaljs()æˆ–runjs()æ–¹æ³•</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">autoload</span><span class="p">([[</span>
          <span class="kd">function</span> <span class="nx">get_document_title</span><span class="p">(){</span>
          <span class="k">return</span> <span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
          <span class="p">}</span>
      <span class="p">]])</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.baidu.com</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">evaljs</span><span class="p">(</span><span class="dl">"</span><span class="s2">get_document_title()</span><span class="dl">"</span><span class="p">)</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œæˆ‘ä»¬è°ƒç”¨autoload()æ–¹æ³•å£°æ˜äº†ä¸€ä¸ªJavaScriptæ–¹æ³•ï¼Œç„¶åé€šè¿‡evaljs()æ–¹æ³•æ¥æ‰§è¡Œæ­¤JavaScriptæ–¹æ³•</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ç™¾åº¦ä¸€ä¸‹ï¼Œä½ å°±çŸ¥é“
</code></pre></div>    </div>
    <p>å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨autoload()æ–¹æ³•åŠ è½½æŸäº›æ–¹æ³•åº“ï¼Œå¦‚jQuery</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">autoload</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://code.jquery.com/jquery-2.1.3.min.js</span><span class="dl">"</span><span class="p">))</span>
      <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.taobao.com</span><span class="dl">"</span><span class="p">))</span>
      <span class="nx">local</span> <span class="nx">version</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">evaljs</span><span class="p">(</span><span class="dl">"</span><span class="s2">$.fn.jquery</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="dl">'</span><span class="s1">JQuery version: </span><span class="dl">'</span> <span class="p">..</span> <span class="nx">version</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  JQuery version: 2.1.3
</code></pre></div>    </div>
  </li>
  <li>
    <p>call_later()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥é€šè¿‡è®¾ç½®å®šæ—¶ä»»åŠ¡å’Œå»¶è¿Ÿæ—¶é—´æ¥å®ç°ä»»åŠ¡å»¶æ—¶æ‰§è¡Œï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ‰§è¡Œå‰é€šè¿‡cancel()æ–¹æ³•é‡æ–°æ‰§è¡Œå®šæ—¶ä»»åŠ¡</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">snapshots</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="nx">local</span> <span class="nx">timer</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">call_later</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span>
          <span class="nx">snapshots</span><span class="p">[</span><span class="dl">"</span><span class="s2">a</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()</span>
          <span class="nx">splash</span><span class="p">:</span><span class="nx">wait</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
          <span class="nx">snapshots</span><span class="p">[</span><span class="dl">"</span><span class="s2">b</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()</span>
      <span class="nx">end</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.taobao.com</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">wait</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">snapshots</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œæˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œ0.2ç§’çš„æ—¶å€™è·å–ç½‘é¡µæˆªå›¾ï¼Œç„¶åç­‰å¾…1ç§’ï¼Œ1.2ç§’æ—¶å†æ¬¡è·å–ç½‘é¡µæˆªå›¾ï¼Œè®¿é—®çš„é¡µé¢æ˜¯æ·˜å®ï¼Œæœ€åå°†æˆªå›¾ç»“æœè¿”å›</p>
  </li>
  <li>
    <p>http_get()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥æ¨¡æ‹Ÿå‘é€HTTPçš„GETè¯·æ±‚</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">response</span> <span class="o">=</span> <span class="n">splash</span><span class="p">:</span><span class="n">http_get</span><span class="p">{</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">nil</span><span class="p">,</span> <span class="n">follow_redirects</span><span class="o">=</span><span class="n">true</span><span class="p">}</span>
</code></pre></div>    </div>

    <ul>
      <li>url: è¯·æ±‚URL</li>
      <li>headers: å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºç©ºï¼Œè¯·æ±‚å¤´</li>
      <li>follow_redirects: å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºæ˜¯å¦å¯åŠ¨è‡ªåŠ¨é‡å®šå‘ï¼Œé»˜è®¤ä¸ºtrue</li>
    </ul>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">treat</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">treat</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">http_get</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://httpbin.org/get</span><span class="dl">"</span><span class="p">)</span>
          <span class="k">return</span> <span class="p">{</span>
          <span class="nx">html</span><span class="o">=</span><span class="nx">treat</span><span class="p">.</span><span class="nx">as_string</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">),</span>
          <span class="nx">url</span><span class="o">=</span><span class="nx">response</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
          <span class="nx">status</span><span class="o">=</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span>
          <span class="p">}</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Splash Response: Object
  html: String (length 355)
  {
  "args": {}, 
  "headers": {
      "Accept-Encoding": "gzip, deflate", 
      "Accept-Language": "en,*", 
      "Connection": "close", 
      "Host": "httpbin.org", 
      "User-Agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/602.1 (KHTML, like Gecko) splash Version/9.0 Safari/602.1"
  }, 
  "origin": "60.207.237.85", 
  "url": "http://httpbin.org/get"
  }
  status: 200
  url: "http://httpbin.org/get"
</code></pre></div>    </div>
  </li>
  <li>
    <p>http_post()</p>

    <p>å’Œhttp_get()æ–¹æ³•ç±»ä¼¼ï¼Œæ­¤æ–¹æ³•ç”¨æ¥æ¨¡æ‹Ÿå‘é€POSTè¯·æ±‚ï¼Œä¸è¿‡å¤šäº†ä¸€ä¸ªå‚æ•°body</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  response = splash:http_post{url, headers=nil, follow_redirects=true, body=nil}
</code></pre></div>    </div>

    <ul>
      <li>url: è¯·æ±‚URL</li>
      <li>headers: å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºç©ºï¼Œè¯·æ±‚å¤´</li>
      <li>follow_redirects: å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºæ˜¯å¦å¯åŠ¨è‡ªåŠ¨é‡å®šå‘ï¼Œé»˜è®¤ä¸ºtrue</li>
      <li>body: å¯é€‰å‚æ•°ï¼Œå³è¡¨å•æ•°æ®ï¼Œé»˜è®¤ä¸ºç©º</li>
    </ul>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">treat</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">treat</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">json</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">http_post</span><span class="p">{</span><span class="dl">"</span><span class="s2">http://httpbin.org/post</span><span class="dl">"</span><span class="p">,</span>     
          <span class="nx">body</span><span class="o">=</span><span class="nx">json</span><span class="p">.</span><span class="nx">encode</span><span class="p">({</span><span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">Germey</span><span class="dl">"</span><span class="p">}),</span>
          <span class="nx">headers</span><span class="o">=</span><span class="p">{[</span><span class="dl">"</span><span class="s2">content-type</span><span class="dl">"</span><span class="p">]</span><span class="o">=</span><span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">}</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="p">{</span>
          <span class="nx">html</span><span class="o">=</span><span class="nx">treat</span><span class="p">.</span><span class="nx">as_string</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">),</span>
          <span class="nx">url</span><span class="o">=</span><span class="nx">response</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
          <span class="nx">status</span><span class="o">=</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span>
          <span class="p">}</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Splash Response: Object
  html: String (length 533)
  {
  "args": {}, 
  "data": "{\"name\": \"Germey\"}", 
  "files": {}, 
  "form": {}, 
  "headers": {
      "Accept-Encoding": "gzip, deflate", 
      "Accept-Language": "en,*", 
      "Connection": "close", 
      "Content-Length": "18", 
      "Content-Type": "application/json", 
      "Host": "httpbin.org", 
      "User-Agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/602.1 (KHTML, like Gecko) splash Version/9.0 Safari/602.1"
  }, 
  "json": {
      "name": "Germey"
  }, 
  "origin": "60.207.237.85", 
  "url": "http://httpbin.org/post"
  }
  status: 200
  url: "http://httpbin.org/post"
</code></pre></div>    </div>
  </li>
  <li>
    <p>set_content()</p>

    <p>æ­¤æ–¹æ³•ç”¨æ¥è®¾ç½®é¡µé¢çš„å†…å®¹</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">set_content</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;html&gt;&lt;body&gt;&lt;h1&gt;hello&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><span class="dl">"</span><span class="p">))</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>html()</p>

    <p>æ­¤æ–¹æ³•ç”¨æ¥è·å–ç½‘é¡µçš„æºä»£ç ï¼Œå®ƒæ˜¯éå¸¸ç®€å•åˆå¸¸ç”¨çš„æ–¹æ³•</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://httpbin.org/get</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">html</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;pre style="word-wrap: break-word; white-space: pre-wrap;"&gt;{
  "args": {}, 
  "headers": {
      "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", 
      "Accept-Encoding": "gzip, deflate", 
      "Accept-Language": "en,*", 
      "Connection": "close", 
      "Host": "httpbin.org", 
      "User-Agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/602.1 (KHTML, like Gecko) splash Version/9.0 Safari/602.1"
  }, 
  "origin": "60.207.237.85", 
  "url": "https://httpbin.org/get"
  }
  &lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre></div>    </div>
  </li>
  <li>
    <p>png()</p>

    <p>æ­¤æ–¹æ³•ç”¨æ¥è·å–PNGæ ¼å¼çš„ç½‘é¡µæˆªå›¾</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.taobao.com</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>jpeg()</p>

    <p>æ­¤æ–¹æ³•ç”¨æ¥è·å–JPEGæ ¼å¼çš„ç½‘é¡µæˆªå›¾</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.taobao.com</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">jpeg</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>har()</p>

    <p>æ­¤æ–¹æ³•ç”¨æ¥è·å–é¡µé¢åŠ è½½è¿‡ç¨‹æè¿°</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.baidu.com</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">har</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>url()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥è·å–å½“å‰æ­£åœ¨è®¿é—®çš„URL</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.baidu.com</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">url</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  https://www.baidu.com/
</code></pre></div>    </div>
  </li>
  <li>
    <p>get_cookies()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥è·å–å½“å‰é¡µé¢çš„Cookies</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.baidu.com</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">get_cookies</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Splash Response: Array[2]
  0: Object
  domain: ".baidu.com"
  expires: "2085-08-21T20:13:23Z"
  httpOnly: false
  name: "BAIDUID"
  path: "/"
  secure: false
  value: "C1263A470B02DEF45593B062451C9722:FG=1"
  1: Object
  domain: ".baidu.com"
  expires: "2085-08-21T20:13:23Z"
  httpOnly: false
  name: "BIDUPSID"
  path: "/"
  secure: false
  value: "C1263A470B02DEF45593B062451C9722"
</code></pre></div>    </div>
  </li>
  <li>
    <p>add_cookies()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥ä¸ºå½“å‰é¡µé¢æ·»åŠ Cookie</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">cookies</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">add_cookie</span><span class="p">{</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">path</span><span class="o">=</span><span class="nx">nil</span><span class="p">,</span> <span class="nx">domain</span><span class="o">=</span><span class="nx">nil</span><span class="p">,</span> <span class="nx">expires</span><span class="o">=</span><span class="nx">nil</span><span class="p">,</span> <span class="nx">httpOnly</span><span class="o">=</span><span class="nx">nil</span><span class="p">,</span> <span class="nx">secure</span><span class="o">=</span><span class="nx">nil</span><span class="p">}</span>
</code></pre></div>    </div>
    <p>è¯¥æ–¹æ³•çš„å„ä¸ªå‚æ•°ä»£è¡¨Cookieçš„å„ä¸ªå±æ€§</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">add_cookie</span><span class="p">{</span><span class="dl">"</span><span class="s2">sessionid</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">237465ghgfsd</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="nx">domain</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://example.com</span><span class="dl">"</span><span class="p">}</span>
      <span class="nl">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://example.com/</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">html</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>clear_cookies()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥æ¸…é™¤æ‰€æœ‰çš„Cookies</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.baidu.com/</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">clear_cookies</span><span class="p">()</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">get_cookies</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œæˆ‘ä»¬æ¸…é™¤äº†æ‰€æœ‰çš„Cookiesï¼Œç„¶åè°ƒç”¨get_cookies()å°†ç»“æœè¿”å›</p>

    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Splash Response: Array[0]
</code></pre></div>    </div>
  </li>
  <li>
    <p>get_viewport_size()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥è·å–å½“å‰æµè§ˆå™¨é¡µé¢çš„å¤§å°ï¼Œå³å®½é«˜</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.baidu.com/</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">get_viewport_size</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Splash Response: Array[2]
  0: 1024
  1: 768
</code></pre></div>    </div>
  </li>
  <li>
    <p>set_viewport_size()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥è®¾ç½®å½“å‰æµè§ˆå™¨é¡µé¢çš„å¤§å°ï¼Œå³å®½é«˜</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">splash</span><span class="p">:</span><span class="nx">set_viewport_size</span><span class="p">(</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>ä¾‹å¦‚ï¼Œè¿™é‡Œè®¿é—®ä¸€ä¸ªå®½åº¦è‡ªé€‚åº”çš„é¡µé¢</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">set_viewport_size</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">700</span><span class="p">)</span>
      <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://balbozheng.com</span><span class="dl">"</span><span class="p">))</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>set_viewport_full()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥è®¾ç½®æµè§ˆå™¨å…¨å±æ˜¾ç¤º</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">set_viewport_full</span><span class="p">()</span>
      <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://cuiqingcai.com</span><span class="dl">"</span><span class="p">))</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>set_user_agent()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥è®¾ç½®æµè§ˆå™¨çš„User-Agent</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">set_user_agent</span><span class="p">(</span><span class="dl">'</span><span class="s1">Splash</span><span class="dl">'</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://httpbin.org/get</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">html</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œæˆ‘ä»¬å°†æµè§ˆå™¨çš„User-Agentè®¾ç½®ä¸ºSplash,è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;pre style="word-wrap: break-word; white-space: pre-wrap;"&gt;{
  "args": {}, 
  "headers": {
      "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", 
      "Accept-Encoding": "gzip, deflate", 
      "Accept-Language": "en,*", 
      "Connection": "close", 
      "Host": "httpbin.org", 
      "User-Agent": "Splash"
  }, 
  "origin": "60.207.237.85", 
  "url": "http://httpbin.org/get"
  }
  &lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre></div>    </div>
  </li>
  <li>
    <p>set_custom_headers()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥è®¾ç½®è¯·æ±‚å¤´</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">set_custom_headers</span><span class="p">({</span>
          <span class="p">[</span><span class="dl">"</span><span class="s2">User-Agent</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Splash</span><span class="dl">"</span><span class="p">,</span>
          <span class="p">[</span><span class="dl">"</span><span class="s2">Site</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Splash</span><span class="dl">"</span><span class="p">,</span>
      <span class="p">})</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://httpbin.org/get</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">html</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œæˆ‘ä»¬è®¾ç½®äº†è¯·æ±‚å¤´ä¸­çš„User-Agentå’ŒSiteå±æ€§ï¼Œè¿è¡Œç»“æœ</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;pre style="word-wrap: break-word; white-space: pre-wrap;"&gt;{
  "args": {}, 
  "headers": {
      "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", 
      "Accept-Encoding": "gzip, deflate", 
      "Accept-Language": "en,*", 
      "Connection": "close", 
      "Host": "httpbin.org", 
      "Site": "Splash", 
      "User-Agent": "Splash"
  }, 
  "origin": "60.207.237.85", 
  "url": "http://httpbin.org/get"
  }
  &lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre></div>    </div>
  </li>
  <li>
    <p>select()</p>

    <p>è¯¥æ–¹æ³•å¯ä»¥é€‰ä¸­ç¬¦åˆæ¡ä»¶çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœæœ‰å¤šä¸ªèŠ‚ç‚¹ç¬¦åˆæ¡ä»¶ï¼Œåˆ™åªä¼šè¿”å›ä¸€ä¸ªï¼Œå…¶å‚æ•°æ˜¯CSSé€‰æ‹©å™¨</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.baidu.com/</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">input</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">select</span><span class="p">(</span><span class="dl">"</span><span class="s2">#kw</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">input</span><span class="p">:</span><span class="nx">send_text</span><span class="p">(</span><span class="dl">'</span><span class="s1">Splash</span><span class="dl">'</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">wait</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œæˆ‘ä»¬é¦–å…ˆè®¿é—®äº†ç™¾åº¦ï¼Œç„¶åé€‰ä¸­äº†æœç´¢æ¡†ï¼Œéšåè°ƒç”¨äº†send_text()æ–¹æ³•å¡«å†™äº†æ–‡æœ¬ï¼Œç„¶åè¿”å›ç½‘é¡µæˆªå›¾ã€‚</p>
  </li>
  <li>
    <p>select_all()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥é€‰ä¸­æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ï¼Œå…¶å‚æ•°æ˜¯CSSé€‰æ‹©å™¨</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">treat</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">treat</span><span class="dl">'</span><span class="p">)</span>
      <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://quotes.toscrape.com/</span><span class="dl">"</span><span class="p">))</span>
      <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">wait</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
      <span class="nx">local</span> <span class="nx">texts</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">select_all</span><span class="p">(</span><span class="dl">'</span><span class="s1">.quote .text</span><span class="dl">'</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">results</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="k">for</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">text</span> <span class="k">in</span> <span class="nx">ipairs</span><span class="p">(</span><span class="nx">texts</span><span class="p">)</span> <span class="k">do</span>
          <span class="nx">results</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">innerHTML</span>
      <span class="nx">end</span>
      <span class="k">return</span> <span class="nx">treat</span><span class="p">.</span><span class="nx">as_array</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œæˆ‘ä»¬é€šè¿‡CSSé€‰æ‹©å™¨é€‰ä¸­äº†èŠ‚ç‚¹çš„æ­£æ–‡å†…å®¹ï¼Œéšåéå†äº†æ‰€æœ‰èŠ‚ç‚¹ï¼Œå°†å…¶ä¸­çš„æ–‡æœ¬è·å–ä¸‹æ¥,è¿è¡Œç»“æœ</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Splash Response: Array[10]
  0: "â€œThe world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.â€"
  1: "â€œIt is our choices, Harry, that show what we truly are, far more than our abilities.â€"
  2: â€œThere are only two ways to live your life. One is as though nothing is a miracle. The other is as though everything is a miracle.â€
  3: "â€œThe person, be it gentleman or lady, who has not pleasure in a good novel, must be intolerably stupid.â€"
  4: "â€œImperfection is beauty, madness is genius and it's better to be absolutely ridiculous than absolutely boring.â€"
  5: "â€œTry not to become a man of success. Rather become a man of value.â€"
  6: "â€œIt is better to be hated for what you are than to be loved for what you are not.â€"
  7: "â€œI have not failed. I've just found 10,000 ways that won't work.â€"
  8: "â€œA woman is like a tea bag; you never know how strong it is until it's in hot water.â€"
  9: "â€œA day without sunshine is like, you know, night.â€"
</code></pre></div>    </div>
  </li>
  <li>
    <p>mouse_click()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥æ¨¡æ‹Ÿé¼ æ ‡ç‚¹å‡»æ“ä½œï¼Œä¼ å…¥çš„å‚æ•°ä¸ºåæ ‡å€¼xå’Œyã€‚æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥é€‰ä¸­æŸä¸ªèŠ‚ç‚¹ï¼Œç„¶åè°ƒç”¨æ­¤æ–¹æ³•</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.baidu.com/</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">input</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">select</span><span class="p">(</span><span class="dl">"</span><span class="s2">#kw</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">input</span><span class="p">:</span><span class="nx">send_text</span><span class="p">(</span><span class="dl">'</span><span class="s1">Splash</span><span class="dl">'</span><span class="p">)</span>
      <span class="nx">submit</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">#su</span><span class="dl">'</span><span class="p">)</span>
      <span class="nx">submit</span><span class="p">:</span><span class="nx">mouse_click</span><span class="p">()</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">wait</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œæˆ‘ä»¬é¦–å…ˆé€‰ä¸­é¡µé¢çš„è¾“å…¥æ¡†ï¼Œè¾“å…¥äº†æ–‡æœ¬ï¼Œç„¶åé€‰ä¸­â€œæäº¤â€æŒ‰é’®ï¼Œè°ƒç”¨äº†mouse_click()æ–¹æ³•æäº¤æŸ¥è¯¢ï¼Œç„¶åé¡µé¢ç­‰å¾…ä¸‰ç§’ï¼Œè¿”å›æˆªå›¾</p>
  </li>
</ul>

<h3 id="splash-api-è°ƒç”¨">Splash API è°ƒç”¨</h3>

<ul>
  <li>
    <p>render.html</p>

    <p>æ­¤æ¥å£ç”¨äºè·å–JavaScriptæ¸²æŸ“çš„é¡µé¢çš„HTMLä»£ç ï¼Œæ¥å£åœ°å€å°±æ˜¯Splashçš„è¿è¡Œåœ°å€åŠ æ­¤æ¥å£åç§°ï¼Œä¾‹å¦‚http://localhost:8050/render.htmlã€‚å¯ä»¥ç”¨curlæ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">curl</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//localhost:8050/render.html?url=https://www.baidu.com</span>
</code></pre></div>    </div>
    <p>æˆ‘ä»¬ç»™æ­¤æ¥å£ä¼ é€’äº†ä¸€ä¸ªurlå‚æ•°æ¥æŒ‡å®šæ¸²æŸ“çš„URLï¼Œè¿”å›ç»“æœå³é¡µé¢æ¸²æŸ“åçš„æºä»£ç ã€‚</p>

    <p>å¦‚æœç”¨Pythonå®ç°çš„è¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">import</span> <span class="nn">requests</span>
  <span class="n">url</span> <span class="o">=</span> <span class="s">'http://localhost:8050/render.html?url=https://www.baidu.com'</span>
  <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>è¿™æ ·å°±å¯ä»¥æˆåŠŸè¾“å‡ºç™¾åº¦é¡µé¢æ¸²æŸ“åçš„æºä»£ç äº†ã€‚</p>

    <p>å¦å¤–ï¼Œæ­¤æ¥å£è¿˜å¯ä»¥æŒ‡å®šå…¶ä»–å‚æ•°ï¼Œæ¯”å¦‚é€šè¿‡waitæŒ‡å®šç­‰å¾…ç§’æ•°ã€‚å¦‚æœè¦ç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½å‡ºæ¥ï¼Œå¯ä»¥å¢åŠ ç­‰å¾…æ—¶é—´ï¼Œä¾‹å¦‚ï¼š</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">import</span> <span class="nn">requests</span>
  <span class="n">url</span> <span class="o">=</span> <span class="s">'http://localhost:8050/render.html?url=https://www.taobao.com&amp;wait=5'</span>
  <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>æ­¤æ—¶å¾—åˆ°å“åº”çš„æ—¶é—´å°±ä¼šç›¸åº”å˜é•¿ï¼Œæ¯”å¦‚è¿™é‡Œä¼šç­‰å¾…5ç§’å¤šé’Ÿæ‰èƒ½è·å–æ·˜å®é¡µé¢çš„æºä»£ç ã€‚</p>

    <p>å¦å¤–ï¼Œæ­¤æ¥å£è¿˜æ”¯æŒä»£ç†è®¾ç½®ã€å›¾ç‰‡åŠ è½½è®¾ç½®ã€Headersè®¾ç½®ã€è¯·æ±‚æ–¹æ³•è®¾ç½®ï¼Œå…·ä½“çš„ç”¨æ³•å¯ä»¥å‚è§å®˜æ–¹æ–‡æ¡£https://splash.readthedocs.io/en/stable/api.html#render-html</p>
  </li>
  <li>
    <p>render.png</p>

    <p>æ­¤æ¥å£å¯ä»¥è·å–ç½‘é¡µæˆªå›¾ï¼Œå…¶å‚æ•°æ¯”render.htmlå¤šäº†å‡ ä¸ªï¼Œæ¯”å¦‚é€šè¿‡widthå’Œheightæ¥æ§åˆ¶å®½é«˜ï¼Œå®ƒè¿”å›çš„æ˜¯PNGæ ¼å¼çš„å›¾ç‰‡äºŒè¿›åˆ¶æ•°æ®ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">curl</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//localhost:8050/render.png?url=https://www.taobao.com&amp;wait=5&amp;width=1000&amp;height=700</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œæˆ‘ä»¬ä¼ å…¥äº†widthå’Œheightæ¥è®¾ç½®é¡µé¢å¤§å°ä¸º1000Ã—700åƒç´ ã€‚</p>

    <p>å¦‚æœç”¨Pythonå®ç°ï¼Œå¯ä»¥å°†è¿”å›çš„äºŒè¿›åˆ¶æ•°æ®ä¿å­˜ä¸ºPNGæ ¼å¼çš„å›¾ç‰‡ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">import</span> <span class="nn">requests</span>

  <span class="n">url</span> <span class="o">=</span> <span class="s">'http://localhost:8050/render.png?url=https://www.jd.com&amp;wait=5&amp;width=1000&amp;height=700'</span>
  <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'taobao.png'</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
      <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>è¿™æ ·æˆ‘ä»¬å°±æˆåŠŸè·å–äº†äº¬ä¸œé¦–é¡µæ¸²æŸ“å®Œæˆåçš„é¡µé¢æˆªå›¾ï¼Œè¯¦ç»†çš„å‚æ•°è®¾ç½®å¯ä»¥å‚è€ƒå®˜ç½‘æ–‡æ¡£ https://splash.readthedocs.io/en/stable/api.html#render-png</p>
  </li>
  <li>
    <p>render.jpeg</p>

    <p>æ­¤æ¥å£å’Œrender.pngç±»ä¼¼ï¼Œä¸è¿‡å®ƒè¿”å›çš„æ˜¯JPEGæ ¼å¼çš„å›¾ç‰‡äºŒè¿›åˆ¶æ•°æ®ã€‚</p>

    <p>å¦å¤–ï¼Œæ­¤æ¥å£æ¯”render.pngå¤šäº†å‚æ•°qualityï¼Œå®ƒç”¨æ¥è®¾ç½®å›¾ç‰‡è´¨é‡ã€‚</p>
  </li>
  <li>
    <p>render.har</p>

    <p>æ­¤æ¥å£ç”¨äºè·å–é¡µé¢åŠ è½½çš„HARæ•°æ®ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">curl</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//localhost:8050/render.har?url=https://www.jd.com&amp;wait=5</span>
</code></pre></div>    </div>
    <p>å®ƒçš„è¿”å›ç»“æœï¼ˆå¦‚å›¾7-18æ‰€ç¤ºï¼‰éå¸¸å¤šï¼Œæ˜¯ä¸€ä¸ªJSONæ ¼å¼çš„æ•°æ®ï¼Œå…¶ä¸­åŒ…å«é¡µé¢åŠ è½½è¿‡ç¨‹ä¸­çš„HARæ•°æ®</p>
  </li>
  <li>
    <p>render.json</p>

    <p>æ­¤æ¥å£åŒ…å«äº†å‰é¢æ¥å£çš„æ‰€æœ‰åŠŸèƒ½ï¼Œè¿”å›ç»“æœæ˜¯JSONæ ¼å¼ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">curl</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//localhost:8050/render.json?url=https://httpbin.org</span>
</code></pre></div>    </div>
    <p>ç»“æœå¦‚ä¸‹ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {"title": "httpbin(1): HTTP Client Testing Service", "url": "https://httpbin.org/", "requestedUrl": "https://httpbin.org/", "geometry": [0, 0, 1024, 768]}
</code></pre></div>    </div>
    <p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œä»¥JSONå½¢å¼è¿”å›äº†ç›¸åº”çš„è¯·æ±‚æ•°æ®ã€‚</p>

    <p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ å…¥ä¸åŒå‚æ•°æ§åˆ¶å…¶è¿”å›ç»“æœã€‚æ¯”å¦‚ï¼Œä¼ å…¥html=1ï¼Œè¿”å›ç»“æœå³ä¼šå¢åŠ æºä»£ç æ•°æ®ï¼›ä¼ å…¥png=1ï¼Œè¿”å›ç»“æœå³ä¼šå¢åŠ é¡µé¢PNGæˆªå›¾æ•°æ®ï¼›ä¼ å…¥har=1ï¼Œåˆ™ä¼šè·å¾—é¡µé¢HARæ•°æ®ã€‚ä¾‹å¦‚ï¼š</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">curl</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//localhost:8050/render.json?url=https://httpbin.org&amp;html=1&amp;har=1</span>
</code></pre></div>    </div>
    <p>è¿™æ ·è¿”å›çš„JSONç»“æœä¼šåŒ…å«ç½‘é¡µæºä»£ç å’ŒHARæ•°æ®ã€‚</p>

    <p>æ­¤å¤–è¿˜æœ‰æ›´å¤šå‚æ•°è®¾ç½®ï¼Œå…·ä½“å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://splash.readthedocs.io/en/stable/api.html#render-json</p>
  </li>
  <li>
    <p>execute</p>

    <p>æ­¤æ¥å£æ‰æ˜¯æœ€ä¸ºå¼ºå¤§çš„æ¥å£ã€‚å‰é¢è¯´äº†å¾ˆå¤šSplash Luaè„šæœ¬çš„æ“ä½œï¼Œç”¨æ­¤æ¥å£ä¾¿å¯å®ç°ä¸Luaè„šæœ¬çš„å¯¹æ¥ã€‚</p>

    <p>å‰é¢çš„render.htmlå’Œrender.pngç­‰æ¥å£å¯¹äºä¸€èˆ¬çš„JavaScriptæ¸²æŸ“é¡µé¢æ˜¯è¶³å¤Ÿäº†ï¼Œä½†æ˜¯å¦‚æœè¦å®ç°ä¸€äº›äº¤äº’æ“ä½œçš„è¯ï¼Œå®ƒä»¬è¿˜æ˜¯æ— èƒ½ä¸ºåŠ›ï¼Œè¿™é‡Œå°±éœ€è¦ä½¿ç”¨executeæ¥å£äº†ã€‚</p>

    <p>æˆ‘ä»¬å…ˆå®ç°ä¸€ä¸ªæœ€ç®€å•çš„è„šæœ¬ï¼Œç›´æ¥è¿”å›æ•°æ®ï¼š</p>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="k">return</span> <span class="dl">'</span><span class="s1">hello</span><span class="dl">'</span>
  <span class="nx">end</span>
</code></pre></div>    </div>

    <p>ç„¶åå°†æ­¤è„šæœ¬è½¬åŒ–ä¸ºURLç¼–ç åçš„å­—ç¬¦ä¸²ï¼Œæ‹¼æ¥åˆ°executeæ¥å£åé¢ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">curl</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//localhost:8050/execute?lua_source=function+main%28splash%29%0D%0A++return+%27hello%27%0D%0Aend</span>
</code></pre></div>    </div>

    <p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  hello
</code></pre></div>    </div>

    <p>è¿™é‡Œæˆ‘ä»¬é€šè¿‡lua_sourceå‚æ•°ä¼ é€’äº†è½¬ç åçš„Luaè„šæœ¬ï¼Œé€šè¿‡executeæ¥å£è·å–äº†æœ€ç»ˆè„šæœ¬çš„æ‰§è¡Œç»“æœã€‚</p>

    <p>è¿™é‡Œæˆ‘ä»¬æ›´åŠ å…³å¿ƒçš„è‚¯å®šæ˜¯å¦‚ä½•ç”¨Pythonæ¥å®ç°ï¼Œä¸Šä¾‹ç”¨Pythonå®ç°çš„è¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">import</span> <span class="nn">requests</span>
  <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">quote</span>
     
  <span class="n">lua</span> <span class="o">=</span> <span class="s">'''
  function main(splash)
      return 'hello'
  end
  '''</span>
     
  <span class="n">url</span> <span class="o">=</span> <span class="s">'http://localhost:8050/execute?lua_source='</span> <span class="o">+</span> <span class="n">quote</span><span class="p">(</span><span class="n">lua</span><span class="p">)</span>
  <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>    </div>

    <p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  hello
</code></pre></div>    </div>

    <p>è¿™é‡Œæˆ‘ä»¬ç”¨Pythonä¸­çš„ä¸‰å¼•å·å°†Luaè„šæœ¬åŒ…æ‹¬èµ·æ¥ï¼Œç„¶åç”¨urllib.parseæ¨¡å—é‡Œçš„quote()æ–¹æ³•å°†è„šæœ¬è¿›è¡ŒURLè½¬ç ï¼Œéšåæ„é€ äº†Splashè¯·æ±‚URLï¼Œå°†å…¶ä½œä¸ºlua_sourceå‚æ•°ä¼ é€’ï¼Œè¿™æ ·è¿è¡Œç»“æœå°±ä¼šæ˜¾ç¤ºLuaè„šæœ¬æ‰§è¡Œåçš„ç»“æœã€‚</p>

    <p>æˆ‘ä»¬å†é€šè¿‡å®ä¾‹çœ‹ä¸€ä¸‹ï¼š</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">import</span> <span class="nn">requests</span>
  <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">quote</span>
     
  <span class="n">lua</span> <span class="o">=</span> <span class="s">'''
  function main(splash, args)
    local treat = require("treat")
    local response = splash:http_get("http://httpbin.org/get")
      return {
      html=treat.as_string(response.body),
      url=response.url,
      status=response.status
      }
  end
  '''</span>
     
  <span class="n">url</span> <span class="o">=</span> <span class="s">'http://localhost:8050/execute?lua_source='</span> <span class="o">+</span> <span class="n">quote</span><span class="p">(</span><span class="n">lua</span><span class="p">)</span>
  <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>    </div>

    <p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {"url": "http://httpbin.org/get", "status": 200, "html": "{\n  \"args\": {}, \n  \"headers\": {\n    \"Accept-Encoding\": \"gzip, deflate\", \n    \"Accept-Language\": \"en,*\", \n    \"Connection\": \"close\", \n    \"Host\": \"httpbin.org\", \n    \"User-Agent\": \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/602.1 (KHTML, like Gecko) splash Version/9.0 Safari/602.1\"\n  }, \n  \"origin\": \"60.207.237.85\", \n  \"url\": \"http://httpbin.org/get\"\n}\n"}
</code></pre></div>    </div>

    <p>å¯ä»¥çœ‹åˆ°ï¼Œè¿”å›ç»“æœæ˜¯JSONå½¢å¼ï¼Œæˆ‘ä»¬æˆåŠŸè·å–äº†è¯·æ±‚çš„URLã€çŠ¶æ€ç å’Œç½‘é¡µæºä»£ç ã€‚</p>

    <p>å¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„Luaè„šæœ¬å‡å¯ä»¥ç”¨æ­¤æ–¹å¼ä¸Pythonè¿›è¡Œå¯¹æ¥ï¼Œæ‰€æœ‰ç½‘é¡µçš„åŠ¨æ€æ¸²æŸ“ã€æ¨¡æ‹Ÿç‚¹å‡»ã€è¡¨å•æäº¤ã€é¡µé¢æ»‘åŠ¨ã€å»¶æ—¶ç­‰å¾…åçš„ä¸€äº›ç»“æœå‡å¯ä»¥è‡ªç”±æ§åˆ¶ï¼Œè·å–é¡µé¢æºç å’Œæˆªå›¾ä¹Ÿéƒ½ä¸åœ¨è¯ä¸‹</p>
  </li>
</ul>

<h3 id="splash-è´Ÿè½½å‡è¡¡é…ç½®">Splash è´Ÿè½½å‡è¡¡é…ç½®</h3>

<ol>
  <li>
    <p>é…ç½® Splash æœåŠ¡</p>

    <p>è¦æ­å»ºSplashè´Ÿè½½å‡è¡¡ï¼Œé¦–å…ˆè¦æœ‰å¤šä¸ªSplashæœåŠ¡ã€‚å‡å¦‚è¿™é‡Œåœ¨4å°è¿œç¨‹ä¸»æœºçš„8050ç«¯å£ä¸Šéƒ½å¼€å¯äº†SplashæœåŠ¡ï¼Œå®ƒä»¬çš„æœåŠ¡åœ°å€åˆ†åˆ«ä¸º41.159.27.223:8050ã€41.159.27.221:8050ã€41.159.27.9:8050å’Œ41.159.117.119:8050ï¼Œè¿™4ä¸ªæœåŠ¡å®Œå…¨ä¸€è‡´ï¼Œéƒ½æ˜¯é€šè¿‡Dockerçš„Splashé•œåƒå¼€å¯çš„ã€‚è®¿é—®å…¶ä¸­ä»»ä½•ä¸€ä¸ªæœåŠ¡æ—¶ï¼Œéƒ½å¯ä»¥ä½¿ç”¨SplashæœåŠ¡</p>
  </li>
  <li>
    <p>é…ç½®è´Ÿè½½å‡è¡¡</p>

    <p>æ¥ä¸‹æ¥ï¼Œå¯ä»¥é€‰ç”¨ä»»æ„ä¸€å°å¸¦æœ‰å…¬ç½‘IPçš„ä¸»æœºæ¥é…ç½®è´Ÿè½½å‡è¡¡ã€‚é¦–å…ˆï¼Œåœ¨è¿™å°ä¸»æœºä¸Šè£…å¥½Nginxï¼Œç„¶åä¿®æ”¹Nginxçš„é…ç½®æ–‡ä»¶nginx.confï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> http {
 upstream splash {
         least_conn;
         server 41.159.27.223:8050;
         server 41.159.27.221:8050;
         server 41.159.27.9:8050;
         server 41.159.117.119:8050;
     }
     server {
         listen 8050;
         location / {
             proxy_pass http://splash;
         }
     }
 }
</code></pre></div>    </div>
    <p>è¿™æ ·æˆ‘ä»¬é€šè¿‡upstreamå­—æ®µå®šä¹‰äº†ä¸€ä¸ªåå­—å«ä½œsplashçš„æœåŠ¡é›†ç¾¤é…ç½®ã€‚å…¶ä¸­least_connä»£è¡¨æœ€å°‘é“¾æ¥è´Ÿè½½å‡è¡¡ï¼Œå®ƒé€‚åˆå¤„ç†è¯·æ±‚å¤„ç†æ—¶é—´é•¿çŸ­ä¸ä¸€é€ æˆæœåŠ¡å™¨è¿‡è½½çš„æƒ…å†µã€‚</p>

    <p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸æŒ‡å®šé…ç½®ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> upstream splash {
     server 41.159.27.223:8050;
     server 41.159.27.221:8050;
     server 41.159.27.9:8050;
     server 41.159.117.119:8050;
 }
</code></pre></div>    </div>
    <p>è¿™æ ·é»˜è®¤ä»¥è½®è¯¢ç­–ç•¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œæ¯ä¸ªæœåŠ¡å™¨çš„å‹åŠ›ç›¸åŒã€‚æ­¤ç­–ç•¥é€‚åˆæœåŠ¡å™¨é…ç½®ç›¸å½“ã€æ— çŠ¶æ€ä¸”çŸ­å¹³å¿«çš„æœåŠ¡ä½¿ç”¨ã€‚</p>

    <p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®šæƒé‡ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> upstream splash {
     server 41.159.27.223:8050 weight=4;
     server 41.159.27.221:8050 weight=2;
     server 41.159.27.9:8050 weight=2;
     server 41.159.117.119:8050 weight=1;
 }
</code></pre></div>    </div>
    <p>æœåŠ¡å™¨æ ¹æ®è¯·æ±‚å®¢æˆ·ç«¯çš„IPåœ°å€è¿›è¡Œæ•£åˆ—è®¡ç®—ï¼Œç¡®ä¿ä½¿ç”¨åŒä¸€ä¸ªæœåŠ¡å™¨å“åº”è¯·æ±‚ï¼Œè¿™ç§ç­–ç•¥é€‚åˆæœ‰çŠ¶æ€çš„æœåŠ¡ï¼Œæ¯”å¦‚ç”¨æˆ·ç™»å½•åè®¿é—®æŸä¸ªé¡µé¢çš„æƒ…å½¢ã€‚å¯¹äºSplashæ¥è¯´ï¼Œä¸éœ€è¦åº”ç”¨æ­¤è®¾ç½®ã€‚</p>

    <p>æˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸åŒçš„æƒ…å½¢é€‰ç”¨ä¸åŒçš„é…ç½®ï¼Œé…ç½®å®Œæˆåé‡å¯ä¸€ä¸‹NginxæœåŠ¡ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> sudo nginx -s reload
</code></pre></div>    </div>
  </li>
  <li>
    <p>é…ç½®è®¤è¯</p>

    <p>ç°åœ¨Splashæ˜¯å¯ä»¥å…¬å¼€è®¿é—®çš„ï¼Œå¦‚æœä¸æƒ³è®©å…¶å…¬å¼€è®¿é—®ï¼Œè¿˜å¯ä»¥é…ç½®è®¤è¯ï¼Œè¿™ä»ç„¶å€ŸåŠ©äºNginxã€‚å¯ä»¥åœ¨serverçš„locationå­—æ®µä¸­æ·»åŠ auth_basicå’Œauth_basic_user_fileå­—æ®µï¼Œå…·ä½“é…ç½®å¦‚ä¸‹ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> http {
     upstream splash {
         least_conn;
         server 41.159.27.223:8050;
         server 41.159.27.221:8050;
         server 41.159.27.9:8050;
         server 41.159.117.119:8050;
     }
     server {
         listen 8050;
         location / {
             proxy_pass http://splash;
             auth_basic "Restricted";
             auth_basic_user_file /etc/nginx/conf.d/.htpasswd;
         }
     }
 }
</code></pre></div>    </div>
    <p>è¿™é‡Œä½¿ç”¨çš„ç”¨æˆ·åå’Œå¯†ç é…ç½®æ”¾ç½®åœ¨/etc/nginx/conf.dç›®å½•ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨htpasswdå‘½ä»¤åˆ›å»ºã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªç”¨æˆ·åä¸ºadminçš„æ–‡ä»¶ï¼Œç›¸å…³å‘½ä»¤å¦‚ä¸‹ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> htpasswd -c .htpasswd admin
</code></pre></div>    </div>
    <p>æ¥ä¸‹æ¥å°±ä¼šæç¤ºæˆ‘ä»¬è¾“å…¥å¯†ç ï¼Œè¾“å…¥ä¸¤æ¬¡ä¹‹åï¼Œå°±ä¼šç”Ÿæˆå¯†ç æ–‡ä»¶ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> cat .htpasswd 
 admin:5ZBxQr0rCqwbc
</code></pre></div>    </div>
    <p>é…ç½®å®Œæˆåï¼Œé‡å¯ä¸€ä¸‹NginxæœåŠ¡ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> sudo nginx -s reload
</code></pre></div>    </div>
    <p>è¿™æ ·è®¿é—®è®¤è¯å°±æˆåŠŸé…ç½®å¥½äº†ã€‚</p>
  </li>
  <li>
    <p>æµ‹è¯•</p>

    <p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä»£ç æ¥æµ‹è¯•ä¸€ä¸‹è´Ÿè½½å‡è¡¡çš„é…ç½®ï¼Œçœ‹çœ‹åˆ°åº•æ˜¯ä¸æ˜¯æ¯æ¬¡è¯·æ±‚ä¼šåˆ‡æ¢IPã€‚åˆ©ç”¨http://httpbin.org/getæµ‹è¯•å³å¯ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kn">import</span> <span class="nn">requests</span>
 <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">quote</span>
 <span class="kn">import</span> <span class="nn">re</span>

 <span class="n">lua</span> <span class="o">=</span> <span class="s">'''
 function main(splash, args)
 local treat = require("treat")
 local response = splash:http_get("http://httpbin.org/get")
 return treat.as_string(response.body)
 end
 '''</span>

 <span class="n">url</span> <span class="o">=</span> <span class="s">'http://splash:8050/execute?lua_source='</span> <span class="o">+</span> <span class="n">quote</span><span class="p">(</span><span class="n">lua</span><span class="p">)</span>
 <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="s">'admin'</span><span class="p">,</span> <span class="s">'admin'</span><span class="p">))</span>
 <span class="n">ip</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="s">'(\d+\.\d+\.\d+\.\d+)'</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">).</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
 <span class="k">print</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>è¿™é‡ŒURLä¸­çš„splashå­—ç¬¦ä¸²è¯·è‡ªè¡Œæ›¿æ¢æˆè‡ªå·±çš„NginxæœåŠ¡å™¨IPã€‚è¿™é‡Œæˆ‘ä¿®æ”¹äº†Hostsï¼Œè®¾ç½®äº†splashä¸ºNginxæœåŠ¡å™¨IPã€‚</p>

    <p>å¤šæ¬¡è¿è¡Œä»£ç ä¹‹åï¼Œå¯ä»¥å‘ç°æ¯æ¬¡è¯·æ±‚çš„IPéƒ½ä¼šå˜åŒ–ï¼Œæ¯”å¦‚ç¬¬ä¸€æ¬¡çš„ç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 41.159.27.223
</code></pre></div>    </div>
    <p>ç¬¬äºŒæ¬¡çš„ç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 41.159.27.9
</code></pre></div>    </div>
    <p>è¿™å°±è¯´æ˜è´Ÿè½½å‡è¡¡å·²ç»æˆåŠŸå®ç°äº†ã€‚
=======
â€”
layout: post
title: Splash çš„ä½¿ç”¨
subtitle: 
author: Balbo Cheng
categories: python
tags: [reptile]
â€”</p>
    <h2 id="splash-çš„ä½¿ç”¨-1">Splash çš„ä½¿ç”¨</h2>
    <h3 id="åŠŸèƒ½ä»‹ç»-1">åŠŸèƒ½ä»‹ç»</h3>
  </li>
  <li>å¼‚æ­¥æ–¹å¼å¤„ç†å¤šä¸ªç½‘é¡µæ¸²æŸ“è¿‡ç¨‹</li>
  <li>è·å–æ¸²æŸ“åçš„é¡µé¢çš„æºä»£ç æˆ–æˆªå›¾</li>
  <li>é€šè¿‡å…³é—­å›¾ç‰‡æ¸²æŸ“æˆ–è€…ä½¿ç”¨ Adblock è§„åˆ™æ¥åŠ å¿«é¡µé¢æ¸²æŸ“é€Ÿåº¦</li>
  <li>å¯æ‰§è¡Œç‰¹å®šçš„ JavaScript è„šæœ¬</li>
  <li>å¯é€šè¿‡ Lua è„šæœ¬æ¥æ§åˆ¶é¡µé¢æ¸²æŸ“è¿‡ç¨‹</li>
  <li>è·å–æ¸²æŸ“çš„è¯¦ç»†è¿‡ç¨‹å¹¶é€šè¿‡ HARï¼ˆHTTP Archiveï¼‰æ ¼å¼å‘ˆç°</li>
</ol>

<h3 id="ç¤ºä¾‹å¼•å…¥-1">ç¤ºä¾‹å¼•å…¥</h3>

<p>é¦–å…ˆï¼Œé€šè¿‡Splashæä¾›çš„Webé¡µé¢æ¥æµ‹è¯•å…¶æ¸²æŸ“è¿‡ç¨‹ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨æœ¬æœº8050ç«¯å£ä¸Šè¿è¡Œäº†SplashæœåŠ¡ï¼Œæ‰“å¼€http://localhost:8050/å³å¯çœ‹åˆ°å…¶Webé¡µé¢</p>

<p>åœ¨å›¾7-6å³ä¾§ï¼Œå‘ˆç°çš„æ˜¯ä¸€ä¸ªæ¸²æŸ“ç¤ºä¾‹ã€‚å¯ä»¥çœ‹åˆ°ï¼Œä¸Šæ–¹æœ‰ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œé»˜è®¤æ˜¯http://google.comï¼Œè¿™é‡Œæ¢æˆç™¾åº¦æµ‹è¯•ä¸€ä¸‹ï¼Œå°†å†…å®¹æ›´æ”¹ä¸ºhttps://www.baidu.comï¼Œç„¶åç‚¹å‡»Render meæŒ‰é’®å¼€å§‹æ¸²æŸ“</p>

<p>å¯ä»¥çœ‹åˆ°ï¼Œç½‘é¡µçš„è¿”å›ç»“æœå‘ˆç°äº†æ¸²æŸ“æˆªå›¾ã€HARåŠ è½½ç»Ÿè®¡æ•°æ®ã€ç½‘é¡µçš„æºä»£ç ã€‚</p>

<p>é€šè¿‡HARçš„ç»“æœå¯ä»¥çœ‹åˆ°ï¼ŒSplashæ‰§è¡Œäº†æ•´ä¸ªç½‘é¡µçš„æ¸²æŸ“è¿‡ç¨‹ï¼ŒåŒ…æ‹¬CSSã€JavaScriptçš„åŠ è½½ç­‰è¿‡ç¨‹ï¼Œå‘ˆç°çš„é¡µé¢å’Œæˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­å¾—åˆ°çš„ç»“æœå®Œå…¨ä¸€è‡´ã€‚</p>

<p>é‚£ä¹ˆï¼Œè¿™ä¸ªè¿‡ç¨‹ç”±ä»€ä¹ˆæ¥æ§åˆ¶å‘¢ï¼Ÿé‡æ–°è¿”å›é¦–é¡µï¼Œå¯ä»¥çœ‹åˆ°å®é™…ä¸Šæ˜¯æœ‰ä¸€æ®µè„šæœ¬ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
  <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">url</span><span class="p">))</span>
  <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">wait</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">html</span> <span class="o">=</span> <span class="na">splash</span><span class="p">:</span><span class="nx">html</span><span class="p">(),</span>
    <span class="nx">png</span> <span class="o">=</span> <span class="na">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">(),</span>
    <span class="nx">har</span> <span class="o">=</span> <span class="na">splash</span><span class="p">:</span><span class="nx">har</span><span class="p">(),</span>
  <span class="p">}</span>
<span class="nx">end</span>
</code></pre></div></div>
<p>è¿™ä¸ªè„šæœ¬å®é™…ä¸Šæ˜¯ç”¨Luaè¯­è¨€å†™çš„è„šæœ¬ã€‚å³ä½¿ä¸æ‡‚è¿™ä¸ªè¯­è¨€çš„è¯­æ³•ï¼Œä½†ä»è„šæœ¬çš„è¡¨é¢æ„æ€ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¤§è‡´äº†è§£åˆ°å®ƒé¦–å…ˆè°ƒç”¨go()æ–¹æ³•å»åŠ è½½é¡µé¢ï¼Œç„¶åè°ƒç”¨wait()æ–¹æ³•ç­‰å¾…äº†ä¸€å®šæ—¶é—´ï¼Œæœ€åè¿”å›äº†é¡µé¢çš„æºç ã€æˆªå›¾å’ŒHARä¿¡æ¯ã€‚</p>

<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¤§ä½“äº†è§£äº†Splashæ˜¯é€šè¿‡Luaè„šæœ¬æ¥æ§åˆ¶äº†é¡µé¢çš„åŠ è½½è¿‡ç¨‹çš„ï¼ŒåŠ è½½è¿‡ç¨‹å®Œå…¨æ¨¡æ‹Ÿæµè§ˆå™¨ï¼Œæœ€åå¯è¿”å›å„ç§æ ¼å¼çš„ç»“æœï¼Œå¦‚ç½‘é¡µæºç å’Œæˆªå›¾ç­‰ã€‚</p>

<h3 id="splash-luaè„šæœ¬-1">Splash Luaè„šæœ¬</h3>

<p>Splashå¯ä»¥é€šè¿‡Luaè„šæœ¬æ‰§è¡Œä¸€ç³»åˆ—æ¸²æŸ“æ“ä½œï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç”¨Splashæ¥æ¨¡æ‹Ÿç±»ä¼¼Chromeã€PhantomJSçš„æ“ä½œäº†ã€‚</p>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹Splash Luaè„šæœ¬çš„å…¥å£å’Œæ‰§è¡Œæ–¹å¼ã€‚</p>

<ul>
  <li>
    <p>äººå£åŠè¿”å›å€¼</p>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
  <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://www.baidu.com</span><span class="dl">"</span><span class="p">)</span>
  <span class="nx">splash</span><span class="p">:</span><span class="nx">wait</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
  <span class="nx">local</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">evaljs</span><span class="p">(</span><span class="dl">"</span><span class="s2">document.title</span><span class="dl">"</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">{</span><span class="nx">title</span><span class="o">=</span><span class="nx">title</span><span class="p">}</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>æˆ‘ä»¬å°†ä»£ç ç²˜è´´åˆ°åˆšæ‰æ‰“å¼€çš„http://localhost:8050/çš„ä»£ç ç¼–è¾‘åŒºåŸŸï¼Œç„¶åç‚¹å‡»Render me!æŒ‰é’®æ¥æµ‹è¯•ä¸€ä¸‹ã€‚</p>

    <p>æˆ‘ä»¬çœ‹åˆ°å®ƒè¿”å›äº†ç½‘é¡µçš„æ ‡é¢˜ï¼Œå¦‚å›¾7-8æ‰€ç¤ºã€‚è¿™é‡Œæˆ‘ä»¬é€šè¿‡evaljs()æ–¹æ³•ä¼ å…¥JavaScriptè„šæœ¬ï¼Œè€Œdocument.titleçš„æ‰§è¡Œç»“æœå°±æ˜¯è¿”å›ç½‘é¡µæ ‡é¢˜ï¼Œæ‰§è¡Œå®Œæ¯•åå°†å…¶èµ‹å€¼ç»™ä¸€ä¸ªtitleå˜é‡ï¼Œéšåå°†å…¶è¿”å›ã€‚</p>

    <p>æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå®šä¹‰çš„æ–¹æ³•åç§°å«ä½œmain()ã€‚è¿™ä¸ªåç§°å¿…é¡»æ˜¯å›ºå®šçš„ï¼ŒSplashä¼šé»˜è®¤è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p>

    <p>è¯¥æ–¹æ³•çš„è¿”å›å€¼æ—¢å¯ä»¥æ˜¯å­—å…¸å½¢å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²å½¢å¼ï¼Œæœ€åéƒ½ä¼šè½¬åŒ–ä¸ºSplash HTTP Response</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="k">return</span> <span class="p">{</span><span class="nx">hello</span><span class="o">=</span><span class="dl">"</span><span class="s2">world!</span><span class="dl">"</span><span class="p">}</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿”å›äº†ä¸€ä¸ªå­—å…¸å½¢å¼çš„å†…å®¹</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="k">return</span> <span class="dl">'</span><span class="s1">hello</span><span class="dl">'</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿”å›äº†ä¸€ä¸ªå­—ç¬¦ä¸²å½¢å¼çš„å†…å®¹</p>
  </li>
  <li>
    <p>å¼‚æ­¥å¤„ç†</p>

    <p>Splashæ”¯æŒå¼‚æ­¥å¤„ç†ï¼Œä½†æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰æ˜¾å¼æŒ‡æ˜å›è°ƒæ–¹æ³•ï¼Œå…¶å›è°ƒçš„è·³è½¬æ˜¯åœ¨Splashå†…éƒ¨å®Œæˆçš„</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">example_urls</span> <span class="o">=</span> <span class="p">{</span><span class="dl">"</span><span class="s2">www.baidu.com</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">www.taobao.com</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">www.zhihu.com</span><span class="dl">"</span><span class="p">}</span>
      <span class="nx">local</span> <span class="nx">urls</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">urls</span> <span class="nx">or</span> <span class="nx">example_urls</span>
      <span class="nx">local</span> <span class="nx">results</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="k">for</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">url</span> <span class="k">in</span> <span class="nx">ipairs</span><span class="p">(</span><span class="nx">urls</span><span class="p">)</span> <span class="k">do</span>
          <span class="nx">local</span> <span class="nx">ok</span><span class="p">,</span> <span class="nx">reason</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://</span><span class="dl">"</span> <span class="p">..</span> <span class="nx">url</span><span class="p">)</span>
          <span class="k">if</span> <span class="nx">ok</span> <span class="nx">then</span>
          <span class="nx">splash</span><span class="p">:</span><span class="nx">wait</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
          <span class="nx">results</span><span class="p">[</span><span class="nx">url</span><span class="p">]</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()</span>
          <span class="nx">end</span>
      <span class="nx">end</span>
      <span class="k">return</span> <span class="nx">results</span>
  <span class="nx">end</span>
</code></pre></div>    </div>

    <p>åœ¨è„šæœ¬å†…è°ƒç”¨çš„wait()æ–¹æ³•ç±»ä¼¼äºPythonä¸­çš„sleep()ï¼Œå…¶å‚æ•°ä¸ºç­‰å¾…çš„ç§’æ•°ã€‚å½“Splashæ‰§è¡Œåˆ°æ­¤æ–¹æ³•æ—¶ï¼Œå®ƒä¼šè½¬è€Œå»å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œç„¶ååœ¨æŒ‡å®šçš„æ—¶é—´è¿‡åå†å›æ¥ç»§ç»­å¤„ç†ã€‚</p>

    <p>è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒLuaè„šæœ¬ä¸­çš„å­—ç¬¦ä¸²æ‹¼æ¥å’ŒPythonä¸åŒï¼Œå®ƒä½¿ç”¨çš„æ˜¯..æ“ä½œç¬¦ï¼Œè€Œä¸æ˜¯+ã€‚å¦‚æœæœ‰å¿…è¦ï¼Œå¯ä»¥ç®€å•äº†è§£ä¸€ä¸‹Luaè„šæœ¬çš„è¯­æ³•ï¼Œè¯¦è§http://www.runoob.com/lua/lua-basic-syntax.htmlã€‚</p>

    <p>å¦å¤–ï¼Œè¿™é‡Œåšäº†åŠ è½½æ—¶çš„å¼‚å¸¸æ£€æµ‹ã€‚go()æ–¹æ³•ä¼šè¿”å›åŠ è½½é¡µé¢çš„ç»“æœçŠ¶æ€ï¼Œå¦‚æœé¡µé¢å‡ºç°4xxæˆ–5xxçŠ¶æ€ç ï¼Œokå˜é‡å°±ä¸ºç©ºï¼Œå°±ä¸ä¼šè¿”å›åŠ è½½åçš„å›¾ç‰‡</p>
  </li>
</ul>

<h3 id="splash-å¯¹è±¡å±æ€§-1">Splash å¯¹è±¡å±æ€§</h3>

<ul>
  <li>
    <p>args</p>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">url</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œç¬¬äºŒä¸ªå‚æ•°argså°±ç›¸å½“äºsplash.argså±æ€§ï¼Œä»¥ä¸Šä»£ç ç­‰ä»·äº:</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">url</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>js_enabled</p>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.baidu.com</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">.</span><span class="nx">js_enabled</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="nx">local</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">evaljs</span><span class="p">(</span><span class="dl">"</span><span class="s2">document.title</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="p">{</span><span class="nx">title</span><span class="o">=</span><span class="nx">title</span><span class="p">}</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>é‡æ–°è°ƒç”¨äº†evaljs()æ–¹æ³•æ‰§è¡ŒJavaScriptä»£ç ï¼Œæ­¤æ—¶è¿è¡Œç»“æœå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
      "error": 400,
      "type": "ScriptError",
      "info": {
          "type": "JS_ERROR",
          "js_error_message": null,
          "source": "[string \"function main(splash, args)\r...\"]",
          "message": "[string \"function main(splash, args)\r...\"]:4: unknown JS error: None",
          "line_number": 4,
          "error": "unknown JS error: None",
          "splash_method": "evaljs"
      },
      "description": "Error happened while executing Lua script"
  }
</code></pre></div>    </div>
    <p>ä¸€èˆ¬æ¥è¯´ï¼Œä¸ç”¨è®¾ç½®æ­¤å±æ€§ï¼Œé»˜è®¤å¼€å¯å³å¯ã€‚</p>
  </li>
  <li>
    <p>resource_timeout</p>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">.</span><span class="nx">resource_timeout</span> <span class="o">=</span> <span class="mf">0.1</span>
      <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://www.taobao.com</span><span class="dl">'</span><span class="p">))</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œå°†è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º0.1ç§’ã€‚å¦‚æœåœ¨0.1ç§’ä¹‹å†…æ²¡æœ‰å¾—åˆ°å“åº”ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {
      "error": 400,
      "type": "ScriptError",
      "info": {
          "error": "network5",
          "type": "LUA_ERROR",
          "line_number": 3,
          "source": "[string \"function main(splash)\r...\"]",
          "message": "Lua error: [string \"function main(splash)\r...\"]:3: network5"
      },
      "description": "Error happened while executing Lua script"
  }
</code></pre></div>    </div>
    <p>æ­¤å±æ€§é€‚åˆåœ¨ç½‘é¡µåŠ è½½é€Ÿåº¦è¾ƒæ…¢çš„æƒ…å†µä¸‹è®¾ç½®ã€‚å¦‚æœè¶…è¿‡äº†æŸä¸ªæ—¶é—´æ— å“åº”ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸å¹¶å¿½ç•¥å³å¯ã€‚</p>
  </li>
  <li>
    <p>images_enable</p>

    <p>æ­¤å±æ€§å¯ä»¥è®¾ç½®å›¾ç‰‡æ˜¯å¦åŠ è½½ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯åŠ è½½çš„ã€‚ç¦ç”¨è¯¥å±æ€§åï¼Œå¯ä»¥èŠ‚çœç½‘ç»œæµé‡å¹¶æé«˜ç½‘é¡µåŠ è½½é€Ÿåº¦ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¦ç”¨å›¾ç‰‡åŠ è½½å¯èƒ½ä¼šå½±å“JavaScriptæ¸²æŸ“ã€‚å› ä¸ºç¦ç”¨å›¾ç‰‡ä¹‹åï¼Œå®ƒçš„å¤–å±‚DOMèŠ‚ç‚¹çš„é«˜åº¦ä¼šå—å½±å“ï¼Œè¿›è€Œå½±å“DOMèŠ‚ç‚¹çš„ä½ç½®ã€‚å› æ­¤ï¼Œå¦‚æœJavaScriptå¯¹å›¾ç‰‡èŠ‚ç‚¹æœ‰æ“ä½œçš„è¯ï¼Œå…¶æ‰§è¡Œå°±ä¼šå—åˆ°å½±å“ã€‚</p>

    <p>å¦å¤–å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒSplashä½¿ç”¨äº†ç¼“å­˜ã€‚å¦‚æœä¸€å¼€å§‹åŠ è½½å‡ºæ¥äº†ç½‘é¡µå›¾ç‰‡ï¼Œç„¶åç¦ç”¨äº†å›¾ç‰‡åŠ è½½ï¼Œå†é‡æ–°åŠ è½½é¡µé¢ï¼Œä¹‹å‰åŠ è½½å¥½çš„å›¾ç‰‡å¯èƒ½è¿˜ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œè¿™æ—¶ç›´æ¥é‡å¯Splashå³å¯ã€‚</p>

    <p>ç¦ç”¨å›¾ç‰‡åŠ è½½çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">.</span><span class="nx">images_enabled</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://www.jd.com</span><span class="dl">'</span><span class="p">))</span>
      <span class="k">return</span> <span class="p">{</span><span class="nx">png</span><span class="o">=</span><span class="na">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()}</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™æ ·è¿”å›çš„é¡µé¢æˆªå›¾å°±ä¸ä¼šå¸¦æœ‰ä»»ä½•å›¾ç‰‡ï¼ŒåŠ è½½é€Ÿåº¦ä¹Ÿä¼šå¿«å¾ˆå¤šã€‚</p>
  </li>
  <li>
    <p>plugins_enable</p>

    <p>æ­¤å±æ€§å¯ä»¥æ§åˆ¶æµè§ˆå™¨æ’ä»¶ï¼ˆå¦‚Flashæ’ä»¶ï¼‰æ˜¯å¦å¼€å¯ã€‚</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">splash</span><span class="p">.</span><span class="nx">plugins_enabled</span> <span class="o">=</span> <span class="kc">true</span><span class="o">/</span><span class="kc">false</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>scroll_position</p>

    <p>é€šè¿‡è®¾ç½®æ­¤å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶é¡µé¢ä¸Šä¸‹æˆ–å·¦å³æ»šåŠ¨</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://www.taobao.com</span><span class="dl">'</span><span class="p">))</span>
      <span class="nx">splash</span><span class="p">.</span><span class="nx">scroll_position</span> <span class="o">=</span> <span class="p">{</span><span class="nx">y</span><span class="o">=</span><span class="mi">400</span><span class="p">}</span>
      <span class="k">return</span> <span class="p">{</span><span class="nx">png</span><span class="o">=</span><span class="na">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()}</span>
  <span class="nx">end</span>
</code></pre></div>    </div>

    <p>å¦‚æœè¦è®©é¡µé¢å·¦å³æ»šåŠ¨ï¼Œå¯ä»¥ä¼ å…¥xå‚æ•°</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">splash</span><span class="p">.</span><span class="nx">scroll_position</span> <span class="o">=</span> <span class="p">{</span><span class="nx">x</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="nx">y</span><span class="o">=</span><span class="mi">200</span><span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="splash-å¯¹è±¡çš„æ–¹æ³•-1">Splash å¯¹è±¡çš„æ–¹æ³•</h3>

<ul>
  <li>
    <p>go()</p>

    <p>è¯¥æ–¹æ³•ç”¨æ¥è¯·æ±‚æŸä¸ªé“¾æ¥ï¼Œè€Œä¸”å®ƒå¯ä»¥æ¨¡æ‹ŸGETå’ŒPOSTè¯·æ±‚ï¼ŒåŒæ—¶æ”¯æŒä¼ å…¥è¯·æ±‚å¤´ã€è¡¨å•ç­‰æ•°æ®</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">ok</span><span class="p">,</span> <span class="nx">reason</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">{</span><span class="nx">url</span><span class="p">,</span> <span class="nx">baseurl</span><span class="o">=</span><span class="nx">nil</span><span class="p">,</span> <span class="nx">headers</span><span class="o">=</span><span class="nx">nil</span><span class="p">,</span> <span class="nx">http_method</span><span class="o">=</span><span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">,</span> <span class="nx">body</span><span class="o">=</span><span class="nx">nil</span><span class="p">,</span> <span class="nx">formdata</span><span class="o">=</span><span class="nx">nil</span><span class="p">}</span>
</code></pre></div>    </div>

    <ul>
      <li>url: è¯·æ±‚çš„URL</li>
      <li>baseurl: å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºç©ºï¼Œè¡¨ç¤ºèµ„æºåŠ è½½ç›¸å¯¹è·¯å¾„</li>
      <li>headers: å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºç©ºï¼Œè¡¨ç¤ºè¯·æ±‚å¤´</li>
      <li>http_method: å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºGETï¼ŒåŒæ—¶æ”¯æŒPOST</li>
      <li>body: å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºç©ºï¼Œå‘POSTè¯·æ±‚æ—¶çš„è¡¨å•æ•°æ®ï¼Œä½¿ç”¨çš„Content-typeä¸ºapplication/json</li>
      <li>formdata: å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºç©ºï¼ŒPOSTçš„æ—¶å€™çš„è¡¨å•æ•°æ®ï¼Œä½¿ç”¨çš„Content-typeä¸ºapplication/x-www-form-urlencoded</li>
    </ul>

    <p>è¯¥æ–¹æ³•çš„è¿”å›ç»“æœæ˜¯ç»“æœokå’ŒåŸå› reasonçš„ç»„åˆï¼Œå¦‚æœokä¸ºç©ºï¼Œä»£è¡¨ç½‘é¡µåŠ è½½å‡ºç°äº†é”™è¯¯ï¼Œæ­¤æ—¶reasonå˜é‡ä¸­åŒ…å«äº†é”™è¯¯çš„åŸå› ï¼Œå¦åˆ™è¯æ˜é¡µé¢åŠ è½½æˆåŠŸ</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">ok</span><span class="p">,</span> <span class="nx">reason</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">{</span><span class="dl">"</span><span class="s2">http://httpbin.org/post</span><span class="dl">"</span><span class="p">,</span> <span class="nx">http_method</span><span class="o">=</span><span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span> <span class="nx">body</span><span class="o">=</span><span class="dl">"</span><span class="s2">name=Germey</span><span class="dl">"</span><span class="p">}</span>
      <span class="k">if</span> <span class="nx">ok</span> <span class="nx">then</span>
              <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">html</span><span class="p">()</span>
      <span class="nx">end</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿäº†ä¸€ä¸ªPOSTè¯·æ±‚ï¼Œå¹¶ä¼ å…¥äº†POSTçš„è¡¨å•æ•°æ®ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™è¿”å›é¡µé¢çš„æºä»£ç </p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;pre style="word-wrap: break-word; white-space: pre-wrap;"&gt;{
  "args": {}, 
  "data": "", 
  "files": {}, 
  "form": {
      "name": "Germey"
  }, 
  "headers": {
      "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", 
      "Accept-Encoding": "gzip, deflate", 
      "Accept-Language": "en,*", 
      "Connection": "close", 
      "Content-Length": "11", 
      "Content-Type": "application/x-www-form-urlencoded", 
      "Host": "httpbin.org", 
      "Origin": "null", 
      "User-Agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/602.1 (KHTML, like Gecko) splash Version/9.0 Safari/602.1"
  }, 
  "json": null, 
  "origin": "60.207.237.85", 
  "url": "http://httpbin.org/post"
  }
  &lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre></div>    </div>
  </li>
  <li>
    <p>wait()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥æ§åˆ¶é¡µé¢çš„ç­‰å¾…æ—¶é—´</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">ok</span><span class="p">,</span> <span class="nx">reason</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">wait</span><span class="p">{</span><span class="nx">time</span><span class="p">,</span> <span class="nx">cancel_on_redirect</span><span class="o">=</span><span class="kc">false</span><span class="p">,</span> <span class="nx">cancel_on_error</span><span class="o">=</span><span class="kc">true</span><span class="p">}</span>
</code></pre></div>    </div>

    <ul>
      <li>time: ç­‰å¾…çš„ç§’æ•°</li>
      <li>cancel_on_redirect: å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºfalseï¼Œè¡¨ç¤ºå¦‚æœå‘ç”Ÿäº†é‡å®šå‘å°±åœæ­¢ç­‰å¾…ï¼Œå¹¶è¿”å›é‡å®šå‘ç»“æœ</li>
      <li>cancel_on_error: å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºfalseï¼Œè¡¨ç¤ºå¦‚æœå‘ç”Ÿäº†åŠ è½½é”™è¯¯ï¼Œå°±åœæ­¢ç­‰å¾…</li>
    </ul>

    <p>è¿”å›ç»“æœåŒæ ·æ˜¯ç»“æœokå’ŒåŸå› reasonçš„ç»„åˆ</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.taobao.com</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">wait</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
      <span class="k">return</span> <span class="p">{</span><span class="nx">html</span><span class="o">=</span><span class="na">splash</span><span class="p">:</span><span class="nx">html</span><span class="p">()}</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>jsfunc()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥ç›´æ¥è°ƒç”¨JavaScriptå®šä¹‰çš„æ–¹æ³•ï¼Œä½†æ˜¯æ‰€è°ƒç”¨çš„æ–¹æ³•éœ€è¦ç”¨åŒä¸­æ‹¬å·åŒ…å›´ï¼Œè¿™ç›¸å½“äºå®ç°äº†JavaScriptæ–¹æ³•åˆ°Luaè„šæœ¬çš„è½¬æ¢</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">get_div_count</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">jsfunc</span><span class="p">([[</span>
      <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">divs</span> <span class="o">=</span> <span class="nx">body</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">divs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="p">]])</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.baidu.com</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="p">(</span><span class="dl">"</span><span class="s2">There are %s DIVs</span><span class="dl">"</span><span class="p">):</span><span class="nx">format</span><span class="p">(</span>
          <span class="nx">get_div_count</span><span class="p">())</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  There are 21 DIVs
</code></pre></div>    </div>
    <p>é¦–å…ˆï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªJavaScriptå®šä¹‰çš„æ–¹æ³•ï¼Œç„¶ååœ¨é¡µé¢åŠ è½½æˆåŠŸåè°ƒç”¨äº†æ­¤æ–¹æ³•è®¡ç®—å‡ºäº†é¡µé¢ä¸­divèŠ‚ç‚¹çš„ä¸ªæ•°ã€‚</p>

    <p>å…³äºJavaScriptåˆ°Luaè„šæœ¬çš„æ›´å¤šè½¬æ¢ç»†èŠ‚ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://splash.readthedocs.io/en/stable/scripting-ref.html#splash-jsfunc</p>
  </li>
  <li>
    <p>evaljs()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥æ‰§è¡ŒJavaScriptä»£ç å¹¶è¿”å›æœ€åä¸€æ¡JavaScriptè¯­å¥çš„è¿”å›ç»“æœ</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">result</span> <span class="o">=</span> <span class="n">splash</span><span class="p">:</span><span class="n">evaljs</span><span class="p">(</span><span class="n">js</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>æ¯”å¦‚</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">local</span> <span class="n">title</span> <span class="o">=</span> <span class="n">splash</span><span class="p">:</span><span class="n">evaljs</span><span class="p">(</span><span class="s">"document.title"</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>runjs()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥æ‰§è¡ŒJavaScriptä»£ç ï¼Œå®ƒä¸evaljs()çš„åŠŸèƒ½ç±»ä¼¼ï¼Œä½†æ˜¯æ›´åå‘äºæ‰§è¡ŒæŸäº›åŠ¨ä½œæˆ–å£°æ˜æŸäº›æ–¹æ³•</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.baidu.com</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">runjs</span><span class="p">(</span><span class="dl">"</span><span class="s2">foo = function() { return 'bar' }</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">evaljs</span><span class="p">(</span><span class="dl">"</span><span class="s2">foo()</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">result</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œæˆ‘ä»¬ç”¨runjs()å…ˆå£°æ˜äº†ä¸€ä¸ªJavaScriptå®šä¹‰çš„æ–¹æ³•ï¼Œç„¶åé€šè¿‡evaljs()æ¥è°ƒç”¨å¾—åˆ°çš„ç»“æœ</p>

    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  bar
</code></pre></div>    </div>
  </li>
  <li>
    <p>autoload()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥è®¾ç½®æ¯ä¸ªé¡µé¢è®¿é—®æ—¶è‡ªåŠ¨åŠ è½½çš„å¯¹è±¡</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">ok</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="n">splash</span><span class="p">:</span><span class="n">autoload</span><span class="p">{</span><span class="n">source_or_url</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">nil</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">nil</span><span class="p">}</span>
</code></pre></div>    </div>

    <ul>
      <li>source_or_url: JavaScriptä»£ç æˆ–è€…JavaScriptåº“é“¾æ¥</li>
      <li>source: JavaScriptä»£ç </li>
      <li>url: JavaScriptåº“é“¾æ¥</li>
    </ul>

    <p>ä½†æ˜¯æ­¤æ–¹æ³•åªè´Ÿè´£åŠ è½½JavaScriptä»£ç æˆ–åº“ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚å¦‚æœè¦æ‰§è¡Œæ“ä½œï¼Œå¯ä»¥è°ƒç”¨evaljs()æˆ–runjs()æ–¹æ³•</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">autoload</span><span class="p">([[</span>
          <span class="kd">function</span> <span class="nx">get_document_title</span><span class="p">(){</span>
          <span class="k">return</span> <span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
          <span class="p">}</span>
      <span class="p">]])</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.baidu.com</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">evaljs</span><span class="p">(</span><span class="dl">"</span><span class="s2">get_document_title()</span><span class="dl">"</span><span class="p">)</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œæˆ‘ä»¬è°ƒç”¨autoload()æ–¹æ³•å£°æ˜äº†ä¸€ä¸ªJavaScriptæ–¹æ³•ï¼Œç„¶åé€šè¿‡evaljs()æ–¹æ³•æ¥æ‰§è¡Œæ­¤JavaScriptæ–¹æ³•</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ç™¾åº¦ä¸€ä¸‹ï¼Œä½ å°±çŸ¥é“
</code></pre></div>    </div>
    <p>å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨autoload()æ–¹æ³•åŠ è½½æŸäº›æ–¹æ³•åº“ï¼Œå¦‚jQuery</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">autoload</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://code.jquery.com/jquery-2.1.3.min.js</span><span class="dl">"</span><span class="p">))</span>
      <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.taobao.com</span><span class="dl">"</span><span class="p">))</span>
      <span class="nx">local</span> <span class="nx">version</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">evaljs</span><span class="p">(</span><span class="dl">"</span><span class="s2">$.fn.jquery</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="dl">'</span><span class="s1">JQuery version: </span><span class="dl">'</span> <span class="p">..</span> <span class="nx">version</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  JQuery version: 2.1.3
</code></pre></div>    </div>
  </li>
  <li>
    <p>call_later()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥é€šè¿‡è®¾ç½®å®šæ—¶ä»»åŠ¡å’Œå»¶è¿Ÿæ—¶é—´æ¥å®ç°ä»»åŠ¡å»¶æ—¶æ‰§è¡Œï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ‰§è¡Œå‰é€šè¿‡cancel()æ–¹æ³•é‡æ–°æ‰§è¡Œå®šæ—¶ä»»åŠ¡</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">snapshots</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="nx">local</span> <span class="nx">timer</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">call_later</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span>
          <span class="nx">snapshots</span><span class="p">[</span><span class="dl">"</span><span class="s2">a</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()</span>
          <span class="nx">splash</span><span class="p">:</span><span class="nx">wait</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
          <span class="nx">snapshots</span><span class="p">[</span><span class="dl">"</span><span class="s2">b</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()</span>
      <span class="nx">end</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.taobao.com</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">wait</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">snapshots</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œæˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œ0.2ç§’çš„æ—¶å€™è·å–ç½‘é¡µæˆªå›¾ï¼Œç„¶åç­‰å¾…1ç§’ï¼Œ1.2ç§’æ—¶å†æ¬¡è·å–ç½‘é¡µæˆªå›¾ï¼Œè®¿é—®çš„é¡µé¢æ˜¯æ·˜å®ï¼Œæœ€åå°†æˆªå›¾ç»“æœè¿”å›</p>
  </li>
  <li>
    <p>http_get()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥æ¨¡æ‹Ÿå‘é€HTTPçš„GETè¯·æ±‚</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">response</span> <span class="o">=</span> <span class="n">splash</span><span class="p">:</span><span class="n">http_get</span><span class="p">{</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">nil</span><span class="p">,</span> <span class="n">follow_redirects</span><span class="o">=</span><span class="n">true</span><span class="p">}</span>
</code></pre></div>    </div>

    <ul>
      <li>url: è¯·æ±‚URL</li>
      <li>headers: å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºç©ºï¼Œè¯·æ±‚å¤´</li>
      <li>follow_redirects: å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºæ˜¯å¦å¯åŠ¨è‡ªåŠ¨é‡å®šå‘ï¼Œé»˜è®¤ä¸ºtrue</li>
    </ul>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">treat</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">treat</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">http_get</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://httpbin.org/get</span><span class="dl">"</span><span class="p">)</span>
          <span class="k">return</span> <span class="p">{</span>
          <span class="nx">html</span><span class="o">=</span><span class="nx">treat</span><span class="p">.</span><span class="nx">as_string</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">),</span>
          <span class="nx">url</span><span class="o">=</span><span class="nx">response</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
          <span class="nx">status</span><span class="o">=</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span>
          <span class="p">}</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Splash Response: Object
  html: String (length 355)
  {
  "args": {}, 
  "headers": {
      "Accept-Encoding": "gzip, deflate", 
      "Accept-Language": "en,*", 
      "Connection": "close", 
      "Host": "httpbin.org", 
      "User-Agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/602.1 (KHTML, like Gecko) splash Version/9.0 Safari/602.1"
  }, 
  "origin": "60.207.237.85", 
  "url": "http://httpbin.org/get"
  }
  status: 200
  url: "http://httpbin.org/get"
</code></pre></div>    </div>
  </li>
  <li>
    <p>http_post()</p>

    <p>å’Œhttp_get()æ–¹æ³•ç±»ä¼¼ï¼Œæ­¤æ–¹æ³•ç”¨æ¥æ¨¡æ‹Ÿå‘é€POSTè¯·æ±‚ï¼Œä¸è¿‡å¤šäº†ä¸€ä¸ªå‚æ•°body</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  response = splash:http_post{url, headers=nil, follow_redirects=true, body=nil}
</code></pre></div>    </div>

    <ul>
      <li>url: è¯·æ±‚URL</li>
      <li>headers: å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºç©ºï¼Œè¯·æ±‚å¤´</li>
      <li>follow_redirects: å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºæ˜¯å¦å¯åŠ¨è‡ªåŠ¨é‡å®šå‘ï¼Œé»˜è®¤ä¸ºtrue</li>
      <li>body: å¯é€‰å‚æ•°ï¼Œå³è¡¨å•æ•°æ®ï¼Œé»˜è®¤ä¸ºç©º</li>
    </ul>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">treat</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">treat</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">json</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">http_post</span><span class="p">{</span><span class="dl">"</span><span class="s2">http://httpbin.org/post</span><span class="dl">"</span><span class="p">,</span>     
          <span class="nx">body</span><span class="o">=</span><span class="nx">json</span><span class="p">.</span><span class="nx">encode</span><span class="p">({</span><span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">Germey</span><span class="dl">"</span><span class="p">}),</span>
          <span class="nx">headers</span><span class="o">=</span><span class="p">{[</span><span class="dl">"</span><span class="s2">content-type</span><span class="dl">"</span><span class="p">]</span><span class="o">=</span><span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">}</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="p">{</span>
          <span class="nx">html</span><span class="o">=</span><span class="nx">treat</span><span class="p">.</span><span class="nx">as_string</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">),</span>
          <span class="nx">url</span><span class="o">=</span><span class="nx">response</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
          <span class="nx">status</span><span class="o">=</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span>
          <span class="p">}</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Splash Response: Object
  html: String (length 533)
  {
  "args": {}, 
  "data": "{\"name\": \"Germey\"}", 
  "files": {}, 
  "form": {}, 
  "headers": {
      "Accept-Encoding": "gzip, deflate", 
      "Accept-Language": "en,*", 
      "Connection": "close", 
      "Content-Length": "18", 
      "Content-Type": "application/json", 
      "Host": "httpbin.org", 
      "User-Agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/602.1 (KHTML, like Gecko) splash Version/9.0 Safari/602.1"
  }, 
  "json": {
      "name": "Germey"
  }, 
  "origin": "60.207.237.85", 
  "url": "http://httpbin.org/post"
  }
  status: 200
  url: "http://httpbin.org/post"
</code></pre></div>    </div>
  </li>
  <li>
    <p>set_content()</p>

    <p>æ­¤æ–¹æ³•ç”¨æ¥è®¾ç½®é¡µé¢çš„å†…å®¹</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">set_content</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;html&gt;&lt;body&gt;&lt;h1&gt;hello&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><span class="dl">"</span><span class="p">))</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>html()</p>

    <p>æ­¤æ–¹æ³•ç”¨æ¥è·å–ç½‘é¡µçš„æºä»£ç ï¼Œå®ƒæ˜¯éå¸¸ç®€å•åˆå¸¸ç”¨çš„æ–¹æ³•</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://httpbin.org/get</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">html</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;pre style="word-wrap: break-word; white-space: pre-wrap;"&gt;{
  "args": {}, 
  "headers": {
      "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", 
      "Accept-Encoding": "gzip, deflate", 
      "Accept-Language": "en,*", 
      "Connection": "close", 
      "Host": "httpbin.org", 
      "User-Agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/602.1 (KHTML, like Gecko) splash Version/9.0 Safari/602.1"
  }, 
  "origin": "60.207.237.85", 
  "url": "https://httpbin.org/get"
  }
  &lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre></div>    </div>
  </li>
  <li>
    <p>png()</p>

    <p>æ­¤æ–¹æ³•ç”¨æ¥è·å–PNGæ ¼å¼çš„ç½‘é¡µæˆªå›¾</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.taobao.com</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>jpeg()</p>

    <p>æ­¤æ–¹æ³•ç”¨æ¥è·å–JPEGæ ¼å¼çš„ç½‘é¡µæˆªå›¾</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.taobao.com</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">jpeg</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>har()</p>

    <p>æ­¤æ–¹æ³•ç”¨æ¥è·å–é¡µé¢åŠ è½½è¿‡ç¨‹æè¿°</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.baidu.com</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">har</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>url()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥è·å–å½“å‰æ­£åœ¨è®¿é—®çš„URL</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.baidu.com</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">url</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  https://www.baidu.com/
</code></pre></div>    </div>
  </li>
  <li>
    <p>get_cookies()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥è·å–å½“å‰é¡µé¢çš„Cookies</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.baidu.com</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">get_cookies</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Splash Response: Array[2]
  0: Object
  domain: ".baidu.com"
  expires: "2085-08-21T20:13:23Z"
  httpOnly: false
  name: "BAIDUID"
  path: "/"
  secure: false
  value: "C1263A470B02DEF45593B062451C9722:FG=1"
  1: Object
  domain: ".baidu.com"
  expires: "2085-08-21T20:13:23Z"
  httpOnly: false
  name: "BIDUPSID"
  path: "/"
  secure: false
  value: "C1263A470B02DEF45593B062451C9722"
</code></pre></div>    </div>
  </li>
  <li>
    <p>add_cookies()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥ä¸ºå½“å‰é¡µé¢æ·»åŠ Cookie</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">cookies</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">add_cookie</span><span class="p">{</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">path</span><span class="o">=</span><span class="nx">nil</span><span class="p">,</span> <span class="nx">domain</span><span class="o">=</span><span class="nx">nil</span><span class="p">,</span> <span class="nx">expires</span><span class="o">=</span><span class="nx">nil</span><span class="p">,</span> <span class="nx">httpOnly</span><span class="o">=</span><span class="nx">nil</span><span class="p">,</span> <span class="nx">secure</span><span class="o">=</span><span class="nx">nil</span><span class="p">}</span>
</code></pre></div>    </div>
    <p>è¯¥æ–¹æ³•çš„å„ä¸ªå‚æ•°ä»£è¡¨Cookieçš„å„ä¸ªå±æ€§</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">add_cookie</span><span class="p">{</span><span class="dl">"</span><span class="s2">sessionid</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">237465ghgfsd</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="nx">domain</span><span class="o">=</span><span class="dl">"</span><span class="s2">http://example.com</span><span class="dl">"</span><span class="p">}</span>
      <span class="nl">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://example.com/</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">html</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>clear_cookies()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥æ¸…é™¤æ‰€æœ‰çš„Cookies</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.baidu.com/</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">clear_cookies</span><span class="p">()</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">get_cookies</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œæˆ‘ä»¬æ¸…é™¤äº†æ‰€æœ‰çš„Cookiesï¼Œç„¶åè°ƒç”¨get_cookies()å°†ç»“æœè¿”å›</p>

    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Splash Response: Array[0]
</code></pre></div>    </div>
  </li>
  <li>
    <p>get_viewport_size()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥è·å–å½“å‰æµè§ˆå™¨é¡µé¢çš„å¤§å°ï¼Œå³å®½é«˜</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.baidu.com/</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">get_viewport_size</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Splash Response: Array[2]
  0: 1024
  1: 768
</code></pre></div>    </div>
  </li>
  <li>
    <p>set_viewport_size()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥è®¾ç½®å½“å‰æµè§ˆå™¨é¡µé¢çš„å¤§å°ï¼Œå³å®½é«˜</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">splash</span><span class="p">:</span><span class="nx">set_viewport_size</span><span class="p">(</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>ä¾‹å¦‚ï¼Œè¿™é‡Œè®¿é—®ä¸€ä¸ªå®½åº¦è‡ªé€‚åº”çš„é¡µé¢</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">set_viewport_size</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">700</span><span class="p">)</span>
      <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://balbozheng.com</span><span class="dl">"</span><span class="p">))</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>set_viewport_full()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥è®¾ç½®æµè§ˆå™¨å…¨å±æ˜¾ç¤º</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">set_viewport_full</span><span class="p">()</span>
      <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://cuiqingcai.com</span><span class="dl">"</span><span class="p">))</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>set_user_agent()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥è®¾ç½®æµè§ˆå™¨çš„User-Agent</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">set_user_agent</span><span class="p">(</span><span class="dl">'</span><span class="s1">Splash</span><span class="dl">'</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://httpbin.org/get</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">html</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œæˆ‘ä»¬å°†æµè§ˆå™¨çš„User-Agentè®¾ç½®ä¸ºSplash,è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;pre style="word-wrap: break-word; white-space: pre-wrap;"&gt;{
  "args": {}, 
  "headers": {
      "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", 
      "Accept-Encoding": "gzip, deflate", 
      "Accept-Language": "en,*", 
      "Connection": "close", 
      "Host": "httpbin.org", 
      "User-Agent": "Splash"
  }, 
  "origin": "60.207.237.85", 
  "url": "http://httpbin.org/get"
  }
  &lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre></div>    </div>
  </li>
  <li>
    <p>set_custom_headers()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥è®¾ç½®è¯·æ±‚å¤´</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">set_custom_headers</span><span class="p">({</span>
          <span class="p">[</span><span class="dl">"</span><span class="s2">User-Agent</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Splash</span><span class="dl">"</span><span class="p">,</span>
          <span class="p">[</span><span class="dl">"</span><span class="s2">Site</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Splash</span><span class="dl">"</span><span class="p">,</span>
      <span class="p">})</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://httpbin.org/get</span><span class="dl">"</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">html</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œæˆ‘ä»¬è®¾ç½®äº†è¯·æ±‚å¤´ä¸­çš„User-Agentå’ŒSiteå±æ€§ï¼Œè¿è¡Œç»“æœ</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;pre style="word-wrap: break-word; white-space: pre-wrap;"&gt;{
  "args": {}, 
  "headers": {
      "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", 
      "Accept-Encoding": "gzip, deflate", 
      "Accept-Language": "en,*", 
      "Connection": "close", 
      "Host": "httpbin.org", 
      "Site": "Splash", 
      "User-Agent": "Splash"
  }, 
  "origin": "60.207.237.85", 
  "url": "http://httpbin.org/get"
  }
  &lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre></div>    </div>
  </li>
  <li>
    <p>select()</p>

    <p>è¯¥æ–¹æ³•å¯ä»¥é€‰ä¸­ç¬¦åˆæ¡ä»¶çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœæœ‰å¤šä¸ªèŠ‚ç‚¹ç¬¦åˆæ¡ä»¶ï¼Œåˆ™åªä¼šè¿”å›ä¸€ä¸ªï¼Œå…¶å‚æ•°æ˜¯CSSé€‰æ‹©å™¨</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.baidu.com/</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">input</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">select</span><span class="p">(</span><span class="dl">"</span><span class="s2">#kw</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">input</span><span class="p">:</span><span class="nx">send_text</span><span class="p">(</span><span class="dl">'</span><span class="s1">Splash</span><span class="dl">'</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">wait</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œæˆ‘ä»¬é¦–å…ˆè®¿é—®äº†ç™¾åº¦ï¼Œç„¶åé€‰ä¸­äº†æœç´¢æ¡†ï¼Œéšåè°ƒç”¨äº†send_text()æ–¹æ³•å¡«å†™äº†æ–‡æœ¬ï¼Œç„¶åè¿”å›ç½‘é¡µæˆªå›¾ã€‚</p>
  </li>
  <li>
    <p>select_all()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥é€‰ä¸­æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ï¼Œå…¶å‚æ•°æ˜¯CSSé€‰æ‹©å™¨</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">treat</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">treat</span><span class="dl">'</span><span class="p">)</span>
      <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://quotes.toscrape.com/</span><span class="dl">"</span><span class="p">))</span>
      <span class="nx">assert</span><span class="p">(</span><span class="nx">splash</span><span class="p">:</span><span class="nx">wait</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
      <span class="nx">local</span> <span class="nx">texts</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">select_all</span><span class="p">(</span><span class="dl">'</span><span class="s1">.quote .text</span><span class="dl">'</span><span class="p">)</span>
      <span class="nx">local</span> <span class="nx">results</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="k">for</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">text</span> <span class="k">in</span> <span class="nx">ipairs</span><span class="p">(</span><span class="nx">texts</span><span class="p">)</span> <span class="k">do</span>
          <span class="nx">results</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">innerHTML</span>
      <span class="nx">end</span>
      <span class="k">return</span> <span class="nx">treat</span><span class="p">.</span><span class="nx">as_array</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œæˆ‘ä»¬é€šè¿‡CSSé€‰æ‹©å™¨é€‰ä¸­äº†èŠ‚ç‚¹çš„æ­£æ–‡å†…å®¹ï¼Œéšåéå†äº†æ‰€æœ‰èŠ‚ç‚¹ï¼Œå°†å…¶ä¸­çš„æ–‡æœ¬è·å–ä¸‹æ¥,è¿è¡Œç»“æœ</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Splash Response: Array[10]
  0: "â€œThe world as we have created it is a process of our thinking. It cannot be changed without changing our thinking.â€"
  1: "â€œIt is our choices, Harry, that show what we truly are, far more than our abilities.â€"
  2: â€œThere are only two ways to live your life. One is as though nothing is a miracle. The other is as though everything is a miracle.â€
  3: "â€œThe person, be it gentleman or lady, who has not pleasure in a good novel, must be intolerably stupid.â€"
  4: "â€œImperfection is beauty, madness is genius and it's better to be absolutely ridiculous than absolutely boring.â€"
  5: "â€œTry not to become a man of success. Rather become a man of value.â€"
  6: "â€œIt is better to be hated for what you are than to be loved for what you are not.â€"
  7: "â€œI have not failed. I've just found 10,000 ways that won't work.â€"
  8: "â€œA woman is like a tea bag; you never know how strong it is until it's in hot water.â€"
  9: "â€œA day without sunshine is like, you know, night.â€"
</code></pre></div>    </div>
  </li>
  <li>
    <p>mouse_click()</p>

    <p>æ­¤æ–¹æ³•å¯ä»¥æ¨¡æ‹Ÿé¼ æ ‡ç‚¹å‡»æ“ä½œï¼Œä¼ å…¥çš„å‚æ•°ä¸ºåæ ‡å€¼xå’Œyã€‚æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥é€‰ä¸­æŸä¸ªèŠ‚ç‚¹ï¼Œç„¶åè°ƒç”¨æ­¤æ–¹æ³•</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">go</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://www.baidu.com/</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">input</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">select</span><span class="p">(</span><span class="dl">"</span><span class="s2">#kw</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">input</span><span class="p">:</span><span class="nx">send_text</span><span class="p">(</span><span class="dl">'</span><span class="s1">Splash</span><span class="dl">'</span><span class="p">)</span>
      <span class="nx">submit</span> <span class="o">=</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">select</span><span class="p">(</span><span class="dl">'</span><span class="s1">#su</span><span class="dl">'</span><span class="p">)</span>
      <span class="nx">submit</span><span class="p">:</span><span class="nx">mouse_click</span><span class="p">()</span>
      <span class="nx">splash</span><span class="p">:</span><span class="nx">wait</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">splash</span><span class="p">:</span><span class="nx">png</span><span class="p">()</span>
  <span class="nx">end</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œæˆ‘ä»¬é¦–å…ˆé€‰ä¸­é¡µé¢çš„è¾“å…¥æ¡†ï¼Œè¾“å…¥äº†æ–‡æœ¬ï¼Œç„¶åé€‰ä¸­â€œæäº¤â€æŒ‰é’®ï¼Œè°ƒç”¨äº†mouse_click()æ–¹æ³•æäº¤æŸ¥è¯¢ï¼Œç„¶åé¡µé¢ç­‰å¾…ä¸‰ç§’ï¼Œè¿”å›æˆªå›¾</p>
  </li>
</ul>

<h3 id="splash-api-è°ƒç”¨-1">Splash API è°ƒç”¨</h3>

<ul>
  <li>
    <p>render.html</p>

    <p>æ­¤æ¥å£ç”¨äºè·å–JavaScriptæ¸²æŸ“çš„é¡µé¢çš„HTMLä»£ç ï¼Œæ¥å£åœ°å€å°±æ˜¯Splashçš„è¿è¡Œåœ°å€åŠ æ­¤æ¥å£åç§°ï¼Œä¾‹å¦‚http://localhost:8050/render.htmlã€‚å¯ä»¥ç”¨curlæ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">curl</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//localhost:8050/render.html?url=https://www.baidu.com</span>
</code></pre></div>    </div>
    <p>æˆ‘ä»¬ç»™æ­¤æ¥å£ä¼ é€’äº†ä¸€ä¸ªurlå‚æ•°æ¥æŒ‡å®šæ¸²æŸ“çš„URLï¼Œè¿”å›ç»“æœå³é¡µé¢æ¸²æŸ“åçš„æºä»£ç ã€‚</p>

    <p>å¦‚æœç”¨Pythonå®ç°çš„è¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">import</span> <span class="nn">requests</span>
  <span class="n">url</span> <span class="o">=</span> <span class="s">'http://localhost:8050/render.html?url=https://www.baidu.com'</span>
  <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>è¿™æ ·å°±å¯ä»¥æˆåŠŸè¾“å‡ºç™¾åº¦é¡µé¢æ¸²æŸ“åçš„æºä»£ç äº†ã€‚</p>

    <p>å¦å¤–ï¼Œæ­¤æ¥å£è¿˜å¯ä»¥æŒ‡å®šå…¶ä»–å‚æ•°ï¼Œæ¯”å¦‚é€šè¿‡waitæŒ‡å®šç­‰å¾…ç§’æ•°ã€‚å¦‚æœè¦ç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½å‡ºæ¥ï¼Œå¯ä»¥å¢åŠ ç­‰å¾…æ—¶é—´ï¼Œä¾‹å¦‚ï¼š</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">import</span> <span class="nn">requests</span>
  <span class="n">url</span> <span class="o">=</span> <span class="s">'http://localhost:8050/render.html?url=https://www.taobao.com&amp;wait=5'</span>
  <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>æ­¤æ—¶å¾—åˆ°å“åº”çš„æ—¶é—´å°±ä¼šç›¸åº”å˜é•¿ï¼Œæ¯”å¦‚è¿™é‡Œä¼šç­‰å¾…5ç§’å¤šé’Ÿæ‰èƒ½è·å–æ·˜å®é¡µé¢çš„æºä»£ç ã€‚</p>

    <p>å¦å¤–ï¼Œæ­¤æ¥å£è¿˜æ”¯æŒä»£ç†è®¾ç½®ã€å›¾ç‰‡åŠ è½½è®¾ç½®ã€Headersè®¾ç½®ã€è¯·æ±‚æ–¹æ³•è®¾ç½®ï¼Œå…·ä½“çš„ç”¨æ³•å¯ä»¥å‚è§å®˜æ–¹æ–‡æ¡£https://splash.readthedocs.io/en/stable/api.html#render-html</p>
  </li>
  <li>
    <p>render.png</p>

    <p>æ­¤æ¥å£å¯ä»¥è·å–ç½‘é¡µæˆªå›¾ï¼Œå…¶å‚æ•°æ¯”render.htmlå¤šäº†å‡ ä¸ªï¼Œæ¯”å¦‚é€šè¿‡widthå’Œheightæ¥æ§åˆ¶å®½é«˜ï¼Œå®ƒè¿”å›çš„æ˜¯PNGæ ¼å¼çš„å›¾ç‰‡äºŒè¿›åˆ¶æ•°æ®ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">curl</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//localhost:8050/render.png?url=https://www.taobao.com&amp;wait=5&amp;width=1000&amp;height=700</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œæˆ‘ä»¬ä¼ å…¥äº†widthå’Œheightæ¥è®¾ç½®é¡µé¢å¤§å°ä¸º1000Ã—700åƒç´ ã€‚</p>

    <p>å¦‚æœç”¨Pythonå®ç°ï¼Œå¯ä»¥å°†è¿”å›çš„äºŒè¿›åˆ¶æ•°æ®ä¿å­˜ä¸ºPNGæ ¼å¼çš„å›¾ç‰‡ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">import</span> <span class="nn">requests</span>

  <span class="n">url</span> <span class="o">=</span> <span class="s">'http://localhost:8050/render.png?url=https://www.jd.com&amp;wait=5&amp;width=1000&amp;height=700'</span>
  <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'taobao.png'</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
      <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>è¿™æ ·æˆ‘ä»¬å°±æˆåŠŸè·å–äº†äº¬ä¸œé¦–é¡µæ¸²æŸ“å®Œæˆåçš„é¡µé¢æˆªå›¾ï¼Œè¯¦ç»†çš„å‚æ•°è®¾ç½®å¯ä»¥å‚è€ƒå®˜ç½‘æ–‡æ¡£ https://splash.readthedocs.io/en/stable/api.html#render-png</p>
  </li>
  <li>
    <p>render.jpeg</p>

    <p>æ­¤æ¥å£å’Œrender.pngç±»ä¼¼ï¼Œä¸è¿‡å®ƒè¿”å›çš„æ˜¯JPEGæ ¼å¼çš„å›¾ç‰‡äºŒè¿›åˆ¶æ•°æ®ã€‚</p>

    <p>å¦å¤–ï¼Œæ­¤æ¥å£æ¯”render.pngå¤šäº†å‚æ•°qualityï¼Œå®ƒç”¨æ¥è®¾ç½®å›¾ç‰‡è´¨é‡ã€‚</p>
  </li>
  <li>
    <p>render.har</p>

    <p>æ­¤æ¥å£ç”¨äºè·å–é¡µé¢åŠ è½½çš„HARæ•°æ®ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">curl</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//localhost:8050/render.har?url=https://www.jd.com&amp;wait=5</span>
</code></pre></div>    </div>
    <p>å®ƒçš„è¿”å›ç»“æœï¼ˆå¦‚å›¾7-18æ‰€ç¤ºï¼‰éå¸¸å¤šï¼Œæ˜¯ä¸€ä¸ªJSONæ ¼å¼çš„æ•°æ®ï¼Œå…¶ä¸­åŒ…å«é¡µé¢åŠ è½½è¿‡ç¨‹ä¸­çš„HARæ•°æ®</p>
  </li>
  <li>
    <p>render.json</p>

    <p>æ­¤æ¥å£åŒ…å«äº†å‰é¢æ¥å£çš„æ‰€æœ‰åŠŸèƒ½ï¼Œè¿”å›ç»“æœæ˜¯JSONæ ¼å¼ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">curl</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//localhost:8050/render.json?url=https://httpbin.org</span>
</code></pre></div>    </div>
    <p>ç»“æœå¦‚ä¸‹ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {"title": "httpbin(1): HTTP Client Testing Service", "url": "https://httpbin.org/", "requestedUrl": "https://httpbin.org/", "geometry": [0, 0, 1024, 768]}
</code></pre></div>    </div>
    <p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œä»¥JSONå½¢å¼è¿”å›äº†ç›¸åº”çš„è¯·æ±‚æ•°æ®ã€‚</p>

    <p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ å…¥ä¸åŒå‚æ•°æ§åˆ¶å…¶è¿”å›ç»“æœã€‚æ¯”å¦‚ï¼Œä¼ å…¥html=1ï¼Œè¿”å›ç»“æœå³ä¼šå¢åŠ æºä»£ç æ•°æ®ï¼›ä¼ å…¥png=1ï¼Œè¿”å›ç»“æœå³ä¼šå¢åŠ é¡µé¢PNGæˆªå›¾æ•°æ®ï¼›ä¼ å…¥har=1ï¼Œåˆ™ä¼šè·å¾—é¡µé¢HARæ•°æ®ã€‚ä¾‹å¦‚ï¼š</p>
    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">curl</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//localhost:8050/render.json?url=https://httpbin.org&amp;html=1&amp;har=1</span>
</code></pre></div>    </div>
    <p>è¿™æ ·è¿”å›çš„JSONç»“æœä¼šåŒ…å«ç½‘é¡µæºä»£ç å’ŒHARæ•°æ®ã€‚</p>

    <p>æ­¤å¤–è¿˜æœ‰æ›´å¤šå‚æ•°è®¾ç½®ï¼Œå…·ä½“å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://splash.readthedocs.io/en/stable/api.html#render-json</p>
  </li>
  <li>
    <p>execute</p>

    <p>æ­¤æ¥å£æ‰æ˜¯æœ€ä¸ºå¼ºå¤§çš„æ¥å£ã€‚å‰é¢è¯´äº†å¾ˆå¤šSplash Luaè„šæœ¬çš„æ“ä½œï¼Œç”¨æ­¤æ¥å£ä¾¿å¯å®ç°ä¸Luaè„šæœ¬çš„å¯¹æ¥ã€‚</p>

    <p>å‰é¢çš„render.htmlå’Œrender.pngç­‰æ¥å£å¯¹äºä¸€èˆ¬çš„JavaScriptæ¸²æŸ“é¡µé¢æ˜¯è¶³å¤Ÿäº†ï¼Œä½†æ˜¯å¦‚æœè¦å®ç°ä¸€äº›äº¤äº’æ“ä½œçš„è¯ï¼Œå®ƒä»¬è¿˜æ˜¯æ— èƒ½ä¸ºåŠ›ï¼Œè¿™é‡Œå°±éœ€è¦ä½¿ç”¨executeæ¥å£äº†ã€‚</p>

    <p>æˆ‘ä»¬å…ˆå®ç°ä¸€ä¸ªæœ€ç®€å•çš„è„šæœ¬ï¼Œç›´æ¥è¿”å›æ•°æ®ï¼š</p>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">splash</span><span class="p">)</span>
      <span class="k">return</span> <span class="dl">'</span><span class="s1">hello</span><span class="dl">'</span>
  <span class="nx">end</span>
</code></pre></div>    </div>

    <p>ç„¶åå°†æ­¤è„šæœ¬è½¬åŒ–ä¸ºURLç¼–ç åçš„å­—ç¬¦ä¸²ï¼Œæ‹¼æ¥åˆ°executeæ¥å£åé¢ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">curl</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//localhost:8050/execute?lua_source=function+main%28splash%29%0D%0A++return+%27hello%27%0D%0Aend</span>
</code></pre></div>    </div>

    <p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  hello
</code></pre></div>    </div>

    <p>è¿™é‡Œæˆ‘ä»¬é€šè¿‡lua_sourceå‚æ•°ä¼ é€’äº†è½¬ç åçš„Luaè„šæœ¬ï¼Œé€šè¿‡executeæ¥å£è·å–äº†æœ€ç»ˆè„šæœ¬çš„æ‰§è¡Œç»“æœã€‚</p>

    <p>è¿™é‡Œæˆ‘ä»¬æ›´åŠ å…³å¿ƒçš„è‚¯å®šæ˜¯å¦‚ä½•ç”¨Pythonæ¥å®ç°ï¼Œä¸Šä¾‹ç”¨Pythonå®ç°çš„è¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">import</span> <span class="nn">requests</span>
  <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">quote</span>
     
  <span class="n">lua</span> <span class="o">=</span> <span class="s">'''
  function main(splash)
      return 'hello'
  end
  '''</span>
     
  <span class="n">url</span> <span class="o">=</span> <span class="s">'http://localhost:8050/execute?lua_source='</span> <span class="o">+</span> <span class="n">quote</span><span class="p">(</span><span class="n">lua</span><span class="p">)</span>
  <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>    </div>

    <p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  hello
</code></pre></div>    </div>

    <p>è¿™é‡Œæˆ‘ä»¬ç”¨Pythonä¸­çš„ä¸‰å¼•å·å°†Luaè„šæœ¬åŒ…æ‹¬èµ·æ¥ï¼Œç„¶åç”¨urllib.parseæ¨¡å—é‡Œçš„quote()æ–¹æ³•å°†è„šæœ¬è¿›è¡ŒURLè½¬ç ï¼Œéšåæ„é€ äº†Splashè¯·æ±‚URLï¼Œå°†å…¶ä½œä¸ºlua_sourceå‚æ•°ä¼ é€’ï¼Œè¿™æ ·è¿è¡Œç»“æœå°±ä¼šæ˜¾ç¤ºLuaè„šæœ¬æ‰§è¡Œåçš„ç»“æœã€‚</p>

    <p>æˆ‘ä»¬å†é€šè¿‡å®ä¾‹çœ‹ä¸€ä¸‹ï¼š</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">import</span> <span class="nn">requests</span>
  <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">quote</span>
     
  <span class="n">lua</span> <span class="o">=</span> <span class="s">'''
  function main(splash, args)
    local treat = require("treat")
    local response = splash:http_get("http://httpbin.org/get")
      return {
      html=treat.as_string(response.body),
      url=response.url,
      status=response.status
      }
  end
  '''</span>
     
  <span class="n">url</span> <span class="o">=</span> <span class="s">'http://localhost:8050/execute?lua_source='</span> <span class="o">+</span> <span class="n">quote</span><span class="p">(</span><span class="n">lua</span><span class="p">)</span>
  <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>    </div>

    <p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  {"url": "http://httpbin.org/get", "status": 200, "html": "{\n  \"args\": {}, \n  \"headers\": {\n    \"Accept-Encoding\": \"gzip, deflate\", \n    \"Accept-Language\": \"en,*\", \n    \"Connection\": \"close\", \n    \"Host\": \"httpbin.org\", \n    \"User-Agent\": \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/602.1 (KHTML, like Gecko) splash Version/9.0 Safari/602.1\"\n  }, \n  \"origin\": \"60.207.237.85\", \n  \"url\": \"http://httpbin.org/get\"\n}\n"}
</code></pre></div>    </div>

    <p>å¯ä»¥çœ‹åˆ°ï¼Œè¿”å›ç»“æœæ˜¯JSONå½¢å¼ï¼Œæˆ‘ä»¬æˆåŠŸè·å–äº†è¯·æ±‚çš„URLã€çŠ¶æ€ç å’Œç½‘é¡µæºä»£ç ã€‚</p>

    <p>å¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„Luaè„šæœ¬å‡å¯ä»¥ç”¨æ­¤æ–¹å¼ä¸Pythonè¿›è¡Œå¯¹æ¥ï¼Œæ‰€æœ‰ç½‘é¡µçš„åŠ¨æ€æ¸²æŸ“ã€æ¨¡æ‹Ÿç‚¹å‡»ã€è¡¨å•æäº¤ã€é¡µé¢æ»‘åŠ¨ã€å»¶æ—¶ç­‰å¾…åçš„ä¸€äº›ç»“æœå‡å¯ä»¥è‡ªç”±æ§åˆ¶ï¼Œè·å–é¡µé¢æºç å’Œæˆªå›¾ä¹Ÿéƒ½ä¸åœ¨è¯ä¸‹</p>
  </li>
</ul>

<h3 id="splash-è´Ÿè½½å‡è¡¡é…ç½®-1">Splash è´Ÿè½½å‡è¡¡é…ç½®</h3>

<ol>
  <li>
    <p>é…ç½® Splash æœåŠ¡</p>

    <p>è¦æ­å»ºSplashè´Ÿè½½å‡è¡¡ï¼Œé¦–å…ˆè¦æœ‰å¤šä¸ªSplashæœåŠ¡ã€‚å‡å¦‚è¿™é‡Œåœ¨4å°è¿œç¨‹ä¸»æœºçš„8050ç«¯å£ä¸Šéƒ½å¼€å¯äº†SplashæœåŠ¡ï¼Œå®ƒä»¬çš„æœåŠ¡åœ°å€åˆ†åˆ«ä¸º41.159.27.223:8050ã€41.159.27.221:8050ã€41.159.27.9:8050å’Œ41.159.117.119:8050ï¼Œè¿™4ä¸ªæœåŠ¡å®Œå…¨ä¸€è‡´ï¼Œéƒ½æ˜¯é€šè¿‡Dockerçš„Splashé•œåƒå¼€å¯çš„ã€‚è®¿é—®å…¶ä¸­ä»»ä½•ä¸€ä¸ªæœåŠ¡æ—¶ï¼Œéƒ½å¯ä»¥ä½¿ç”¨SplashæœåŠ¡</p>
  </li>
  <li>
    <p>é…ç½®è´Ÿè½½å‡è¡¡</p>

    <p>æ¥ä¸‹æ¥ï¼Œå¯ä»¥é€‰ç”¨ä»»æ„ä¸€å°å¸¦æœ‰å…¬ç½‘IPçš„ä¸»æœºæ¥é…ç½®è´Ÿè½½å‡è¡¡ã€‚é¦–å…ˆï¼Œåœ¨è¿™å°ä¸»æœºä¸Šè£…å¥½Nginxï¼Œç„¶åä¿®æ”¹Nginxçš„é…ç½®æ–‡ä»¶nginx.confï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> http {
 upstream splash {
         least_conn;
         server 41.159.27.223:8050;
         server 41.159.27.221:8050;
         server 41.159.27.9:8050;
         server 41.159.117.119:8050;
     }
     server {
         listen 8050;
         location / {
             proxy_pass http://splash;
         }
     }
 }
</code></pre></div>    </div>
    <p>è¿™æ ·æˆ‘ä»¬é€šè¿‡upstreamå­—æ®µå®šä¹‰äº†ä¸€ä¸ªåå­—å«ä½œsplashçš„æœåŠ¡é›†ç¾¤é…ç½®ã€‚å…¶ä¸­least_connä»£è¡¨æœ€å°‘é“¾æ¥è´Ÿè½½å‡è¡¡ï¼Œå®ƒé€‚åˆå¤„ç†è¯·æ±‚å¤„ç†æ—¶é—´é•¿çŸ­ä¸ä¸€é€ æˆæœåŠ¡å™¨è¿‡è½½çš„æƒ…å†µã€‚</p>

    <p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸æŒ‡å®šé…ç½®ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> upstream splash {
     server 41.159.27.223:8050;
     server 41.159.27.221:8050;
     server 41.159.27.9:8050;
     server 41.159.117.119:8050;
 }
</code></pre></div>    </div>
    <p>è¿™æ ·é»˜è®¤ä»¥è½®è¯¢ç­–ç•¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œæ¯ä¸ªæœåŠ¡å™¨çš„å‹åŠ›ç›¸åŒã€‚æ­¤ç­–ç•¥é€‚åˆæœåŠ¡å™¨é…ç½®ç›¸å½“ã€æ— çŠ¶æ€ä¸”çŸ­å¹³å¿«çš„æœåŠ¡ä½¿ç”¨ã€‚</p>

    <p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®šæƒé‡ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> upstream splash {
     server 41.159.27.223:8050 weight=4;
     server 41.159.27.221:8050 weight=2;
     server 41.159.27.9:8050 weight=2;
     server 41.159.117.119:8050 weight=1;
 }
</code></pre></div>    </div>
    <p>æœåŠ¡å™¨æ ¹æ®è¯·æ±‚å®¢æˆ·ç«¯çš„IPåœ°å€è¿›è¡Œæ•£åˆ—è®¡ç®—ï¼Œç¡®ä¿ä½¿ç”¨åŒä¸€ä¸ªæœåŠ¡å™¨å“åº”è¯·æ±‚ï¼Œè¿™ç§ç­–ç•¥é€‚åˆæœ‰çŠ¶æ€çš„æœåŠ¡ï¼Œæ¯”å¦‚ç”¨æˆ·ç™»å½•åè®¿é—®æŸä¸ªé¡µé¢çš„æƒ…å½¢ã€‚å¯¹äºSplashæ¥è¯´ï¼Œä¸éœ€è¦åº”ç”¨æ­¤è®¾ç½®ã€‚</p>

    <p>æˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸åŒçš„æƒ…å½¢é€‰ç”¨ä¸åŒçš„é…ç½®ï¼Œé…ç½®å®Œæˆåé‡å¯ä¸€ä¸‹NginxæœåŠ¡ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> sudo nginx -s reload
</code></pre></div>    </div>
  </li>
  <li>
    <p>é…ç½®è®¤è¯</p>

    <p>ç°åœ¨Splashæ˜¯å¯ä»¥å…¬å¼€è®¿é—®çš„ï¼Œå¦‚æœä¸æƒ³è®©å…¶å…¬å¼€è®¿é—®ï¼Œè¿˜å¯ä»¥é…ç½®è®¤è¯ï¼Œè¿™ä»ç„¶å€ŸåŠ©äºNginxã€‚å¯ä»¥åœ¨serverçš„locationå­—æ®µä¸­æ·»åŠ auth_basicå’Œauth_basic_user_fileå­—æ®µï¼Œå…·ä½“é…ç½®å¦‚ä¸‹ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> http {
     upstream splash {
         least_conn;
         server 41.159.27.223:8050;
         server 41.159.27.221:8050;
         server 41.159.27.9:8050;
         server 41.159.117.119:8050;
     }
     server {
         listen 8050;
         location / {
             proxy_pass http://splash;
             auth_basic "Restricted";
             auth_basic_user_file /etc/nginx/conf.d/.htpasswd;
         }
     }
 }
</code></pre></div>    </div>
    <p>è¿™é‡Œä½¿ç”¨çš„ç”¨æˆ·åå’Œå¯†ç é…ç½®æ”¾ç½®åœ¨/etc/nginx/conf.dç›®å½•ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨htpasswdå‘½ä»¤åˆ›å»ºã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªç”¨æˆ·åä¸ºadminçš„æ–‡ä»¶ï¼Œç›¸å…³å‘½ä»¤å¦‚ä¸‹ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> htpasswd -c .htpasswd admin
</code></pre></div>    </div>
    <p>æ¥ä¸‹æ¥å°±ä¼šæç¤ºæˆ‘ä»¬è¾“å…¥å¯†ç ï¼Œè¾“å…¥ä¸¤æ¬¡ä¹‹åï¼Œå°±ä¼šç”Ÿæˆå¯†ç æ–‡ä»¶ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> cat .htpasswd 
 admin:5ZBxQr0rCqwbc
</code></pre></div>    </div>
    <p>é…ç½®å®Œæˆåï¼Œé‡å¯ä¸€ä¸‹NginxæœåŠ¡ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> sudo nginx -s reload
</code></pre></div>    </div>
    <p>è¿™æ ·è®¿é—®è®¤è¯å°±æˆåŠŸé…ç½®å¥½äº†ã€‚</p>
  </li>
  <li>
    <p>æµ‹è¯•</p>

    <p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä»£ç æ¥æµ‹è¯•ä¸€ä¸‹è´Ÿè½½å‡è¡¡çš„é…ç½®ï¼Œçœ‹çœ‹åˆ°åº•æ˜¯ä¸æ˜¯æ¯æ¬¡è¯·æ±‚ä¼šåˆ‡æ¢IPã€‚åˆ©ç”¨http://httpbin.org/getæµ‹è¯•å³å¯ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kn">import</span> <span class="nn">requests</span>
 <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">quote</span>
 <span class="kn">import</span> <span class="nn">re</span>

 <span class="n">lua</span> <span class="o">=</span> <span class="s">'''
 function main(splash, args)
 local treat = require("treat")
 local response = splash:http_get("http://httpbin.org/get")
 return treat.as_string(response.body)
 end
 '''</span>

 <span class="n">url</span> <span class="o">=</span> <span class="s">'http://splash:8050/execute?lua_source='</span> <span class="o">+</span> <span class="n">quote</span><span class="p">(</span><span class="n">lua</span><span class="p">)</span>
 <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="s">'admin'</span><span class="p">,</span> <span class="s">'admin'</span><span class="p">))</span>
 <span class="n">ip</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="s">'(\d+\.\d+\.\d+\.\d+)'</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">).</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
 <span class="k">print</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>è¿™é‡ŒURLä¸­çš„splashå­—ç¬¦ä¸²è¯·è‡ªè¡Œæ›¿æ¢æˆè‡ªå·±çš„NginxæœåŠ¡å™¨IPã€‚è¿™é‡Œæˆ‘ä¿®æ”¹äº†Hostsï¼Œè®¾ç½®äº†splashä¸ºNginxæœåŠ¡å™¨IPã€‚</p>

    <p>å¤šæ¬¡è¿è¡Œä»£ç ä¹‹åï¼Œå¯ä»¥å‘ç°æ¯æ¬¡è¯·æ±‚çš„IPéƒ½ä¼šå˜åŒ–ï¼Œæ¯”å¦‚ç¬¬ä¸€æ¬¡çš„ç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 41.159.27.223
</code></pre></div>    </div>
    <p>ç¬¬äºŒæ¬¡çš„ç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 41.159.27.9
</code></pre></div>    </div>
    <p>è¿™å°±è¯´æ˜è´Ÿè½½å‡è¡¡å·²ç»æˆåŠŸå®ç°äº†ã€‚</p>
    <blockquote>
      <blockquote>
        <blockquote>
          <blockquote>
            <blockquote>
              <blockquote>
                <blockquote>
                  <p>e5c77ca (æ–°é¡µé¢)</p>
                </blockquote>
              </blockquote>
            </blockquote>
          </blockquote>
        </blockquote>
      </blockquote>
    </blockquote>
  </li>
</ol>
:ET