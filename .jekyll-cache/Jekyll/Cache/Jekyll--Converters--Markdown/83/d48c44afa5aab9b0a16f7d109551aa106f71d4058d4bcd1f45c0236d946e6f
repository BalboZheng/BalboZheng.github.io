I"ûƒ<h2 id="-head">Â«Â«Â«&lt; HEAD</h2>
<p>layout:     post
title:      â€œXPathâ€
subtitle:   â€œâ€
date:       2019-11-17 14:28:25
author:     â€œBalboâ€
header-img: â€œimg/post-bg-2019.jpgâ€
tags:
    - reptile
â€”
<strong>XPath</strong>ï¼Œå…¨ç§° XML Path Languageï¼Œå³ XML è·¯å¾„è¯­è¨€ï¼Œå®ƒæ˜¯ä¸€é—¨åœ¨XMLæ–‡æ¡£ä¸­æŸ¥æ‰¾ä¿¡æ¯çš„è¯­è¨€ã€‚XPath æœ€åˆè®¾è®¡æ˜¯ç”¨æ¥æœå¯»XMLæ–‡æ¡£çš„ï¼Œä½†æ˜¯å®ƒåŒæ ·é€‚ç”¨äº HTML æ–‡æ¡£çš„æœç´¢ã€‚</p>

<p>æ‰€ä»¥åœ¨åšçˆ¬è™«æ—¶ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ä½¿ç”¨ XPath æ¥åšç›¸åº”çš„ä¿¡æ¯æŠ½å–ã€‚</p>
<h2 id="xpathæ¦‚è§ˆ">XPathæ¦‚è§ˆ</h2>

<p>XPath çš„é€‰æ‹©åŠŸèƒ½ååˆ†å¼ºå¤§ï¼Œå®ƒæä¾›äº†éå¸¸ç®€æ´æ˜äº†çš„è·¯å¾„é€‰æ‹©è¡¨è¾¾å¼ï¼Œå¦å¤–å®ƒè¿˜æä¾›äº†è¶…è¿‡ 100 ä¸ªå†…å»ºå‡½æ•°ç”¨äºå­—ç¬¦ä¸²ã€æ•°å€¼ã€æ—¶é—´çš„åŒ¹é…ä»¥åŠèŠ‚ç‚¹ã€åºåˆ—çš„å¤„ç†ç­‰ç­‰ï¼Œå‡ ä¹æ‰€æœ‰æˆ‘ä»¬æƒ³è¦å®šä½çš„èŠ‚ç‚¹éƒ½å¯ä»¥ç”¨XPathæ¥é€‰æ‹©ã€‚</p>

<p>XPath äº 1999 å¹´ 11 æœˆ 16 æ—¥ æˆä¸º W3C æ ‡å‡†ï¼Œå®ƒè¢«è®¾è®¡ä¸ºä¾› XSLTã€XPointer ä»¥åŠå…¶ä»– XML è§£æè½¯ä»¶ä½¿ç”¨ï¼Œæ›´å¤šçš„æ–‡æ¡£å¯ä»¥è®¿é—®å…¶å®˜æ–¹ç½‘ç«™ï¼šhttps://www.w3.org/TR/xpath/ã€‚</p>
<h2 id="xpathå¸¸ç”¨è§„åˆ™">XPathå¸¸ç”¨è§„åˆ™</h2>

<p>æˆ‘ä»¬ç°ç”¨è¡¨æ ¼åˆ—ä¸¾ä¸€ä¸‹å‡ ä¸ªå¸¸ç”¨è§„åˆ™ï¼š</p>

<table>
  <thead>
    <tr>
      <th>è¡¨è¾¾å¼</th>
      <th>æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>nodename</td>
      <td>é€‰å–æ­¤èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>/</td>
      <td>ä»å½“å‰èŠ‚ç‚¹é€‰å–ç›´æ¥å­èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>//</td>
      <td>ä»å½“å‰èŠ‚ç‚¹é€‰å–å­å­™èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>.</td>
      <td>é€‰å–å½“å‰èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>..</td>
      <td>é€‰å–å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>@</td>
      <td>é€‰å–å±æ€§</td>
    </tr>
  </tbody>
</table>

<p>åœ¨è¿™é‡Œåˆ—å‡ºäº†XPathçš„å¸¸ç”¨åŒ¹é…è§„åˆ™ï¼Œä¾‹å¦‚ï¼š</p>

<blockquote>
  <p>//title[@lang=â€™engâ€™]</p>
</blockquote>

<p>è¿™å°±æ˜¯ä¸€ä¸ª XPath è§„åˆ™ï¼Œå®ƒå°±ä»£è¡¨é€‰æ‹©æ‰€æœ‰åç§°ä¸º titleï¼ŒåŒæ—¶å±æ€§ lang çš„å€¼ä¸º eng çš„èŠ‚ç‚¹ã€‚</p>

<p>åœ¨åæ–‡æˆ‘ä»¬ä¼šä»‹ç» XPath çš„è¯¦ç»†ç”¨æ³•ï¼Œé€šè¿‡ Python çš„ LXML åº“åˆ©ç”¨ XPath è¿›è¡Œ HTML çš„è§£æã€‚</p>

<h2 id="å®ä¾‹å¼•å…¥">å®ä¾‹å¼•å…¥</h2>

<p>æˆ‘ä»¬ç°ç”¨ä¸€ä¸ªå®ä¾‹æ¥æ„Ÿå—ä¸€ä¸‹ä½¿ç”¨ XPath æ¥å¯¹ç½‘é¡µè¿›è¡Œè§£æçš„è¿‡ç¨‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">text</span> <span class="o">=</span> <span class="s">'''
&lt;div&gt;
    &lt;ul&gt;
         &lt;li class="item-0"&gt;&lt;a href="https://ask.hellobi.com/link1.html"&gt;first item&lt;/a&gt;&lt;/li&gt;
         &lt;li class="item-1"&gt;&lt;a href="https://ask.hellobi.com/link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt;
         &lt;li class="item-inactive"&gt;&lt;a href="https://ask.hellobi.com/link3.html"&gt;third item&lt;/a&gt;&lt;/li&gt;
         &lt;li class="item-1"&gt;&lt;a href="https://ask.hellobi.com/link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt;
         &lt;li class="item-0"&gt;&lt;a href="https://ask.hellobi.com/link5.html"&gt;fifth item&lt;/a&gt;
     &lt;/ul&gt;
 &lt;/div&gt;
'''</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
</code></pre></div></div>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº† LXML åº“çš„ etree æ¨¡å—ï¼Œç„¶åå£°æ˜äº†ä¸€æ®µ HTML æ–‡æœ¬ï¼Œè°ƒç”¨ HTML ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ ·æˆ‘ä»¬å°±æˆåŠŸæ„é€ äº†ä¸€ä¸ª XPath è§£æå¯¹è±¡ï¼Œåœ¨è¿™é‡Œæ³¨æ„åˆ° HTML æ–‡æœ¬ä¸­çš„æœ€åä¸€ä¸ª li èŠ‚ç‚¹æ˜¯æ²¡æœ‰é—­åˆçš„ï¼Œä½†æ˜¯ etree æ¨¡å—å¯ä»¥å¯¹ HTML æ–‡æœ¬è¿›è¡Œè‡ªåŠ¨ä¿®æ­£ã€‚</p>

<p>åœ¨è¿™é‡Œæˆ‘ä»¬è°ƒç”¨ tostring() æ–¹æ³•å³å¯è¾“å‡ºä¿®æ­£åçš„ HTML ä»£ç ï¼Œä½†æ˜¯ç»“æœæ˜¯ bytes ç±»å‹ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨ decode() æ–¹æ³•è½¬æˆ str ç±»å‹ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;&lt;body&gt;&lt;div&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-0"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://ask.hellobi.com/link1.html"</span><span class="nt">&gt;</span>first item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-1"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://ask.hellobi.com/link2.html"</span><span class="nt">&gt;</span>second item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-inactive"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://ask.hellobi.com/link3.html"</span><span class="nt">&gt;</span>third item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-1"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://ask.hellobi.com/link4.html"</span><span class="nt">&gt;</span>fourth item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-0"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://ask.hellobi.com/link5.html"</span><span class="nt">&gt;</span>fifth item<span class="nt">&lt;/a&gt;</span>
     <span class="nt">&lt;/li&gt;&lt;/ul&gt;</span>
 <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;&lt;/html&gt;</span>
</code></pre></div></div>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç»è¿‡å¤„ç†ä¹‹å li èŠ‚ç‚¹æ ‡ç­¾è¢«è¡¥å…¨ï¼Œå¹¶ä¸”è¿˜è‡ªåŠ¨æ·»åŠ äº† bodyã€html èŠ‚ç‚¹ã€‚</p>

<p>å¦å¤–æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥è¯»å–æ–‡æœ¬æ–‡ä»¶è¿›è¡Œè§£æï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
</code></pre></div></div>
<p>å…¶ä¸­ test.html çš„å†…å®¹å°±æ˜¯ä¸Šé¢ä¾‹å­ä¸­çš„ HTML ä»£ç ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-0"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://ask.hellobi.com/link1.html"</span><span class="nt">&gt;</span>first item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-1"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://ask.hellobi.com/link2.html"</span><span class="nt">&gt;</span>second item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-inactive"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://ask.hellobi.com/link3.html"</span><span class="nt">&gt;</span>third item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-1"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://ask.hellobi.com/link4.html"</span><span class="nt">&gt;</span>fourth item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-0"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://ask.hellobi.com/link5.html"</span><span class="nt">&gt;</span>fifth item<span class="nt">&lt;/a&gt;</span>
     <span class="nt">&lt;/ul&gt;</span>
 <span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>
<p>è¿™æ¬¡çš„è¾“å‡ºç»“æœç•¥æœ‰ä¸åŒï¼Œå¤šäº†ä¸€ä¸ª DOCTYPE çš„å£°æ˜ï¼Œä¸è¿‡å¯¹è§£ææ— ä»»ä½•å½±å“ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"&gt;</span>
<span class="nt">&lt;html&gt;&lt;body&gt;&lt;div&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-0"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"link1.html"</span><span class="nt">&gt;</span>first item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-1"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"link2.html"</span><span class="nt">&gt;</span>second item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-inactive"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"link3.html"</span><span class="nt">&gt;</span>third item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-1"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"link4.html"</span><span class="nt">&gt;</span>fourth item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-0"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"link5.html"</span><span class="nt">&gt;</span>fifth item<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/li&gt;&lt;/ul&gt;</span>
<span class="nt">&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;</span>
</code></pre></div></div>
<h2 id="æ‰€æœ‰èŠ‚ç‚¹">æ‰€æœ‰èŠ‚ç‚¹</h2>

<p>æˆ‘ä»¬ä¸€èˆ¬ä¼šç”¨ // å¼€å¤´çš„ XPath è§„åˆ™æ¥é€‰å–æ‰€æœ‰ç¬¦åˆè¦æ±‚çš„èŠ‚ç‚¹ï¼Œä»¥ä¸Šæ–‡çš„ HTML æ–‡æœ¬ä¸ºä¾‹ï¼Œå¦‚æœæˆ‘ä»¬è¦é€‰å–æ‰€æœ‰èŠ‚ç‚¹ï¼Œå¯ä»¥è¿™æ ·å®ç°ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//*'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[&lt;Element html at 0x10510d9c8&gt;, &lt;Element body at 0x10510da08&gt;, &lt;Element div at 0x10510da48&gt;, &lt;Element ul at 0x10510da88&gt;, &lt;Element li at 0x10510dac8&gt;, &lt;Element a at 0x10510db48&gt;, &lt;Element li at 0x10510db88&gt;, &lt;Element a at 0x10510dbc8&gt;, &lt;Element li at 0x10510dc08&gt;, &lt;Element a at 0x10510db08&gt;, &lt;Element li at 0x10510dc48&gt;, &lt;Element a at 0x10510dc88&gt;, &lt;Element li at 0x10510dcc8&gt;, &lt;Element a at 0x10510dd08&gt;]
</code></pre></div></div>
<p>æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨ * ä»£è¡¨åŒ¹é…æ‰€æœ‰èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ª HTML æ–‡æœ¬ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šè¢«è·å–ï¼Œå¯ä»¥çœ‹åˆ°è¿”å›å½¢å¼æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ Element ç±»å‹ï¼Œå…¶åè·Ÿäº†èŠ‚ç‚¹çš„åç§°ï¼Œå¦‚ htmlã€bodyã€divã€ulã€liã€a ç­‰ç­‰ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½åŒ…å«åœ¨åˆ—è¡¨ä¸­äº†ã€‚</p>

<p>å½“ç„¶æ­¤å¤„åŒ¹é…ä¹Ÿå¯ä»¥æŒ‡å®šèŠ‚ç‚¹åç§°ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è·å–æ‰€æœ‰ li èŠ‚ç‚¹ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></div>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬è¦é€‰å–æ‰€æœ‰ li èŠ‚ç‚¹å¯ä»¥ä½¿ç”¨ //ï¼Œç„¶åç›´æ¥åŠ ä¸ŠèŠ‚ç‚¹çš„åç§°å³å¯ï¼Œè°ƒç”¨æ—¶ç›´æ¥è°ƒç”¨ xpath() æ–¹æ³•å³å¯æå–ã€‚</p>

<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[&lt;Element li at 0xb11f9c8&gt;, &lt;Element li at 0xb11fa08&gt;, &lt;Element li at 0xb11fa48&gt;, &lt;Element li at 0xb11f788&gt;, &lt;Element li at 0xb11f708&gt;]
&lt;Element li at 0xb11f9c8&gt;
</code></pre></div></div>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æå–ç»“æœæ˜¯ä¸€ä¸ªåˆ—è¡¨å½¢å¼ï¼Œå…¶æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ª Element å¯¹è±¡ï¼Œå¦‚æœè¦å–å‡ºå…¶ä¸­ä¸€ä¸ªå¯¹è±¡å¯ä»¥ç›´æ¥ç”¨ä¸­æ‹¬å·åŠ ç´¢å¼•å³å¯å–å‡ºï¼Œå¦‚ [0]ã€‚</p>
<h2 id="å­èŠ‚ç‚¹">å­èŠ‚ç‚¹</h2>

<p>æˆ‘ä»¬é€šè¿‡ / æˆ– // å³å¯æŸ¥æ‰¾å…ƒç´ çš„å­èŠ‚ç‚¹æˆ–å­å­™èŠ‚ç‚¹ï¼ŒåŠ å…¥æˆ‘ä»¬ç°åœ¨æƒ³é€‰æ‹© li èŠ‚ç‚¹æ‰€æœ‰ç›´æ¥ a å­èŠ‚ç‚¹ï¼Œå¯ä»¥è¿™æ ·æ¥å®ç°ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li/a'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬é€šè¿‡è¿½åŠ ä¸€ä¸ª /a å³é€‰æ‹©äº†æ‰€æœ‰ li èŠ‚ç‚¹çš„æ‰€æœ‰ç›´æ¥ a å­èŠ‚ç‚¹ï¼Œå› ä¸º //li æ˜¯é€‰ä¸­æ‰€æœ‰lièŠ‚ç‚¹ï¼Œ /a æ˜¯é€‰ä¸­lièŠ‚ç‚¹çš„æ‰€æœ‰ç›´æ¥å­èŠ‚ç‚¹ aï¼ŒäºŒè€…ç»„åˆåœ¨ä¸€èµ·å³è·å–äº†æ‰€æœ‰lièŠ‚ç‚¹çš„æ‰€æœ‰ç›´æ¥ a å­èŠ‚ç‚¹ã€‚</p>

<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[&lt;Element a at 0x106ee8688&gt;, &lt;Element a at 0x106ee86c8&gt;, &lt;Element a at 0x106ee8708&gt;, &lt;Element a at 0x106ee8748&gt;, &lt;Element a at 0x106ee8788&gt;]
</code></pre></div></div>
<p>ä½†æ˜¯æ­¤å¤„çš„ / æ˜¯é€‰å–ç›´æ¥å­èŠ‚ç‚¹ï¼Œå¦‚æœæˆ‘ä»¬è¦è·å–æ‰€æœ‰å­å­™èŠ‚ç‚¹å°±è¯¥ä½¿ç”¨ // äº†ï¼Œä¾‹å¦‚æˆ‘ä»¬è¦è·å– ul èŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å­å­™ a èŠ‚ç‚¹ï¼Œå¯ä»¥è¿™æ ·æ¥å®ç°ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//ul//a'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿è¡Œç»“æœæ˜¯ç›¸åŒçš„ã€‚</p>

<p>ä½†æ˜¯è¿™é‡Œå¦‚æœæˆ‘ä»¬ç”¨ //ul/a å°±æ— æ³•è·å–ä»»ä½•ç»“æœäº†ï¼Œå› ä¸º / æ˜¯è·å–ç›´æ¥å­èŠ‚ç‚¹ï¼Œè€Œåœ¨ ul èŠ‚ç‚¹ä¸‹æ²¡æœ‰ç›´æ¥çš„ a å­èŠ‚ç‚¹ï¼Œåªæœ‰ li èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ— æ³•è·å–ä»»ä½•åŒ¹é…ç»“æœï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//ul/a'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[]
</code></pre></div></div>
<p>å› æ­¤åœ¨è¿™é‡Œæˆ‘ä»¬è¦æ³¨æ„ / å’Œ // çš„åŒºåˆ«ï¼Œ/ æ˜¯è·å–ç›´æ¥å­èŠ‚ç‚¹ï¼Œ// æ˜¯è·å–å­å­™èŠ‚ç‚¹ã€‚</p>
<h2 id="çˆ¶èŠ‚ç‚¹">çˆ¶èŠ‚ç‚¹</h2>

<p>æˆ‘ä»¬çŸ¥é“é€šè¿‡è¿ç»­çš„ / æˆ– // å¯ä»¥æŸ¥æ‰¾å­èŠ‚ç‚¹æˆ–å­å­™èŠ‚ç‚¹ï¼Œé‚£å‡å¦‚æˆ‘ä»¬çŸ¥é“äº†å­èŠ‚ç‚¹æ€æ ·æ¥æŸ¥æ‰¾çˆ¶èŠ‚ç‚¹å‘¢ï¼Ÿåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨ .. æ¥è·å–çˆ¶èŠ‚ç‚¹ã€‚</p>

<p>æ¯”å¦‚æˆ‘ä»¬ç°åœ¨é¦–å…ˆé€‰ä¸­ href æ˜¯ link4.html çš„ a èŠ‚ç‚¹ï¼Œç„¶åå†è·å–å…¶çˆ¶èŠ‚ç‚¹ï¼Œç„¶åå†è·å–å…¶ class å±æ€§ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//a[@href="https://ask.hellobi.com/link4.html"]/../@class'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['item-1']
</code></pre></div></div>
<p>æ£€æŸ¥ä¸€ä¸‹ç»“æœï¼Œæ­£æ˜¯æˆ‘ä»¬è·å–çš„ç›®æ ‡ li èŠ‚ç‚¹çš„ classï¼Œè·å–çˆ¶èŠ‚ç‚¹æˆåŠŸã€‚</p>

<p>åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ parent:: æ¥è·å–çˆ¶èŠ‚ç‚¹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//a[@href="https://ask.hellobi.com/link4.html"]/parent::*/@class'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<h2 id="å±æ€§åŒ¹é…">å±æ€§åŒ¹é…</h2>

<p>åœ¨é€‰å–çš„æ—¶å€™æˆ‘ä»¬è¿˜å¯ä»¥ç”¨ @ ç¬¦å·è¿›è¡Œå±æ€§è¿‡æ»¤ï¼Œæ¯”å¦‚åœ¨è¿™é‡Œå¦‚æœæˆ‘ä»¬è¦é€‰å– class ä¸º item-1 çš„ li èŠ‚ç‚¹ï¼Œå¯ä»¥è¿™æ ·å®ç°:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[@class="item-0"]'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬é€šè¿‡åŠ å…¥ [@class=â€item-0â€] å°±é™åˆ¶äº†èŠ‚ç‚¹çš„ class å±æ€§ä¸º item-0ï¼Œè€Œ HTML æ–‡æœ¬ä¸­ç¬¦åˆæ¡ä»¶çš„ li èŠ‚ç‚¹æœ‰ä¸¤ä¸ªï¼Œæ‰€ä»¥è¿”å›ç»“æœåº”è¯¥è¿”å›ä¸¤ä¸ªåŒ¹é…åˆ°çš„å…ƒç´ ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[&lt;Element li at 0x10a399288&gt;, &lt;Element li at 0x10a3992c8&gt;]
</code></pre></div></div>
<p>å¯è§åŒ¹é…ç»“æœç»“æœæ­£æ˜¯ä¸¤ä¸ªï¼Œè‡³äºæ˜¯ä¸æ˜¯é‚£æ­£ç¡®çš„ä¸¤ä¸ªï¼Œæˆ‘ä»¬åœ¨åé¢éªŒè¯ä¸€ä¸‹ã€‚</p>
<h2 id="æ–‡æœ¬è·å–">æ–‡æœ¬è·å–</h2>

<p>æˆ‘ä»¬ç”¨ XPath ä¸­çš„ text() æ–¹æ³•å¯ä»¥è·å–èŠ‚ç‚¹ä¸­çš„æ–‡æœ¬ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°è¯•è·å–ä¸€ä¸‹ä¸Šæ–‡ li èŠ‚ç‚¹ä¸­çš„æ–‡æœ¬ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[@class="item-0"]/text()'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['\n     ']
</code></pre></div></div>
<p>å¾ˆå¥‡æ€ªçš„æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰è·å–åˆ°ä»»ä½•æ–‡æœ¬ï¼Œè€Œæ˜¯åªè·å–åˆ°äº†ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸º XPath ä¸­ text() å‰é¢æ˜¯ /ï¼Œè€Œæ­¤ / çš„å«ä¹‰æ˜¯é€‰å–ç›´æ¥å­èŠ‚ç‚¹ï¼Œè€Œæ­¤å¤„å¾ˆæ˜æ˜¾ li çš„ç›´æ¥å­èŠ‚ç‚¹éƒ½æ˜¯ a èŠ‚ç‚¹ï¼Œæ–‡æœ¬éƒ½æ˜¯åœ¨ a èŠ‚ç‚¹å†…éƒ¨çš„ï¼Œæ‰€ä»¥è¿™é‡ŒåŒ¹é…åˆ°çš„ç»“æœå°±æ˜¯è¢«ä¿®æ­£çš„ li èŠ‚ç‚¹å†…éƒ¨çš„æ¢è¡Œç¬¦ï¼Œå› ä¸ºè‡ªåŠ¨ä¿®æ­£çš„lièŠ‚ç‚¹çš„å°¾æ ‡ç­¾æ¢è¡Œäº†ã€‚</p>

<p>å³é€‰ä¸­çš„æ˜¯è¿™ä¸¤ä¸ªèŠ‚ç‚¹ï¼š</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-0"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"link1.html"</span><span class="nt">&gt;</span>first item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-0"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"link5.html"</span><span class="nt">&gt;</span>fifth item<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/li&gt;</span>
</code></pre></div></div>
<p>å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹å› ä¸ºè‡ªåŠ¨ä¿®æ­£ï¼Œli èŠ‚ç‚¹çš„å°¾æ ‡ç­¾æ·»åŠ çš„æ—¶å€™æ¢è¡Œäº†ï¼Œæ‰€ä»¥æå–æ–‡æœ¬å¾—åˆ°çš„å”¯ä¸€ç»“æœå°±æ˜¯ li èŠ‚ç‚¹çš„å°¾æ ‡ç­¾å’Œ a èŠ‚ç‚¹çš„å°¾æ ‡ç­¾ä¹‹é—´çš„æ¢è¡Œç¬¦ã€‚</p>

<p>å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è·å– li èŠ‚ç‚¹å†…éƒ¨çš„æ–‡æœ¬å°±æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯é€‰å–åˆ° a èŠ‚ç‚¹å†è·å–æ–‡æœ¬ï¼Œå¦ä¸€ç§å°±æ˜¯ä½¿ç”¨ //ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹äºŒè€…çš„åŒºåˆ«æ˜¯ä»€ä¹ˆã€‚</p>

<p>é¦–å…ˆæˆ‘ä»¬é€‰å–åˆ° a èŠ‚ç‚¹å†è·å–æ–‡æœ¬ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[@class="item-0"]/a/text()'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['first item', 'fifth item']
</code></pre></div></div>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œè¿”å›å€¼æ˜¯ä¸¤ä¸ªï¼Œå†…å®¹éƒ½æ˜¯å±æ€§ä¸º item-0 çš„ li èŠ‚ç‚¹çš„æ–‡æœ¬ï¼Œè¿™ä¹Ÿå°è¯äº†æˆ‘ä»¬ä¸Šæ–‡ä¸­å±æ€§åŒ¹é…çš„ç»“æœæ˜¯æ­£ç¡®çš„ã€‚</p>

<p>åœ¨è¿™é‡Œæˆ‘ä»¬æ˜¯é€å±‚é€‰å–çš„ï¼Œå…ˆé€‰å–äº† li èŠ‚ç‚¹ï¼Œåˆåˆ©ç”¨ / é€‰å–äº†å…¶ç›´æ¥å­èŠ‚ç‚¹ aï¼Œç„¶åå†é€‰å–å…¶æ–‡æœ¬ï¼Œå¾—åˆ°çš„ç»“æœæ°å¥½æ˜¯ç¬¦åˆæˆ‘ä»¬é¢„æœŸçš„ä¸¤ä¸ªç»“æœã€‚</p>

<p>æˆ‘ä»¬å†æ¥çœ‹ä¸‹ç”¨å¦ä¸€ç§æ–¹å¼ // é€‰å–çš„ç»“æœï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[@class="item-0"]//text()'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['first item', 'fifth item', '\n     ']
</code></pre></div></div>
<p>ä¸å‡ºæ‰€æ–™ï¼Œè¿™é‡Œè¿”å›ç»“æœæ˜¯ä¸‰ä¸ªï¼Œå¯æƒ³è€ŒçŸ¥è¿™é‡Œæ˜¯é€‰å–æ‰€æœ‰å­å­™èŠ‚ç‚¹çš„æ–‡æœ¬ï¼Œå…¶ä¸­å‰ä¸¤ä¸ªå°±æ˜¯ li çš„å­èŠ‚ç‚¹ a èŠ‚ç‚¹å†…éƒ¨çš„æ–‡æœ¬ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯æœ€åä¸€ä¸ª li èŠ‚ç‚¹å†…éƒ¨çš„æ–‡æœ¬ï¼Œå³æ¢è¡Œç¬¦ã€‚</p>

<p>æ‰€ä»¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬è¦æƒ³è·å–å­å­™èŠ‚ç‚¹å†…éƒ¨çš„æ‰€æœ‰æ–‡æœ¬ï¼Œå¯ä»¥ç›´æ¥ç”¨ // åŠ  text() çš„æ–¹å¼è·å–ï¼Œè¿™æ ·å¯ä»¥ä¿è¯è·å–åˆ°æœ€å…¨é¢çš„æ–‡æœ¬ä¿¡æ¯ï¼Œä½†æ˜¯å¯èƒ½ä¼šå¤¹æ‚ä¸€äº›æ¢è¡Œç¬¦ç­‰ç‰¹æ®Šå­—ç¬¦ã€‚å¦‚æœæˆ‘ä»¬æƒ³è·å–æŸäº›ç‰¹å®šå­å­™èŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰æ–‡æœ¬ï¼Œå¯ä»¥å…ˆé€‰å–åˆ°ç‰¹å®šçš„å­å­™èŠ‚ç‚¹ï¼Œç„¶åå†è°ƒç”¨ text() æ–¹æ³•è·å–å…¶å†…éƒ¨æ–‡æœ¬ï¼Œè¿™æ ·å¯ä»¥ä¿è¯è·å–çš„ç»“æœæ˜¯æ•´æ´çš„ã€‚</p>
<h2 id="å±æ€§è·å–">å±æ€§è·å–</h2>

<p>æˆ‘ä»¬çŸ¥é“äº†ç”¨ text() å¯ä»¥è·å–èŠ‚ç‚¹å†…éƒ¨æ–‡æœ¬ï¼Œé‚£ä¹ˆèŠ‚ç‚¹å±æ€§è¯¥æ€æ ·è·å–å‘¢ï¼Ÿå…¶å®è¿˜æ˜¯ç”¨ @ ç¬¦å·å°±å¯ä»¥ï¼Œä¾‹å¦‚æˆ‘ä»¬æƒ³è·å–æ‰€æœ‰ li èŠ‚ç‚¹ä¸‹æ‰€æœ‰ a èŠ‚ç‚¹çš„ href å±æ€§ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li/a/@href'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬é€šè¿‡ @href å³å¯è·å–èŠ‚ç‚¹çš„ href å±æ€§ï¼Œæ³¨æ„æ­¤å¤„å’Œå±æ€§åŒ¹é…çš„æ–¹æ³•ä¸åŒï¼Œå±æ€§åŒ¹é…æ˜¯ä¸­æ‹¬å·åŠ å±æ€§åå’Œå€¼æ¥é™å®šæŸä¸ªå±æ€§ï¼Œå¦‚ [@href=â€https://ask.hellobi.com/link1.htmlâ€]ï¼Œè€Œæ­¤å¤„çš„ @href æŒ‡çš„æ˜¯è·å–èŠ‚ç‚¹çš„æŸä¸ªå±æ€§ï¼ŒäºŒè€…éœ€è¦åšå¥½åŒºåˆ†ã€‚</p>

<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['link1.html', 'link2.html', 'link3.html', 'link4.html', 'link5.html']
</code></pre></div></div>
<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆåŠŸè·å–äº†æ‰€æœ‰ li èŠ‚ç‚¹ä¸‹çš„ a èŠ‚ç‚¹çš„ href å±æ€§ï¼Œä»¥åˆ—è¡¨å½¢å¼è¿”å›ã€‚</p>
<h2 id="å±æ€§å¤šå€¼åŒ¹é…">å±æ€§å¤šå€¼åŒ¹é…</h2>

<p>æœ‰æ—¶å€™æŸäº›èŠ‚ç‚¹çš„æŸä¸ªå±æ€§å¯èƒ½æœ‰å¤šä¸ªå€¼ï¼Œä¾‹å¦‚ä¸‹é¢ä¾‹å­ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">text</span> <span class="o">=</span> <span class="s">'''
&lt;li class="li li-first"&gt;&lt;a href="https://ask.hellobi.com/link.html"&gt;first item&lt;/a&gt;&lt;/li&gt;
'''</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[@class="li"]/a/text()'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>åœ¨è¿™é‡Œ HTML æ–‡æœ¬ä¸­çš„ li èŠ‚ç‚¹çš„ class å±æ€§æœ‰ä¸¤ä¸ªå€¼ li å’Œ li-firstï¼Œä½†æ˜¯æ­¤æ—¶å¦‚æœæˆ‘ä»¬è¿˜æƒ³ç”¨ä¹‹å‰çš„å±æ€§åŒ¹é…è·å–å°±æ— æ³•åŒ¹é…äº†ï¼Œä»£ç è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[]
</code></pre></div></div>
<p>è¿™æ—¶å¦‚æœå±æ€§æœ‰å¤šä¸ªå€¼å°±éœ€è¦ç”¨ contains() å‡½æ•°äº†ï¼Œä»£ç å¯ä»¥æ”¹å†™å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">text</span> <span class="o">=</span> <span class="s">'''
&lt;li class="li li-first"&gt;&lt;a href="https://ask.hellobi.com/link.html"&gt;first item&lt;/a&gt;&lt;/li&gt;
'''</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[contains(@class, "li")]/a/text()'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿™æ ·æˆ‘ä»¬é€šè¿‡ contains() æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥å±æ€§åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥å±æ€§å€¼ï¼Œè¿™æ ·åªè¦æ­¤å±æ€§åŒ…å«æ‰€ä¼ å…¥çš„å±æ€§å€¼å°±å¯ä»¥å®ŒæˆåŒ¹é…äº†ã€‚</p>

<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['first item']
</code></pre></div></div>
<p>æ­¤ç§é€‰æ‹©æ–¹å¼åœ¨æŸä¸ªèŠ‚ç‚¹çš„æŸä¸ªå±æ€§æœ‰å¤šä¸ªå€¼çš„æ—¶å€™ç»å¸¸ä¼šç”¨åˆ°ï¼Œå¦‚æŸä¸ªèŠ‚ç‚¹çš„ class å±æ€§é€šå¸¸æœ‰å¤šä¸ªã€‚</p>
<h2 id="å¤šå±æ€§åŒ¹é…">å¤šå±æ€§åŒ¹é…</h2>

<p>å¦å¤–æˆ‘ä»¬å¯èƒ½è¿˜é‡åˆ°ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æ ¹æ®å¤šä¸ªå±æ€§æ‰èƒ½ç¡®å®šä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ˜¯å°±éœ€è¦åŒæ—¶åŒ¹é…å¤šä¸ªå±æ€§æ‰å¯ä»¥ï¼Œé‚£ä¹ˆè¿™é‡Œå¯ä»¥ä½¿ç”¨è¿ç®—ç¬¦ and æ¥è¿æ¥ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">text</span> <span class="o">=</span> <span class="s">'''
&lt;li class="li li-first" name="item"&gt;&lt;a href="https://ask.hellobi.com/link.html"&gt;first item&lt;/a&gt;&lt;/li&gt;
'''</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[contains(@class, "li") and @name="item"]/a/text()'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>åœ¨è¿™é‡Œ HTML æ–‡æœ¬çš„ li èŠ‚ç‚¹åˆå¢åŠ äº†ä¸€ä¸ªå±æ€§ nameï¼Œè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦åŒæ—¶æ ¹æ® class å’Œ name å±æ€§æ¥é€‰æ‹©ï¼Œå°±å¯ä»¥ and è¿ç®—ç¬¦è¿æ¥ä¸¤ä¸ªæ¡ä»¶ï¼Œä¸¤ä¸ªæ¡ä»¶éƒ½è¢«ä¸­æ‹¬å·åŒ…å›´ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['first item']
</code></pre></div></div>
<p>è¿™é‡Œçš„ and å…¶å®æ˜¯ XPath ä¸­çš„è¿ç®—ç¬¦ï¼Œå¦å¤–è¿˜æœ‰å¾ˆå¤šè¿ç®—ç¬¦ï¼Œå¦‚ orã€mod ç­‰ç­‰ï¼Œåœ¨æ­¤æ€»ç»“å¦‚ä¸‹ï¼š</p>

<table>
  <thead>
    <tr>
      <th>è¿ç®—ç¬¦</th>
      <th>æè¿°</th>
      <th>å®ä¾‹</th>
      <th>è¿”å›å€¼</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>or</td>
      <td>æˆ–</td>
      <td>price=9.80 or price=9.70</td>
      <td>å¦‚æœ price æ˜¯ 9.80ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ price æ˜¯ 9.50ï¼Œåˆ™è¿”å› false</td>
    </tr>
    <tr>
      <td>and</td>
      <td>ä¸</td>
      <td>price&gt;9.00 and price&lt;9.90</td>
      <td>å¦‚æœ price æ˜¯ 9.80ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ price æ˜¯ 8.50ï¼Œåˆ™è¿”å› false</td>
    </tr>
    <tr>
      <td>mod</td>
      <td>è®¡ç®—é™¤æ³•çš„ä½™æ•°</td>
      <td>5 mod 2</td>
      <td>1</td>
    </tr>
    <tr>
      <td>|</td>
      <td>è®¡ç®—ä¸¤ä¸ªèŠ‚ç‚¹é›†</td>
      <td>//book | //cd</td>
      <td>è¿”å›æ‰€æœ‰æ‹¥æœ‰ book å’Œ cd å…ƒç´ çš„èŠ‚ç‚¹é›†</td>
    </tr>
    <tr>
      <td>+</td>
      <td>åŠ æ³•</td>
      <td>6 + 4</td>
      <td>10</td>
    </tr>
    <tr>
      <td>-</td>
      <td>å‡æ³•</td>
      <td>6 - 4</td>
      <td>2</td>
    </tr>
    <tr>
      <td>*</td>
      <td>ä¹˜æ³•</td>
      <td>6 * 4</td>
      <td>24</td>
    </tr>
    <tr>
      <td>div</td>
      <td>é™¤æ³•</td>
      <td>8 div 4</td>
      <td>2</td>
    </tr>
    <tr>
      <td>=</td>
      <td>ç­‰äº</td>
      <td>price=9.80</td>
      <td>å¦‚æœ price æ˜¯ 9.80ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ price æ˜¯ 9.90ï¼Œåˆ™è¿”å› false</td>
    </tr>
    <tr>
      <td>!=</td>
      <td>ä¸ç­‰äº</td>
      <td>price!=9.80</td>
      <td>å¦‚æœ price æ˜¯ 9.90ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ price æ˜¯ 9.80ï¼Œåˆ™è¿”å› false</td>
    </tr>
    <tr>
      <td>&lt;</td>
      <td>å°äº</td>
      <td>price&lt;9.80</td>
      <td>å¦‚æœ price æ˜¯ 9.00ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ price æ˜¯ 9.90ï¼Œåˆ™è¿”å› false</td>
    </tr>
    <tr>
      <td>&lt;=</td>
      <td>å°äºæˆ–ç­‰äº</td>
      <td>price&lt;=9.80</td>
      <td>å¦‚æœ price æ˜¯ 9.00ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ price æ˜¯ 9.90ï¼Œåˆ™è¿”å› false</td>
    </tr>
    <tr>
      <td>&gt;</td>
      <td>å¤§äº</td>
      <td>price&gt;9.80</td>
      <td>å¦‚æœ price æ˜¯ 9.90ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ price æ˜¯ 9.80ï¼Œåˆ™è¿”å› false</td>
    </tr>
    <tr>
      <td>&gt;=</td>
      <td>å¤§äºæˆ–ç­‰äº</td>
      <td>price&gt;=9.80</td>
      <td>å¦‚æœ price æ˜¯ 9.90ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ price æ˜¯ 9.70ï¼Œåˆ™è¿”å› false</td>
    </tr>
  </tbody>
</table>

<p>æ­¤è¡¨å‚è€ƒæ¥æºï¼šhttp://www.w3school.com.cn/xpath/xpath_operators.aspã€‚</p>
<h2 id="æŒ‰åºé€‰æ‹©">æŒ‰åºé€‰æ‹©</h2>

<p>æœ‰æ—¶å€™æˆ‘ä»¬åœ¨é€‰æ‹©çš„æ—¶å€™å¯èƒ½æŸäº›å±æ€§åŒæ—¶åŒ¹é…äº†å¤šä¸ªèŠ‚ç‚¹ï¼Œä½†æ˜¯æˆ‘ä»¬åªæƒ³è¦å…¶ä¸­çš„æŸä¸ªèŠ‚ç‚¹ï¼Œå¦‚ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼Œæˆ–è€…æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ—¶è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>

<p>è¿™æ—¶å¯ä»¥åˆ©ç”¨ä¸­æ‹¬å·ä¼ å…¥ç´¢å¼•çš„æ–¹æ³•è·å–ç‰¹å®šæ¬¡åºçš„èŠ‚ç‚¹ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">text</span> <span class="o">=</span> <span class="s">'''
 &lt;div&gt;
     &lt;ul&gt;
          &lt;li class="item-0"&gt;&lt;a href="https://ask.hellobi.com/link1.html"&gt;first item&lt;/a&gt;&lt;/li&gt;
          &lt;li class="item-1"&gt;&lt;a href="https://ask.hellobi.com/link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt;
          &lt;li class="item-inactive"&gt;&lt;a href="https://ask.hellobi.com/link3.html"&gt;third item&lt;/a&gt;&lt;/li&gt;
          &lt;li class="item-1"&gt;&lt;a href="https://ask.hellobi.com/link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt;
          &lt;li class="item-0"&gt;&lt;a href="https://ask.hellobi.com/link5.html"&gt;fifth item&lt;/a&gt;
      &lt;/ul&gt;
  &lt;/div&gt;
 '''</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[1]/a/text()'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[last()]/a/text()'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[position()&lt;3]/a/text()'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[last()-2]/a/text()'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>ç¬¬ä¸€æ¬¡é€‰æ‹©æˆ‘ä»¬é€‰å–äº†ç¬¬ä¸€ä¸ª li èŠ‚ç‚¹ï¼Œä¸­æ‹¬å·ä¸­ä¼ å…¥æ•°å­—1å³å¯ï¼Œæ³¨æ„è¿™é‡Œå’Œä»£ç ä¸­ä¸åŒï¼Œåºå·æ˜¯ä»¥ 1 å¼€å¤´çš„ï¼Œä¸æ˜¯ 0 å¼€å¤´çš„ã€‚</p>

<p>ç¬¬äºŒæ¬¡é€‰æ‹©æˆ‘ä»¬é€‰å–äº†æœ€åä¸€ä¸ª li èŠ‚ç‚¹ï¼Œä¸­æ‹¬å·ä¸­ä¼ å…¥ last() å³å¯ï¼Œè¿”å›çš„ä¾¿æ˜¯æœ€åä¸€ä¸ª li èŠ‚ç‚¹ã€‚</p>

<p>ç¬¬ä¸‰æ¬¡é€‰æ‹©æˆ‘ä»¬é€‰å–äº†ä½ç½®å°äº 3 çš„ li èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä½ç½®åºå·ä¸º 1 å’Œ 2 çš„èŠ‚ç‚¹ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯å‰ 2 ä¸ª li èŠ‚ç‚¹ã€‚</p>

<p>ç¬¬å››æ¬¡é€‰æ‹©æˆ‘ä»¬é€‰å–äº†å€’æ•°ç¬¬ä¸‰ä¸ª li èŠ‚ç‚¹ï¼Œä¸­æ‹¬å·ä¸­ä¼ å…¥ last()-2å³å¯ï¼Œå› ä¸º last() æ˜¯æœ€åä¸€ä¸ªï¼Œæ‰€ä»¥ last()-2 å°±æ˜¯å€’æ•°ç¬¬ä¸‰ä¸ªã€‚</p>

<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    ['first item']
    ['fifth item']
    ['first item', 'second item']
    ['third item']
</code></pre></div></div>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† last()ã€position() ç­‰å‡½æ•°ï¼ŒXPath ä¸­æä¾›äº† 100 å¤šä¸ªå‡½æ•°ï¼ŒåŒ…æ‹¬å­˜å–ã€æ•°å€¼ã€å­—ç¬¦ä¸²ã€é€»è¾‘ã€èŠ‚ç‚¹ã€åºåˆ—ç­‰å¤„ç†åŠŸèƒ½ï¼Œå…·ä½“æ‰€æœ‰çš„å‡½æ•°ä½œç”¨å¯ä»¥å‚è€ƒï¼šhttp://www.w3school.com.cn/xpath/xpath_functions.aspã€‚</p>
<h2 id="èŠ‚ç‚¹è½´é€‰æ‹©">èŠ‚ç‚¹è½´é€‰æ‹©</h2>

<p>XPath æä¾›äº†å¾ˆå¤šèŠ‚ç‚¹è½´é€‰æ‹©æ–¹æ³•ï¼Œè‹±æ–‡å«åš XPath Axesï¼ŒåŒ…æ‹¬è·å–å­å…ƒç´ ã€å…„å¼Ÿå…ƒç´ ã€çˆ¶å…ƒç´ ã€ç¥–å…ˆå…ƒç´ ç­‰ç­‰ï¼Œåœ¨ä¸€å®šæƒ…å†µä¸‹ä½¿ç”¨å®ƒå¯ä»¥æ–¹ä¾¿åœ°å®ŒæˆèŠ‚ç‚¹çš„é€‰æ‹©ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªå®ä¾‹æ¥æ„Ÿå—ä¸€ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">text</span> <span class="o">=</span> <span class="s">'''
&lt;div&gt;
    &lt;ul&gt;
         &lt;li class="item-0"&gt;&lt;a href="https://ask.hellobi.com/link1.html"&gt;&lt;span&gt;first item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
         &lt;li class="item-1"&gt;&lt;a href="https://ask.hellobi.com/link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt;
         &lt;li class="item-inactive"&gt;&lt;a href="https://ask.hellobi.com/link3.html"&gt;third item&lt;/a&gt;&lt;/li&gt;
         &lt;li class="item-1"&gt;&lt;a href="https://ask.hellobi.com/link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt;
         &lt;li class="item-0"&gt;&lt;a href="https://ask.hellobi.com/link5.html"&gt;fifth item&lt;/a&gt;
     &lt;/ul&gt;
 &lt;/div&gt;
'''</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[1]/ancestor::*'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[1]/ancestor::div'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[1]/attribute::*'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[1]/child::a[@href="https://ask.hellobi.com/link1.html"]'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[1]/descendant::span'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[1]/following::*[2]'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[1]/following-sibling::*'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    [&lt;Element html at 0x107941808&gt;, &lt;Element body at 0x1079418c8&gt;, &lt;Element div at 0x107941908&gt;, &lt;Element ul at 0x107941948&gt;]
    [&lt;Element div at 0x107941908&gt;]
    ['item-0']
    [&lt;Element a at 0x1079418c8&gt;]
    [&lt;Element span at 0x107941948&gt;]
    [&lt;Element a at 0x1079418c8&gt;]
    [&lt;Element li at 0x107941948&gt;, &lt;Element li at 0x107941988&gt;, &lt;Element li at 0x1079419c8&gt;, &lt;Element li at 0x107941a08&gt;]
</code></pre></div></div>
<p>ç¬¬ä¸€æ¬¡é€‰æ‹©æˆ‘ä»¬è°ƒç”¨äº† ancestor è½´ï¼Œå¯ä»¥è·å–æ‰€æœ‰ç¥–å…ˆèŠ‚ç‚¹ï¼Œå…¶åéœ€è¦è·Ÿä¸¤ä¸ªå†’å·ï¼Œç„¶åæ˜¯èŠ‚ç‚¹çš„é€‰æ‹©å™¨ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨äº† *ï¼Œè¡¨ç¤ºåŒ¹é…æ‰€æœ‰èŠ‚ç‚¹ï¼Œå› æ­¤è¿”å›ç»“æœæ˜¯ç¬¬ä¸€ä¸ª li èŠ‚ç‚¹çš„æ‰€æœ‰ç¥–å…ˆèŠ‚ç‚¹ï¼ŒåŒ…æ‹¬ htmlï¼Œbodyï¼Œdivï¼Œulã€‚</p>

<p>ç¬¬äºŒæ¬¡é€‰æ‹©æˆ‘ä»¬åˆåŠ äº†é™å®šæ¡ä»¶ï¼Œè¿™æ¬¡åœ¨å†’å·åé¢åŠ äº† divï¼Œè¿™æ ·å¾—åˆ°çš„ç»“æœå°±åªæœ‰ div è¿™ä¸ªç¥–å…ˆèŠ‚ç‚¹äº†ã€‚</p>

<p>ç¬¬ä¸‰æ¬¡é€‰æ‹©æˆ‘ä»¬è°ƒç”¨äº† attribute è½´ï¼Œå¯ä»¥è·å–æ‰€æœ‰å±æ€§å€¼ï¼Œå…¶åè·Ÿçš„é€‰æ‹©å™¨è¿˜æ˜¯ *ï¼Œè¿™ä»£è¡¨è·å–èŠ‚ç‚¹çš„æ‰€æœ‰å±æ€§ï¼Œè¿”å›å€¼å°±æ˜¯ li èŠ‚ç‚¹çš„æ‰€æœ‰å±æ€§å€¼ã€‚</p>

<p>ç¬¬å››æ¬¡é€‰æ‹©æˆ‘ä»¬è°ƒç”¨äº† child è½´ï¼Œå¯ä»¥è·å–æ‰€æœ‰ç›´æ¥å­èŠ‚ç‚¹ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åˆåŠ äº†é™å®šæ¡ä»¶é€‰å– href å±æ€§ä¸º link1.html çš„ a èŠ‚ç‚¹ã€‚</p>

<p>ç¬¬äº”æ¬¡é€‰æ‹©æˆ‘ä»¬è°ƒç”¨äº† descendant è½´ï¼Œå¯ä»¥è·å–æ‰€æœ‰å­å­™èŠ‚ç‚¹ï¼Œè¿™é‡Œæˆ‘ä»¬åˆåŠ äº†é™å®šæ¡ä»¶è·å– span èŠ‚ç‚¹ï¼Œæ‰€ä»¥è¿”å›çš„å°±æ˜¯åªåŒ…å« span èŠ‚ç‚¹è€Œæ²¡æœ‰ a èŠ‚ç‚¹ã€‚</p>

<p>ç¬¬å…­æ¬¡é€‰æ‹©æˆ‘ä»¬è°ƒç”¨äº† following è½´ï¼Œå¯ä»¥è·å–å½“å‰èŠ‚ç‚¹ä¹‹åçš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿™é‡Œæˆ‘ä»¬è™½ç„¶ä½¿ç”¨çš„æ˜¯ * åŒ¹é…ï¼Œä½†åˆåŠ äº†ç´¢å¼•é€‰æ‹©ï¼Œæ‰€ä»¥åªè·å–äº†ç¬¬äºŒä¸ªåç»­èŠ‚ç‚¹ã€‚</p>

<p>ç¬¬ä¸ƒæ¬¡é€‰æ‹©æˆ‘ä»¬è°ƒç”¨äº† following-sibling è½´ï¼Œå¯ä»¥è·å–å½“å‰èŠ‚ç‚¹ä¹‹åçš„æ‰€æœ‰åŒçº§èŠ‚ç‚¹ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ * åŒ¹é…ï¼Œæ‰€ä»¥è·å–äº†æ‰€æœ‰åç»­åŒçº§èŠ‚ç‚¹ã€‚</p>

<h1 id="ä»¥ä¸Šæ˜¯xpathè½´çš„ç®€å•ç”¨æ³•æ›´å¤šçš„è½´çš„ä½¿ç”¨å¯ä»¥å‚è€ƒhttpwwww3schoolcomcnxpathxpath_axesasp">ä»¥ä¸Šæ˜¯XPathè½´çš„ç®€å•ç”¨æ³•ï¼Œæ›´å¤šçš„è½´çš„ä½¿ç”¨å¯ä»¥å‚è€ƒï¼šhttp://www.w3school.com.cn/xpath/xpath_axes.aspã€‚</h1>
<hr />
<p>layout: post
title: XPath
subtitle: 
author: Balbo Cheng
categories: python
tags: [reptile]
â€”
<strong>XPath</strong>ï¼Œå…¨ç§° XML Path Languageï¼Œå³ XML è·¯å¾„è¯­è¨€ï¼Œå®ƒæ˜¯ä¸€é—¨åœ¨XMLæ–‡æ¡£ä¸­æŸ¥æ‰¾ä¿¡æ¯çš„è¯­è¨€ã€‚XPath æœ€åˆè®¾è®¡æ˜¯ç”¨æ¥æœå¯»XMLæ–‡æ¡£çš„ï¼Œä½†æ˜¯å®ƒåŒæ ·é€‚ç”¨äº HTML æ–‡æ¡£çš„æœç´¢ã€‚</p>

<p>æ‰€ä»¥åœ¨åšçˆ¬è™«æ—¶ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ä½¿ç”¨ XPath æ¥åšç›¸åº”çš„ä¿¡æ¯æŠ½å–ã€‚</p>
<h2 id="xpathæ¦‚è§ˆ-1">XPathæ¦‚è§ˆ</h2>

<p>XPath çš„é€‰æ‹©åŠŸèƒ½ååˆ†å¼ºå¤§ï¼Œå®ƒæä¾›äº†éå¸¸ç®€æ´æ˜äº†çš„è·¯å¾„é€‰æ‹©è¡¨è¾¾å¼ï¼Œå¦å¤–å®ƒè¿˜æä¾›äº†è¶…è¿‡ 100 ä¸ªå†…å»ºå‡½æ•°ç”¨äºå­—ç¬¦ä¸²ã€æ•°å€¼ã€æ—¶é—´çš„åŒ¹é…ä»¥åŠèŠ‚ç‚¹ã€åºåˆ—çš„å¤„ç†ç­‰ç­‰ï¼Œå‡ ä¹æ‰€æœ‰æˆ‘ä»¬æƒ³è¦å®šä½çš„èŠ‚ç‚¹éƒ½å¯ä»¥ç”¨XPathæ¥é€‰æ‹©ã€‚</p>

<p>XPath äº 1999 å¹´ 11 æœˆ 16 æ—¥ æˆä¸º W3C æ ‡å‡†ï¼Œå®ƒè¢«è®¾è®¡ä¸ºä¾› XSLTã€XPointer ä»¥åŠå…¶ä»– XML è§£æè½¯ä»¶ä½¿ç”¨ï¼Œæ›´å¤šçš„æ–‡æ¡£å¯ä»¥è®¿é—®å…¶å®˜æ–¹ç½‘ç«™ï¼šhttps://www.w3.org/TR/xpath/ã€‚</p>
<h2 id="xpathå¸¸ç”¨è§„åˆ™-1">XPathå¸¸ç”¨è§„åˆ™</h2>

<p>æˆ‘ä»¬ç°ç”¨è¡¨æ ¼åˆ—ä¸¾ä¸€ä¸‹å‡ ä¸ªå¸¸ç”¨è§„åˆ™ï¼š</p>

<table>
  <thead>
    <tr>
      <th>è¡¨è¾¾å¼</th>
      <th>æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>nodename</td>
      <td>é€‰å–æ­¤èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>/</td>
      <td>ä»å½“å‰èŠ‚ç‚¹é€‰å–ç›´æ¥å­èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>//</td>
      <td>ä»å½“å‰èŠ‚ç‚¹é€‰å–å­å­™èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>.</td>
      <td>é€‰å–å½“å‰èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>..</td>
      <td>é€‰å–å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>@</td>
      <td>é€‰å–å±æ€§</td>
    </tr>
  </tbody>
</table>

<p>åœ¨è¿™é‡Œåˆ—å‡ºäº†XPathçš„å¸¸ç”¨åŒ¹é…è§„åˆ™ï¼Œä¾‹å¦‚ï¼š</p>

<blockquote>
  <p>//title[@lang=â€™engâ€™]</p>
</blockquote>

<p>è¿™å°±æ˜¯ä¸€ä¸ª XPath è§„åˆ™ï¼Œå®ƒå°±ä»£è¡¨é€‰æ‹©æ‰€æœ‰åç§°ä¸º titleï¼ŒåŒæ—¶å±æ€§ lang çš„å€¼ä¸º eng çš„èŠ‚ç‚¹ã€‚</p>

<p>åœ¨åæ–‡æˆ‘ä»¬ä¼šä»‹ç» XPath çš„è¯¦ç»†ç”¨æ³•ï¼Œé€šè¿‡ Python çš„ LXML åº“åˆ©ç”¨ XPath è¿›è¡Œ HTML çš„è§£æã€‚</p>

<h2 id="å®ä¾‹å¼•å…¥-1">å®ä¾‹å¼•å…¥</h2>

<p>æˆ‘ä»¬ç°ç”¨ä¸€ä¸ªå®ä¾‹æ¥æ„Ÿå—ä¸€ä¸‹ä½¿ç”¨ XPath æ¥å¯¹ç½‘é¡µè¿›è¡Œè§£æçš„è¿‡ç¨‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">text</span> <span class="o">=</span> <span class="s">'''
&lt;div&gt;
    &lt;ul&gt;
         &lt;li class="item-0"&gt;&lt;a href="https://ask.hellobi.com/link1.html"&gt;first item&lt;/a&gt;&lt;/li&gt;
         &lt;li class="item-1"&gt;&lt;a href="https://ask.hellobi.com/link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt;
         &lt;li class="item-inactive"&gt;&lt;a href="https://ask.hellobi.com/link3.html"&gt;third item&lt;/a&gt;&lt;/li&gt;
         &lt;li class="item-1"&gt;&lt;a href="https://ask.hellobi.com/link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt;
         &lt;li class="item-0"&gt;&lt;a href="https://ask.hellobi.com/link5.html"&gt;fifth item&lt;/a&gt;
     &lt;/ul&gt;
 &lt;/div&gt;
'''</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
</code></pre></div></div>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥äº† LXML åº“çš„ etree æ¨¡å—ï¼Œç„¶åå£°æ˜äº†ä¸€æ®µ HTML æ–‡æœ¬ï¼Œè°ƒç”¨ HTML ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ ·æˆ‘ä»¬å°±æˆåŠŸæ„é€ äº†ä¸€ä¸ª XPath è§£æå¯¹è±¡ï¼Œåœ¨è¿™é‡Œæ³¨æ„åˆ° HTML æ–‡æœ¬ä¸­çš„æœ€åä¸€ä¸ª li èŠ‚ç‚¹æ˜¯æ²¡æœ‰é—­åˆçš„ï¼Œä½†æ˜¯ etree æ¨¡å—å¯ä»¥å¯¹ HTML æ–‡æœ¬è¿›è¡Œè‡ªåŠ¨ä¿®æ­£ã€‚</p>

<p>åœ¨è¿™é‡Œæˆ‘ä»¬è°ƒç”¨ tostring() æ–¹æ³•å³å¯è¾“å‡ºä¿®æ­£åçš„ HTML ä»£ç ï¼Œä½†æ˜¯ç»“æœæ˜¯ bytes ç±»å‹ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨ decode() æ–¹æ³•è½¬æˆ str ç±»å‹ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;&lt;body&gt;&lt;div&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-0"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://ask.hellobi.com/link1.html"</span><span class="nt">&gt;</span>first item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-1"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://ask.hellobi.com/link2.html"</span><span class="nt">&gt;</span>second item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-inactive"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://ask.hellobi.com/link3.html"</span><span class="nt">&gt;</span>third item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-1"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://ask.hellobi.com/link4.html"</span><span class="nt">&gt;</span>fourth item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-0"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://ask.hellobi.com/link5.html"</span><span class="nt">&gt;</span>fifth item<span class="nt">&lt;/a&gt;</span>
     <span class="nt">&lt;/li&gt;&lt;/ul&gt;</span>
 <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;&lt;/html&gt;</span>
</code></pre></div></div>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç»è¿‡å¤„ç†ä¹‹å li èŠ‚ç‚¹æ ‡ç­¾è¢«è¡¥å…¨ï¼Œå¹¶ä¸”è¿˜è‡ªåŠ¨æ·»åŠ äº† bodyã€html èŠ‚ç‚¹ã€‚</p>

<p>å¦å¤–æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥è¯»å–æ–‡æœ¬æ–‡ä»¶è¿›è¡Œè§£æï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
</code></pre></div></div>
<p>å…¶ä¸­ test.html çš„å†…å®¹å°±æ˜¯ä¸Šé¢ä¾‹å­ä¸­çš„ HTML ä»£ç ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-0"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://ask.hellobi.com/link1.html"</span><span class="nt">&gt;</span>first item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-1"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://ask.hellobi.com/link2.html"</span><span class="nt">&gt;</span>second item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-inactive"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://ask.hellobi.com/link3.html"</span><span class="nt">&gt;</span>third item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-1"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://ask.hellobi.com/link4.html"</span><span class="nt">&gt;</span>fourth item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-0"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"https://ask.hellobi.com/link5.html"</span><span class="nt">&gt;</span>fifth item<span class="nt">&lt;/a&gt;</span>
     <span class="nt">&lt;/ul&gt;</span>
 <span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>
<p>è¿™æ¬¡çš„è¾“å‡ºç»“æœç•¥æœ‰ä¸åŒï¼Œå¤šäº†ä¸€ä¸ª DOCTYPE çš„å£°æ˜ï¼Œä¸è¿‡å¯¹è§£ææ— ä»»ä½•å½±å“ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"&gt;</span>
<span class="nt">&lt;html&gt;&lt;body&gt;&lt;div&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-0"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"link1.html"</span><span class="nt">&gt;</span>first item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-1"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"link2.html"</span><span class="nt">&gt;</span>second item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-inactive"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"link3.html"</span><span class="nt">&gt;</span>third item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-1"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"link4.html"</span><span class="nt">&gt;</span>fourth item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
         <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-0"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"link5.html"</span><span class="nt">&gt;</span>fifth item<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/li&gt;&lt;/ul&gt;</span>
<span class="nt">&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;</span>
</code></pre></div></div>
<h2 id="æ‰€æœ‰èŠ‚ç‚¹-1">æ‰€æœ‰èŠ‚ç‚¹</h2>

<p>æˆ‘ä»¬ä¸€èˆ¬ä¼šç”¨ // å¼€å¤´çš„ XPath è§„åˆ™æ¥é€‰å–æ‰€æœ‰ç¬¦åˆè¦æ±‚çš„èŠ‚ç‚¹ï¼Œä»¥ä¸Šæ–‡çš„ HTML æ–‡æœ¬ä¸ºä¾‹ï¼Œå¦‚æœæˆ‘ä»¬è¦é€‰å–æ‰€æœ‰èŠ‚ç‚¹ï¼Œå¯ä»¥è¿™æ ·å®ç°ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//*'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[&lt;Element html at 0x10510d9c8&gt;, &lt;Element body at 0x10510da08&gt;, &lt;Element div at 0x10510da48&gt;, &lt;Element ul at 0x10510da88&gt;, &lt;Element li at 0x10510dac8&gt;, &lt;Element a at 0x10510db48&gt;, &lt;Element li at 0x10510db88&gt;, &lt;Element a at 0x10510dbc8&gt;, &lt;Element li at 0x10510dc08&gt;, &lt;Element a at 0x10510db08&gt;, &lt;Element li at 0x10510dc48&gt;, &lt;Element a at 0x10510dc88&gt;, &lt;Element li at 0x10510dcc8&gt;, &lt;Element a at 0x10510dd08&gt;]
</code></pre></div></div>
<p>æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨ * ä»£è¡¨åŒ¹é…æ‰€æœ‰èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ª HTML æ–‡æœ¬ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šè¢«è·å–ï¼Œå¯ä»¥çœ‹åˆ°è¿”å›å½¢å¼æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ Element ç±»å‹ï¼Œå…¶åè·Ÿäº†èŠ‚ç‚¹çš„åç§°ï¼Œå¦‚ htmlã€bodyã€divã€ulã€liã€a ç­‰ç­‰ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½åŒ…å«åœ¨åˆ—è¡¨ä¸­äº†ã€‚</p>

<p>å½“ç„¶æ­¤å¤„åŒ¹é…ä¹Ÿå¯ä»¥æŒ‡å®šèŠ‚ç‚¹åç§°ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è·å–æ‰€æœ‰ li èŠ‚ç‚¹ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></div>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬è¦é€‰å–æ‰€æœ‰ li èŠ‚ç‚¹å¯ä»¥ä½¿ç”¨ //ï¼Œç„¶åç›´æ¥åŠ ä¸ŠèŠ‚ç‚¹çš„åç§°å³å¯ï¼Œè°ƒç”¨æ—¶ç›´æ¥è°ƒç”¨ xpath() æ–¹æ³•å³å¯æå–ã€‚</p>

<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[&lt;Element li at 0xb11f9c8&gt;, &lt;Element li at 0xb11fa08&gt;, &lt;Element li at 0xb11fa48&gt;, &lt;Element li at 0xb11f788&gt;, &lt;Element li at 0xb11f708&gt;]
&lt;Element li at 0xb11f9c8&gt;
</code></pre></div></div>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æå–ç»“æœæ˜¯ä¸€ä¸ªåˆ—è¡¨å½¢å¼ï¼Œå…¶æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ª Element å¯¹è±¡ï¼Œå¦‚æœè¦å–å‡ºå…¶ä¸­ä¸€ä¸ªå¯¹è±¡å¯ä»¥ç›´æ¥ç”¨ä¸­æ‹¬å·åŠ ç´¢å¼•å³å¯å–å‡ºï¼Œå¦‚ [0]ã€‚</p>
<h2 id="å­èŠ‚ç‚¹-1">å­èŠ‚ç‚¹</h2>

<p>æˆ‘ä»¬é€šè¿‡ / æˆ– // å³å¯æŸ¥æ‰¾å…ƒç´ çš„å­èŠ‚ç‚¹æˆ–å­å­™èŠ‚ç‚¹ï¼ŒåŠ å…¥æˆ‘ä»¬ç°åœ¨æƒ³é€‰æ‹© li èŠ‚ç‚¹æ‰€æœ‰ç›´æ¥ a å­èŠ‚ç‚¹ï¼Œå¯ä»¥è¿™æ ·æ¥å®ç°ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li/a'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬é€šè¿‡è¿½åŠ ä¸€ä¸ª /a å³é€‰æ‹©äº†æ‰€æœ‰ li èŠ‚ç‚¹çš„æ‰€æœ‰ç›´æ¥ a å­èŠ‚ç‚¹ï¼Œå› ä¸º //li æ˜¯é€‰ä¸­æ‰€æœ‰lièŠ‚ç‚¹ï¼Œ /a æ˜¯é€‰ä¸­lièŠ‚ç‚¹çš„æ‰€æœ‰ç›´æ¥å­èŠ‚ç‚¹ aï¼ŒäºŒè€…ç»„åˆåœ¨ä¸€èµ·å³è·å–äº†æ‰€æœ‰lièŠ‚ç‚¹çš„æ‰€æœ‰ç›´æ¥ a å­èŠ‚ç‚¹ã€‚</p>

<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[&lt;Element a at 0x106ee8688&gt;, &lt;Element a at 0x106ee86c8&gt;, &lt;Element a at 0x106ee8708&gt;, &lt;Element a at 0x106ee8748&gt;, &lt;Element a at 0x106ee8788&gt;]
</code></pre></div></div>
<p>ä½†æ˜¯æ­¤å¤„çš„ / æ˜¯é€‰å–ç›´æ¥å­èŠ‚ç‚¹ï¼Œå¦‚æœæˆ‘ä»¬è¦è·å–æ‰€æœ‰å­å­™èŠ‚ç‚¹å°±è¯¥ä½¿ç”¨ // äº†ï¼Œä¾‹å¦‚æˆ‘ä»¬è¦è·å– ul èŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å­å­™ a èŠ‚ç‚¹ï¼Œå¯ä»¥è¿™æ ·æ¥å®ç°ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//ul//a'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿è¡Œç»“æœæ˜¯ç›¸åŒçš„ã€‚</p>

<p>ä½†æ˜¯è¿™é‡Œå¦‚æœæˆ‘ä»¬ç”¨ //ul/a å°±æ— æ³•è·å–ä»»ä½•ç»“æœäº†ï¼Œå› ä¸º / æ˜¯è·å–ç›´æ¥å­èŠ‚ç‚¹ï¼Œè€Œåœ¨ ul èŠ‚ç‚¹ä¸‹æ²¡æœ‰ç›´æ¥çš„ a å­èŠ‚ç‚¹ï¼Œåªæœ‰ li èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ— æ³•è·å–ä»»ä½•åŒ¹é…ç»“æœï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//ul/a'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[]
</code></pre></div></div>
<p>å› æ­¤åœ¨è¿™é‡Œæˆ‘ä»¬è¦æ³¨æ„ / å’Œ // çš„åŒºåˆ«ï¼Œ/ æ˜¯è·å–ç›´æ¥å­èŠ‚ç‚¹ï¼Œ// æ˜¯è·å–å­å­™èŠ‚ç‚¹ã€‚</p>
<h2 id="çˆ¶èŠ‚ç‚¹-1">çˆ¶èŠ‚ç‚¹</h2>

<p>æˆ‘ä»¬çŸ¥é“é€šè¿‡è¿ç»­çš„ / æˆ– // å¯ä»¥æŸ¥æ‰¾å­èŠ‚ç‚¹æˆ–å­å­™èŠ‚ç‚¹ï¼Œé‚£å‡å¦‚æˆ‘ä»¬çŸ¥é“äº†å­èŠ‚ç‚¹æ€æ ·æ¥æŸ¥æ‰¾çˆ¶èŠ‚ç‚¹å‘¢ï¼Ÿåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨ .. æ¥è·å–çˆ¶èŠ‚ç‚¹ã€‚</p>

<p>æ¯”å¦‚æˆ‘ä»¬ç°åœ¨é¦–å…ˆé€‰ä¸­ href æ˜¯ link4.html çš„ a èŠ‚ç‚¹ï¼Œç„¶åå†è·å–å…¶çˆ¶èŠ‚ç‚¹ï¼Œç„¶åå†è·å–å…¶ class å±æ€§ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//a[@href="https://ask.hellobi.com/link4.html"]/../@class'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['item-1']
</code></pre></div></div>
<p>æ£€æŸ¥ä¸€ä¸‹ç»“æœï¼Œæ­£æ˜¯æˆ‘ä»¬è·å–çš„ç›®æ ‡ li èŠ‚ç‚¹çš„ classï¼Œè·å–çˆ¶èŠ‚ç‚¹æˆåŠŸã€‚</p>

<p>åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ parent:: æ¥è·å–çˆ¶èŠ‚ç‚¹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//a[@href="https://ask.hellobi.com/link4.html"]/parent::*/@class'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<h2 id="å±æ€§åŒ¹é…-1">å±æ€§åŒ¹é…</h2>

<p>åœ¨é€‰å–çš„æ—¶å€™æˆ‘ä»¬è¿˜å¯ä»¥ç”¨ @ ç¬¦å·è¿›è¡Œå±æ€§è¿‡æ»¤ï¼Œæ¯”å¦‚åœ¨è¿™é‡Œå¦‚æœæˆ‘ä»¬è¦é€‰å– class ä¸º item-1 çš„ li èŠ‚ç‚¹ï¼Œå¯ä»¥è¿™æ ·å®ç°:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[@class="item-0"]'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬é€šè¿‡åŠ å…¥ [@class=â€item-0â€] å°±é™åˆ¶äº†èŠ‚ç‚¹çš„ class å±æ€§ä¸º item-0ï¼Œè€Œ HTML æ–‡æœ¬ä¸­ç¬¦åˆæ¡ä»¶çš„ li èŠ‚ç‚¹æœ‰ä¸¤ä¸ªï¼Œæ‰€ä»¥è¿”å›ç»“æœåº”è¯¥è¿”å›ä¸¤ä¸ªåŒ¹é…åˆ°çš„å…ƒç´ ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[&lt;Element li at 0x10a399288&gt;, &lt;Element li at 0x10a3992c8&gt;]
</code></pre></div></div>
<p>å¯è§åŒ¹é…ç»“æœç»“æœæ­£æ˜¯ä¸¤ä¸ªï¼Œè‡³äºæ˜¯ä¸æ˜¯é‚£æ­£ç¡®çš„ä¸¤ä¸ªï¼Œæˆ‘ä»¬åœ¨åé¢éªŒè¯ä¸€ä¸‹ã€‚</p>
<h2 id="æ–‡æœ¬è·å–-1">æ–‡æœ¬è·å–</h2>

<p>æˆ‘ä»¬ç”¨ XPath ä¸­çš„ text() æ–¹æ³•å¯ä»¥è·å–èŠ‚ç‚¹ä¸­çš„æ–‡æœ¬ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°è¯•è·å–ä¸€ä¸‹ä¸Šæ–‡ li èŠ‚ç‚¹ä¸­çš„æ–‡æœ¬ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[@class="item-0"]/text()'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['\n     ']
</code></pre></div></div>
<p>å¾ˆå¥‡æ€ªçš„æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰è·å–åˆ°ä»»ä½•æ–‡æœ¬ï¼Œè€Œæ˜¯åªè·å–åˆ°äº†ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸º XPath ä¸­ text() å‰é¢æ˜¯ /ï¼Œè€Œæ­¤ / çš„å«ä¹‰æ˜¯é€‰å–ç›´æ¥å­èŠ‚ç‚¹ï¼Œè€Œæ­¤å¤„å¾ˆæ˜æ˜¾ li çš„ç›´æ¥å­èŠ‚ç‚¹éƒ½æ˜¯ a èŠ‚ç‚¹ï¼Œæ–‡æœ¬éƒ½æ˜¯åœ¨ a èŠ‚ç‚¹å†…éƒ¨çš„ï¼Œæ‰€ä»¥è¿™é‡ŒåŒ¹é…åˆ°çš„ç»“æœå°±æ˜¯è¢«ä¿®æ­£çš„ li èŠ‚ç‚¹å†…éƒ¨çš„æ¢è¡Œç¬¦ï¼Œå› ä¸ºè‡ªåŠ¨ä¿®æ­£çš„lièŠ‚ç‚¹çš„å°¾æ ‡ç­¾æ¢è¡Œäº†ã€‚</p>

<p>å³é€‰ä¸­çš„æ˜¯è¿™ä¸¤ä¸ªèŠ‚ç‚¹ï¼š</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-0"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"link1.html"</span><span class="nt">&gt;</span>first item<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
<span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"item-0"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"link5.html"</span><span class="nt">&gt;</span>fifth item<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/li&gt;</span>
</code></pre></div></div>
<p>å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹å› ä¸ºè‡ªåŠ¨ä¿®æ­£ï¼Œli èŠ‚ç‚¹çš„å°¾æ ‡ç­¾æ·»åŠ çš„æ—¶å€™æ¢è¡Œäº†ï¼Œæ‰€ä»¥æå–æ–‡æœ¬å¾—åˆ°çš„å”¯ä¸€ç»“æœå°±æ˜¯ li èŠ‚ç‚¹çš„å°¾æ ‡ç­¾å’Œ a èŠ‚ç‚¹çš„å°¾æ ‡ç­¾ä¹‹é—´çš„æ¢è¡Œç¬¦ã€‚</p>

<p>å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è·å– li èŠ‚ç‚¹å†…éƒ¨çš„æ–‡æœ¬å°±æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯é€‰å–åˆ° a èŠ‚ç‚¹å†è·å–æ–‡æœ¬ï¼Œå¦ä¸€ç§å°±æ˜¯ä½¿ç”¨ //ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹äºŒè€…çš„åŒºåˆ«æ˜¯ä»€ä¹ˆã€‚</p>

<p>é¦–å…ˆæˆ‘ä»¬é€‰å–åˆ° a èŠ‚ç‚¹å†è·å–æ–‡æœ¬ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[@class="item-0"]/a/text()'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['first item', 'fifth item']
</code></pre></div></div>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œè¿”å›å€¼æ˜¯ä¸¤ä¸ªï¼Œå†…å®¹éƒ½æ˜¯å±æ€§ä¸º item-0 çš„ li èŠ‚ç‚¹çš„æ–‡æœ¬ï¼Œè¿™ä¹Ÿå°è¯äº†æˆ‘ä»¬ä¸Šæ–‡ä¸­å±æ€§åŒ¹é…çš„ç»“æœæ˜¯æ­£ç¡®çš„ã€‚</p>

<p>åœ¨è¿™é‡Œæˆ‘ä»¬æ˜¯é€å±‚é€‰å–çš„ï¼Œå…ˆé€‰å–äº† li èŠ‚ç‚¹ï¼Œåˆåˆ©ç”¨ / é€‰å–äº†å…¶ç›´æ¥å­èŠ‚ç‚¹ aï¼Œç„¶åå†é€‰å–å…¶æ–‡æœ¬ï¼Œå¾—åˆ°çš„ç»“æœæ°å¥½æ˜¯ç¬¦åˆæˆ‘ä»¬é¢„æœŸçš„ä¸¤ä¸ªç»“æœã€‚</p>

<p>æˆ‘ä»¬å†æ¥çœ‹ä¸‹ç”¨å¦ä¸€ç§æ–¹å¼ // é€‰å–çš„ç»“æœï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[@class="item-0"]//text()'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['first item', 'fifth item', '\n     ']
</code></pre></div></div>
<p>ä¸å‡ºæ‰€æ–™ï¼Œè¿™é‡Œè¿”å›ç»“æœæ˜¯ä¸‰ä¸ªï¼Œå¯æƒ³è€ŒçŸ¥è¿™é‡Œæ˜¯é€‰å–æ‰€æœ‰å­å­™èŠ‚ç‚¹çš„æ–‡æœ¬ï¼Œå…¶ä¸­å‰ä¸¤ä¸ªå°±æ˜¯ li çš„å­èŠ‚ç‚¹ a èŠ‚ç‚¹å†…éƒ¨çš„æ–‡æœ¬ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯æœ€åä¸€ä¸ª li èŠ‚ç‚¹å†…éƒ¨çš„æ–‡æœ¬ï¼Œå³æ¢è¡Œç¬¦ã€‚</p>

<p>æ‰€ä»¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬è¦æƒ³è·å–å­å­™èŠ‚ç‚¹å†…éƒ¨çš„æ‰€æœ‰æ–‡æœ¬ï¼Œå¯ä»¥ç›´æ¥ç”¨ // åŠ  text() çš„æ–¹å¼è·å–ï¼Œè¿™æ ·å¯ä»¥ä¿è¯è·å–åˆ°æœ€å…¨é¢çš„æ–‡æœ¬ä¿¡æ¯ï¼Œä½†æ˜¯å¯èƒ½ä¼šå¤¹æ‚ä¸€äº›æ¢è¡Œç¬¦ç­‰ç‰¹æ®Šå­—ç¬¦ã€‚å¦‚æœæˆ‘ä»¬æƒ³è·å–æŸäº›ç‰¹å®šå­å­™èŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰æ–‡æœ¬ï¼Œå¯ä»¥å…ˆé€‰å–åˆ°ç‰¹å®šçš„å­å­™èŠ‚ç‚¹ï¼Œç„¶åå†è°ƒç”¨ text() æ–¹æ³•è·å–å…¶å†…éƒ¨æ–‡æœ¬ï¼Œè¿™æ ·å¯ä»¥ä¿è¯è·å–çš„ç»“æœæ˜¯æ•´æ´çš„ã€‚</p>
<h2 id="å±æ€§è·å–-1">å±æ€§è·å–</h2>

<p>æˆ‘ä»¬çŸ¥é“äº†ç”¨ text() å¯ä»¥è·å–èŠ‚ç‚¹å†…éƒ¨æ–‡æœ¬ï¼Œé‚£ä¹ˆèŠ‚ç‚¹å±æ€§è¯¥æ€æ ·è·å–å‘¢ï¼Ÿå…¶å®è¿˜æ˜¯ç”¨ @ ç¬¦å·å°±å¯ä»¥ï¼Œä¾‹å¦‚æˆ‘ä»¬æƒ³è·å–æ‰€æœ‰ li èŠ‚ç‚¹ä¸‹æ‰€æœ‰ a èŠ‚ç‚¹çš„ href å±æ€§ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">'./test.html'</span><span class="p">,</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTMLParser</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li/a/@href'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬é€šè¿‡ @href å³å¯è·å–èŠ‚ç‚¹çš„ href å±æ€§ï¼Œæ³¨æ„æ­¤å¤„å’Œå±æ€§åŒ¹é…çš„æ–¹æ³•ä¸åŒï¼Œå±æ€§åŒ¹é…æ˜¯ä¸­æ‹¬å·åŠ å±æ€§åå’Œå€¼æ¥é™å®šæŸä¸ªå±æ€§ï¼Œå¦‚ [@href=â€https://ask.hellobi.com/link1.htmlâ€]ï¼Œè€Œæ­¤å¤„çš„ @href æŒ‡çš„æ˜¯è·å–èŠ‚ç‚¹çš„æŸä¸ªå±æ€§ï¼ŒäºŒè€…éœ€è¦åšå¥½åŒºåˆ†ã€‚</p>

<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['link1.html', 'link2.html', 'link3.html', 'link4.html', 'link5.html']
</code></pre></div></div>
<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆåŠŸè·å–äº†æ‰€æœ‰ li èŠ‚ç‚¹ä¸‹çš„ a èŠ‚ç‚¹çš„ href å±æ€§ï¼Œä»¥åˆ—è¡¨å½¢å¼è¿”å›ã€‚</p>
<h2 id="å±æ€§å¤šå€¼åŒ¹é…-1">å±æ€§å¤šå€¼åŒ¹é…</h2>

<p>æœ‰æ—¶å€™æŸäº›èŠ‚ç‚¹çš„æŸä¸ªå±æ€§å¯èƒ½æœ‰å¤šä¸ªå€¼ï¼Œä¾‹å¦‚ä¸‹é¢ä¾‹å­ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">text</span> <span class="o">=</span> <span class="s">'''
&lt;li class="li li-first"&gt;&lt;a href="https://ask.hellobi.com/link.html"&gt;first item&lt;/a&gt;&lt;/li&gt;
'''</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[@class="li"]/a/text()'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>åœ¨è¿™é‡Œ HTML æ–‡æœ¬ä¸­çš„ li èŠ‚ç‚¹çš„ class å±æ€§æœ‰ä¸¤ä¸ªå€¼ li å’Œ li-firstï¼Œä½†æ˜¯æ­¤æ—¶å¦‚æœæˆ‘ä»¬è¿˜æƒ³ç”¨ä¹‹å‰çš„å±æ€§åŒ¹é…è·å–å°±æ— æ³•åŒ¹é…äº†ï¼Œä»£ç è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[]
</code></pre></div></div>
<p>è¿™æ—¶å¦‚æœå±æ€§æœ‰å¤šä¸ªå€¼å°±éœ€è¦ç”¨ contains() å‡½æ•°äº†ï¼Œä»£ç å¯ä»¥æ”¹å†™å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">text</span> <span class="o">=</span> <span class="s">'''
&lt;li class="li li-first"&gt;&lt;a href="https://ask.hellobi.com/link.html"&gt;first item&lt;/a&gt;&lt;/li&gt;
'''</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[contains(@class, "li")]/a/text()'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿™æ ·æˆ‘ä»¬é€šè¿‡ contains() æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥å±æ€§åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥å±æ€§å€¼ï¼Œè¿™æ ·åªè¦æ­¤å±æ€§åŒ…å«æ‰€ä¼ å…¥çš„å±æ€§å€¼å°±å¯ä»¥å®ŒæˆåŒ¹é…äº†ã€‚</p>

<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['first item']
</code></pre></div></div>
<p>æ­¤ç§é€‰æ‹©æ–¹å¼åœ¨æŸä¸ªèŠ‚ç‚¹çš„æŸä¸ªå±æ€§æœ‰å¤šä¸ªå€¼çš„æ—¶å€™ç»å¸¸ä¼šç”¨åˆ°ï¼Œå¦‚æŸä¸ªèŠ‚ç‚¹çš„ class å±æ€§é€šå¸¸æœ‰å¤šä¸ªã€‚</p>
<h2 id="å¤šå±æ€§åŒ¹é…-1">å¤šå±æ€§åŒ¹é…</h2>

<p>å¦å¤–æˆ‘ä»¬å¯èƒ½è¿˜é‡åˆ°ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æ ¹æ®å¤šä¸ªå±æ€§æ‰èƒ½ç¡®å®šä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ˜¯å°±éœ€è¦åŒæ—¶åŒ¹é…å¤šä¸ªå±æ€§æ‰å¯ä»¥ï¼Œé‚£ä¹ˆè¿™é‡Œå¯ä»¥ä½¿ç”¨è¿ç®—ç¬¦ and æ¥è¿æ¥ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">text</span> <span class="o">=</span> <span class="s">'''
&lt;li class="li li-first" name="item"&gt;&lt;a href="https://ask.hellobi.com/link.html"&gt;first item&lt;/a&gt;&lt;/li&gt;
'''</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[contains(@class, "li") and @name="item"]/a/text()'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>åœ¨è¿™é‡Œ HTML æ–‡æœ¬çš„ li èŠ‚ç‚¹åˆå¢åŠ äº†ä¸€ä¸ªå±æ€§ nameï¼Œè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦åŒæ—¶æ ¹æ® class å’Œ name å±æ€§æ¥é€‰æ‹©ï¼Œå°±å¯ä»¥ and è¿ç®—ç¬¦è¿æ¥ä¸¤ä¸ªæ¡ä»¶ï¼Œä¸¤ä¸ªæ¡ä»¶éƒ½è¢«ä¸­æ‹¬å·åŒ…å›´ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['first item']
</code></pre></div></div>
<p>è¿™é‡Œçš„ and å…¶å®æ˜¯ XPath ä¸­çš„è¿ç®—ç¬¦ï¼Œå¦å¤–è¿˜æœ‰å¾ˆå¤šè¿ç®—ç¬¦ï¼Œå¦‚ orã€mod ç­‰ç­‰ï¼Œåœ¨æ­¤æ€»ç»“å¦‚ä¸‹ï¼š</p>

<table>
  <thead>
    <tr>
      <th>è¿ç®—ç¬¦</th>
      <th>æè¿°</th>
      <th>å®ä¾‹</th>
      <th>è¿”å›å€¼</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>or</td>
      <td>æˆ–</td>
      <td>price=9.80 or price=9.70</td>
      <td>å¦‚æœ price æ˜¯ 9.80ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ price æ˜¯ 9.50ï¼Œåˆ™è¿”å› false</td>
    </tr>
    <tr>
      <td>and</td>
      <td>ä¸</td>
      <td>price&gt;9.00 and price&lt;9.90</td>
      <td>å¦‚æœ price æ˜¯ 9.80ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ price æ˜¯ 8.50ï¼Œåˆ™è¿”å› false</td>
    </tr>
    <tr>
      <td>mod</td>
      <td>è®¡ç®—é™¤æ³•çš„ä½™æ•°</td>
      <td>5 mod 2</td>
      <td>1</td>
    </tr>
    <tr>
      <td>|</td>
      <td>è®¡ç®—ä¸¤ä¸ªèŠ‚ç‚¹é›†</td>
      <td>//book | //cd</td>
      <td>è¿”å›æ‰€æœ‰æ‹¥æœ‰ book å’Œ cd å…ƒç´ çš„èŠ‚ç‚¹é›†</td>
    </tr>
    <tr>
      <td>+</td>
      <td>åŠ æ³•</td>
      <td>6 + 4</td>
      <td>10</td>
    </tr>
    <tr>
      <td>-</td>
      <td>å‡æ³•</td>
      <td>6 - 4</td>
      <td>2</td>
    </tr>
    <tr>
      <td>*</td>
      <td>ä¹˜æ³•</td>
      <td>6 * 4</td>
      <td>24</td>
    </tr>
    <tr>
      <td>div</td>
      <td>é™¤æ³•</td>
      <td>8 div 4</td>
      <td>2</td>
    </tr>
    <tr>
      <td>=</td>
      <td>ç­‰äº</td>
      <td>price=9.80</td>
      <td>å¦‚æœ price æ˜¯ 9.80ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ price æ˜¯ 9.90ï¼Œåˆ™è¿”å› false</td>
    </tr>
    <tr>
      <td>!=</td>
      <td>ä¸ç­‰äº</td>
      <td>price!=9.80</td>
      <td>å¦‚æœ price æ˜¯ 9.90ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ price æ˜¯ 9.80ï¼Œåˆ™è¿”å› false</td>
    </tr>
    <tr>
      <td>&lt;</td>
      <td>å°äº</td>
      <td>price&lt;9.80</td>
      <td>å¦‚æœ price æ˜¯ 9.00ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ price æ˜¯ 9.90ï¼Œåˆ™è¿”å› false</td>
    </tr>
    <tr>
      <td>&lt;=</td>
      <td>å°äºæˆ–ç­‰äº</td>
      <td>price&lt;=9.80</td>
      <td>å¦‚æœ price æ˜¯ 9.00ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ price æ˜¯ 9.90ï¼Œåˆ™è¿”å› false</td>
    </tr>
    <tr>
      <td>&gt;</td>
      <td>å¤§äº</td>
      <td>price&gt;9.80</td>
      <td>å¦‚æœ price æ˜¯ 9.90ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ price æ˜¯ 9.80ï¼Œåˆ™è¿”å› false</td>
    </tr>
    <tr>
      <td>&gt;=</td>
      <td>å¤§äºæˆ–ç­‰äº</td>
      <td>price&gt;=9.80</td>
      <td>å¦‚æœ price æ˜¯ 9.90ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœ price æ˜¯ 9.70ï¼Œåˆ™è¿”å› false</td>
    </tr>
  </tbody>
</table>

<p>æ­¤è¡¨å‚è€ƒæ¥æºï¼šhttp://www.w3school.com.cn/xpath/xpath_operators.aspã€‚</p>
<h2 id="æŒ‰åºé€‰æ‹©-1">æŒ‰åºé€‰æ‹©</h2>

<p>æœ‰æ—¶å€™æˆ‘ä»¬åœ¨é€‰æ‹©çš„æ—¶å€™å¯èƒ½æŸäº›å±æ€§åŒæ—¶åŒ¹é…äº†å¤šä¸ªèŠ‚ç‚¹ï¼Œä½†æ˜¯æˆ‘ä»¬åªæƒ³è¦å…¶ä¸­çš„æŸä¸ªèŠ‚ç‚¹ï¼Œå¦‚ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼Œæˆ–è€…æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ—¶è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>

<p>è¿™æ—¶å¯ä»¥åˆ©ç”¨ä¸­æ‹¬å·ä¼ å…¥ç´¢å¼•çš„æ–¹æ³•è·å–ç‰¹å®šæ¬¡åºçš„èŠ‚ç‚¹ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">text</span> <span class="o">=</span> <span class="s">'''
 &lt;div&gt;
     &lt;ul&gt;
          &lt;li class="item-0"&gt;&lt;a href="https://ask.hellobi.com/link1.html"&gt;first item&lt;/a&gt;&lt;/li&gt;
          &lt;li class="item-1"&gt;&lt;a href="https://ask.hellobi.com/link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt;
          &lt;li class="item-inactive"&gt;&lt;a href="https://ask.hellobi.com/link3.html"&gt;third item&lt;/a&gt;&lt;/li&gt;
          &lt;li class="item-1"&gt;&lt;a href="https://ask.hellobi.com/link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt;
          &lt;li class="item-0"&gt;&lt;a href="https://ask.hellobi.com/link5.html"&gt;fifth item&lt;/a&gt;
      &lt;/ul&gt;
  &lt;/div&gt;
 '''</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[1]/a/text()'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[last()]/a/text()'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[position()&lt;3]/a/text()'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[last()-2]/a/text()'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>ç¬¬ä¸€æ¬¡é€‰æ‹©æˆ‘ä»¬é€‰å–äº†ç¬¬ä¸€ä¸ª li èŠ‚ç‚¹ï¼Œä¸­æ‹¬å·ä¸­ä¼ å…¥æ•°å­—1å³å¯ï¼Œæ³¨æ„è¿™é‡Œå’Œä»£ç ä¸­ä¸åŒï¼Œåºå·æ˜¯ä»¥ 1 å¼€å¤´çš„ï¼Œä¸æ˜¯ 0 å¼€å¤´çš„ã€‚</p>

<p>ç¬¬äºŒæ¬¡é€‰æ‹©æˆ‘ä»¬é€‰å–äº†æœ€åä¸€ä¸ª li èŠ‚ç‚¹ï¼Œä¸­æ‹¬å·ä¸­ä¼ å…¥ last() å³å¯ï¼Œè¿”å›çš„ä¾¿æ˜¯æœ€åä¸€ä¸ª li èŠ‚ç‚¹ã€‚</p>

<p>ç¬¬ä¸‰æ¬¡é€‰æ‹©æˆ‘ä»¬é€‰å–äº†ä½ç½®å°äº 3 çš„ li èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ä½ç½®åºå·ä¸º 1 å’Œ 2 çš„èŠ‚ç‚¹ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯å‰ 2 ä¸ª li èŠ‚ç‚¹ã€‚</p>

<p>ç¬¬å››æ¬¡é€‰æ‹©æˆ‘ä»¬é€‰å–äº†å€’æ•°ç¬¬ä¸‰ä¸ª li èŠ‚ç‚¹ï¼Œä¸­æ‹¬å·ä¸­ä¼ å…¥ last()-2å³å¯ï¼Œå› ä¸º last() æ˜¯æœ€åä¸€ä¸ªï¼Œæ‰€ä»¥ last()-2 å°±æ˜¯å€’æ•°ç¬¬ä¸‰ä¸ªã€‚</p>

<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    ['first item']
    ['fifth item']
    ['first item', 'second item']
    ['third item']
</code></pre></div></div>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† last()ã€position() ç­‰å‡½æ•°ï¼ŒXPath ä¸­æä¾›äº† 100 å¤šä¸ªå‡½æ•°ï¼ŒåŒ…æ‹¬å­˜å–ã€æ•°å€¼ã€å­—ç¬¦ä¸²ã€é€»è¾‘ã€èŠ‚ç‚¹ã€åºåˆ—ç­‰å¤„ç†åŠŸèƒ½ï¼Œå…·ä½“æ‰€æœ‰çš„å‡½æ•°ä½œç”¨å¯ä»¥å‚è€ƒï¼šhttp://www.w3school.com.cn/xpath/xpath_functions.aspã€‚</p>
<h2 id="èŠ‚ç‚¹è½´é€‰æ‹©-1">èŠ‚ç‚¹è½´é€‰æ‹©</h2>

<p>XPath æä¾›äº†å¾ˆå¤šèŠ‚ç‚¹è½´é€‰æ‹©æ–¹æ³•ï¼Œè‹±æ–‡å«åš XPath Axesï¼ŒåŒ…æ‹¬è·å–å­å…ƒç´ ã€å…„å¼Ÿå…ƒç´ ã€çˆ¶å…ƒç´ ã€ç¥–å…ˆå…ƒç´ ç­‰ç­‰ï¼Œåœ¨ä¸€å®šæƒ…å†µä¸‹ä½¿ç”¨å®ƒå¯ä»¥æ–¹ä¾¿åœ°å®ŒæˆèŠ‚ç‚¹çš„é€‰æ‹©ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªå®ä¾‹æ¥æ„Ÿå—ä¸€ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">text</span> <span class="o">=</span> <span class="s">'''
&lt;div&gt;
    &lt;ul&gt;
         &lt;li class="item-0"&gt;&lt;a href="https://ask.hellobi.com/link1.html"&gt;&lt;span&gt;first item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
         &lt;li class="item-1"&gt;&lt;a href="https://ask.hellobi.com/link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt;
         &lt;li class="item-inactive"&gt;&lt;a href="https://ask.hellobi.com/link3.html"&gt;third item&lt;/a&gt;&lt;/li&gt;
         &lt;li class="item-1"&gt;&lt;a href="https://ask.hellobi.com/link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt;
         &lt;li class="item-0"&gt;&lt;a href="https://ask.hellobi.com/link5.html"&gt;fifth item&lt;/a&gt;
     &lt;/ul&gt;
 &lt;/div&gt;
'''</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">etree</span><span class="p">.</span><span class="n">HTML</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[1]/ancestor::*'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[1]/ancestor::div'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[1]/attribute::*'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[1]/child::a[@href="https://ask.hellobi.com/link1.html"]'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[1]/descendant::span'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[1]/following::*[2]'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">html</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//li[1]/following-sibling::*'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    [&lt;Element html at 0x107941808&gt;, &lt;Element body at 0x1079418c8&gt;, &lt;Element div at 0x107941908&gt;, &lt;Element ul at 0x107941948&gt;]
    [&lt;Element div at 0x107941908&gt;]
    ['item-0']
    [&lt;Element a at 0x1079418c8&gt;]
    [&lt;Element span at 0x107941948&gt;]
    [&lt;Element a at 0x1079418c8&gt;]
    [&lt;Element li at 0x107941948&gt;, &lt;Element li at 0x107941988&gt;, &lt;Element li at 0x1079419c8&gt;, &lt;Element li at 0x107941a08&gt;]
</code></pre></div></div>
<p>ç¬¬ä¸€æ¬¡é€‰æ‹©æˆ‘ä»¬è°ƒç”¨äº† ancestor è½´ï¼Œå¯ä»¥è·å–æ‰€æœ‰ç¥–å…ˆèŠ‚ç‚¹ï¼Œå…¶åéœ€è¦è·Ÿä¸¤ä¸ªå†’å·ï¼Œç„¶åæ˜¯èŠ‚ç‚¹çš„é€‰æ‹©å™¨ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨äº† *ï¼Œè¡¨ç¤ºåŒ¹é…æ‰€æœ‰èŠ‚ç‚¹ï¼Œå› æ­¤è¿”å›ç»“æœæ˜¯ç¬¬ä¸€ä¸ª li èŠ‚ç‚¹çš„æ‰€æœ‰ç¥–å…ˆèŠ‚ç‚¹ï¼ŒåŒ…æ‹¬ htmlï¼Œbodyï¼Œdivï¼Œulã€‚</p>

<p>ç¬¬äºŒæ¬¡é€‰æ‹©æˆ‘ä»¬åˆåŠ äº†é™å®šæ¡ä»¶ï¼Œè¿™æ¬¡åœ¨å†’å·åé¢åŠ äº† divï¼Œè¿™æ ·å¾—åˆ°çš„ç»“æœå°±åªæœ‰ div è¿™ä¸ªç¥–å…ˆèŠ‚ç‚¹äº†ã€‚</p>

<p>ç¬¬ä¸‰æ¬¡é€‰æ‹©æˆ‘ä»¬è°ƒç”¨äº† attribute è½´ï¼Œå¯ä»¥è·å–æ‰€æœ‰å±æ€§å€¼ï¼Œå…¶åè·Ÿçš„é€‰æ‹©å™¨è¿˜æ˜¯ *ï¼Œè¿™ä»£è¡¨è·å–èŠ‚ç‚¹çš„æ‰€æœ‰å±æ€§ï¼Œè¿”å›å€¼å°±æ˜¯ li èŠ‚ç‚¹çš„æ‰€æœ‰å±æ€§å€¼ã€‚</p>

<p>ç¬¬å››æ¬¡é€‰æ‹©æˆ‘ä»¬è°ƒç”¨äº† child è½´ï¼Œå¯ä»¥è·å–æ‰€æœ‰ç›´æ¥å­èŠ‚ç‚¹ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åˆåŠ äº†é™å®šæ¡ä»¶é€‰å– href å±æ€§ä¸º link1.html çš„ a èŠ‚ç‚¹ã€‚</p>

<p>ç¬¬äº”æ¬¡é€‰æ‹©æˆ‘ä»¬è°ƒç”¨äº† descendant è½´ï¼Œå¯ä»¥è·å–æ‰€æœ‰å­å­™èŠ‚ç‚¹ï¼Œè¿™é‡Œæˆ‘ä»¬åˆåŠ äº†é™å®šæ¡ä»¶è·å– span èŠ‚ç‚¹ï¼Œæ‰€ä»¥è¿”å›çš„å°±æ˜¯åªåŒ…å« span èŠ‚ç‚¹è€Œæ²¡æœ‰ a èŠ‚ç‚¹ã€‚</p>

<p>ç¬¬å…­æ¬¡é€‰æ‹©æˆ‘ä»¬è°ƒç”¨äº† following è½´ï¼Œå¯ä»¥è·å–å½“å‰èŠ‚ç‚¹ä¹‹åçš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿™é‡Œæˆ‘ä»¬è™½ç„¶ä½¿ç”¨çš„æ˜¯ * åŒ¹é…ï¼Œä½†åˆåŠ äº†ç´¢å¼•é€‰æ‹©ï¼Œæ‰€ä»¥åªè·å–äº†ç¬¬äºŒä¸ªåç»­èŠ‚ç‚¹ã€‚</p>

<p>ç¬¬ä¸ƒæ¬¡é€‰æ‹©æˆ‘ä»¬è°ƒç”¨äº† following-sibling è½´ï¼Œå¯ä»¥è·å–å½“å‰èŠ‚ç‚¹ä¹‹åçš„æ‰€æœ‰åŒçº§èŠ‚ç‚¹ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ * åŒ¹é…ï¼Œæ‰€ä»¥è·å–äº†æ‰€æœ‰åç»­åŒçº§èŠ‚ç‚¹ã€‚</p>

<p>ä»¥ä¸Šæ˜¯XPathè½´çš„ç®€å•ç”¨æ³•ï¼Œæ›´å¤šçš„è½´çš„ä½¿ç”¨å¯ä»¥å‚è€ƒï¼šhttp://www.w3school.com.cn/xpath/xpath_axes.aspã€‚</p>
<blockquote>
  <blockquote>
    <blockquote>
      <blockquote>
        <blockquote>
          <blockquote>
            <blockquote>
              <p>e5c77ca (æ–°é¡µé¢)</p>
            </blockquote>
          </blockquote>
        </blockquote>
      </blockquote>
    </blockquote>
  </blockquote>
</blockquote>
:ET