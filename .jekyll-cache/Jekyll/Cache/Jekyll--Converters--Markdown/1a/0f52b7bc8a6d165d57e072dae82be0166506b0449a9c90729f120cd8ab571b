I"Ÿ/<h2 id="-head">Â«Â«Â«&lt; HEAD</h2>
<p>layout:     post
title:      â€œSeleniumâ€
subtitle:   â€œâ€
date:       2019-11-24 21:12:21
author:     â€œBalboâ€
header-img: â€œimg/post-bg-2019.jpgâ€
tags:
    - reptile
â€”</p>
<h2 id="selenium-çš„ä½¿ç”¨">Selenium çš„ä½¿ç”¨</h2>
<h3 id="åŸºæœ¬ä½¿ç”¨">åŸºæœ¬ä½¿ç”¨</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.wait</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.baidu.com'</span><span class="p">)</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'kw'</span><span class="p">)</span>
    <span class="nb">input</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'Python'</span><span class="p">)</span>
    <span class="nb">input</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="n">ENTER</span><span class="p">)</span>
    <span class="n">wait</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">'content_left'</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">current_url</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">get_cookies</span><span class="p">())</span>
    <span class="k">print</span><span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">page_source</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">browser</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>
<p>å¦‚æœç”¨ Selenium æ¥é©±åŠ¨æµè§ˆå™¨åŠ è½½ç½‘é¡µçš„è¯ï¼Œå°±å¯ä»¥ç›´æ¥æ‹¿åˆ° JavaScript æ¸²æŸ“çš„ç»“æœ</p>

<h3 id="å£°æ˜æµè§ˆå™¨å¯¹è±¡">å£°æ˜æµè§ˆå™¨å¯¹è±¡</h3>

<p>Selenium æ”¯æŒéå¸¸å¤šçš„æµè§ˆå™¨ï¼Œå¦‚ Chromã€Firefoxã€Edgeç­‰ï¼Œè¿˜æœ‰ Androidã€BalckBerryç­‰æ‰‹æœºç«¯çš„æµè§ˆå™¨ï¼Œè¿˜æœ‰æ— ç•Œé¢æµè§ˆå™¨ PhantomJS</p>

<p>æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼åˆå§‹åŒ–</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Firefox</span><span class="p">()</span>
<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Edge</span><span class="p">()</span>
<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">PhantomJS</span><span class="p">()</span>
<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Safari</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="è®¿é—®é¡µé¢">è®¿é—®é¡µé¢</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://taobao.com/'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">page_source</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="æŸ¥æ‰¾ç»“ç‚¹">æŸ¥æ‰¾ç»“ç‚¹</h3>

<ul>
  <li>
    <p>å•ä¸ªèŠ‚ç‚¹</p>

    <p>æƒ³è¦ä»æ·˜å®é¦–é¡µä¸­æå–æœç´¢æ¡†è¿™ä¸ªèŠ‚ç‚¹ï¼Œé¦–å…ˆè§‚å¯Ÿä»–çš„æºä»£ç </p>

    <p>ä»£ç å®ç°</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
    
  <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://taobao.com/'</span><span class="p">)</span>
  <span class="n">input_first</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'q'</span><span class="p">)</span>
  <span class="n">input_second</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">'#q'</span><span class="p">)</span>
  <span class="n">input_third</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s">'//*[@id="q"]'</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">input_first</span><span class="p">,</span> <span class="n">input_second</span><span class="p">,</span> <span class="n">input_third</span><span class="p">)</span>
  <span class="n">browser</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œä½¿ç”¨3ç§æ–¹å¼è·å–è¾“å…¥æ¡†ï¼Œä»–ä»¬è¿”å›çš„ç»“æœéƒ½ä¸€æ ·éƒ½æ˜¯ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;selenium.webdriver.remote.webelement.WebElement (session="dd3692957c85930ca38ce1665fa2787f", element="262fbd50-eadb-4b7d-9a25-776e2e54020b")&gt;
</code></pre></div>    </div>
    <p>å¦å¤–ï¼Œè·å–å•ä¸ªèŠ‚ç‚¹çš„æ–¹æ³•è¿˜å¯ä»¥ç”¨</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">find_element_by_id</span><span class="p">()</span>
  <span class="n">find_element_by_name</span><span class="p">()</span>
  <span class="n">find_element_by_xpath</span><span class="p">()</span>
  <span class="n">find_element_by_link_text</span><span class="p">()</span>
  <span class="n">find_element_by_partial_link_text</span><span class="p">()</span>
  <span class="n">find_element_by_tag_name</span><span class="p">()</span>
  <span class="n">find_element_by_class_name</span><span class="p">()</span>
  <span class="n">find_element_by_css_selector</span><span class="p">()</span>
    
  <span class="c1"># é€šç”¨æ–¹æ³•
# ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼šæŸ¥æ‰¾æ–¹å¼å’Œå€¼
</span>  <span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">xx</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>å¤šä¸ªèŠ‚ç‚¹</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

  <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
  <span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://taobao.com/'</span><span class="p">)</span>
  <span class="n">lis</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s">'.service-bd li'</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span>
  <span class="n">browser</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>    </div>
    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="p">[</span><span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"5f8d80a7-847a-4213-a46b-1ece5e469075"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"d2bd82d2-ce90-489d-a827-eb9f13c81a05"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"3a27519d-ea9a-4d00-981d-a02bed240586"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"2ad04b30-84a0-43a9-bd48-455194a9ab6c"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"9ab80873-f1e9-4095-9b7b-5cfd63a4bc1c"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"4e8135ce-d1f7-4f16-a211-58307a96703b"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"4c7f9990-88a2-4731-b1cb-2b0e3b423447"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"c6bd9291-e744-4b95-85c0-ff2e9e37d026"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"0651f495-b40c-4236-9553-3ec9fc3cb2ff"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"87e5aaf1-7ace-45aa-ab33-fa283dde15f9"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"4aa4088e-8afc-43c9-8d96-0c367b0f4e32"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"7eb9b09d-cf45-4554-8c86-4c44fff8b089"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"10634f40-9a59-419c-b09f-6eb0817dd213"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"0efb2ecd-f2b1-478c-93da-c22f8cebef9a"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"525855b9-786b-4dd8-86c0-1dc8811d89f0"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"b6dfe37c-730a-4ee1-a436-04b51d26cb1b"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">]</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="èŠ‚ç‚¹äº¤äº’">èŠ‚ç‚¹äº¤äº’</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://taobao.com/'</span><span class="p">)</span>
<span class="nb">input</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'q'</span><span class="p">)</span>
<span class="nb">input</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'iPhone'</span><span class="p">)</span>
<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">input</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
<span class="nb">input</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'iPad'</span><span class="p">)</span>
<span class="n">button</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_class_name</span><span class="p">(</span><span class="s">'btn-search'</span><span class="p">)</span>
<span class="n">button</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
</code></pre></div></div>
<p>é€šè¿‡ä¸Šé¢çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å®Œæˆäº†ä¸€äº›å¸¸è§çš„åŠ¨ä½œæ“ä½œï¼Œæ›´å¤šçš„æ“ä½œå¯ä»¥å‚è§å®˜æ–¹æ–‡æ¡£çš„äº¤äº’åŠ¨ä½œä»‹ç»ï¼š http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.remote.webelement</p>

<h3 id="åŠ¨ä½œé“¾">åŠ¨ä½œé“¾</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver</span> <span class="kn">import</span> <span class="n">ActionChains</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">'http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable'</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">switch_to</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="s">'iframeResult'</span><span class="p">)</span>
<span class="n">source</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">'#draggable'</span><span class="p">)</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">'#droppable'</span><span class="p">)</span>
<span class="n">actions</span> <span class="o">=</span> <span class="n">ActionChains</span><span class="p">(</span><span class="n">browser</span><span class="p">)</span>
<span class="n">actions</span><span class="p">.</span><span class="n">drag_and_drop</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
<span class="n">actions</span><span class="p">.</span><span class="n">perform</span><span class="p">()</span>
</code></pre></div></div>
<p>æ›´å¤šçš„åŠ¨ä½œé“¾æ“ä½œå¯ä»¥å‚è§å®˜æ–¹æ–‡æ¡£ï¼š http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.common.action_chains</p>

<h3 id="æ‰§è¡Œ-javascript">æ‰§è¡Œ JavaScript</h3>

<p>å¯¹äºé»˜å†™æ“ä½œï¼ŒSelenium API æ²¡æœ‰æä¾›ï¼Œæ¯”å¦‚ï¼Œä¸‹æ‹‰è¿›åº¦æ¡</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.zhihu.com/explore'</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s">'window.scrollTo(0, document.body.scrollHeight)'</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s">'alert("To Bottom")'</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="è·å–èŠ‚ç‚¹ä¿¡æ¯">è·å–èŠ‚ç‚¹ä¿¡æ¯</h3>

<ul>
  <li>
    <p>è·å–å±æ€§</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

  <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
  <span class="n">url</span> <span class="o">=</span> <span class="s">'http://www.zhihu.com/explore'</span>
  <span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="n">logo</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'zh-top-link-logo'</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">logo</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">logo</span><span class="p">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">'class'</span><span class="p">))</span>
</code></pre></div>    </div>

    <p>è¿è¡Œä¹‹åï¼Œç¨‹åºä¾¿ä¼šé©±åŠ¨æµè§ˆå™¨æ‰“å¼€çŸ¥ä¹é¡µé¢ï¼Œç„¶åè·å–çŸ¥ä¹çš„logoèŠ‚ç‚¹ï¼Œæœ€åæ‰“å°å‡ºå®ƒçš„class</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;selenium.webdriver.remote.webelement.WebElement (session="e08c0f28d7f44d75ccd50df6bb676104", element="0.7236390660048155-1")&gt;
  zu-top-link-logo
</code></pre></div>    </div>
  </li>
  <li>
    <p>è·å–æ–‡æœ¬å€¼</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

  <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
  <span class="n">url</span> <span class="o">=</span> <span class="s">'http://www.zhihu.com/explore'</span>
  <span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="nb">input</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_class_name</span><span class="p">(</span><span class="s">'zu-top-add-question'</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  æé—®
</code></pre></div>    </div>
  </li>
  <li>
    <p>è·å–idã€ä½ç½®ã€æ ‡ç­¾åå’Œå¤§å°</p>

    <p>WebElementèŠ‚ç‚¹è¿˜æœ‰ä¸€äº›å…¶ä»–å±æ€§ï¼Œæ¯”å¦‚idå±æ€§å¯ä»¥è·å–èŠ‚ç‚¹idï¼Œlocationå±æ€§å¯ä»¥è·å–è¯¥èŠ‚ç‚¹åœ¨é¡µé¢ä¸­çš„ç›¸å¯¹ä½ç½®ï¼Œtag_nameå±æ€§å¯ä»¥è·å–æ ‡ç­¾åç§°ï¼Œsizeå±æ€§å¯ä»¥è·å–èŠ‚ç‚¹çš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯å®½é«˜ï¼Œè¿™äº›å±æ€§æœ‰æ—¶å€™è¿˜æ˜¯å¾ˆæœ‰ç”¨çš„</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

  <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
  <span class="n">url</span> <span class="o">=</span> <span class="s">'http://www.zhihu.com/explore'</span>
  <span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="nb">input</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_class_name</span><span class="p">(</span><span class="s">'zu-top-add-question'</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="nb">id</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">location</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">tag_name</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">size</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="åˆ‡æ¢-frame">åˆ‡æ¢ Frame</h3>

<p>ç½‘é¡µä¸­æœ‰ä¸€ç§èŠ‚ç‚¹å«ä½œiframeï¼Œä¹Ÿå°±æ˜¯å­Frameï¼Œç›¸å½“äºé¡µé¢çš„å­é¡µé¢ï¼Œå®ƒçš„ç»“æ„å’Œå¤–éƒ¨ç½‘é¡µçš„ç»“æ„å®Œå…¨ä¸€è‡´ã€‚eleniumæ‰“å¼€é¡µé¢åï¼Œå®ƒé»˜è®¤æ˜¯åœ¨çˆ¶çº§Frameé‡Œé¢æ“ä½œï¼Œè€Œæ­¤æ—¶å¦‚æœé¡µé¢ä¸­è¿˜æœ‰å­Frameï¼Œå®ƒæ˜¯ä¸èƒ½è·å–åˆ°å­Frameé‡Œé¢çš„èŠ‚ç‚¹çš„ã€‚è¿™æ—¶å°±éœ€è¦ä½¿ç”¨switch_to.frame()æ–¹æ³•æ¥åˆ‡æ¢Frameã€‚</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">'http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable'</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">switch_to</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="s">'iframeResult'</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">logo</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_class_name</span><span class="p">(</span><span class="s">'logo'</span><span class="p">)</span>
<span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'No LOGO!'</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">switch_to</span><span class="p">.</span><span class="n">parent_frame</span><span class="p">()</span>
<span class="n">logo</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_class_name</span><span class="p">(</span><span class="s">'logo'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">logo</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">logo</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>No LOGO!
&lt;selenium.webdriver.remote.webelement.WebElement (session="a79db882fea6cf339ffff2980d14f4ed", element="8cf2debf-78f1-49d5-a689-4a31ae7306de")&gt;
RUNOOB.COM
</code></pre></div></div>
<p>è¿™é‡Œé¦–å…ˆé€šè¿‡switch_to.frame()æ–¹æ³•åˆ‡æ¢åˆ°å­Frameé‡Œé¢ï¼Œç„¶åå°è¯•è·å–çˆ¶çº§Frameé‡Œçš„logoèŠ‚ç‚¹ï¼ˆè¿™æ˜¯ä¸èƒ½æ‰¾åˆ°çš„ï¼‰ï¼Œå¦‚æœæ‰¾ä¸åˆ°çš„è¯ï¼Œå°±ä¼šæŠ›å‡ºNoSuchElementExceptionå¼‚å¸¸ï¼Œå¼‚å¸¸è¢«æ•æ‰ä¹‹åï¼Œå°±ä¼šè¾“å‡ºNO LOGOã€‚æ¥ä¸‹æ¥ï¼Œé‡æ–°åˆ‡æ¢å›çˆ¶çº§Frameï¼Œç„¶åå†æ¬¡é‡æ–°è·å–èŠ‚ç‚¹ï¼Œå‘ç°æ­¤æ—¶å¯ä»¥æˆåŠŸè·å–äº†ã€‚</p>

<p>æ‰€ä»¥ï¼Œå½“é¡µé¢ä¸­åŒ…å«å­Frameæ—¶ï¼Œå¦‚æœæƒ³è·å–å­Frameä¸­çš„èŠ‚ç‚¹ï¼Œéœ€è¦å…ˆè°ƒç”¨switch_to.frame()æ–¹æ³•åˆ‡æ¢åˆ°å¯¹åº”çš„Frameï¼Œç„¶åå†è¿›è¡Œæ“ä½œã€‚</p>

<h3 id="å»¶æ—¶ç­‰å¾…">å»¶æ—¶ç­‰å¾…</h3>

<p>åœ¨Seleniumä¸­ï¼Œget()æ–¹æ³•ä¼šåœ¨ç½‘é¡µæ¡†æ¶åŠ è½½ç»“æŸåç»“æŸæ‰§è¡Œï¼Œæ­¤æ—¶å¦‚æœè·å–page_sourceï¼Œå¯èƒ½å¹¶ä¸æ˜¯æµè§ˆå™¨å®Œå…¨åŠ è½½å®Œæˆçš„é¡µé¢ï¼Œå¦‚æœæŸäº›é¡µé¢æœ‰é¢å¤–çš„Ajaxè¯·æ±‚ï¼Œæˆ‘ä»¬åœ¨ç½‘é¡µæºä»£ç ä¸­ä¹Ÿä¸ä¸€å®šèƒ½æˆåŠŸè·å–åˆ°ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œéœ€è¦å»¶æ—¶ç­‰å¾…ä¸€å®šæ—¶é—´ï¼Œç¡®ä¿èŠ‚ç‚¹å·²ç»åŠ è½½å‡ºæ¥ã€‚</p>

<ul>
  <li>
    <p>éšå¼ç­‰å¾…</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

  <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
  <span class="n">browser</span><span class="p">.</span><span class="n">implicitly_wait</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
  <span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.zhihu.com/explore'</span><span class="p">)</span>
  <span class="nb">input</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_class_name</span><span class="p">(</span><span class="s">'zu-top-ass-question'</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>æ˜¾ç¤ºç­‰å¾…</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
  <span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
  <span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
  <span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>

  <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
  <span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.taobao.com/'</span><span class="p">)</span>
  <span class="n">wait</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
  <span class="nb">input</span> <span class="o">=</span> <span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">'q'</span><span class="p">)))</span>
  <span class="n">button</span> <span class="o">=</span> <span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s">'.btn-search'</span><span class="p">)))</span>
  <span class="k">print</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">button</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ul>

<table>
  <thead>
    <tr>
      <th>ç­‰å¾…æ¡ä»¶</th>
      <th>å«ä¹‰</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>title_is</td>
      <td>æ ‡é¢˜æ˜¯æŸå†…å®¹</td>
    </tr>
    <tr>
      <td>title_contains</td>
      <td>æ ‡é¢˜åŒ…å«æŸå†…å®¹</td>
    </tr>
    <tr>
      <td>presence_of_element_located</td>
      <td>èŠ‚ç‚¹åŠ è½½å‡ºæ¥ï¼Œä¼ å…¥å®šä½å…ƒç»„</td>
    </tr>
    <tr>
      <td>visibilty_of_element_located</td>
      <td>èŠ‚ç‚¹å¯è§ï¼Œä¼ å…¥å®šä½å…ƒç»„</td>
    </tr>
    <tr>
      <td>visibilty_of</td>
      <td>å¯è§ï¼Œä¼ å…¥èŠ‚ç‚¹å¯¹è±¡</td>
    </tr>
    <tr>
      <td>presence_of_all_elements_loacted</td>
      <td>æ‰€æœ‰èŠ‚ç‚¹åŠ è½½å‡ºæ¥</td>
    </tr>
    <tr>
      <td>text_to_be_present_in_element</td>
      <td>æŸä¸ªèŠ‚ç‚¹æ–‡æœ¬åŒ…å«æŸæ–‡å­—</td>
    </tr>
    <tr>
      <td>text_to_be_present_in_element_value</td>
      <td>æŸä¸ªèŠ‚ç‚¹å€¼åŒ…å«æŸæ–‡å­—</td>
    </tr>
    <tr>
      <td>frame_to_be_available_and_switch_to_it</td>
      <td>åŠ è½½å¹¶åˆ‡æ¢</td>
    </tr>
    <tr>
      <td>invisibility_of_element_located</td>
      <td>èŠ‚ç‚¹ä¸å¯è§</td>
    </tr>
    <tr>
      <td>element_to_be_clickable</td>
      <td>èŠ‚ç‚¹å¯ç‚¹å‡»</td>
    </tr>
    <tr>
      <td>staleness_of</td>
      <td>åˆ¤æ–­ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ä»åœ¨ DOMï¼Œå¯åˆ¤æ–­é¡µé¢æ˜¯å¦å·²ç»åˆ·æ–°</td>
    </tr>
    <tr>
      <td>element_to_be_selected</td>
      <td>èŠ‚ç‚¹å¯é€‰æ‹©ï¼Œä¼ èŠ‚ç‚¹å¯¹è±¡</td>
    </tr>
    <tr>
      <td>element_located_to_be_selected</td>
      <td>èŠ‚ç‚¹å¯é€‰æ‹©ï¼Œä¼ å…¥å®šä½å…ƒç»„</td>
    </tr>
    <tr>
      <td>element_selection_state_to_be</td>
      <td>ä¼ å…¥èŠ‚ç‚¹å¯¹è±¡ä»¥åŠçŠ¶æ€ï¼Œç›¸ç­‰è¿”å› Trueï¼Œå¦åˆ™è¿”å› False</td>
    </tr>
    <tr>
      <td>element_located_selection_state_to_be</td>
      <td>ä¼ å…¥å®šä½å…ƒç»„ä»¥åŠçŠ¶æ€ï¼Œç›¸ç­‰è¿”å› Trueï¼Œå¦åˆ™è¿”å› False</td>
    </tr>
    <tr>
      <td>alert_is_present</td>
      <td>æ˜¯å¦å‡ºç°è­¦å‘Š</td>
    </tr>
  </tbody>
</table>

<h3 id="å‰è¿›å’Œåé€€">å‰è¿›å’Œåé€€</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.baidu.com/'</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.taobao.com/'</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://python.org/'</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">back</span><span class="p">()</span>
<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">forward</span><span class="p">()</span>
<span class="n">browser</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="cookies">Cookies</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.zhihu.com/explore'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">get_cookies</span><span class="p">())</span>
<span class="n">browser</span><span class="p">.</span><span class="n">add_cookie</span><span class="p">({</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'name'</span><span class="p">,</span> <span class="s">'domain'</span><span class="p">:</span> <span class="s">'www.zhihu.com'</span><span class="p">,</span> <span class="s">'value'</span><span class="p">:</span> <span class="s">'germey'</span><span class="p">})</span>
<span class="k">print</span><span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">get_cookies</span><span class="p">())</span>
<span class="n">browser</span><span class="p">.</span><span class="n">delete_all_cookies</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">get_cookies</span><span class="p">())</span>
</code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[{'domain': '.zhihu.com', 'httpOnly': False, 'name': 'Hm_lpvt_98beee57fd2ef70ccdd5ca52b9740c49', 'path': '/', 'secure': False, 'value': '1574632295'}, {'domain': '.zhihu.com', 'expiry': 1606168295, 'httpOnly': False, 'name': 'Hm_lvt_98beee57fd2ef70ccdd5ca52b9740c49', 'path': '/', 'secure': False, 'value': '1574632295'}, {'domain': 'www.zhihu.com', 'expiry': 1574633193.39274, 'httpOnly': False, 'name': 'tgw_l7_route', 'path': '/', 'secure': False, 'value': '060f637cd101836814f6c53316f73463'}, {'domain': '.zhihu.com', 'expiry': 1669240293.393064, 'httpOnly': False, 'name': 'd_c0', 'path': '/', 'secure': False, 'value': '"AKAvpC3tZxCPTpjxr8sWHBQwuVqsYUAIHxY=|1574632294"'}, {'domain': '.zhihu.com', 'httpOnly': False, 'name': '_xsrf', 'path': '/', 'secure': False, 'value': 'a08e97a6-1b4c-4a42-80a4-f157b12f0e40'}, {'domain': '.zhihu.com', 'expiry': 1637704293.392961, 'httpOnly': False, 'name': '_zap', 'path': '/', 'secure': False, 'value': 'a23bc58f-40a5-41ce-b0c1-06556a1fb95e'}]
[{'domain': '.www.zhihu.com', 'httpOnly': False, 'name': 'name', 'path': '/', 'secure': True, 'value': 'germey'}, {'domain': '.zhihu.com', 'httpOnly': False, 'name': 'Hm_lpvt_98beee57fd2ef70ccdd5ca52b9740c49', 'path': '/', 'secure': False, 'value': '1574632295'}, {'domain': '.zhihu.com', 'expiry': 1606168295, 'httpOnly': False, 'name': 'Hm_lvt_98beee57fd2ef70ccdd5ca52b9740c49', 'path': '/', 'secure': False, 'value': '1574632295'}, {'domain': 'www.zhihu.com', 'expiry': 1574633193.39274, 'httpOnly': False, 'name': 'tgw_l7_route', 'path': '/', 'secure': False, 'value': '060f637cd101836814f6c53316f73463'}, {'domain': '.zhihu.com', 'expiry': 1669240293.393064, 'httpOnly': False, 'name': 'd_c0', 'path': '/', 'secure': False, 'value': '"AKAvpC3tZxCPTpjxr8sWHBQwuVqsYUAIHxY=|1574632294"'}, {'domain': '.zhihu.com', 'httpOnly': False, 'name': '_xsrf', 'path': '/', 'secure': False, 'value': 'a08e97a6-1b4c-4a42-80a4-f157b12f0e40'}, {'domain': '.zhihu.com', 'expiry': 1637704293.392961, 'httpOnly': False, 'name': '_zap', 'path': '/', 'secure': False, 'value': 'a23bc58f-40a5-41ce-b0c1-06556a1fb95e'}]
[]
</code></pre></div></div>

<h3 id="é€‰é¡¹å¡ç®¡ç†">é€‰é¡¹å¡ç®¡ç†</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.baidu.com/'</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s">'window.open()'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">window_handles</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">switch_to</span><span class="p">.</span><span class="n">window</span><span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">window_handles</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.taobao.com/'</span><span class="p">)</span>
<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">switch_to</span><span class="p">.</span><span class="n">window</span><span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">window_handles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://python.org'</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="å¼‚å¸¸å¤„ç†">å¼‚å¸¸å¤„ç†</h3>

<p>èŠ‚ç‚¹æœªæ‰¾åˆ°å¼‚å¸¸</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.baidu.com/'</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'hello'</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>selenium.common.exceptions.NoSuchElementException: Message: no such element: Unable to locate element: {"method":"css selector","selector":"[id="hello"]"}
  (Session info: chrome=78.0.3904.108)
</code></pre></div></div>
<p>æ•è·å¼‚å¸¸</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span><span class="p">,</span><span class="n">NoSuchElementException</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.baidu.com/'</span><span class="p">)</span>
<span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Time OUT!'</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'hello'</span><span class="p">)</span>
<span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'No Element'</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">browser</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="ä½¿ç”¨-selenium-çˆ¬å–æ·˜å®å•†å“">ä½¿ç”¨ Selenium çˆ¬å–æ·˜å®å•†å“</h2>
<h3 id="æ¥å£åˆ†æ">æ¥å£åˆ†æ</h3>

<p>æ‰“å¼€æ·˜å®é¦–é¡µï¼Œæœç´¢ä½ è¦æœç´¢çš„å•†å“åç§°ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œæœç´¢ipad,æ³¨æ„è§‚å¯Ÿæ­¤æ—¶çš„urlæœ‰ä»€ä¹ˆå˜åŒ–(é™„ä¸Šé“¾æ¥ https://s.taobao.com/search?q=ipad)ï¼Œä»”ç»†è§‚å¯Ÿä¾¿å¯ä»¥çœ‹åˆ°ä¸åŒï¼Œç„¶åæŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œæ‰¾åˆ°å•†å“åˆ—è¡¨æ‰€åœ¨çš„ä½ç½®ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œå•†å“åˆ—è¡¨è—åœ¨m-itemlist é‡Œé¢çš„itemsé‡Œé¢çš„itemï¼š</p>

<p>ç»§ç»­ä¸‹æ‹‰ï¼ŒæŸ¥è¯¢å•†å“çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚å•†å“çš„å›¾ç‰‡ï¼Œåç§°ï¼Œä»·æ ¼ï¼Œè´­ä¹°äººæ•°ï¼Œåº—é“ºåç§°ç­‰ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>

<p>å¤§æ¦‚å°±æ˜¯ç±»ä¼¼è¿™æ ·çš„ä¿¡æ¯ã€‚è€Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯å°†è¿™äº›ä¿¡æ¯æŠ“å–ä¸‹æ¥ï¼Œå†å¾€ä¸‹æ‹‰å°±å¯ä»¥å‘ç°ï¼Œåœ¨é¡µé¢ä¸‹æ–¹ï¼Œæœ‰ä¸€ä¸ªåˆ†é¡µå¯¼èˆªï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªå¯ä»¥è¾“å…¥ä»»æ„é¡µç è·³è½¬çš„é“¾æ¥</p>

<p>è¿™é‡Œå•†å“çš„æœç´¢ç»“æœä¸€èˆ¬éƒ½å¤§äº100é¡µï¼Œè¦è·å–æ¯ä¸€é¡µçš„å†…å®¹ï¼Œåªéœ€è¦å°†é¡µç ä»1åˆ°100éå†å³å¯ã€‚æ‰€ä»¥ï¼Œç›´æ¥åœ¨é¡µé¢è·³è½¬é“¾æ¥ä¸­è¾“å…¥è¦è·³è½¬çš„é“¾æ¥å³å¯è·³è½¬åˆ°é¡µç ç›¸åº”çš„é¡µé¢ã€‚</p>

<h3 id="è·å–å•†å“åˆ—è¡¨">è·å–å•†å“åˆ—è¡¨</h3>

<p>é¦–å…ˆï¼Œéœ€è¦æ„é€ ä¸€ä¸ªæŠ“å–çš„URLï¼šhttps://s.taobao.com/search?q=iPadã€‚è¿™ä¸ªURLéå¸¸ç®€æ´ï¼Œå‚æ•°qå°±æ˜¯è¦æœç´¢çš„å…³é”®å­—ã€‚åªè¦æ”¹å˜è¿™ä¸ªå‚æ•°ï¼Œå³å¯è·å–ä¸åŒå•†å“çš„åˆ—è¡¨ã€‚è¿™é‡Œæˆ‘ä»¬å°†å•†å“çš„å…³é”®å­—å®šä¹‰æˆä¸€ä¸ªå˜é‡ï¼Œç„¶åæ„é€ å‡ºè¿™æ ·çš„ä¸€ä¸ªURLã€‚</p>

<p>ç„¶åï¼Œå°±éœ€è¦ç”¨Seleniumè¿›è¡ŒæŠ“å–äº†ã€‚æˆ‘ä»¬å®ç°å¦‚ä¸‹æŠ“å–åˆ—è¡¨é¡µçš„æ–¹æ³•ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.wait</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">quote</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">wait</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">KEYWORD</span> <span class="o">=</span> <span class="s">'iPad'</span>

<span class="k">def</span> <span class="nf">index_page</span><span class="p">(</span><span class="n">page</span><span class="p">):</span>
    <span class="s">"""
    æŠ“å–ç´¢å¼•é¡µ
    :param page: é¡µç 
    """</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'æ­£åœ¨çˆ¬å–ç¬¬'</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="s">'é¡µ'</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">'https://s.taobao.com/search?q='</span> <span class="o">+</span> <span class="n">quote</span><span class="p">(</span><span class="n">KEYWORD</span><span class="p">)</span>
        <span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">page</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">input</span> <span class="o">=</span> <span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span>
                <span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s">'#mainsrp-pager div.form &gt; input'</span><span class="p">)))</span>
            <span class="n">submit</span> <span class="o">=</span> <span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span>
                <span class="n">EC</span><span class="p">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s">'#mainsrp-pager div.form &gt; span.btn.J_Submit'</span><span class="p">)))</span>
            <span class="nb">input</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="nb">input</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
            <span class="n">submit</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="p">.</span><span class="n">text_to_be_present_in_element</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s">'#mainsrp-pager li.item.active &gt; span'</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">page</span><span class="p">)))</span>
        <span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s">'.m-itemlist .items .item'</span><span class="p">)))</span>
        <span class="n">get_products</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
        <span class="n">index_page</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿™é‡Œé¦–å…ˆæ„é€ äº†ä¸€ä¸ªWebDriverå¯¹è±¡ï¼Œä½¿ç”¨çš„æµè§ˆå™¨æ˜¯Chromeï¼Œç„¶åæŒ‡å®šä¸€ä¸ªå…³é”®è¯ï¼Œå¦‚iPadï¼Œæ¥ç€å®šä¹‰äº†index_page()æ–¹æ³•ï¼Œç”¨äºæŠ“å–å•†å“åˆ—è¡¨é¡µã€‚</p>

<p>åœ¨è¯¥æ–¹æ³•é‡Œï¼Œæˆ‘ä»¬é¦–å…ˆè®¿é—®äº†æœç´¢å•†å“çš„é“¾æ¥ï¼Œç„¶ååˆ¤æ–­äº†å½“å‰çš„é¡µç ï¼Œå¦‚æœå¤§äº1ï¼Œå°±è¿›è¡Œè·³é¡µæ“ä½œï¼Œå¦åˆ™ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆã€‚</p>

<p>ç­‰å¾…åŠ è½½æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†WebDriverWaitå¯¹è±¡ï¼Œå®ƒå¯ä»¥æŒ‡å®šç­‰å¾…æ¡ä»¶ï¼ŒåŒæ—¶æŒ‡å®šä¸€ä¸ªæœ€é•¿ç­‰å¾…æ—¶é—´ï¼Œè¿™é‡ŒæŒ‡å®šä¸ºæœ€é•¿10ç§’ã€‚å¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…æˆåŠŸåŒ¹é…äº†ç­‰å¾…æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´é¡µé¢å…ƒç´ æˆåŠŸåŠ è½½å‡ºæ¥äº†ï¼Œå°±ç«‹å³è¿”å›ç›¸åº”ç»“æœå¹¶ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œå¦åˆ™åˆ°äº†æœ€å¤§ç­‰å¾…æ—¶é—´è¿˜æ²¡æœ‰åŠ è½½å‡ºæ¥æ—¶ï¼Œå°±ç›´æ¥æŠ›å‡ºè¶…æ—¶å¼‚å¸¸ã€‚</p>

<p>æ¯”å¦‚ï¼Œæˆ‘ä»¬æœ€ç»ˆè¦ç­‰å¾…å•†å“ä¿¡æ¯åŠ è½½å‡ºæ¥ï¼Œå°±æŒ‡å®šäº†presence_of_element_locatedè¿™ä¸ªæ¡ä»¶ï¼Œç„¶åä¼ å…¥äº†.m-itemlist .items .itemè¿™ä¸ªé€‰æ‹©å™¨ï¼Œè€Œè¿™ä¸ªé€‰æ‹©å™¨å¯¹åº”çš„é¡µé¢å†…å®¹å°±æ˜¯æ¯ä¸ªå•†å“çš„ä¿¡æ¯å—ï¼Œå¯ä»¥åˆ°ç½‘é¡µé‡Œé¢æŸ¥çœ‹ä¸€ä¸‹ã€‚å¦‚æœåŠ è½½æˆåŠŸï¼Œå°±ä¼šæ‰§è¡Œåç»­çš„get_products()æ–¹æ³•ï¼Œæå–å•†å“ä¿¡æ¯ã€‚</p>

<p>å…³äºç¿»é¡µæ“ä½œï¼Œè¿™é‡Œé¦–å…ˆè·å–é¡µç è¾“å…¥æ¡†ï¼Œèµ‹å€¼ä¸ºinputï¼Œç„¶åè·å–â€œç¡®å®šâ€æŒ‰é’®ï¼Œèµ‹å€¼ä¸ºsubmit</p>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¸…ç©ºäº†è¾“å…¥æ¡†ï¼Œæ­¤æ—¶è°ƒç”¨clear()æ–¹æ³•å³å¯ã€‚éšåï¼Œè°ƒç”¨send_keys()æ–¹æ³•å°†é¡µç å¡«å……åˆ°è¾“å…¥æ¡†ä¸­ï¼Œç„¶åç‚¹å‡»â€œç¡®å®šâ€æŒ‰é’®å³å¯ã€‚</p>

<p>é‚£ä¹ˆï¼Œæ€æ ·çŸ¥é“æœ‰æ²¡æœ‰è·³è½¬åˆ°å¯¹åº”çš„é¡µç å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°ï¼ŒæˆåŠŸè·³è½¬æŸä¸€é¡µåï¼Œé¡µç éƒ½ä¼šé«˜äº®æ˜¾ç¤º</p>

<p>æˆ‘ä»¬åªéœ€è¦åˆ¤æ–­å½“å‰é«˜äº®çš„é¡µç æ•°æ˜¯å½“å‰çš„é¡µç æ•°å³å¯ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨äº†å¦ä¸€ä¸ªç­‰å¾…æ¡ä»¶text_to_be_present_in_elementï¼Œå®ƒä¼šç­‰å¾…æŒ‡å®šçš„æ–‡æœ¬å‡ºç°åœ¨æŸä¸€ä¸ªèŠ‚ç‚¹é‡Œé¢æ—¶å³è¿”å›æˆåŠŸã€‚è¿™é‡Œæˆ‘ä»¬å°†é«˜äº®çš„é¡µç èŠ‚ç‚¹å¯¹åº”çš„CSSé€‰æ‹©å™¨å’Œå½“å‰è¦è·³è½¬çš„é¡µç é€šè¿‡å‚æ•°ä¼ é€’ç»™è¿™ä¸ªç­‰å¾…æ¡ä»¶ï¼Œè¿™æ ·å®ƒå°±ä¼šæ£€æµ‹å½“å‰é«˜äº®çš„é¡µç èŠ‚ç‚¹æ˜¯ä¸æ˜¯æˆ‘ä»¬ä¼ è¿‡æ¥çš„é¡µç æ•°ï¼Œå¦‚æœæ˜¯ï¼Œå°±è¯æ˜é¡µé¢æˆåŠŸè·³è½¬åˆ°äº†è¿™ä¸€é¡µï¼Œé¡µé¢è·³è½¬æˆåŠŸã€‚</p>

<p>è¿™æ ·åˆšæ‰å®ç°çš„index_page()æ–¹æ³•å°±å¯ä»¥ä¼ å…¥å¯¹åº”çš„é¡µç ï¼Œå¾…åŠ è½½å‡ºå¯¹åº”é¡µç çš„å•†å“åˆ—è¡¨åï¼Œå†å»è°ƒç”¨get_products()æ–¹æ³•è¿›è¡Œé¡µé¢è§£æã€‚</p>

<h3 id="è§£æå•†å“åˆ—è¡¨">è§£æå•†å“åˆ—è¡¨</h3>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°get_products()æ–¹æ³•æ¥è§£æå•†å“åˆ—è¡¨äº†ã€‚è¿™é‡Œæˆ‘ä»¬ç›´æ¥è·å–é¡µé¢æºä»£ç ï¼Œç„¶åç”¨pyqueryè¿›è¡Œè§£æ</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyquery</span> <span class="kn">import</span> <span class="n">PyQuery</span> <span class="k">as</span> <span class="n">pq</span>
<span class="k">def</span> <span class="nf">get_products</span><span class="p">():</span>
    <span class="s">"""
    æå–å•†å“æ•°æ®
    """</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">page_source</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">pq</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">doc</span><span class="p">(</span><span class="s">'#mainsrp-itemlist .items .item'</span><span class="p">).</span><span class="n">items</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
        <span class="n">product</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">'image'</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'.pic .img'</span><span class="p">).</span><span class="n">attr</span><span class="p">(</span><span class="s">'data-src'</span><span class="p">),</span>
            <span class="s">'price'</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'.price'</span><span class="p">).</span><span class="n">text</span><span class="p">(),</span>
            <span class="s">'deal'</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'.deal-cnt'</span><span class="p">).</span><span class="n">text</span><span class="p">(),</span>
            <span class="s">'title'</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'.title'</span><span class="p">).</span><span class="n">text</span><span class="p">(),</span>
            <span class="s">'shop'</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'.shop'</span><span class="p">).</span><span class="n">text</span><span class="p">(),</span>
            <span class="s">'location'</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'.location'</span><span class="p">).</span><span class="n">text</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">print</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
        <span class="n">save_to_mongo</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
</code></pre></div></div>
<p>é¦–å…ˆï¼Œè°ƒç”¨page_sourceå±æ€§è·å–é¡µç çš„æºä»£ç ï¼Œç„¶åæ„é€ äº†PyQueryè§£æå¯¹è±¡ï¼Œæ¥ç€æå–äº†å•†å“åˆ—è¡¨ï¼Œæ­¤æ—¶ä½¿ç”¨çš„CSSé€‰æ‹©å™¨æ˜¯#mainsrp-itemlist .items .itemï¼Œå®ƒä¼šåŒ¹é…æ•´ä¸ªé¡µé¢çš„æ¯ä¸ªå•†å“ã€‚å®ƒçš„åŒ¹é…ç»“æœæ˜¯å¤šä¸ªï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åˆå¯¹å®ƒè¿›è¡Œäº†ä¸€æ¬¡éå†ï¼Œç”¨forå¾ªç¯å°†æ¯ä¸ªç»“æœåˆ†åˆ«è¿›è¡Œè§£æï¼Œæ¯æ¬¡å¾ªç¯æŠŠå®ƒèµ‹å€¼ä¸ºitemå˜é‡ï¼Œæ¯ä¸ªitemå˜é‡éƒ½æ˜¯ä¸€ä¸ªPyQueryå¯¹è±¡ï¼Œç„¶åå†è°ƒç”¨å®ƒçš„find()æ–¹æ³•ï¼Œä¼ å…¥CSSé€‰æ‹©å™¨ï¼Œå°±å¯ä»¥è·å–å•ä¸ªå•†å“çš„ç‰¹å®šå†…å®¹äº†ã€‚</p>

<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ©ç”¨find()æ–¹æ³•æ‰¾åˆ°å›¾ç‰‡çš„è¿™ä¸ªèŠ‚ç‚¹ï¼Œç„¶åå†è°ƒç”¨attr()æ–¹æ³•è·å–å•†å“çš„data-srcå±æ€§ï¼Œè¿™æ ·å°±æˆåŠŸæå–äº†å•†å“å›¾ç‰‡é“¾æ¥ã€‚ç„¶åç”¨åŒæ ·çš„æ–¹æ³•æå–å•†å“çš„ä»·æ ¼ã€æˆäº¤é‡ã€åç§°ã€åº—é“ºå’Œåº—é“ºæ‰€åœ¨åœ°ç­‰ä¿¡æ¯ï¼Œæ¥ç€å°†æ‰€æœ‰æå–ç»“æœèµ‹å€¼ä¸ºä¸€ä¸ªå­—å…¸productï¼Œéšåè°ƒç”¨save_to_mongo()å°†å…¶ä¿å­˜åˆ°MongoDBå³å¯ã€‚</p>

<h3 id="ä¿å­˜åˆ°-mongodb">ä¿å­˜åˆ° MongoDB</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">MONGO_URL</span> <span class="o">=</span> <span class="s">'localhost'</span>
<span class="n">MONGO_DB</span> <span class="o">=</span> <span class="s">'taobao'</span>
<span class="n">MONGO_COLLECTION</span> <span class="o">=</span> <span class="s">'products'</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">pymongo</span><span class="p">.</span><span class="n">MongoClient</span><span class="p">(</span><span class="n">MONGO_URL</span><span class="p">)</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="n">MONGO_DB</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">save_to_mongo</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
    <span class="s">"""
    ä¿å­˜è‡³MongoDB
    :param result: ç»“æœ
    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">db</span><span class="p">[</span><span class="n">MONGO_COLLECTION</span><span class="p">].</span><span class="n">insert</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'å­˜å‚¨åˆ°MongoDBæˆåŠŸ'</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'å­˜å‚¨åˆ°MongoDBå¤±è´¥'</span><span class="p">)</span>
</code></pre></div></div>

<p>è¿™é‡Œé¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªMongoDBçš„è¿æ¥å¯¹è±¡ï¼Œç„¶åæŒ‡å®šäº†æ•°æ®åº“ï¼ŒéšåæŒ‡å®šäº†Collectionçš„åç§°ï¼Œæ¥ç€ç›´æ¥è°ƒç”¨insert()æ–¹æ³•å°†æ•°æ®æ’å…¥åˆ°MongoDBã€‚æ­¤å¤„çš„resultå˜é‡å°±æ˜¯åœ¨get_products()æ–¹æ³•é‡Œä¼ æ¥çš„productï¼ŒåŒ…å«å•ä¸ªå•†å“çš„ä¿¡æ¯</p>

<h3 id="éå†æ¯é¡µ">éå†æ¯é¡µ</h3>

<p>åˆšæ‰æˆ‘ä»¬æ‰€å®šä¹‰çš„get_index()æ–¹æ³•éœ€è¦æ¥æ”¶å‚æ•°pageï¼Œpageä»£è¡¨é¡µç ã€‚è¿™é‡Œæˆ‘ä»¬å®ç°é¡µç éå†å³å¯</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">MAX_PAGE</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="s">"""
    éå†æ¯ä¸€é¡µ
    """</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">MAX_PAGE</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">index_page</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</code></pre></div></div>

<p>å…¶å®ç°éå¸¸ç®€å•ï¼Œåªéœ€è¦è°ƒç”¨ä¸€ä¸ªforå¾ªç¯å³å¯ã€‚è¿™é‡Œå®šä¹‰æœ€å¤§çš„é¡µç æ•°ä¸º100ï¼Œrange()æ–¹æ³•çš„è¿”å›ç»“æœå°±æ˜¯1åˆ°100çš„åˆ—è¡¨ï¼Œé¡ºåºéå†ï¼Œè°ƒç”¨index_page()æ–¹æ³•å³å¯ã€‚</p>

<h3 id="è¿è¡Œ">è¿è¡Œ</h3>

<p>è¿è¡Œä»£ç ï¼Œå¯ä»¥å‘ç°é¦–å…ˆä¼šå¼¹å‡ºä¸€ä¸ªChromeæµè§ˆå™¨ï¼Œç„¶åä¼šè®¿é—®æ·˜å®é¡µé¢ï¼Œæ¥ç€æ§åˆ¶å°ä¾¿ä¼šè¾“å‡ºç›¸åº”çš„æå–ç»“æœ</p>

<p>å¯ä»¥å‘ç°ï¼Œè¿™äº›å•†å“ä¿¡æ¯çš„ç»“æœéƒ½æ˜¯å­—å…¸å½¢å¼ï¼Œå®ƒä»¬è¢«å­˜å‚¨åˆ°MongoDBé‡Œé¢ã€‚</p>

<h3 id="chrome-headless-æ¨¡å¼">Chrome Headless æ¨¡å¼</h3>

<p>ä»Chrome 59ç‰ˆæœ¬å¼€å§‹ï¼Œå·²ç»å¼€å§‹æ”¯æŒHeadlessæ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯æ— ç•Œé¢æ¨¡å¼ï¼Œè¿™æ ·çˆ¬å–çš„æ—¶å€™å°±ä¸ä¼šå¼¹å‡ºæµè§ˆå™¨äº†ã€‚å¦‚æœè¦ä½¿ç”¨æ­¤æ¨¡å¼ï¼Œè¯·æŠŠChromeå‡çº§åˆ°59ç‰ˆæœ¬åŠä»¥ä¸Šã€‚å¯ç”¨Headlessæ¨¡å¼çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">chrome_options</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
<span class="n">chrome_options</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--headless'</span><span class="p">)</span>
<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">chrome_options</span><span class="o">=</span><span class="n">chrome_options</span><span class="p">)</span>
</code></pre></div></div>
<p>é¦–å…ˆï¼Œåˆ›å»ºChromeOptionså¯¹è±¡ï¼Œæ¥ç€æ·»åŠ headlesså‚æ•°ï¼Œç„¶ååœ¨åˆå§‹åŒ–Chromeå¯¹è±¡çš„æ—¶å€™é€šè¿‡chrome_optionsä¼ é€’è¿™ä¸ªChromeOptionså¯¹è±¡ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æˆåŠŸå¯ç”¨Chromeçš„Headlessæ¨¡å¼äº†ã€‚</p>

<h3 id="å¯¹æ¥-firefox">å¯¹æ¥ Firefox</h3>

<p>è¦å¯¹æ¥Firefoxæµè§ˆå™¨ï¼Œéå¸¸ç®€å•ï¼Œåªéœ€è¦æ›´æ”¹ä¸€å¤„å³å¯ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Firefox</span><span class="p">()</span>
</code></pre></div></div>
<p>è¿™é‡Œæ›´æ”¹äº†browserå¯¹è±¡çš„åˆ›å»ºæ–¹å¼ï¼Œè¿™æ ·çˆ¬å–çš„æ—¶å€™å°±ä¼šä½¿ç”¨Firefoxæµè§ˆå™¨äº†ã€‚</p>

<h3 id="å¯¹æ¥-phantomjs">å¯¹æ¥ PhantomJS</h3>

<p>å¦‚æœä¸æƒ³ä½¿ç”¨Chromeçš„Headlessæ¨¡å¼ï¼Œè¿˜å¯ä»¥ä½¿ç”¨PhantomJSï¼ˆå®ƒæ˜¯ä¸€ä¸ªæ— ç•Œé¢æµè§ˆå™¨ï¼‰æ¥æŠ“å–ã€‚æŠ“å–æ—¶ï¼ŒåŒæ ·ä¸ä¼šå¼¹å‡ºçª—å£ï¼Œè¿˜æ˜¯åªéœ€è¦å°†WebDriverçš„å£°æ˜ä¿®æ”¹ä¸€ä¸‹å³å¯ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">PhantomJS</span><span class="p">()</span>
</code></pre></div></div>
<p>å¦å¤–ï¼Œå®ƒè¿˜æ”¯æŒå‘½ä»¤è¡Œé…ç½®ã€‚æ¯”å¦‚ï¼Œå¯ä»¥è®¾ç½®ç¼“å­˜å’Œç¦ç”¨å›¾ç‰‡åŠ è½½çš„åŠŸèƒ½ï¼Œè¿›ä¸€æ­¥æé«˜çˆ¬å–æ•ˆç‡ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SERVICE_ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s">'--load-images=false'</span><span class="p">,</span> <span class="s">'--disk-cache=true'</span><span class="p">]</span>
<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">PhantomJS</span><span class="p">(</span><span class="n">service_args</span><span class="o">=</span><span class="n">SERVICE_ARGS</span><span class="p">)</span>
</code></pre></div></div>
<p>=======
â€”
layout: post
title: Selenium çš„ä½¿ç”¨
subtitle: 
author: Balbo Cheng
categories: python
tags: [reptile]
â€”</p>
<h2 id="selenium-çš„ä½¿ç”¨-1">Selenium çš„ä½¿ç”¨</h2>
<h3 id="åŸºæœ¬ä½¿ç”¨-1">åŸºæœ¬ä½¿ç”¨</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="kn">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.wait</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.baidu.com'</span><span class="p">)</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'kw'</span><span class="p">)</span>
    <span class="nb">input</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'Python'</span><span class="p">)</span>
    <span class="nb">input</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="n">ENTER</span><span class="p">)</span>
    <span class="n">wait</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">'content_left'</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">current_url</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">get_cookies</span><span class="p">())</span>
    <span class="k">print</span><span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">page_source</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">browser</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>
<p>å¦‚æœç”¨ Selenium æ¥é©±åŠ¨æµè§ˆå™¨åŠ è½½ç½‘é¡µçš„è¯ï¼Œå°±å¯ä»¥ç›´æ¥æ‹¿åˆ° JavaScript æ¸²æŸ“çš„ç»“æœ</p>

<h3 id="å£°æ˜æµè§ˆå™¨å¯¹è±¡-1">å£°æ˜æµè§ˆå™¨å¯¹è±¡</h3>

<p>Selenium æ”¯æŒéå¸¸å¤šçš„æµè§ˆå™¨ï¼Œå¦‚ Chromã€Firefoxã€Edgeç­‰ï¼Œè¿˜æœ‰ Androidã€BalckBerryç­‰æ‰‹æœºç«¯çš„æµè§ˆå™¨ï¼Œè¿˜æœ‰æ— ç•Œé¢æµè§ˆå™¨ PhantomJS</p>

<p>æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼åˆå§‹åŒ–</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Firefox</span><span class="p">()</span>
<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Edge</span><span class="p">()</span>
<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">PhantomJS</span><span class="p">()</span>
<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Safari</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="è®¿é—®é¡µé¢-1">è®¿é—®é¡µé¢</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://taobao.com/'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">page_source</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="æŸ¥æ‰¾ç»“ç‚¹-1">æŸ¥æ‰¾ç»“ç‚¹</h3>

<ul>
  <li>
    <p>å•ä¸ªèŠ‚ç‚¹</p>

    <p>æƒ³è¦ä»æ·˜å®é¦–é¡µä¸­æå–æœç´¢æ¡†è¿™ä¸ªèŠ‚ç‚¹ï¼Œé¦–å…ˆè§‚å¯Ÿä»–çš„æºä»£ç </p>

    <p>ä»£ç å®ç°</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
    
  <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://taobao.com/'</span><span class="p">)</span>
  <span class="n">input_first</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'q'</span><span class="p">)</span>
  <span class="n">input_second</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">'#q'</span><span class="p">)</span>
  <span class="n">input_third</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_xpath</span><span class="p">(</span><span class="s">'//*[@id="q"]'</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">input_first</span><span class="p">,</span> <span class="n">input_second</span><span class="p">,</span> <span class="n">input_third</span><span class="p">)</span>
  <span class="n">browser</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>    </div>
    <p>è¿™é‡Œä½¿ç”¨3ç§æ–¹å¼è·å–è¾“å…¥æ¡†ï¼Œä»–ä»¬è¿”å›çš„ç»“æœéƒ½ä¸€æ ·éƒ½æ˜¯ï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;selenium.webdriver.remote.webelement.WebElement (session="dd3692957c85930ca38ce1665fa2787f", element="262fbd50-eadb-4b7d-9a25-776e2e54020b")&gt;
</code></pre></div>    </div>
    <p>å¦å¤–ï¼Œè·å–å•ä¸ªèŠ‚ç‚¹çš„æ–¹æ³•è¿˜å¯ä»¥ç”¨</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">find_element_by_id</span><span class="p">()</span>
  <span class="n">find_element_by_name</span><span class="p">()</span>
  <span class="n">find_element_by_xpath</span><span class="p">()</span>
  <span class="n">find_element_by_link_text</span><span class="p">()</span>
  <span class="n">find_element_by_partial_link_text</span><span class="p">()</span>
  <span class="n">find_element_by_tag_name</span><span class="p">()</span>
  <span class="n">find_element_by_class_name</span><span class="p">()</span>
  <span class="n">find_element_by_css_selector</span><span class="p">()</span>
    
  <span class="c1"># é€šç”¨æ–¹æ³•
# ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼šæŸ¥æ‰¾æ–¹å¼å’Œå€¼
</span>  <span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="p">.</span><span class="n">xx</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>å¤šä¸ªèŠ‚ç‚¹</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

  <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
  <span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://taobao.com/'</span><span class="p">)</span>
  <span class="n">lis</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s">'.service-bd li'</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span>
  <span class="n">browser</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>    </div>
    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="p">[</span><span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"5f8d80a7-847a-4213-a46b-1ece5e469075"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"d2bd82d2-ce90-489d-a827-eb9f13c81a05"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"3a27519d-ea9a-4d00-981d-a02bed240586"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"2ad04b30-84a0-43a9-bd48-455194a9ab6c"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"9ab80873-f1e9-4095-9b7b-5cfd63a4bc1c"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"4e8135ce-d1f7-4f16-a211-58307a96703b"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"4c7f9990-88a2-4731-b1cb-2b0e3b423447"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"c6bd9291-e744-4b95-85c0-ff2e9e37d026"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"0651f495-b40c-4236-9553-3ec9fc3cb2ff"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"87e5aaf1-7ace-45aa-ab33-fa283dde15f9"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"4aa4088e-8afc-43c9-8d96-0c367b0f4e32"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"7eb9b09d-cf45-4554-8c86-4c44fff8b089"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"10634f40-9a59-419c-b09f-6eb0817dd213"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"0efb2ecd-f2b1-478c-93da-c22f8cebef9a"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"525855b9-786b-4dd8-86c0-1dc8811d89f0"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">selenium</span><span class="p">.</span><span class="n">webdriver</span><span class="p">.</span><span class="n">remote</span><span class="p">.</span><span class="n">webelement</span><span class="p">.</span><span class="n">WebElement</span> <span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="s">"e933a9f34ca134090e701423f47f241c"</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="s">"b6dfe37c-730a-4ee1-a436-04b51d26cb1b"</span><span class="p">)</span><span class="o">&gt;</span><span class="p">]</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="èŠ‚ç‚¹äº¤äº’-1">èŠ‚ç‚¹äº¤äº’</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://taobao.com/'</span><span class="p">)</span>
<span class="nb">input</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'q'</span><span class="p">)</span>
<span class="nb">input</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'iPhone'</span><span class="p">)</span>
<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">input</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
<span class="nb">input</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'iPad'</span><span class="p">)</span>
<span class="n">button</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_class_name</span><span class="p">(</span><span class="s">'btn-search'</span><span class="p">)</span>
<span class="n">button</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
</code></pre></div></div>
<p>é€šè¿‡ä¸Šé¢çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å®Œæˆäº†ä¸€äº›å¸¸è§çš„åŠ¨ä½œæ“ä½œï¼Œæ›´å¤šçš„æ“ä½œå¯ä»¥å‚è§å®˜æ–¹æ–‡æ¡£çš„äº¤äº’åŠ¨ä½œä»‹ç»ï¼š http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.remote.webelement</p>

<h3 id="åŠ¨ä½œé“¾-1">åŠ¨ä½œé“¾</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver</span> <span class="kn">import</span> <span class="n">ActionChains</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">'http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable'</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">switch_to</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="s">'iframeResult'</span><span class="p">)</span>
<span class="n">source</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">'#draggable'</span><span class="p">)</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="s">'#droppable'</span><span class="p">)</span>
<span class="n">actions</span> <span class="o">=</span> <span class="n">ActionChains</span><span class="p">(</span><span class="n">browser</span><span class="p">)</span>
<span class="n">actions</span><span class="p">.</span><span class="n">drag_and_drop</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
<span class="n">actions</span><span class="p">.</span><span class="n">perform</span><span class="p">()</span>
</code></pre></div></div>
<p>æ›´å¤šçš„åŠ¨ä½œé“¾æ“ä½œå¯ä»¥å‚è§å®˜æ–¹æ–‡æ¡£ï¼š http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.common.action_chains</p>

<h3 id="æ‰§è¡Œ-javascript-1">æ‰§è¡Œ JavaScript</h3>

<p>å¯¹äºé»˜å†™æ“ä½œï¼ŒSelenium API æ²¡æœ‰æä¾›ï¼Œæ¯”å¦‚ï¼Œä¸‹æ‹‰è¿›åº¦æ¡</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.zhihu.com/explore'</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s">'window.scrollTo(0, document.body.scrollHeight)'</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s">'alert("To Bottom")'</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="è·å–èŠ‚ç‚¹ä¿¡æ¯-1">è·å–èŠ‚ç‚¹ä¿¡æ¯</h3>

<ul>
  <li>
    <p>è·å–å±æ€§</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

  <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
  <span class="n">url</span> <span class="o">=</span> <span class="s">'http://www.zhihu.com/explore'</span>
  <span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="n">logo</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'zh-top-link-logo'</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">logo</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">logo</span><span class="p">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">'class'</span><span class="p">))</span>
</code></pre></div>    </div>

    <p>è¿è¡Œä¹‹åï¼Œç¨‹åºä¾¿ä¼šé©±åŠ¨æµè§ˆå™¨æ‰“å¼€çŸ¥ä¹é¡µé¢ï¼Œç„¶åè·å–çŸ¥ä¹çš„logoèŠ‚ç‚¹ï¼Œæœ€åæ‰“å°å‡ºå®ƒçš„class</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;selenium.webdriver.remote.webelement.WebElement (session="e08c0f28d7f44d75ccd50df6bb676104", element="0.7236390660048155-1")&gt;
  zu-top-link-logo
</code></pre></div>    </div>
  </li>
  <li>
    <p>è·å–æ–‡æœ¬å€¼</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

  <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
  <span class="n">url</span> <span class="o">=</span> <span class="s">'http://www.zhihu.com/explore'</span>
  <span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="nb">input</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_class_name</span><span class="p">(</span><span class="s">'zu-top-add-question'</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>    </div>
    <p>è¿è¡Œç»“æœï¼š</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  æé—®
</code></pre></div>    </div>
  </li>
  <li>
    <p>è·å–idã€ä½ç½®ã€æ ‡ç­¾åå’Œå¤§å°</p>

    <p>WebElementèŠ‚ç‚¹è¿˜æœ‰ä¸€äº›å…¶ä»–å±æ€§ï¼Œæ¯”å¦‚idå±æ€§å¯ä»¥è·å–èŠ‚ç‚¹idï¼Œlocationå±æ€§å¯ä»¥è·å–è¯¥èŠ‚ç‚¹åœ¨é¡µé¢ä¸­çš„ç›¸å¯¹ä½ç½®ï¼Œtag_nameå±æ€§å¯ä»¥è·å–æ ‡ç­¾åç§°ï¼Œsizeå±æ€§å¯ä»¥è·å–èŠ‚ç‚¹çš„å¤§å°ï¼Œä¹Ÿå°±æ˜¯å®½é«˜ï¼Œè¿™äº›å±æ€§æœ‰æ—¶å€™è¿˜æ˜¯å¾ˆæœ‰ç”¨çš„</p>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

  <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
  <span class="n">url</span> <span class="o">=</span> <span class="s">'http://www.zhihu.com/explore'</span>
  <span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="nb">input</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_class_name</span><span class="p">(</span><span class="s">'zu-top-add-question'</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="nb">id</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">location</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">tag_name</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">size</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="åˆ‡æ¢-frame-1">åˆ‡æ¢ Frame</h3>

<p>ç½‘é¡µä¸­æœ‰ä¸€ç§èŠ‚ç‚¹å«ä½œiframeï¼Œä¹Ÿå°±æ˜¯å­Frameï¼Œç›¸å½“äºé¡µé¢çš„å­é¡µé¢ï¼Œå®ƒçš„ç»“æ„å’Œå¤–éƒ¨ç½‘é¡µçš„ç»“æ„å®Œå…¨ä¸€è‡´ã€‚eleniumæ‰“å¼€é¡µé¢åï¼Œå®ƒé»˜è®¤æ˜¯åœ¨çˆ¶çº§Frameé‡Œé¢æ“ä½œï¼Œè€Œæ­¤æ—¶å¦‚æœé¡µé¢ä¸­è¿˜æœ‰å­Frameï¼Œå®ƒæ˜¯ä¸èƒ½è·å–åˆ°å­Frameé‡Œé¢çš„èŠ‚ç‚¹çš„ã€‚è¿™æ—¶å°±éœ€è¦ä½¿ç”¨switch_to.frame()æ–¹æ³•æ¥åˆ‡æ¢Frameã€‚</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">NoSuchElementException</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">'http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable'</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">switch_to</span><span class="p">.</span><span class="n">frame</span><span class="p">(</span><span class="s">'iframeResult'</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">logo</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_class_name</span><span class="p">(</span><span class="s">'logo'</span><span class="p">)</span>
<span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'No LOGO!'</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">switch_to</span><span class="p">.</span><span class="n">parent_frame</span><span class="p">()</span>
<span class="n">logo</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_class_name</span><span class="p">(</span><span class="s">'logo'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">logo</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">logo</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>No LOGO!
&lt;selenium.webdriver.remote.webelement.WebElement (session="a79db882fea6cf339ffff2980d14f4ed", element="8cf2debf-78f1-49d5-a689-4a31ae7306de")&gt;
RUNOOB.COM
</code></pre></div></div>
<p>è¿™é‡Œé¦–å…ˆé€šè¿‡switch_to.frame()æ–¹æ³•åˆ‡æ¢åˆ°å­Frameé‡Œé¢ï¼Œç„¶åå°è¯•è·å–çˆ¶çº§Frameé‡Œçš„logoèŠ‚ç‚¹ï¼ˆè¿™æ˜¯ä¸èƒ½æ‰¾åˆ°çš„ï¼‰ï¼Œå¦‚æœæ‰¾ä¸åˆ°çš„è¯ï¼Œå°±ä¼šæŠ›å‡ºNoSuchElementExceptionå¼‚å¸¸ï¼Œå¼‚å¸¸è¢«æ•æ‰ä¹‹åï¼Œå°±ä¼šè¾“å‡ºNO LOGOã€‚æ¥ä¸‹æ¥ï¼Œé‡æ–°åˆ‡æ¢å›çˆ¶çº§Frameï¼Œç„¶åå†æ¬¡é‡æ–°è·å–èŠ‚ç‚¹ï¼Œå‘ç°æ­¤æ—¶å¯ä»¥æˆåŠŸè·å–äº†ã€‚</p>

<p>æ‰€ä»¥ï¼Œå½“é¡µé¢ä¸­åŒ…å«å­Frameæ—¶ï¼Œå¦‚æœæƒ³è·å–å­Frameä¸­çš„èŠ‚ç‚¹ï¼Œéœ€è¦å…ˆè°ƒç”¨switch_to.frame()æ–¹æ³•åˆ‡æ¢åˆ°å¯¹åº”çš„Frameï¼Œç„¶åå†è¿›è¡Œæ“ä½œã€‚</p>

<h3 id="å»¶æ—¶ç­‰å¾…-1">å»¶æ—¶ç­‰å¾…</h3>

<p>åœ¨Seleniumä¸­ï¼Œget()æ–¹æ³•ä¼šåœ¨ç½‘é¡µæ¡†æ¶åŠ è½½ç»“æŸåç»“æŸæ‰§è¡Œï¼Œæ­¤æ—¶å¦‚æœè·å–page_sourceï¼Œå¯èƒ½å¹¶ä¸æ˜¯æµè§ˆå™¨å®Œå…¨åŠ è½½å®Œæˆçš„é¡µé¢ï¼Œå¦‚æœæŸäº›é¡µé¢æœ‰é¢å¤–çš„Ajaxè¯·æ±‚ï¼Œæˆ‘ä»¬åœ¨ç½‘é¡µæºä»£ç ä¸­ä¹Ÿä¸ä¸€å®šèƒ½æˆåŠŸè·å–åˆ°ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œéœ€è¦å»¶æ—¶ç­‰å¾…ä¸€å®šæ—¶é—´ï¼Œç¡®ä¿èŠ‚ç‚¹å·²ç»åŠ è½½å‡ºæ¥ã€‚</p>

<ul>
  <li>
    <p>éšå¼ç­‰å¾…</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

  <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
  <span class="n">browser</span><span class="p">.</span><span class="n">implicitly_wait</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
  <span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.zhihu.com/explore'</span><span class="p">)</span>
  <span class="nb">input</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_class_name</span><span class="p">(</span><span class="s">'zu-top-ass-question'</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>æ˜¾ç¤ºç­‰å¾…</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
  <span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
  <span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
  <span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>

  <span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
  <span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.taobao.com/'</span><span class="p">)</span>
  <span class="n">wait</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
  <span class="nb">input</span> <span class="o">=</span> <span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">'q'</span><span class="p">)))</span>
  <span class="n">button</span> <span class="o">=</span> <span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s">'.btn-search'</span><span class="p">)))</span>
  <span class="k">print</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">button</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ul>

<table>
  <thead>
    <tr>
      <th>ç­‰å¾…æ¡ä»¶</th>
      <th>å«ä¹‰</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>title_is</td>
      <td>æ ‡é¢˜æ˜¯æŸå†…å®¹</td>
    </tr>
    <tr>
      <td>title_contains</td>
      <td>æ ‡é¢˜åŒ…å«æŸå†…å®¹</td>
    </tr>
    <tr>
      <td>presence_of_element_located</td>
      <td>èŠ‚ç‚¹åŠ è½½å‡ºæ¥ï¼Œä¼ å…¥å®šä½å…ƒç»„</td>
    </tr>
    <tr>
      <td>visibilty_of_element_located</td>
      <td>èŠ‚ç‚¹å¯è§ï¼Œä¼ å…¥å®šä½å…ƒç»„</td>
    </tr>
    <tr>
      <td>visibilty_of</td>
      <td>å¯è§ï¼Œä¼ å…¥èŠ‚ç‚¹å¯¹è±¡</td>
    </tr>
    <tr>
      <td>presence_of_all_elements_loacted</td>
      <td>æ‰€æœ‰èŠ‚ç‚¹åŠ è½½å‡ºæ¥</td>
    </tr>
    <tr>
      <td>text_to_be_present_in_element</td>
      <td>æŸä¸ªèŠ‚ç‚¹æ–‡æœ¬åŒ…å«æŸæ–‡å­—</td>
    </tr>
    <tr>
      <td>text_to_be_present_in_element_value</td>
      <td>æŸä¸ªèŠ‚ç‚¹å€¼åŒ…å«æŸæ–‡å­—</td>
    </tr>
    <tr>
      <td>frame_to_be_available_and_switch_to_it</td>
      <td>åŠ è½½å¹¶åˆ‡æ¢</td>
    </tr>
    <tr>
      <td>invisibility_of_element_located</td>
      <td>èŠ‚ç‚¹ä¸å¯è§</td>
    </tr>
    <tr>
      <td>element_to_be_clickable</td>
      <td>èŠ‚ç‚¹å¯ç‚¹å‡»</td>
    </tr>
    <tr>
      <td>staleness_of</td>
      <td>åˆ¤æ–­ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ä»åœ¨ DOMï¼Œå¯åˆ¤æ–­é¡µé¢æ˜¯å¦å·²ç»åˆ·æ–°</td>
    </tr>
    <tr>
      <td>element_to_be_selected</td>
      <td>èŠ‚ç‚¹å¯é€‰æ‹©ï¼Œä¼ èŠ‚ç‚¹å¯¹è±¡</td>
    </tr>
    <tr>
      <td>element_located_to_be_selected</td>
      <td>èŠ‚ç‚¹å¯é€‰æ‹©ï¼Œä¼ å…¥å®šä½å…ƒç»„</td>
    </tr>
    <tr>
      <td>element_selection_state_to_be</td>
      <td>ä¼ å…¥èŠ‚ç‚¹å¯¹è±¡ä»¥åŠçŠ¶æ€ï¼Œç›¸ç­‰è¿”å› Trueï¼Œå¦åˆ™è¿”å› False</td>
    </tr>
    <tr>
      <td>element_located_selection_state_to_be</td>
      <td>ä¼ å…¥å®šä½å…ƒç»„ä»¥åŠçŠ¶æ€ï¼Œç›¸ç­‰è¿”å› Trueï¼Œå¦åˆ™è¿”å› False</td>
    </tr>
    <tr>
      <td>alert_is_present</td>
      <td>æ˜¯å¦å‡ºç°è­¦å‘Š</td>
    </tr>
  </tbody>
</table>

<h3 id="å‰è¿›å’Œåé€€-1">å‰è¿›å’Œåé€€</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.baidu.com/'</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.taobao.com/'</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://python.org/'</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">back</span><span class="p">()</span>
<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">forward</span><span class="p">()</span>
<span class="n">browser</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="cookies-1">Cookies</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.zhihu.com/explore'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">get_cookies</span><span class="p">())</span>
<span class="n">browser</span><span class="p">.</span><span class="n">add_cookie</span><span class="p">({</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'name'</span><span class="p">,</span> <span class="s">'domain'</span><span class="p">:</span> <span class="s">'www.zhihu.com'</span><span class="p">,</span> <span class="s">'value'</span><span class="p">:</span> <span class="s">'germey'</span><span class="p">})</span>
<span class="k">print</span><span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">get_cookies</span><span class="p">())</span>
<span class="n">browser</span><span class="p">.</span><span class="n">delete_all_cookies</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">get_cookies</span><span class="p">())</span>
</code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[{'domain': '.zhihu.com', 'httpOnly': False, 'name': 'Hm_lpvt_98beee57fd2ef70ccdd5ca52b9740c49', 'path': '/', 'secure': False, 'value': '1574632295'}, {'domain': '.zhihu.com', 'expiry': 1606168295, 'httpOnly': False, 'name': 'Hm_lvt_98beee57fd2ef70ccdd5ca52b9740c49', 'path': '/', 'secure': False, 'value': '1574632295'}, {'domain': 'www.zhihu.com', 'expiry': 1574633193.39274, 'httpOnly': False, 'name': 'tgw_l7_route', 'path': '/', 'secure': False, 'value': '060f637cd101836814f6c53316f73463'}, {'domain': '.zhihu.com', 'expiry': 1669240293.393064, 'httpOnly': False, 'name': 'd_c0', 'path': '/', 'secure': False, 'value': '"AKAvpC3tZxCPTpjxr8sWHBQwuVqsYUAIHxY=|1574632294"'}, {'domain': '.zhihu.com', 'httpOnly': False, 'name': '_xsrf', 'path': '/', 'secure': False, 'value': 'a08e97a6-1b4c-4a42-80a4-f157b12f0e40'}, {'domain': '.zhihu.com', 'expiry': 1637704293.392961, 'httpOnly': False, 'name': '_zap', 'path': '/', 'secure': False, 'value': 'a23bc58f-40a5-41ce-b0c1-06556a1fb95e'}]
[{'domain': '.www.zhihu.com', 'httpOnly': False, 'name': 'name', 'path': '/', 'secure': True, 'value': 'germey'}, {'domain': '.zhihu.com', 'httpOnly': False, 'name': 'Hm_lpvt_98beee57fd2ef70ccdd5ca52b9740c49', 'path': '/', 'secure': False, 'value': '1574632295'}, {'domain': '.zhihu.com', 'expiry': 1606168295, 'httpOnly': False, 'name': 'Hm_lvt_98beee57fd2ef70ccdd5ca52b9740c49', 'path': '/', 'secure': False, 'value': '1574632295'}, {'domain': 'www.zhihu.com', 'expiry': 1574633193.39274, 'httpOnly': False, 'name': 'tgw_l7_route', 'path': '/', 'secure': False, 'value': '060f637cd101836814f6c53316f73463'}, {'domain': '.zhihu.com', 'expiry': 1669240293.393064, 'httpOnly': False, 'name': 'd_c0', 'path': '/', 'secure': False, 'value': '"AKAvpC3tZxCPTpjxr8sWHBQwuVqsYUAIHxY=|1574632294"'}, {'domain': '.zhihu.com', 'httpOnly': False, 'name': '_xsrf', 'path': '/', 'secure': False, 'value': 'a08e97a6-1b4c-4a42-80a4-f157b12f0e40'}, {'domain': '.zhihu.com', 'expiry': 1637704293.392961, 'httpOnly': False, 'name': '_zap', 'path': '/', 'secure': False, 'value': 'a23bc58f-40a5-41ce-b0c1-06556a1fb95e'}]
[]
</code></pre></div></div>

<h3 id="é€‰é¡¹å¡ç®¡ç†-1">é€‰é¡¹å¡ç®¡ç†</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.baidu.com/'</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s">'window.open()'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">window_handles</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">switch_to</span><span class="p">.</span><span class="n">window</span><span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">window_handles</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.taobao.com/'</span><span class="p">)</span>
<span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">switch_to</span><span class="p">.</span><span class="n">window</span><span class="p">(</span><span class="n">browser</span><span class="p">.</span><span class="n">window_handles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://python.org'</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="å¼‚å¸¸å¤„ç†-1">å¼‚å¸¸å¤„ç†</h3>

<p>èŠ‚ç‚¹æœªæ‰¾åˆ°å¼‚å¸¸</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.baidu.com/'</span><span class="p">)</span>
<span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'hello'</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>selenium.common.exceptions.NoSuchElementException: Message: no such element: Unable to locate element: {"method":"css selector","selector":"[id="hello"]"}
  (Session info: chrome=78.0.3904.108)
</code></pre></div></div>
<p>æ•è·å¼‚å¸¸</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span><span class="p">,</span><span class="n">NoSuchElementException</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.baidu.com/'</span><span class="p">)</span>
<span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Time OUT!'</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">browser</span><span class="p">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'hello'</span><span class="p">)</span>
<span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'No Element'</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">browser</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="ä½¿ç”¨-selenium-çˆ¬å–æ·˜å®å•†å“-1">ä½¿ç”¨ Selenium çˆ¬å–æ·˜å®å•†å“</h2>
<h3 id="æ¥å£åˆ†æ-1">æ¥å£åˆ†æ</h3>

<p>æ‰“å¼€æ·˜å®é¦–é¡µï¼Œæœç´¢ä½ è¦æœç´¢çš„å•†å“åç§°ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œæœç´¢ipad,æ³¨æ„è§‚å¯Ÿæ­¤æ—¶çš„urlæœ‰ä»€ä¹ˆå˜åŒ–(é™„ä¸Šé“¾æ¥ https://s.taobao.com/search?q=ipad)ï¼Œä»”ç»†è§‚å¯Ÿä¾¿å¯ä»¥çœ‹åˆ°ä¸åŒï¼Œç„¶åæŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œæ‰¾åˆ°å•†å“åˆ—è¡¨æ‰€åœ¨çš„ä½ç½®ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œå•†å“åˆ—è¡¨è—åœ¨m-itemlist é‡Œé¢çš„itemsé‡Œé¢çš„itemï¼š</p>

<p>ç»§ç»­ä¸‹æ‹‰ï¼ŒæŸ¥è¯¢å•†å“çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚å•†å“çš„å›¾ç‰‡ï¼Œåç§°ï¼Œä»·æ ¼ï¼Œè´­ä¹°äººæ•°ï¼Œåº—é“ºåç§°ç­‰ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>

<p>å¤§æ¦‚å°±æ˜¯ç±»ä¼¼è¿™æ ·çš„ä¿¡æ¯ã€‚è€Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯å°†è¿™äº›ä¿¡æ¯æŠ“å–ä¸‹æ¥ï¼Œå†å¾€ä¸‹æ‹‰å°±å¯ä»¥å‘ç°ï¼Œåœ¨é¡µé¢ä¸‹æ–¹ï¼Œæœ‰ä¸€ä¸ªåˆ†é¡µå¯¼èˆªï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªå¯ä»¥è¾“å…¥ä»»æ„é¡µç è·³è½¬çš„é“¾æ¥</p>

<p>è¿™é‡Œå•†å“çš„æœç´¢ç»“æœä¸€èˆ¬éƒ½å¤§äº100é¡µï¼Œè¦è·å–æ¯ä¸€é¡µçš„å†…å®¹ï¼Œåªéœ€è¦å°†é¡µç ä»1åˆ°100éå†å³å¯ã€‚æ‰€ä»¥ï¼Œç›´æ¥åœ¨é¡µé¢è·³è½¬é“¾æ¥ä¸­è¾“å…¥è¦è·³è½¬çš„é“¾æ¥å³å¯è·³è½¬åˆ°é¡µç ç›¸åº”çš„é¡µé¢ã€‚</p>

<h3 id="è·å–å•†å“åˆ—è¡¨-1">è·å–å•†å“åˆ—è¡¨</h3>

<p>é¦–å…ˆï¼Œéœ€è¦æ„é€ ä¸€ä¸ªæŠ“å–çš„URLï¼šhttps://s.taobao.com/search?q=iPadã€‚è¿™ä¸ªURLéå¸¸ç®€æ´ï¼Œå‚æ•°qå°±æ˜¯è¦æœç´¢çš„å…³é”®å­—ã€‚åªè¦æ”¹å˜è¿™ä¸ªå‚æ•°ï¼Œå³å¯è·å–ä¸åŒå•†å“çš„åˆ—è¡¨ã€‚è¿™é‡Œæˆ‘ä»¬å°†å•†å“çš„å…³é”®å­—å®šä¹‰æˆä¸€ä¸ªå˜é‡ï¼Œç„¶åæ„é€ å‡ºè¿™æ ·çš„ä¸€ä¸ªURLã€‚</p>

<p>ç„¶åï¼Œå°±éœ€è¦ç”¨Seleniumè¿›è¡ŒæŠ“å–äº†ã€‚æˆ‘ä»¬å®ç°å¦‚ä¸‹æŠ“å–åˆ—è¡¨é¡µçš„æ–¹æ³•ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.wait</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">quote</span>

<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
<span class="n">wait</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">KEYWORD</span> <span class="o">=</span> <span class="s">'iPad'</span>

<span class="k">def</span> <span class="nf">index_page</span><span class="p">(</span><span class="n">page</span><span class="p">):</span>
    <span class="s">"""
    æŠ“å–ç´¢å¼•é¡µ
    :param page: é¡µç 
    """</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'æ­£åœ¨çˆ¬å–ç¬¬'</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="s">'é¡µ'</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">'https://s.taobao.com/search?q='</span> <span class="o">+</span> <span class="n">quote</span><span class="p">(</span><span class="n">KEYWORD</span><span class="p">)</span>
        <span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">page</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">input</span> <span class="o">=</span> <span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span>
                <span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s">'#mainsrp-pager div.form &gt; input'</span><span class="p">)))</span>
            <span class="n">submit</span> <span class="o">=</span> <span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span>
                <span class="n">EC</span><span class="p">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s">'#mainsrp-pager div.form &gt; span.btn.J_Submit'</span><span class="p">)))</span>
            <span class="nb">input</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="nb">input</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
            <span class="n">submit</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="p">.</span><span class="n">text_to_be_present_in_element</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s">'#mainsrp-pager li.item.active &gt; span'</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">page</span><span class="p">)))</span>
        <span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="s">'.m-itemlist .items .item'</span><span class="p">)))</span>
        <span class="n">get_products</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
        <span class="n">index_page</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
</code></pre></div></div>
<p>è¿™é‡Œé¦–å…ˆæ„é€ äº†ä¸€ä¸ªWebDriverå¯¹è±¡ï¼Œä½¿ç”¨çš„æµè§ˆå™¨æ˜¯Chromeï¼Œç„¶åæŒ‡å®šä¸€ä¸ªå…³é”®è¯ï¼Œå¦‚iPadï¼Œæ¥ç€å®šä¹‰äº†index_page()æ–¹æ³•ï¼Œç”¨äºæŠ“å–å•†å“åˆ—è¡¨é¡µã€‚</p>

<p>åœ¨è¯¥æ–¹æ³•é‡Œï¼Œæˆ‘ä»¬é¦–å…ˆè®¿é—®äº†æœç´¢å•†å“çš„é“¾æ¥ï¼Œç„¶ååˆ¤æ–­äº†å½“å‰çš„é¡µç ï¼Œå¦‚æœå¤§äº1ï¼Œå°±è¿›è¡Œè·³é¡µæ“ä½œï¼Œå¦åˆ™ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆã€‚</p>

<p>ç­‰å¾…åŠ è½½æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†WebDriverWaitå¯¹è±¡ï¼Œå®ƒå¯ä»¥æŒ‡å®šç­‰å¾…æ¡ä»¶ï¼ŒåŒæ—¶æŒ‡å®šä¸€ä¸ªæœ€é•¿ç­‰å¾…æ—¶é—´ï¼Œè¿™é‡ŒæŒ‡å®šä¸ºæœ€é•¿10ç§’ã€‚å¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…æˆåŠŸåŒ¹é…äº†ç­‰å¾…æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´é¡µé¢å…ƒç´ æˆåŠŸåŠ è½½å‡ºæ¥äº†ï¼Œå°±ç«‹å³è¿”å›ç›¸åº”ç»“æœå¹¶ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œå¦åˆ™åˆ°äº†æœ€å¤§ç­‰å¾…æ—¶é—´è¿˜æ²¡æœ‰åŠ è½½å‡ºæ¥æ—¶ï¼Œå°±ç›´æ¥æŠ›å‡ºè¶…æ—¶å¼‚å¸¸ã€‚</p>

<p>æ¯”å¦‚ï¼Œæˆ‘ä»¬æœ€ç»ˆè¦ç­‰å¾…å•†å“ä¿¡æ¯åŠ è½½å‡ºæ¥ï¼Œå°±æŒ‡å®šäº†presence_of_element_locatedè¿™ä¸ªæ¡ä»¶ï¼Œç„¶åä¼ å…¥äº†.m-itemlist .items .itemè¿™ä¸ªé€‰æ‹©å™¨ï¼Œè€Œè¿™ä¸ªé€‰æ‹©å™¨å¯¹åº”çš„é¡µé¢å†…å®¹å°±æ˜¯æ¯ä¸ªå•†å“çš„ä¿¡æ¯å—ï¼Œå¯ä»¥åˆ°ç½‘é¡µé‡Œé¢æŸ¥çœ‹ä¸€ä¸‹ã€‚å¦‚æœåŠ è½½æˆåŠŸï¼Œå°±ä¼šæ‰§è¡Œåç»­çš„get_products()æ–¹æ³•ï¼Œæå–å•†å“ä¿¡æ¯ã€‚</p>

<p>å…³äºç¿»é¡µæ“ä½œï¼Œè¿™é‡Œé¦–å…ˆè·å–é¡µç è¾“å…¥æ¡†ï¼Œèµ‹å€¼ä¸ºinputï¼Œç„¶åè·å–â€œç¡®å®šâ€æŒ‰é’®ï¼Œèµ‹å€¼ä¸ºsubmit</p>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¸…ç©ºäº†è¾“å…¥æ¡†ï¼Œæ­¤æ—¶è°ƒç”¨clear()æ–¹æ³•å³å¯ã€‚éšåï¼Œè°ƒç”¨send_keys()æ–¹æ³•å°†é¡µç å¡«å……åˆ°è¾“å…¥æ¡†ä¸­ï¼Œç„¶åç‚¹å‡»â€œç¡®å®šâ€æŒ‰é’®å³å¯ã€‚</p>

<p>é‚£ä¹ˆï¼Œæ€æ ·çŸ¥é“æœ‰æ²¡æœ‰è·³è½¬åˆ°å¯¹åº”çš„é¡µç å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°ï¼ŒæˆåŠŸè·³è½¬æŸä¸€é¡µåï¼Œé¡µç éƒ½ä¼šé«˜äº®æ˜¾ç¤º</p>

<p>æˆ‘ä»¬åªéœ€è¦åˆ¤æ–­å½“å‰é«˜äº®çš„é¡µç æ•°æ˜¯å½“å‰çš„é¡µç æ•°å³å¯ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨äº†å¦ä¸€ä¸ªç­‰å¾…æ¡ä»¶text_to_be_present_in_elementï¼Œå®ƒä¼šç­‰å¾…æŒ‡å®šçš„æ–‡æœ¬å‡ºç°åœ¨æŸä¸€ä¸ªèŠ‚ç‚¹é‡Œé¢æ—¶å³è¿”å›æˆåŠŸã€‚è¿™é‡Œæˆ‘ä»¬å°†é«˜äº®çš„é¡µç èŠ‚ç‚¹å¯¹åº”çš„CSSé€‰æ‹©å™¨å’Œå½“å‰è¦è·³è½¬çš„é¡µç é€šè¿‡å‚æ•°ä¼ é€’ç»™è¿™ä¸ªç­‰å¾…æ¡ä»¶ï¼Œè¿™æ ·å®ƒå°±ä¼šæ£€æµ‹å½“å‰é«˜äº®çš„é¡µç èŠ‚ç‚¹æ˜¯ä¸æ˜¯æˆ‘ä»¬ä¼ è¿‡æ¥çš„é¡µç æ•°ï¼Œå¦‚æœæ˜¯ï¼Œå°±è¯æ˜é¡µé¢æˆåŠŸè·³è½¬åˆ°äº†è¿™ä¸€é¡µï¼Œé¡µé¢è·³è½¬æˆåŠŸã€‚</p>

<p>è¿™æ ·åˆšæ‰å®ç°çš„index_page()æ–¹æ³•å°±å¯ä»¥ä¼ å…¥å¯¹åº”çš„é¡µç ï¼Œå¾…åŠ è½½å‡ºå¯¹åº”é¡µç çš„å•†å“åˆ—è¡¨åï¼Œå†å»è°ƒç”¨get_products()æ–¹æ³•è¿›è¡Œé¡µé¢è§£æã€‚</p>

<h3 id="è§£æå•†å“åˆ—è¡¨-1">è§£æå•†å“åˆ—è¡¨</h3>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°get_products()æ–¹æ³•æ¥è§£æå•†å“åˆ—è¡¨äº†ã€‚è¿™é‡Œæˆ‘ä»¬ç›´æ¥è·å–é¡µé¢æºä»£ç ï¼Œç„¶åç”¨pyqueryè¿›è¡Œè§£æ</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pyquery</span> <span class="kn">import</span> <span class="n">PyQuery</span> <span class="k">as</span> <span class="n">pq</span>
<span class="k">def</span> <span class="nf">get_products</span><span class="p">():</span>
    <span class="s">"""
    æå–å•†å“æ•°æ®
    """</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">browser</span><span class="p">.</span><span class="n">page_source</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">pq</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">doc</span><span class="p">(</span><span class="s">'#mainsrp-itemlist .items .item'</span><span class="p">).</span><span class="n">items</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
        <span class="n">product</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">'image'</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'.pic .img'</span><span class="p">).</span><span class="n">attr</span><span class="p">(</span><span class="s">'data-src'</span><span class="p">),</span>
            <span class="s">'price'</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'.price'</span><span class="p">).</span><span class="n">text</span><span class="p">(),</span>
            <span class="s">'deal'</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'.deal-cnt'</span><span class="p">).</span><span class="n">text</span><span class="p">(),</span>
            <span class="s">'title'</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'.title'</span><span class="p">).</span><span class="n">text</span><span class="p">(),</span>
            <span class="s">'shop'</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'.shop'</span><span class="p">).</span><span class="n">text</span><span class="p">(),</span>
            <span class="s">'location'</span><span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'.location'</span><span class="p">).</span><span class="n">text</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">print</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
        <span class="n">save_to_mongo</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
</code></pre></div></div>
<p>é¦–å…ˆï¼Œè°ƒç”¨page_sourceå±æ€§è·å–é¡µç çš„æºä»£ç ï¼Œç„¶åæ„é€ äº†PyQueryè§£æå¯¹è±¡ï¼Œæ¥ç€æå–äº†å•†å“åˆ—è¡¨ï¼Œæ­¤æ—¶ä½¿ç”¨çš„CSSé€‰æ‹©å™¨æ˜¯#mainsrp-itemlist .items .itemï¼Œå®ƒä¼šåŒ¹é…æ•´ä¸ªé¡µé¢çš„æ¯ä¸ªå•†å“ã€‚å®ƒçš„åŒ¹é…ç»“æœæ˜¯å¤šä¸ªï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åˆå¯¹å®ƒè¿›è¡Œäº†ä¸€æ¬¡éå†ï¼Œç”¨forå¾ªç¯å°†æ¯ä¸ªç»“æœåˆ†åˆ«è¿›è¡Œè§£æï¼Œæ¯æ¬¡å¾ªç¯æŠŠå®ƒèµ‹å€¼ä¸ºitemå˜é‡ï¼Œæ¯ä¸ªitemå˜é‡éƒ½æ˜¯ä¸€ä¸ªPyQueryå¯¹è±¡ï¼Œç„¶åå†è°ƒç”¨å®ƒçš„find()æ–¹æ³•ï¼Œä¼ å…¥CSSé€‰æ‹©å™¨ï¼Œå°±å¯ä»¥è·å–å•ä¸ªå•†å“çš„ç‰¹å®šå†…å®¹äº†ã€‚</p>

<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ©ç”¨find()æ–¹æ³•æ‰¾åˆ°å›¾ç‰‡çš„è¿™ä¸ªèŠ‚ç‚¹ï¼Œç„¶åå†è°ƒç”¨attr()æ–¹æ³•è·å–å•†å“çš„data-srcå±æ€§ï¼Œè¿™æ ·å°±æˆåŠŸæå–äº†å•†å“å›¾ç‰‡é“¾æ¥ã€‚ç„¶åç”¨åŒæ ·çš„æ–¹æ³•æå–å•†å“çš„ä»·æ ¼ã€æˆäº¤é‡ã€åç§°ã€åº—é“ºå’Œåº—é“ºæ‰€åœ¨åœ°ç­‰ä¿¡æ¯ï¼Œæ¥ç€å°†æ‰€æœ‰æå–ç»“æœèµ‹å€¼ä¸ºä¸€ä¸ªå­—å…¸productï¼Œéšåè°ƒç”¨save_to_mongo()å°†å…¶ä¿å­˜åˆ°MongoDBå³å¯ã€‚</p>

<h3 id="ä¿å­˜åˆ°-mongodb-1">ä¿å­˜åˆ° MongoDB</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">MONGO_URL</span> <span class="o">=</span> <span class="s">'localhost'</span>
<span class="n">MONGO_DB</span> <span class="o">=</span> <span class="s">'taobao'</span>
<span class="n">MONGO_COLLECTION</span> <span class="o">=</span> <span class="s">'products'</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">pymongo</span><span class="p">.</span><span class="n">MongoClient</span><span class="p">(</span><span class="n">MONGO_URL</span><span class="p">)</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="n">MONGO_DB</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">save_to_mongo</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
    <span class="s">"""
    ä¿å­˜è‡³MongoDB
    :param result: ç»“æœ
    """</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">db</span><span class="p">[</span><span class="n">MONGO_COLLECTION</span><span class="p">].</span><span class="n">insert</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'å­˜å‚¨åˆ°MongoDBæˆåŠŸ'</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'å­˜å‚¨åˆ°MongoDBå¤±è´¥'</span><span class="p">)</span>
</code></pre></div></div>

<p>è¿™é‡Œé¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªMongoDBçš„è¿æ¥å¯¹è±¡ï¼Œç„¶åæŒ‡å®šäº†æ•°æ®åº“ï¼ŒéšåæŒ‡å®šäº†Collectionçš„åç§°ï¼Œæ¥ç€ç›´æ¥è°ƒç”¨insert()æ–¹æ³•å°†æ•°æ®æ’å…¥åˆ°MongoDBã€‚æ­¤å¤„çš„resultå˜é‡å°±æ˜¯åœ¨get_products()æ–¹æ³•é‡Œä¼ æ¥çš„productï¼ŒåŒ…å«å•ä¸ªå•†å“çš„ä¿¡æ¯</p>

<h3 id="éå†æ¯é¡µ-1">éå†æ¯é¡µ</h3>

<p>åˆšæ‰æˆ‘ä»¬æ‰€å®šä¹‰çš„get_index()æ–¹æ³•éœ€è¦æ¥æ”¶å‚æ•°pageï¼Œpageä»£è¡¨é¡µç ã€‚è¿™é‡Œæˆ‘ä»¬å®ç°é¡µç éå†å³å¯</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">MAX_PAGE</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="s">"""
    éå†æ¯ä¸€é¡µ
    """</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">MAX_PAGE</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">index_page</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</code></pre></div></div>

<p>å…¶å®ç°éå¸¸ç®€å•ï¼Œåªéœ€è¦è°ƒç”¨ä¸€ä¸ªforå¾ªç¯å³å¯ã€‚è¿™é‡Œå®šä¹‰æœ€å¤§çš„é¡µç æ•°ä¸º100ï¼Œrange()æ–¹æ³•çš„è¿”å›ç»“æœå°±æ˜¯1åˆ°100çš„åˆ—è¡¨ï¼Œé¡ºåºéå†ï¼Œè°ƒç”¨index_page()æ–¹æ³•å³å¯ã€‚</p>

<h3 id="è¿è¡Œ-1">è¿è¡Œ</h3>

<p>è¿è¡Œä»£ç ï¼Œå¯ä»¥å‘ç°é¦–å…ˆä¼šå¼¹å‡ºä¸€ä¸ªChromeæµè§ˆå™¨ï¼Œç„¶åä¼šè®¿é—®æ·˜å®é¡µé¢ï¼Œæ¥ç€æ§åˆ¶å°ä¾¿ä¼šè¾“å‡ºç›¸åº”çš„æå–ç»“æœ</p>

<p>å¯ä»¥å‘ç°ï¼Œè¿™äº›å•†å“ä¿¡æ¯çš„ç»“æœéƒ½æ˜¯å­—å…¸å½¢å¼ï¼Œå®ƒä»¬è¢«å­˜å‚¨åˆ°MongoDBé‡Œé¢ã€‚</p>

<h3 id="chrome-headless-æ¨¡å¼-1">Chrome Headless æ¨¡å¼</h3>

<p>ä»Chrome 59ç‰ˆæœ¬å¼€å§‹ï¼Œå·²ç»å¼€å§‹æ”¯æŒHeadlessæ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯æ— ç•Œé¢æ¨¡å¼ï¼Œè¿™æ ·çˆ¬å–çš„æ—¶å€™å°±ä¸ä¼šå¼¹å‡ºæµè§ˆå™¨äº†ã€‚å¦‚æœè¦ä½¿ç”¨æ­¤æ¨¡å¼ï¼Œè¯·æŠŠChromeå‡çº§åˆ°59ç‰ˆæœ¬åŠä»¥ä¸Šã€‚å¯ç”¨Headlessæ¨¡å¼çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">chrome_options</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">ChromeOptions</span><span class="p">()</span>
<span class="n">chrome_options</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'--headless'</span><span class="p">)</span>
<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">chrome_options</span><span class="o">=</span><span class="n">chrome_options</span><span class="p">)</span>
</code></pre></div></div>
<p>é¦–å…ˆï¼Œåˆ›å»ºChromeOptionså¯¹è±¡ï¼Œæ¥ç€æ·»åŠ headlesså‚æ•°ï¼Œç„¶ååœ¨åˆå§‹åŒ–Chromeå¯¹è±¡çš„æ—¶å€™é€šè¿‡chrome_optionsä¼ é€’è¿™ä¸ªChromeOptionså¯¹è±¡ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æˆåŠŸå¯ç”¨Chromeçš„Headlessæ¨¡å¼äº†ã€‚</p>

<h3 id="å¯¹æ¥-firefox-1">å¯¹æ¥ Firefox</h3>

<p>è¦å¯¹æ¥Firefoxæµè§ˆå™¨ï¼Œéå¸¸ç®€å•ï¼Œåªéœ€è¦æ›´æ”¹ä¸€å¤„å³å¯ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Firefox</span><span class="p">()</span>
</code></pre></div></div>
<p>è¿™é‡Œæ›´æ”¹äº†browserå¯¹è±¡çš„åˆ›å»ºæ–¹å¼ï¼Œè¿™æ ·çˆ¬å–çš„æ—¶å€™å°±ä¼šä½¿ç”¨Firefoxæµè§ˆå™¨äº†ã€‚</p>

<h3 id="å¯¹æ¥-phantomjs-1">å¯¹æ¥ PhantomJS</h3>

<p>å¦‚æœä¸æƒ³ä½¿ç”¨Chromeçš„Headlessæ¨¡å¼ï¼Œè¿˜å¯ä»¥ä½¿ç”¨PhantomJSï¼ˆå®ƒæ˜¯ä¸€ä¸ªæ— ç•Œé¢æµè§ˆå™¨ï¼‰æ¥æŠ“å–ã€‚æŠ“å–æ—¶ï¼ŒåŒæ ·ä¸ä¼šå¼¹å‡ºçª—å£ï¼Œè¿˜æ˜¯åªéœ€è¦å°†WebDriverçš„å£°æ˜ä¿®æ”¹ä¸€ä¸‹å³å¯ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">PhantomJS</span><span class="p">()</span>
</code></pre></div></div>
<p>å¦å¤–ï¼Œå®ƒè¿˜æ”¯æŒå‘½ä»¤è¡Œé…ç½®ã€‚æ¯”å¦‚ï¼Œå¯ä»¥è®¾ç½®ç¼“å­˜å’Œç¦ç”¨å›¾ç‰‡åŠ è½½çš„åŠŸèƒ½ï¼Œè¿›ä¸€æ­¥æé«˜çˆ¬å–æ•ˆç‡ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">SERVICE_ARGS</span> <span class="o">=</span> <span class="p">[</span><span class="s">'--load-images=false'</span><span class="p">,</span> <span class="s">'--disk-cache=true'</span><span class="p">]</span>
<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">PhantomJS</span><span class="p">(</span><span class="n">service_args</span><span class="o">=</span><span class="n">SERVICE_ARGS</span><span class="p">)</span>
</code></pre></div></div>
<blockquote>
  <blockquote>
    <blockquote>
      <blockquote>
        <blockquote>
          <blockquote>
            <blockquote>
              <p>e5c77ca (æ–°é¡µé¢)</p>
            </blockquote>
          </blockquote>
        </blockquote>
      </blockquote>
    </blockquote>
  </blockquote>
</blockquote>
:ET