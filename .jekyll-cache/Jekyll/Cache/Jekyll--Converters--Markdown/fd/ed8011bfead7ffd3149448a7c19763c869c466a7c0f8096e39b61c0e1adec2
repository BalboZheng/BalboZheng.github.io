I"ÅC<h2 id="æŠ“å–é¦–é¡µ">æŠ“å–é¦–é¡µ</h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>


<span class="k">def</span> <span class="nf">get_one_page</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'User-Agent'</span><span class="p">:</span> <span class="s">'Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_8; en-us) AppleWebKit/534.50 (KHTML, '</span>
                      <span class="s">'like Gecko) Version/5.1 Safari/534.50 '</span>
    <span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">.</span><span class="n">text</span>
    <span class="k">return</span> <span class="bp">None</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s">'https://maoyan.com/board/4'</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">get_one_page</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>
<h2 id="æ­£åˆ™æå–">æ­£åˆ™æå–</h2>
<p>å›åˆ°ç½‘é¡µï¼ŒæŒ‰F12åœ¨å¼€å‘è€…æ¨¡å¼ä¸‹çš„NETWORKç›‘å¬ç»„ä»¶ä¸­æŸ¥çœ‹åˆ°æºä»£ç </p>

<p>åœ¨æºä»£ç ä¸­å¯ä»¥çœ‹åˆ°ç”µå½±çš„ç›¸å…³ä¿¡æ¯ï¼Œè¿™é‡Œç”¨çº¢è‰²ç®­å¤´ä»ä¸Šè‡³ä¸‹åˆ†åˆ«æ ‡è®°å‡ºäº†ç”µå½±çš„æ’åã€å›¾ç‰‡ã€ç”µå½±åã€æ¼”å‘˜ã€ä¸Šæ˜ æ—¶é—´ä»¥åŠè¯„åˆ†æ‰€åœ¨çš„ä½ç½®ã€‚æ¥ä¸‹æ¥åªéœ€è¦ä¸ºæ¯ä¸€éƒ¨åˆ†çš„ä¿¡æ¯å†™å‡ºå¯¹åº”çš„æ­£åˆ™è¡¨è¾¾å¼å³å¯è·å–åˆ°ç›¸åº”çš„ä¿¡æ¯ã€‚</p>

<p>å…ˆä»¥ç”µå½±æ’åä¸ºä¾‹ï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸€ä¸ªç”µå½±éƒ¨åˆ†çš„æ‰€æœ‰ä¿¡æ¯éƒ½åŒ…å«åœ¨&lt; dd&gt;..&lt;\/dd&gt;èŠ‚ç‚¹ä¸­ï¼Œè€Œç”µå½±æ’åçš„ä¿¡æ¯æ˜¯åœ¨classä¸ºboard-indexçš„ièŠ‚ç‚¹ä¸­ï¼Œæ‰€ä»¥è¿™é‡Œåˆ©ç”¨éè´ªå©ªçš„åŒ¹é…åŸåˆ™æå–è¯¥èŠ‚ç‚¹å†…çš„ä¿¡æ¯ï¼Œæ­£åˆ™è¡¨è¾¾å¼å¯å†™ä¸ºï¼š</p>

<blockquote>
  <dd>.*?"board-index.*?&gt;(.*?)&lt;/i&gt;
</dd>
</blockquote>

<p>æ¥ä¸‹æ¥è·å–ç”µå½±å›¾ç‰‡ã€‚å¯ä»¥çœ‹åˆ°ç”µå½±å›¾ç‰‡çš„ä¿¡æ¯åœ¨img data-srcçš„aèŠ‚ç‚¹ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼å¯å†™ä¸ºï¼š</p>

<blockquote>
  <dd>.*?data-src="(.*?)".*?&lt;/a&gt;
</dd>
</blockquote>

<p>åŒæ ·ï¼Œç”µå½±åç§°çš„ä¿¡æ¯åœ¨nameä¸ºæ ‡å¿—ä½title=â€â€œçš„aèŠ‚ç‚¹ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼å¯å†™ä¸ºï¼š</p>

<blockquote>
  <dd>.*?class="name".*?title="(.*?)".*?&lt;/a&gt;
</dd>
</blockquote>

<p>æŒ‰ç…§ä»¥ä¸Šæ–¹æ³•ï¼Œæœ€åå¯ä»¥å¾—åˆ°å®Œæ•´çš„æ­£åˆ™è¡¨è¾¾å¼ä¸ºï¼š</p>

<blockquote>
  <dd>.*?board-index.*?&gt;(\d+?)&lt;/i&gt;.*?data-src="(.*?)".*?&lt;/a&gt;.*?class="name".*?title="(.*?)".*?&lt;/a&gt;.*?class="star".+?(.*?)&lt;/p&gt;.*?class="releasetime".+?(.*?)&lt;/p&gt;.*?class="integer".+?(.*?)&lt;/i&gt;.*?"fraction".+?(.*?)&lt;/i&gt;.*?</dd>
</blockquote>

<p>æ¥ä¸‹æ¥åªéœ€è¦æ„å»ºä¸€ä¸ªè§£æé¡µé¢çš„å‡½æ•°parse_one_page()ï¼Œç”¨æ¥å¾—åˆ°æ‰€éœ€è¦çš„ç”µå½±ä¿¡æ¯ï¼Œä»£ç å®ç°å¦‚ä¸‹ï¼š</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">parse_one_page</span><span class="p">(</span><span class="n">html</span><span class="p">):</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s">'&lt;dd&gt;.*?board-index.*?&gt;(\d+?)&lt;/i&gt;'</span>
        <span class="sa">r</span><span class="s">'.*?data-src="(.*?)".*?&lt;/a&gt;'</span>
        <span class="sa">r</span><span class="s">'.*?class="name".*?title="(.*?)".*?&lt;/a&gt;'</span>
        <span class="sa">r</span><span class="s">'.*?class="star".+?(.*?)&lt;/p&gt;'</span>
        <span class="sa">r</span><span class="s">'.*?class="releasetime".+?(.*?)&lt;/p&gt;'</span>
        <span class="sa">r</span><span class="s">'.*?class="integer".+?(.*?)&lt;/i&gt;'</span>
        <span class="sa">r</span><span class="s">'.*?"fraction".+?(.*?)&lt;/i&gt;.*?&lt;/dd&gt;'</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">S</span>
    <span class="p">)</span>
    <span class="n">re_lists</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">re_list</span> <span class="ow">in</span> <span class="n">re_lists</span><span class="p">:</span>
        <span class="k">yield</span> <span class="p">{</span>
            <span class="s">'index'</span><span class="p">:</span> <span class="n">re_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s">'image'</span><span class="p">:</span> <span class="n">re_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s">'title'</span><span class="p">:</span> <span class="n">re_list</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="s">'actor'</span><span class="p">:</span> <span class="n">re_list</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">strip</span><span class="p">()[</span><span class="mi">3</span><span class="p">:],</span>
            <span class="s">'time'</span><span class="p">:</span> <span class="n">re_list</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">strip</span><span class="p">()[</span><span class="mi">5</span><span class="p">:],</span>
            <span class="s">'score'</span><span class="p">:</span> <span class="n">re_list</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">re_list</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
        <span class="p">}</span>
</code></pre></div></div>

<h2 id="å†™å…¥æ–‡ä»¶">å†™å…¥æ–‡ä»¶</h2>
<p>å¯¹äºæŠ“å–åˆ°çš„æ•°æ®ï¼Œè¿™é‡Œæ„å»ºä¸€ä¸ªwrite()å‡½æ•°ï¼Œç›´æ¥å°†æ•°æ®å†™å…¥æ–‡æœ¬æ–‡ä»¶ä¸­ã€‚é€šè¿‡JSONåº“é‡Œçš„dumps()æ–¹æ³•å®ç°å­—å…¸çš„åºåˆ—åŒ–ï¼Œå¹¶æŒ‡å®šensure_asciiå‚æ•°ä¸ºFalseï¼Œè¿™æ ·å¯ä»¥ä¿è¯è¾“å‡ºç»“æœæ˜¯ä¸­æ–‡å½¢å¼è€Œä¸æ˜¯Unicodeç¼–ç ã€‚ä»£ç å®ç°å¦‚ä¸‹ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">write_to_file</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'result.txt'</span><span class="p">,</span> <span class="s">'a'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">content</span><span class="p">)))</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">+</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
</code></pre></div></div>
<h2 id="åˆ†é¡µçˆ¬å–">åˆ†é¡µçˆ¬å–</h2>
<p>å› ä¸ºæˆ‘ä»¬éœ€è¦çˆ¬å–çš„æ˜¯TOP100ï¼Œæ‰€ä»¥è¿˜éœ€è¦éå†ä¸€ä¸‹ï¼Œç»™è¿™ä¸ªè¿æ¥ä¼ å…¥ offset å‚æ•°ï¼Œå®ç°å…¶ä»–90ä¸ç”µå½±çš„çˆ¬å–</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">main</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">i</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">offset</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s">'https://maoyan.com/board/4?offset='</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">get_one_page</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">parse_one_page</span><span class="p">(</span><span class="n">html</span><span class="p">):</span>
        <span class="n">write_to_file</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="æ•´åˆä»£ç ">æ•´åˆä»£ç </h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">import</span> <span class="nn">requests</span>


<span class="k">def</span> <span class="nf">get_one_page</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'User-Agent'</span><span class="p">:</span> <span class="s">'Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_8; en-us) AppleWebKit/534.50 (KHTML, '</span>
                      <span class="s">'like Gecko) Version/5.1 Safari/534.50 '</span>
    <span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">.</span><span class="n">text</span>
    <span class="k">return</span> <span class="bp">None</span>


<span class="k">def</span> <span class="nf">parse_one_page</span><span class="p">(</span><span class="n">html</span><span class="p">):</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s">'&lt;dd&gt;.*?board-index.*?&gt;(\d+?)&lt;/i&gt;'</span>
        <span class="sa">r</span><span class="s">'.*?data-src="(.*?)".*?&lt;/a&gt;'</span>
        <span class="sa">r</span><span class="s">'.*?class="name".*?title="(.*?)".*?&lt;/a&gt;'</span>
        <span class="sa">r</span><span class="s">'.*?class="star".+?(.*?)&lt;/p&gt;'</span>
        <span class="sa">r</span><span class="s">'.*?class="releasetime".+?(.*?)&lt;/p&gt;'</span>
        <span class="sa">r</span><span class="s">'.*?class="integer".+?(.*?)&lt;/i&gt;'</span>
        <span class="sa">r</span><span class="s">'.*?"fraction".+?(.*?)&lt;/i&gt;.*?&lt;/dd&gt;'</span><span class="p">,</span> <span class="n">re</span><span class="p">.</span><span class="n">S</span>
    <span class="p">)</span>
    <span class="n">re_lists</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">re_list</span> <span class="ow">in</span> <span class="n">re_lists</span><span class="p">:</span>
        <span class="k">yield</span> <span class="p">{</span>
            <span class="s">'index'</span><span class="p">:</span> <span class="n">re_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s">'image'</span><span class="p">:</span> <span class="n">re_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s">'title'</span><span class="p">:</span> <span class="n">re_list</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="s">'actor'</span><span class="p">:</span> <span class="n">re_list</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">strip</span><span class="p">()[</span><span class="mi">3</span><span class="p">:],</span>
            <span class="s">'time'</span><span class="p">:</span> <span class="n">re_list</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">strip</span><span class="p">()[</span><span class="mi">5</span><span class="p">:],</span>
            <span class="s">'score'</span><span class="p">:</span> <span class="n">re_list</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">re_list</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
        <span class="p">}</span>


<span class="k">def</span> <span class="nf">write_to_file</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'result.txt'</span><span class="p">,</span> <span class="s">'a'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">content</span><span class="p">)))</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">+</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s">'https://maoyan.com/board/4'</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">get_one_page</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">parse_one_page</span><span class="p">(</span><span class="n">html</span><span class="p">):</span>
        <span class="n">write_to_file</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>
:ET