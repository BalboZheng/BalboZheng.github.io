I"MÆ<p>Â«Â«Â«&lt; HEAD
Â«Â«Â«&lt; HEAD:_posts/2019-11-25-verification-code.md
â€”
layout:     post
title:      â€œéªŒè¯ç çš„è¯†åˆ«â€
subtitle:   â€œéªŒè¯ç åœ¨å¾ˆå¤šåœ°æ–¹éƒ½ä¼šç”¨åˆ°â€
date:       2019-11-25 16:38:20
author:     â€œBalboâ€
header-img: â€œimg/post-bg-2019.jpgâ€
tags:
    - reptile
    - python
â€”</p>
<h2 id="å›¾åƒéªŒè¯ç çš„è¯†åˆ«">å›¾åƒéªŒè¯ç çš„è¯†åˆ«</h2>
<h3 id="è·å–éªŒè¯ç ">è·å–éªŒè¯ç </h3>

<p>ä¿å­˜éªŒè¯ç å›¾ç‰‡ä»¥ä¾¿å®éªŒï¼Œ<a href="http://my.cnki.net/elibregister/CheckCode.aspx">éªŒè¯</a></p>

<h3 id="è¯†åˆ«æµ‹è¯•">è¯†åˆ«æµ‹è¯•</h3>

<p>ä½¿ç”¨ tesserocr åº“è¯†åˆ«éªŒè¯ç (ç”±äº tesseract ä¸ window ä¸å…¼å®¹ï¼Œ æš‚æ—¶ç”¨ pytesseract ä»£æ›¿)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">tesserocr</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="s">'code.jpg'</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">tesserocr</span><span class="p">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="éªŒè¯ç å¤„ç†">éªŒè¯ç å¤„ç†</h3>

<p>éªŒè¯ç å†…çš„å¤šä½™çº¿æ¡å¯èƒ½ä¼šå¹²æ‰°å›¾ç‰‡çš„è¯†åˆ«ï¼Œå¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬è¿˜éœ€è¦åšä¸€äº›é¢å¤–çš„å¤„ç†,ä¾‹å¦‚ï¼š</p>

<p>å›¾ç‰‡è½¬åŒ–ä¸ºç°åº¦å›¾åƒ</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">covert</span><span class="p">(</span><span class="s">'L'</span><span class="p">)</span>
<span class="n">image</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<p>è¿›è¡ŒäºŒå€¼åŒ–å¤„ç†</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">covert</span><span class="p">(</span><span class="s">'1'</span><span class="p">)</span>
<span class="n">image</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<p>æŒ‡å®šäºŒå€¼åŒ–é˜ˆå€¼</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">covert</span><span class="p">(</span><span class="s">'L'</span><span class="p">)</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">table</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
        <span class="n">table</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">table</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
<span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="s">'1'</span><span class="p">)</span>
<span class="n">image</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="æéªŒæ»‘åŠ¨éªŒè¯ç çš„è¯†åˆ«">æéªŒæ»‘åŠ¨éªŒè¯ç çš„è¯†åˆ«</h2>
<h3 id="è¯†åˆ«æ€è·¯">è¯†åˆ«æ€è·¯</h3>

<p>å¯¹äºåº”ç”¨äº†æéªŒéªŒè¯ç çš„ç½‘ç«™ï¼Œå¦‚æœæˆ‘ä»¬ä¸­ä»‹æ¨¡æ‹Ÿè¡¨å•æäº¤ï¼ŒåŠ å¯†å‚æ•°çš„æ„é€ æ˜¯ä¸ªé—®é¢˜ï¼Œéœ€è¦åˆ†æå…¶åŠ å¯†å’Œæ ¡éªŒé€»è¾‘ï¼Œç›¸å¯¹ç¹çã€‚éšæ„æˆ‘ä»¬é‡‡ç”¨ç›´æ¥æ¨¡æ‹Ÿæµè§ˆå™¨åŠ¨ä½œçš„æ–¹å¼æ¥å®ŒæˆéªŒè¯</p>

<p>é¦–å…ˆï¼Œæ‰¾åˆ°ä¸€ä¸ªå¸¦æœ‰æéªŒéªŒè¯ç çš„ç½‘ç«™ï¼š http://account.geetest.com/login</p>

<p>æ¬¡æŒ‰é’®ä¸ºæ™ºèƒ½éªŒè¯æŒ‰é’®ã€‚å¦‚æœåŒä¸€ä¼šè¯ï¼Œä¸€æ®µæ—¶é—´å†…ç¬¬äºŒæ¬¡ç‚¹å‡»ä¼šç›´æ¥é€šè¿‡éªŒè¯ã€‚å¦‚æœæ™ºèƒ½è¯†åˆ«ä¸é€šè¿‡ï¼Œåˆ™ä¼šå¼¹å‡ºæ»‘åŠ¨çª—å£</p>

<p>æ‰€ä»¥ï¼Œè¯†åˆ«éªŒè¯éœ€è¦å®Œæˆä¸‰æ­¥</p>

<ol>
  <li>æ¨¡æ‹Ÿç‚¹å‡»éªŒè¯æŒ‰é’®</li>
  <li>è¯†åˆ«æ»‘åŠ¨ç¼ºå£çš„ä½ç½®</li>
  <li>æ¨¡æ‹Ÿæ‹–åŠ¨æ»‘å—</li>
</ol>

<h3 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">EMAIL</span> <span class="o">=</span> <span class="s">'test@test.com'</span>
<span class="n">PASSWORD</span> <span class="o">=</span> <span class="s">'123456'</span>


<span class="k">class</span> <span class="nc">CrackGeetest</span><span class="p">():</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">url</span> <span class="o">=</span> <span class="s">'http://account.geetest.com/login'</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">wait</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">EMAIL</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">PASSWORD</span>
</code></pre></div></div>

<h3 id="æ¨¡æ‹Ÿç‚¹å‡»">æ¨¡æ‹Ÿç‚¹å‡»</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">get_geetest_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        è·å–åˆå§‹åŒ–éªŒè¯æŒ‰é’®
        :return: æŒ‰é’®å¯¹è±¡
        """</span>
        <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s">'geetest_radar_tip'</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">button</span>
</code></pre></div></div>
<p>è·å–ä¸€ä¸ª WebElement å¯¹è±¡ï¼Œè°ƒç”¨å®ƒçš„ click() æ–¹æ³•å³å¯æ¨¡æ‹Ÿç‚¹å‡»</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="n">button</span> <span class="o">=</span> <span class="n">get_geetest_button</span><span class="p">()</span>
        <span class="n">button</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="è¯†åˆ«ç¼ºå£">è¯†åˆ«ç¼ºå£</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">get_screenshot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        è·å–ç½‘é¡µæˆªå›¾
        :return: æˆªå›¾å¯¹è±¡
        """</span>
        <span class="n">screenshot</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">.</span><span class="n">get_screenshot_as_png</span><span class="p">()</span>
        <span class="n">screenshot</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">screenshot</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">screenshot</span>
    
    <span class="k">def</span> <span class="nf">get_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        è·å–éªŒè¯ç ä½ç½®
        :return: éªŒè¯ç ä½ç½®å…ƒç»„
        """</span>
        <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s">'geetest_cavas_img'</span><span class="p">)))</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">location</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">location</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">size</span>
        <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">location</span><span class="p">[</span><span class="s">'y'</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span> <span class="o">+</span> <span class="n">size</span><span class="p">[</span><span class="s">'height'</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="s">'x'</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="s">'x'</span><span class="p">]</span> <span class="o">+</span> <span class="n">size</span><span class="p">[</span><span class="s">'width'</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_geetest_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'captcha.png'</span><span class="p">):</span>
        <span class="s">"""
        è·å–éªŒè¯ç å›¾ç‰‡
        :param name: 
        :return: å›¾ç‰‡å¯¹è±¡
        """</span>
        <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_position</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'éªŒè¯ç ä½ç½®'</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
        <span class="n">screenshot</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_screenshot</span><span class="p">()</span>
        <span class="n">captcha</span> <span class="o">=</span> <span class="n">screenshot</span><span class="p">.</span><span class="n">crop</span><span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">bottom</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">captcha</span>
</code></pre></div></div>
<p>æ¥ä¸‹æ¥ï¼Œè·å–ç¬¬äºŒå¼ å›¾ç‰‡ï¼Œä¹Ÿå°±æ˜¯å¸¦ç¼ºå£çš„å›¾ç‰‡ï¼Œè¦ä½¿å›¾ç‰‡å‡ºç°ç¼ºå£ï¼Œåªéœ€è¦ç‚¹å‡»ä¸‹æ–¹çš„æ»‘åŠ¨å—å³å¯</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">get_slider</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        è·å–æ»‘å—
        :return:æ»‘å—å¯¹è±¡ 
        """</span>
        <span class="n">silder</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s">'geetest_slider_button'</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">silder</span>
</code></pre></div></div>
<p>è°ƒç”¨ click() æ–¹æ³•å³å¯è§¦å‘ç‚¹å‡»</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="n">slider</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_slider</span><span class="p">()</span>
        <span class="n">slider</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
</code></pre></div></div>
<p>æ¥ä¸‹æ¥å¯¹æ¯”å›¾ç‰‡è·å–ç¼ºå£ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œéå†æ¯ä¸ªåæ ‡ç‚¹ï¼Œè·å–ä¸¤å¼ å›¾ç‰‡å¯¹åº”åƒç´ ç‚¹çš„ RGB æ•°æ®ã€‚å¦‚æœ RGB æ•°æ®å·®è·åœ¨ä¸€å®šèŒƒå›´å†…ï¼Œä»£è¡¨ä¸¤ä¸ªåƒç´ ç›¸åŒï¼Œç»§ç»­å¯¹æ¯”ä¸‹ä¸€ä¸ªåƒç´ ï¼Œå¦‚æœå·®è·è¶…è¿‡ä¸€å®šèŒƒå›´ï¼Œåˆ™ä»£è¡¨åƒç´ ç‚¹ä¸åŒï¼Œå³ç¼ºå£ã€‚</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">is_pixel_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image1</span><span class="p">,</span> <span class="n">image2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="s">"""
        åˆ¤æ–­ä¸¤ä¸ªåƒç´ æ˜¯å¦ç›¸åŒ
        :param image1: å›¾ç‰‡1
        :param image2: å›¾ç‰‡2
        :param x: ä½ç½®x
        :param y: ä½ç½®y
        :return: åƒç´ æ˜¯å¦ç›¸åŒ
        """</span>
        <span class="n">pixel1</span> <span class="o">=</span> <span class="n">image1</span><span class="p">.</span><span class="n">load</span><span class="p">()[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>
        <span class="n">pixel2</span> <span class="o">=</span> <span class="n">image2</span><span class="p">.</span><span class="n">load</span><span class="p">()[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="mi">60</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pixel1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pixel2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pixel1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pixel2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">threshold</span> <span class="ow">and</span> \
                <span class="nb">abs</span><span class="p">(</span><span class="n">pixel1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">pixel2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        
    <span class="k">def</span> <span class="nf">get_gap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image1</span><span class="p">,</span> <span class="n">image2</span><span class="p">):</span>
        <span class="s">"""
        è¿˜ç¼ºç¼ºå£åç§»é‡
        :param image1:ä¸å¸¦ç¼ºå£å›¾ç‰‡ 
        :param image2: å¸¦ç¼ºå£å›¾ç‰‡
        :return: 
        """</span>
        <span class="n">left</span> <span class="o">=</span> <span class="mi">60</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">image1</span><span class="p">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image1</span><span class="p">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">is_pixel_equal</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span> <span class="n">image2</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
                    <span class="n">left</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="k">return</span> <span class="n">left</span>
        <span class="k">return</span> <span class="n">left</span>
</code></pre></div></div>

<h3 id="æ¨¡æ‹Ÿæ‹–åŠ¨">æ¨¡æ‹Ÿæ‹–åŠ¨</h3>

<p>æ¨¡æ‹Ÿæ‹–åŠ¨è¿‡ç¨‹å¹¶ä¸å¤æ‚ï¼Œä½†å…¶ä¸­çš„å‘æ¯”è¾ƒå¤šã€‚å¦‚æœæ˜¯åŒ€é€Ÿè¿åŠ¨ï¼ŒæéªŒå¿…ç„¶ä¼šè¯†åˆ«å‡ºæ˜¯ç¨‹åºæ“ä½œï¼Œä»¥ä¸ºäººæ— æ³•åšåˆ°å®Œå…¨åŒ€é€Ÿæ‹–åŠ¨ã€‚æéªŒéªŒè¯ç åˆ©ç”¨æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œç­›é€‰æ­¤ç±»æ•°æ®ä¸ºæœºå™¨æ“ä½œï¼ŒéªŒè¯ç å¿…å¤±è´¥ã€‚</p>

<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬é‡‡ç”¨å‰æ®µåšåŒ€åŠ é€Ÿè¿åŠ¨ï¼Œåæ®µåšåŒ€å‡é€Ÿè¿åŠ¨ï¼Œæ¥æ¨¡æ‹Ÿäººæ‹–åŠ¨æ—¶çš„åŠ¨ä½œï¼Œåˆ©ç”¨ç‰©ç†å­¦çš„åŠ é€Ÿåº¦å…¬å¼å®ŒæˆéªŒè¯ã€‚</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># å½“å‰é€Ÿåº¦ vï¼Œåˆé€Ÿåº¦ v0ï¼Œ ä½ç§» xï¼Œ æ‰€éœ€æ—¶é—´ t
</span><span class="n">x</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">t</span>
</code></pre></div></div>
<p>æ„é€ è½¨è¿¹ç§»åŠ¨ç®—æ³•ï¼Œè®¡ç®—å‡ºå…ˆåŠ é€Ÿåå‡é€Ÿçš„è¿åŠ¨è½¨è¿¹</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">get_track</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span><span class="p">):</span>
        <span class="s">"""
        æ ¹æ®åç§»é‡è·å–è¿åŠ¨è½¨è¿¹
        :param distance: åç§»é‡
        :return: è¿åŠ¨è½¨è¿¹
        """</span>
        <span class="c1"># è¿åŠ¨è½¨è¿¹
</span>        <span class="n">track</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># å½“å‰ä½ç§»
</span>        <span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># å‡é€Ÿé˜ˆå€¼
</span>        <span class="n">mid</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">5</span>
        <span class="c1"># è®¡ç®—é—´éš”
</span>        <span class="n">t</span> <span class="o">=</span> <span class="mf">0.2</span>
        <span class="c1"># åˆé€Ÿåº¦
</span>        <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">distance</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">mid</span><span class="p">:</span>
                <span class="c1"># åŠ é€Ÿåº¦ä¸º+2
</span>                <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># åŠ é€Ÿåº¦ä¸º-3
</span>                <span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
            <span class="c1"># åˆé€Ÿåº¦ v0
</span>            <span class="n">v0</span> <span class="o">=</span> <span class="n">v</span>
            <span class="c1"># å½“å‰é€Ÿåº¦ v = v0 + at
</span>            <span class="n">v</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">t</span>
            <span class="c1"># ç§»åŠ¨è·ç¦» x = v0t + 1/2 * a * t * t
</span>            <span class="n">move</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span>
            <span class="c1"># å½“å‰ä½ç§»
</span>            <span class="n">current</span> <span class="o">+=</span> <span class="n">move</span>
            <span class="c1"># åŠ å…¥è½¨è¿¹
</span>            <span class="n">track</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">move</span><span class="p">))</span>
            
        <span class="k">return</span> <span class="n">track</span>
</code></pre></div></div>
<p>æŒ‰ç…§è¿åŠ¨è½¨è¿¹æ‹–åŠ¨æ»‘å—</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">move_to_gap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slider</span><span class="p">,</span> <span class="n">tracks</span><span class="p">):</span>
        <span class="s">"""
        æ‹–åŠ¨æ»‘å—åˆ°ç¼ºå£å¤„
        :param slider: æ»‘å—
        :param tracks: ç¼ºå£
        :return: 
        """</span>
        <span class="n">ActionChains</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">).</span><span class="n">click_and_hold</span><span class="p">(</span><span class="n">slider</span><span class="p">).</span><span class="n">perform</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tracks</span><span class="p">:</span>
            <span class="n">ActionChains</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">).</span><span class="n">move_by_offset</span><span class="p">(</span><span class="n">xoffset</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">yoffset</span><span class="o">=</span><span class="mi">0</span><span class="p">).</span><span class="n">perform</span><span class="p">()</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ActionChains</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">).</span><span class="n">release</span><span class="p">().</span><span class="n">perform</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="å®Œå–„è¡¨å•æ¨¡æ‹Ÿç™»å½•">å®Œå–„è¡¨å•ï¼Œæ¨¡æ‹Ÿç™»å½•</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">BORDER</span> <span class="o">=</span> <span class="mi">6</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        æ‰“å¼€ç½‘é¡µè¾“å…¥ç”¨æˆ·åå¯†ç 
        :return: None
        """</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">email</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">'email'</span><span class="p">)))</span>
        <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">'password'</span><span class="p">)))</span>
        <span class="n">email</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">email</span><span class="p">)</span>
        <span class="n">password</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">password</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        ç™»å½•
        :return: None
        """</span>
        <span class="n">submit</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s">'login-btn'</span><span class="p">)))</span>
        <span class="n">submit</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'ç™»å½•æˆåŠŸ'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">crack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># è¾“å…¥ç”¨æˆ·åå¯†ç 
</span>        <span class="bp">self</span><span class="p">.</span><span class="nb">open</span><span class="p">()</span>
        <span class="c1"># ç‚¹å‡»éªŒè¯æŒ‰é’®
</span>        <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_geetest_button</span><span class="p">()</span>
        <span class="n">button</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
        <span class="c1"># è·å–éªŒè¯ç å›¾ç‰‡
</span>        <span class="n">image1</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_geetest_image</span><span class="p">(</span><span class="s">'captcha1.png'</span><span class="p">)</span>
        <span class="c1"># ç‚¹æŒ‰å‘¼å‡ºç¼ºå£
</span>        <span class="n">slider</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_slider</span><span class="p">()</span>
        <span class="n">slider</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
        <span class="c1"># è·å–å¸¦ç¼ºå£çš„éªŒè¯ç å›¾ç‰‡
</span>        <span class="n">image2</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_geetest_image</span><span class="p">(</span><span class="s">'captcha2.png'</span><span class="p">)</span>
        <span class="c1"># è·å–ç¼ºå£ä½ç½®
</span>        <span class="n">gap</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_gap</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span> <span class="n">image2</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'ç¼ºå£ä½ç½®'</span><span class="p">,</span> <span class="n">gap</span><span class="p">)</span>
        <span class="c1"># å‡å»ç¼ºå£ä½ç§»
</span>        <span class="n">gap</span> <span class="o">-=</span> <span class="n">BORDER</span>
        <span class="c1"># è·å–ç§»åŠ¨è½¨è¿¹
</span>        <span class="n">track</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_track</span><span class="p">(</span><span class="n">gap</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'æ»‘åŠ¨è½¨è¿¹'</span><span class="p">,</span> <span class="n">track</span><span class="p">)</span>
        <span class="c1"># æ‹–åŠ¨æ»‘å—
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">move_to_gap</span><span class="p">(</span><span class="n">slider</span><span class="p">,</span> <span class="n">track</span><span class="p">)</span>

        <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="p">.</span><span class="n">text_to_be_present_in_element</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s">'geetest_success_radar_tip_content'</span><span class="p">),</span> <span class="s">'éªŒè¯æˆåŠŸ'</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">success</span><span class="p">)</span>

        <span class="c1"># å¤±è´¥åé‡è¯•
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">crack</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">login</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">crack</span> <span class="o">=</span> <span class="n">CrackGeetest</span><span class="p">()</span>
    <span class="n">crack</span><span class="p">.</span><span class="n">crack</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="ç‚¹è§¦éªŒè¯ç çš„è¯†åˆ«">ç‚¹è§¦éªŒè¯ç çš„è¯†åˆ«</h2>
<h3 id="è¯†åˆ«æ€è·¯-1">è¯†åˆ«æ€è·¯</h3>

<p>äº’è”ç½‘ä¸Šæœ‰å¾ˆå¤šéªŒè¯ç æœåŠ¡å¹³å°ï¼Œè¿™é‡Œä½¿ç”¨ <a href="http://www.chaojiying.com">è¶…çº§é¹°</a> å…¶æä¾›çš„æœåŠ¡ç§ç±»éå¸¸å¹¿æ³›ã€‚</p>

<h3 id="æ³¨å†Œè´¦å·"><a href="https://www.chaojiying.com/user/reg">æ³¨å†Œè´¦å·</a></h3>

<h3 id="è·å–-api">è·å– API</h3>

<p>ä¸‹è½½å¯¹åº”çš„ <a href="https://www.chaojiying.com/api-14.html">API</a></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">md5</span>
 
 
<span class="k">class</span> <span class="nc">Chaojiying</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
 
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">soft_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">md5</span><span class="p">(</span><span class="n">password</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)).</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">soft_id</span> <span class="o">=</span> <span class="n">soft_id</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">base_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">'user'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">username</span><span class="p">,</span>
            <span class="s">'pass2'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">password</span><span class="p">,</span>
            <span class="s">'softid'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">soft_id</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">'Connection'</span><span class="p">:</span> <span class="s">'Keep-Alive'</span><span class="p">,</span>
            <span class="s">'User-Agent'</span><span class="p">:</span> <span class="s">'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)'</span><span class="p">,</span>
        <span class="p">}</span>
 
    <span class="k">def</span> <span class="nf">post_pic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">im</span><span class="p">,</span> <span class="n">codetype</span><span class="p">):</span>
        <span class="s">"""
        im: å›¾ç‰‡å­—èŠ‚
        codetype: é¢˜ç›®ç±»å‹ å‚è€ƒ http://www.chaojiying.com/price.html
        """</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">'codetype'</span><span class="p">:</span> <span class="n">codetype</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">params</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">base_params</span><span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s">'userfile'</span><span class="p">:</span> <span class="p">(</span><span class="s">'ccc.jpg'</span><span class="p">,</span> <span class="n">im</span><span class="p">)}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">'http://upload.chaojiying.net/Upload/Processing.php'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
                          <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
 
    <span class="k">def</span> <span class="nf">report_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">im_id</span><span class="p">):</span>
        <span class="s">"""
        im_id:æŠ¥é”™é¢˜ç›®çš„å›¾ç‰‡ID
        """</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">'id'</span><span class="p">:</span> <span class="n">im_id</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">params</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">base_params</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">'http://upload.chaojiying.net/Upload/ReportError.php'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="åˆå§‹åŒ–-1">åˆå§‹åŒ–</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># http://admin.touclick.com/login.htmlçš„é‚®ç®±
</span><span class="n">EMAIL</span> <span class="o">=</span> <span class="s">'787549184@qq.com'</span>
<span class="c1"># http://admin.touclick.com/login.htmlçš„å¯†ç 
</span><span class="n">PASSWORD</span> <span class="o">=</span> <span class="s">''</span>

<span class="n">CHAOJIYING_USERNAME</span> <span class="o">=</span> <span class="s">'787549184'</span>
<span class="n">CHAOJIYING_PASSWORD</span> <span class="o">=</span> <span class="s">''</span>
<span class="n">CHAOJIYING_SOFT_ID</span> <span class="o">=</span> <span class="mi">898551</span>
<span class="n">CHAOJIYING_KIND</span> <span class="o">=</span> <span class="mi">9102</span>

<span class="k">class</span> <span class="nc">CrackTouClick</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">url</span> <span class="o">=</span> <span class="s">'http://admin.touclick.com/login.html'</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">wait</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">EMAIL</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">PASSWORD</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">chaojiying</span> <span class="o">=</span> <span class="n">Chaojiying</span><span class="p">(</span><span class="n">CHAOJIYING_USERNAME</span><span class="p">,</span> <span class="n">CHAOJIYING_PASSWORD</span><span class="p">,</span> <span class="n">CHAOJIYING_SOFT_ID</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="è·å–éªŒè¯ç -1">è·å–éªŒè¯ç </h3>

<p>å®Œå–„ç›¸å…³è¡¨å•ï¼Œæ¨¡æ‹Ÿç‚¹å‡»å‘¼å‡ºéªŒè¯ç </p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        æ‰“å¼€ç½‘é¡µè¾“å…¥ç”¨æˆ·åå¯†ç 
        :return: None
        """</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">email</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">'email'</span><span class="p">)))</span>
        <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">'password'</span><span class="p">)))</span>
        <span class="n">email</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">email</span><span class="p">)</span>
        <span class="n">password</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">password</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_touclick_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        è·å–åˆå§‹éªŒè¯æŒ‰é’®
        :return:
        """</span>
        <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s">'touclick-hod-wrap'</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">button</span>
</code></pre></div></div>
<p>è·å–éªŒè¯ç å›¾ç‰‡ä½ç½®å’Œå¤§å°</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">get_touclick_element</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        è·å–éªŒè¯å›¾ç‰‡å¯¹è±¡
        :return: å›¾ç‰‡å¯¹è±¡
        """</span>
        <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s">'touclick-pub-content'</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">element</span>

    <span class="k">def</span> <span class="nf">get_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        è·å–éªŒè¯ç ä½ç½®
        :return: éªŒè¯ç ä½ç½®å…ƒç»„
        """</span>
        <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_touclick_element</span><span class="p">()</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">location</span> <span class="o">=</span> <span class="n">element</span><span class="p">.</span><span class="n">location</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">element</span><span class="p">.</span><span class="n">size</span>
        <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">location</span><span class="p">[</span><span class="s">'y'</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span> <span class="o">+</span> <span class="n">size</span><span class="p">[</span><span class="s">'height'</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="s">'x'</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="s">'x'</span><span class="p">]</span> <span class="o">+</span> <span class="n">size</span><span class="p">[</span>
            <span class="s">'width'</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_screenshot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        è·å–ç½‘é¡µæˆªå›¾
        :return: æˆªå›¾å¯¹è±¡
        """</span>
        <span class="n">screenshot</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">.</span><span class="n">get_screenshot_as_png</span><span class="p">()</span>
        <span class="n">screenshot</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">screenshot</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">screenshot</span>

    <span class="k">def</span> <span class="nf">get_touclick_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'captcha.png'</span><span class="p">):</span>
        <span class="s">"""
        è·å–éªŒè¯ç å›¾ç‰‡
        :return: å›¾ç‰‡å¯¹è±¡
        """</span>
        <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_position</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'éªŒè¯ç ä½ç½®'</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
        <span class="n">screenshot</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_screenshot</span><span class="p">()</span>
        <span class="n">captcha</span> <span class="o">=</span> <span class="n">screenshot</span><span class="p">.</span><span class="n">crop</span><span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">bottom</span><span class="p">))</span>
        <span class="n">captcha</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">captcha</span>
</code></pre></div></div>

<h3 id="è¯†åˆ«éªŒè¯ç ">è¯†åˆ«éªŒè¯ç </h3>
<p>è°ƒç”¨ Chaojiying å¯¹è±¡çš„ post_pic() æ–¹æ³•ï¼Œå³å¯æŠŠå›¾ç‰‡å‘ç”Ÿåˆ°è¶…çº§é¹°åå°</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="c1"># è·å–éªŒè¯ç å›¾ç‰‡
</span>        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_touclick_image</span><span class="p">()</span>
        <span class="n">bytes_array</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">image</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">bytes_array</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s">'PNG'</span><span class="p">)</span>
        <span class="c1"># è¯†åˆ«éªŒè¯ç 
</span>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">chaojiying</span><span class="p">.</span><span class="n">post_pic</span><span class="p">(</span><span class="n">bytes_array</span><span class="p">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">CHAOJIYING_KIND</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>å°† pic_str() è¯†åˆ«çš„æ–‡å­—åæ ‡ è§£æï¼Œç„¶åæ¨¡æ‹Ÿç‚¹å‡»</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">get_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">captcha_result</span><span class="p">):</span>
        <span class="s">"""
        è§£æè¯†åˆ«ç»“æœ
        :param captcha_result: è¯†åˆ«ç»“æœ
        :return: è½¬åŒ–åçš„ç»“æœ
        """</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="n">captcha_result</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'pic_str'</span><span class="p">).</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)</span>
        <span class="n">locations</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">group</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">','</span><span class="p">)]</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">locations</span>

    <span class="k">def</span> <span class="nf">touch_click_words</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locations</span><span class="p">):</span>
        <span class="s">"""
        ç‚¹å‡»éªŒè¯å›¾ç‰‡
        :param locations: ç‚¹å‡»ä½ç½®
        :return: None
        """</span>
        <span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">locations</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
            <span class="n">ActionChains</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">).</span><span class="n">move_to_element_with_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">get_touclick_element</span><span class="p">(),</span> <span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                   <span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">]).</span><span class="n">click</span><span class="p">().</span><span class="n">perform</span><span class="p">()</span>
            <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="å®Œå–„è¡¨å•æ¨¡æ‹Ÿç™»å½•-1">å®Œå–„è¡¨å•ï¼Œæ¨¡æ‹Ÿç™»å½•</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">touch_click_verify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        ç‚¹å‡»éªŒè¯æŒ‰é’®
        :return: None
        """</span>
        <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s">'touclick-pub-submit'</span><span class="p">)))</span>
        <span class="n">button</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        ç™»å½•
        :return: None
        """</span>
        <span class="n">submit</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">'_submit'</span><span class="p">)))</span>
        <span class="n">submit</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'ç™»å½•æˆåŠŸ'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">crack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        ç ´è§£å…¥å£
        :return: None
        """</span>
        <span class="bp">self</span><span class="p">.</span><span class="nb">open</span><span class="p">()</span>
        <span class="c1"># ç‚¹å‡»éªŒè¯æŒ‰é’®
</span>        <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_touclick_button</span><span class="p">()</span>
        <span class="n">button</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
        <span class="c1"># è·å–éªŒè¯ç å›¾ç‰‡
</span>        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_touclick_image</span><span class="p">()</span>
        <span class="n">bytes_array</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">image</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">bytes_array</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s">'PNG'</span><span class="p">)</span>
        <span class="c1"># è¯†åˆ«éªŒè¯ç 
</span>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">chaojiying</span><span class="p">.</span><span class="n">post_pic</span><span class="p">(</span><span class="n">bytes_array</span><span class="p">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">CHAOJIYING_KIND</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="n">locations</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_points</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">touch_click_words</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">touch_click_verify</span><span class="p">()</span>
        <span class="c1"># åˆ¤å®šæ˜¯å¦æˆåŠŸ
</span>        <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="p">.</span><span class="n">text_to_be_present_in_element</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s">'touclick-hod-note'</span><span class="p">),</span> <span class="s">'éªŒè¯æˆåŠŸ'</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">success</span><span class="p">)</span>

        <span class="c1"># å¤±è´¥åé‡è¯•
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">crack</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">login</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">crack</span> <span class="o">=</span> <span class="n">CrackTouClick</span><span class="p">()</span>
    <span class="n">crack</span><span class="p">.</span><span class="n">crack</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="å¾®åšå®«æ ¼éªŒè¯ç çš„è¯†åˆ«">å¾®åšå®«æ ¼éªŒè¯ç çš„è¯†åˆ«</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver</span> <span class="kn">import</span> <span class="n">ActionChains</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span>

<span class="n">USERNAME</span> <span class="o">=</span> <span class="s">'xxxxxx'</span>
<span class="n">PASSWORD</span> <span class="o">=</span> <span class="s">'xxxxxxx'</span>

<span class="n">TEMPLATES_FOLDER</span> <span class="o">=</span> <span class="s">'templates/'</span>


<span class="k">class</span> <span class="nc">CrackWeiboSlide</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">url</span> <span class="o">=</span> <span class="s">'https://passport.weibo.cn/signin/login?entry=mweibo&amp;r=https://m.weibo.cn/'</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">wait</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">USERNAME</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">PASSWORD</span>
    
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        æ‰“å¼€ç½‘é¡µè¾“å…¥ç”¨æˆ·åå¯†ç å¹¶ç‚¹å‡»
        :return: None
        """</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">'loginName'</span><span class="p">)))</span>
        <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">'loginPassword'</span><span class="p">)))</span>
        <span class="n">submit</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">'loginAction'</span><span class="p">)))</span>
        <span class="n">username</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">username</span><span class="p">)</span>
        <span class="n">password</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">password</span><span class="p">)</span>
        <span class="n">submit</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">get_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        è·å–éªŒè¯ç ä½ç½®
        :return: éªŒè¯ç ä½ç½®å…ƒç»„
        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s">'patt-shadow'</span><span class="p">)))</span>
        <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'æœªå‡ºç°éªŒè¯ç '</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="nb">open</span><span class="p">()</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">location</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">location</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">size</span>
        <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">location</span><span class="p">[</span><span class="s">'y'</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span> <span class="o">+</span> <span class="n">size</span><span class="p">[</span><span class="s">'height'</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="s">'x'</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="s">'x'</span><span class="p">]</span> <span class="o">+</span> <span class="n">size</span><span class="p">[</span>
            <span class="s">'width'</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_screenshot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        è·å–ç½‘é¡µæˆªå›¾
        :return: æˆªå›¾å¯¹è±¡
        """</span>
        <span class="n">screenshot</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">.</span><span class="n">get_screenshot_as_png</span><span class="p">()</span>
        <span class="n">screenshot</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">screenshot</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">screenshot</span>
    
    <span class="k">def</span> <span class="nf">get_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'captcha.png'</span><span class="p">):</span>
        <span class="s">"""
        è·å–éªŒè¯ç å›¾ç‰‡
        :return: å›¾ç‰‡å¯¹è±¡
        """</span>
        <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_position</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'éªŒè¯ç ä½ç½®'</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
        <span class="n">screenshot</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_screenshot</span><span class="p">()</span>
        <span class="n">captcha</span> <span class="o">=</span> <span class="n">screenshot</span><span class="p">.</span><span class="n">crop</span><span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">bottom</span><span class="p">))</span>
        <span class="n">captcha</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">captcha</span>
    
    <span class="k">def</span> <span class="nf">is_pixel_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">image1</span><span class="p">,</span><span class="n">image2</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span><span class="c1">#åˆ¤æ–­åˆ·æ–°å‡ºæ¥çš„éªŒè¯ç å›¾ç‰‡å’Œå·²ç»å­˜å‚¨å¥½çš„éªŒè¯ç æ¨¡æ¿æ˜¯å¦åŒ¹é…
</span>        <span class="n">pixel1</span><span class="o">=</span><span class="n">image1</span><span class="p">.</span><span class="n">load</span><span class="p">()[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span><span class="c1">#è¿”å›çš„æ˜¯RGBå½¢å¼çš„å…ƒç»„
</span>        <span class="n">pixel2</span><span class="o">=</span><span class="n">image2</span><span class="p">.</span><span class="n">load</span><span class="p">()[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span>
        <span class="n">threshold</span><span class="o">=</span><span class="mi">20</span><span class="c1">#è®¾å®šä¸€ä¸ªé˜ˆå€¼
</span>        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pixel1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pixel2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pixel1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pixel2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span>
                <span class="n">pixel1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">pixel2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        
    <span class="k">def</span> <span class="nf">same_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">image</span><span class="p">,</span><span class="n">template</span><span class="p">):</span><span class="c1">#ç¬¬ä¸€ä¸ªä¸ºå¾…è¯†åˆ«çš„éªŒè¯ç ï¼Œç¬¬äºŒä¸ªä¸ºå­˜å‚¨çš„æ¨¡æ¿ï¼Œåªè¦æ˜¯æ¯”å¯¹ä¸€ä¸‹å„ä¸ªç‚¹çš„åƒç´ 
</span>            <span class="n">count</span><span class="o">=</span><span class="mi">0</span><span class="c1">#ç”¨äºå­˜å‚¨åƒç´ ç›¸åŒç‚¹çš„ä¸ªæ•°
</span>            <span class="n">threshold</span><span class="o">=</span><span class="mf">0.99</span><span class="c1">#é˜ˆå€¼ï¼Œç”¨äºæ ‡å®šä¸¤å¼ å›¾è¡¨æ˜¯å¦ç›¸åŒ
</span>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">width</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">height</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">is_pixel_equal</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">template</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">):</span><span class="c1">#å¦‚æœåƒç´ ç›¸åŒ
</span>                        <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">result</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">width</span><span class="o">*</span><span class="n">image</span><span class="p">.</span><span class="n">height</span><span class="p">)</span><span class="c1">#åˆ¤æ–­ç›¸åŒçš„åƒç´ ç‚¹çš„å æ¯”
</span>            <span class="k">if</span> <span class="n">result</span><span class="o">&gt;</span><span class="n">threshold</span><span class="p">:</span>
                <span class="k">print</span> <span class="p">(</span><span class="s">'æˆåŠŸåŒ¹é…'</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">True</span> 
            <span class="k">else</span><span class="err">ï¼š</span>
                <span class="k">return</span> <span class="bp">False</span>
        
    
     <span class="k">def</span> <span class="nf">detect_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">image</span><span class="p">):</span>
         <span class="k">for</span> <span class="n">template_name</span> <span class="ow">in</span> <span class="n">listdir</span><span class="p">(</span><span class="n">TEMPLATES_FOLDER</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'æ­£åœ¨åŒ¹é…'</span><span class="p">,</span> <span class="n">template_name</span><span class="p">)</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">TEMPLATES_FOLDER</span> <span class="o">+</span> <span class="n">template_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">same_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">template</span><span class="p">):</span>
                <span class="c1"># è¿”å›é¡ºåº
</span>                <span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">template_name</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)[</span><span class="mi">0</span><span class="p">])]</span>
                <span class="k">print</span><span class="p">(</span><span class="s">'æ‹–åŠ¨é¡ºåº'</span><span class="p">,</span> <span class="n">numbers</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">numbers</span>
    
    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">numbers</span><span class="p">):</span>
        <span class="n">circles</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s">'.patt-wrap .patt-circ'</span><span class="p">)</span><span class="c1">#è·å¾—çš„æ˜¯å››ä¸ªæŒ‰é’®çš„åˆ—è¡¨
</span>        <span class="n">dx</span><span class="o">=</span><span class="n">dy</span><span class="o">=</span><span class="mi">0</span><span class="c1">#åˆå§‹ä¸€ä¸ªåŸå§‹çš„åˆå§‹ç§»åŠ¨ä½ç½®
</span>        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">circle</span><span class="o">=</span><span class="n">circles</span><span class="p">[</span><span class="n">numbers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="c1">#numbersæ˜¯1-4çš„ä¸€ä¸ªåˆ—è¡¨
</span>            <span class="c1"># å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å¾ªç¯
</span>            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># ç‚¹å‡»ç¬¬ä¸€ä¸ªæŒ‰ç‚¹
</span>                <span class="n">ActionChains</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">)</span> \
                    <span class="p">.</span><span class="n">move_to_element_with_offset</span><span class="p">(</span><span class="n">circle</span><span class="p">,</span> <span class="n">circle</span><span class="p">.</span><span class="n">size</span><span class="p">[</span><span class="s">'width'</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">circle</span><span class="p">.</span><span class="n">size</span><span class="p">[</span><span class="s">'height'</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> \
                    <span class="p">.</span><span class="n">click_and_hold</span><span class="p">().</span><span class="n">perform</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># å°å¹…ç§»åŠ¨æ¬¡æ•°
</span>                <span class="n">times</span> <span class="o">=</span> <span class="mi">30</span>
                <span class="c1"># æ‹–åŠ¨
</span>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">times</span><span class="p">):</span>
                    <span class="n">ActionChains</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">).</span><span class="n">move_by_offset</span><span class="p">(</span><span class="n">dx</span> <span class="o">/</span> <span class="n">times</span><span class="p">,</span> <span class="n">dy</span> <span class="o">/</span> <span class="n">times</span><span class="p">).</span><span class="n">perform</span><span class="p">()</span><span class="c1">#å½“dx=dy=0çš„æ—¶å€™ï¼Œindex=0ï¼Œä¸ä¼šæ‰§è¡Œè¿™ä¸€å¥
</span>                    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">times</span><span class="p">)</span>
            <span class="c1"># å¦‚æœæ˜¯æœ€åä¸€æ¬¡å¾ªç¯
</span>            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="c1"># æ¾å¼€é¼ æ ‡
</span>                <span class="n">ActionChains</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">).</span><span class="n">release</span><span class="p">().</span><span class="n">perform</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># è®¡ç®—ä¸‹ä¸€æ¬¡åç§»
</span>                <span class="n">dx</span> <span class="o">=</span> <span class="n">circles</span><span class="p">[</span><span class="n">numbers</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">location</span><span class="p">[</span><span class="s">'x'</span><span class="p">]</span> <span class="o">-</span> <span class="n">circle</span><span class="p">.</span><span class="n">location</span><span class="p">[</span><span class="s">'x'</span><span class="p">]</span>
                <span class="n">dy</span> <span class="o">=</span> <span class="n">circles</span><span class="p">[</span><span class="n">numbers</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">location</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span> <span class="o">-</span> <span class="n">circle</span><span class="p">.</span><span class="n">location</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span>
                
    <span class="k">def</span> <span class="nf">crack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        ç ´è§£å…¥å£
        :return:
        """</span>
        <span class="bp">self</span><span class="p">.</span><span class="nb">open</span><span class="p">()</span>
        <span class="c1"># è·å–éªŒè¯ç å›¾ç‰‡
</span>        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_image</span><span class="p">(</span><span class="s">'captcha.png'</span><span class="p">)</span>
        <span class="n">numbers</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">detect_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'è¯†åˆ«ç»“æŸ'</span><span class="p">)</span>
            
                    
            
        
    
     <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">count</span><span class="o">=</span><span class="mi">0</span> 
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="nb">open</span><span class="p">()</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">get_image</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">+</span><span class="s">'.png'</span><span class="p">)</span>
            <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
            
            
<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">crack</span><span class="o">=</span> <span class="n">CrackWeiboSlide</span><span class="p">()</span>
    <span class="n">crack</span><span class="p">.</span><span class="n">crack</span><span class="p">()</span>
</code></pre></div></div>
<p>=======
â€”
layout:     post
title:      â€œéªŒè¯ç çš„è¯†åˆ«â€
subtitle:   â€œéªŒè¯ç åœ¨å¾ˆå¤šåœ°æ–¹éƒ½ä¼šç”¨åˆ°â€
date:       2019-11-25 16:38:20
author:     â€œBalboâ€
header-img: â€œimg/post-bg-2019.jpgâ€
catalog: true
tags:
    - reptile
    - python
â€”
=======
â€”
layout: post
title: éªŒè¯ç çš„è¯†åˆ«
subtitle: 
author: Balbo Cheng
categories: python
tags: [reptile]
â€”</p>

<blockquote>
  <blockquote>
    <blockquote>
      <blockquote>
        <blockquote>
          <blockquote>
            <blockquote>
              <p>e5c77ca (æ–°é¡µé¢)</p>
              <h2 id="å›¾åƒéªŒè¯ç çš„è¯†åˆ«-1">å›¾åƒéªŒè¯ç çš„è¯†åˆ«</h2>
              <h3 id="è·å–éªŒè¯ç -2">è·å–éªŒè¯ç </h3>
            </blockquote>
          </blockquote>
        </blockquote>
      </blockquote>
    </blockquote>
  </blockquote>
</blockquote>

<p>ä¿å­˜éªŒè¯ç å›¾ç‰‡ä»¥ä¾¿å®éªŒï¼Œ<a href="http://my.cnki.net/elibregister/CheckCode.aspx">éªŒè¯</a></p>

<h3 id="è¯†åˆ«æµ‹è¯•-1">è¯†åˆ«æµ‹è¯•</h3>

<p>ä½¿ç”¨ tesserocr åº“è¯†åˆ«éªŒè¯ç (ç”±äº tesseract ä¸ window ä¸å…¼å®¹ï¼Œ æš‚æ—¶ç”¨ pytesseract ä»£æ›¿)</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">tesserocr</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="s">'code.jpg'</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">tesserocr</span><span class="p">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="éªŒè¯ç å¤„ç†-1">éªŒè¯ç å¤„ç†</h3>

<p>éªŒè¯ç å†…çš„å¤šä½™çº¿æ¡å¯èƒ½ä¼šå¹²æ‰°å›¾ç‰‡çš„è¯†åˆ«ï¼Œå¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬è¿˜éœ€è¦åšä¸€äº›é¢å¤–çš„å¤„ç†,ä¾‹å¦‚ï¼š</p>

<p>å›¾ç‰‡è½¬åŒ–ä¸ºç°åº¦å›¾åƒ</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">covert</span><span class="p">(</span><span class="s">'L'</span><span class="p">)</span>
<span class="n">image</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<p>è¿›è¡ŒäºŒå€¼åŒ–å¤„ç†</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">covert</span><span class="p">(</span><span class="s">'1'</span><span class="p">)</span>
<span class="n">image</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<p>æŒ‡å®šäºŒå€¼åŒ–é˜ˆå€¼</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">covert</span><span class="p">(</span><span class="s">'L'</span><span class="p">)</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">table</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
        <span class="n">table</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">table</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
<span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="s">'1'</span><span class="p">)</span>
<span class="n">image</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="æéªŒæ»‘åŠ¨éªŒè¯ç çš„è¯†åˆ«-1">æéªŒæ»‘åŠ¨éªŒè¯ç çš„è¯†åˆ«</h2>
<h3 id="è¯†åˆ«æ€è·¯-2">è¯†åˆ«æ€è·¯</h3>

<p>å¯¹äºåº”ç”¨äº†æéªŒéªŒè¯ç çš„ç½‘ç«™ï¼Œå¦‚æœæˆ‘ä»¬ä¸­ä»‹æ¨¡æ‹Ÿè¡¨å•æäº¤ï¼ŒåŠ å¯†å‚æ•°çš„æ„é€ æ˜¯ä¸ªé—®é¢˜ï¼Œéœ€è¦åˆ†æå…¶åŠ å¯†å’Œæ ¡éªŒé€»è¾‘ï¼Œç›¸å¯¹ç¹çã€‚éšæ„æˆ‘ä»¬é‡‡ç”¨ç›´æ¥æ¨¡æ‹Ÿæµè§ˆå™¨åŠ¨ä½œçš„æ–¹å¼æ¥å®ŒæˆéªŒè¯</p>

<p>é¦–å…ˆï¼Œæ‰¾åˆ°ä¸€ä¸ªå¸¦æœ‰æéªŒéªŒè¯ç çš„ç½‘ç«™ï¼š http://account.geetest.com/login</p>

<p>æ¬¡æŒ‰é’®ä¸ºæ™ºèƒ½éªŒè¯æŒ‰é’®ã€‚å¦‚æœåŒä¸€ä¼šè¯ï¼Œä¸€æ®µæ—¶é—´å†…ç¬¬äºŒæ¬¡ç‚¹å‡»ä¼šç›´æ¥é€šè¿‡éªŒè¯ã€‚å¦‚æœæ™ºèƒ½è¯†åˆ«ä¸é€šè¿‡ï¼Œåˆ™ä¼šå¼¹å‡ºæ»‘åŠ¨çª—å£</p>

<p>æ‰€ä»¥ï¼Œè¯†åˆ«éªŒè¯éœ€è¦å®Œæˆä¸‰æ­¥</p>

<ol>
  <li>æ¨¡æ‹Ÿç‚¹å‡»éªŒè¯æŒ‰é’®</li>
  <li>è¯†åˆ«æ»‘åŠ¨ç¼ºå£çš„ä½ç½®</li>
  <li>æ¨¡æ‹Ÿæ‹–åŠ¨æ»‘å—</li>
</ol>

<h3 id="åˆå§‹åŒ–-2">åˆå§‹åŒ–</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">EMAIL</span> <span class="o">=</span> <span class="s">'test@test.com'</span>
<span class="n">PASSWORD</span> <span class="o">=</span> <span class="s">'123456'</span>


<span class="k">class</span> <span class="nc">CrackGeetest</span><span class="p">():</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">url</span> <span class="o">=</span> <span class="s">'http://account.geetest.com/login'</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">wait</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">EMAIL</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">PASSWORD</span>
</code></pre></div></div>

<h3 id="æ¨¡æ‹Ÿç‚¹å‡»-1">æ¨¡æ‹Ÿç‚¹å‡»</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">get_geetest_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        è·å–åˆå§‹åŒ–éªŒè¯æŒ‰é’®
        :return: æŒ‰é’®å¯¹è±¡
        """</span>
        <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s">'geetest_radar_tip'</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">button</span>
</code></pre></div></div>
<p>è·å–ä¸€ä¸ª WebElement å¯¹è±¡ï¼Œè°ƒç”¨å®ƒçš„ click() æ–¹æ³•å³å¯æ¨¡æ‹Ÿç‚¹å‡»</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="n">button</span> <span class="o">=</span> <span class="n">get_geetest_button</span><span class="p">()</span>
        <span class="n">button</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="è¯†åˆ«ç¼ºå£-1">è¯†åˆ«ç¼ºå£</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">get_screenshot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        è·å–ç½‘é¡µæˆªå›¾
        :return: æˆªå›¾å¯¹è±¡
        """</span>
        <span class="n">screenshot</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">.</span><span class="n">get_screenshot_as_png</span><span class="p">()</span>
        <span class="n">screenshot</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">screenshot</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">screenshot</span>
    
    <span class="k">def</span> <span class="nf">get_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        è·å–éªŒè¯ç ä½ç½®
        :return: éªŒè¯ç ä½ç½®å…ƒç»„
        """</span>
        <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s">'geetest_cavas_img'</span><span class="p">)))</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">location</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">location</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">size</span>
        <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">location</span><span class="p">[</span><span class="s">'y'</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span> <span class="o">+</span> <span class="n">size</span><span class="p">[</span><span class="s">'height'</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="s">'x'</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="s">'x'</span><span class="p">]</span> <span class="o">+</span> <span class="n">size</span><span class="p">[</span><span class="s">'width'</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_geetest_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'captcha.png'</span><span class="p">):</span>
        <span class="s">"""
        è·å–éªŒè¯ç å›¾ç‰‡
        :param name: 
        :return: å›¾ç‰‡å¯¹è±¡
        """</span>
        <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_position</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'éªŒè¯ç ä½ç½®'</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
        <span class="n">screenshot</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_screenshot</span><span class="p">()</span>
        <span class="n">captcha</span> <span class="o">=</span> <span class="n">screenshot</span><span class="p">.</span><span class="n">crop</span><span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">bottom</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">captcha</span>
</code></pre></div></div>
<p>æ¥ä¸‹æ¥ï¼Œè·å–ç¬¬äºŒå¼ å›¾ç‰‡ï¼Œä¹Ÿå°±æ˜¯å¸¦ç¼ºå£çš„å›¾ç‰‡ï¼Œè¦ä½¿å›¾ç‰‡å‡ºç°ç¼ºå£ï¼Œåªéœ€è¦ç‚¹å‡»ä¸‹æ–¹çš„æ»‘åŠ¨å—å³å¯</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">get_slider</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        è·å–æ»‘å—
        :return:æ»‘å—å¯¹è±¡ 
        """</span>
        <span class="n">silder</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s">'geetest_slider_button'</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">silder</span>
</code></pre></div></div>
<p>è°ƒç”¨ click() æ–¹æ³•å³å¯è§¦å‘ç‚¹å‡»</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="n">slider</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_slider</span><span class="p">()</span>
        <span class="n">slider</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
</code></pre></div></div>
<p>æ¥ä¸‹æ¥å¯¹æ¯”å›¾ç‰‡è·å–ç¼ºå£ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œéå†æ¯ä¸ªåæ ‡ç‚¹ï¼Œè·å–ä¸¤å¼ å›¾ç‰‡å¯¹åº”åƒç´ ç‚¹çš„ RGB æ•°æ®ã€‚å¦‚æœ RGB æ•°æ®å·®è·åœ¨ä¸€å®šèŒƒå›´å†…ï¼Œä»£è¡¨ä¸¤ä¸ªåƒç´ ç›¸åŒï¼Œç»§ç»­å¯¹æ¯”ä¸‹ä¸€ä¸ªåƒç´ ï¼Œå¦‚æœå·®è·è¶…è¿‡ä¸€å®šèŒƒå›´ï¼Œåˆ™ä»£è¡¨åƒç´ ç‚¹ä¸åŒï¼Œå³ç¼ºå£ã€‚</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">is_pixel_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image1</span><span class="p">,</span> <span class="n">image2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="s">"""
        åˆ¤æ–­ä¸¤ä¸ªåƒç´ æ˜¯å¦ç›¸åŒ
        :param image1: å›¾ç‰‡1
        :param image2: å›¾ç‰‡2
        :param x: ä½ç½®x
        :param y: ä½ç½®y
        :return: åƒç´ æ˜¯å¦ç›¸åŒ
        """</span>
        <span class="n">pixel1</span> <span class="o">=</span> <span class="n">image1</span><span class="p">.</span><span class="n">load</span><span class="p">()[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>
        <span class="n">pixel2</span> <span class="o">=</span> <span class="n">image2</span><span class="p">.</span><span class="n">load</span><span class="p">()[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="mi">60</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pixel1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pixel2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pixel1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pixel2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">threshold</span> <span class="ow">and</span> \
                <span class="nb">abs</span><span class="p">(</span><span class="n">pixel1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">pixel2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        
    <span class="k">def</span> <span class="nf">get_gap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image1</span><span class="p">,</span> <span class="n">image2</span><span class="p">):</span>
        <span class="s">"""
        è¿˜ç¼ºç¼ºå£åç§»é‡
        :param image1:ä¸å¸¦ç¼ºå£å›¾ç‰‡ 
        :param image2: å¸¦ç¼ºå£å›¾ç‰‡
        :return: 
        """</span>
        <span class="n">left</span> <span class="o">=</span> <span class="mi">60</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">image1</span><span class="p">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image1</span><span class="p">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">is_pixel_equal</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span> <span class="n">image2</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
                    <span class="n">left</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="k">return</span> <span class="n">left</span>
        <span class="k">return</span> <span class="n">left</span>
</code></pre></div></div>

<h3 id="æ¨¡æ‹Ÿæ‹–åŠ¨-1">æ¨¡æ‹Ÿæ‹–åŠ¨</h3>

<p>æ¨¡æ‹Ÿæ‹–åŠ¨è¿‡ç¨‹å¹¶ä¸å¤æ‚ï¼Œä½†å…¶ä¸­çš„å‘æ¯”è¾ƒå¤šã€‚å¦‚æœæ˜¯åŒ€é€Ÿè¿åŠ¨ï¼ŒæéªŒå¿…ç„¶ä¼šè¯†åˆ«å‡ºæ˜¯ç¨‹åºæ“ä½œï¼Œä»¥ä¸ºäººæ— æ³•åšåˆ°å®Œå…¨åŒ€é€Ÿæ‹–åŠ¨ã€‚æéªŒéªŒè¯ç åˆ©ç”¨æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œç­›é€‰æ­¤ç±»æ•°æ®ä¸ºæœºå™¨æ“ä½œï¼ŒéªŒè¯ç å¿…å¤±è´¥ã€‚</p>

<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬é‡‡ç”¨å‰æ®µåšåŒ€åŠ é€Ÿè¿åŠ¨ï¼Œåæ®µåšåŒ€å‡é€Ÿè¿åŠ¨ï¼Œæ¥æ¨¡æ‹Ÿäººæ‹–åŠ¨æ—¶çš„åŠ¨ä½œï¼Œåˆ©ç”¨ç‰©ç†å­¦çš„åŠ é€Ÿåº¦å…¬å¼å®ŒæˆéªŒè¯ã€‚</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># å½“å‰é€Ÿåº¦ vï¼Œåˆé€Ÿåº¦ v0ï¼Œ ä½ç§» xï¼Œ æ‰€éœ€æ—¶é—´ t
</span><span class="n">x</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">t</span>
</code></pre></div></div>
<p>æ„é€ è½¨è¿¹ç§»åŠ¨ç®—æ³•ï¼Œè®¡ç®—å‡ºå…ˆåŠ é€Ÿåå‡é€Ÿçš„è¿åŠ¨è½¨è¿¹</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">get_track</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span><span class="p">):</span>
        <span class="s">"""
        æ ¹æ®åç§»é‡è·å–è¿åŠ¨è½¨è¿¹
        :param distance: åç§»é‡
        :return: è¿åŠ¨è½¨è¿¹
        """</span>
        <span class="c1"># è¿åŠ¨è½¨è¿¹
</span>        <span class="n">track</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># å½“å‰ä½ç§»
</span>        <span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># å‡é€Ÿé˜ˆå€¼
</span>        <span class="n">mid</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">5</span>
        <span class="c1"># è®¡ç®—é—´éš”
</span>        <span class="n">t</span> <span class="o">=</span> <span class="mf">0.2</span>
        <span class="c1"># åˆé€Ÿåº¦
</span>        <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">distance</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">mid</span><span class="p">:</span>
                <span class="c1"># åŠ é€Ÿåº¦ä¸º+2
</span>                <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># åŠ é€Ÿåº¦ä¸º-3
</span>                <span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
            <span class="c1"># åˆé€Ÿåº¦ v0
</span>            <span class="n">v0</span> <span class="o">=</span> <span class="n">v</span>
            <span class="c1"># å½“å‰é€Ÿåº¦ v = v0 + at
</span>            <span class="n">v</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">+</span> <span class="n">a</span> <span class="o">*</span> <span class="n">t</span>
            <span class="c1"># ç§»åŠ¨è·ç¦» x = v0t + 1/2 * a * t * t
</span>            <span class="n">move</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span>
            <span class="c1"># å½“å‰ä½ç§»
</span>            <span class="n">current</span> <span class="o">+=</span> <span class="n">move</span>
            <span class="c1"># åŠ å…¥è½¨è¿¹
</span>            <span class="n">track</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">move</span><span class="p">))</span>
            
        <span class="k">return</span> <span class="n">track</span>
</code></pre></div></div>
<p>æŒ‰ç…§è¿åŠ¨è½¨è¿¹æ‹–åŠ¨æ»‘å—</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">move_to_gap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slider</span><span class="p">,</span> <span class="n">tracks</span><span class="p">):</span>
        <span class="s">"""
        æ‹–åŠ¨æ»‘å—åˆ°ç¼ºå£å¤„
        :param slider: æ»‘å—
        :param tracks: ç¼ºå£
        :return: 
        """</span>
        <span class="n">ActionChains</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">).</span><span class="n">click_and_hold</span><span class="p">(</span><span class="n">slider</span><span class="p">).</span><span class="n">perform</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tracks</span><span class="p">:</span>
            <span class="n">ActionChains</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">).</span><span class="n">move_by_offset</span><span class="p">(</span><span class="n">xoffset</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">yoffset</span><span class="o">=</span><span class="mi">0</span><span class="p">).</span><span class="n">perform</span><span class="p">()</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ActionChains</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">).</span><span class="n">release</span><span class="p">().</span><span class="n">perform</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="å®Œå–„è¡¨å•æ¨¡æ‹Ÿç™»å½•-2">å®Œå–„è¡¨å•ï¼Œæ¨¡æ‹Ÿç™»å½•</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">BORDER</span> <span class="o">=</span> <span class="mi">6</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        æ‰“å¼€ç½‘é¡µè¾“å…¥ç”¨æˆ·åå¯†ç 
        :return: None
        """</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">email</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">'email'</span><span class="p">)))</span>
        <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">'password'</span><span class="p">)))</span>
        <span class="n">email</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">email</span><span class="p">)</span>
        <span class="n">password</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">password</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        ç™»å½•
        :return: None
        """</span>
        <span class="n">submit</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s">'login-btn'</span><span class="p">)))</span>
        <span class="n">submit</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'ç™»å½•æˆåŠŸ'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">crack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># è¾“å…¥ç”¨æˆ·åå¯†ç 
</span>        <span class="bp">self</span><span class="p">.</span><span class="nb">open</span><span class="p">()</span>
        <span class="c1"># ç‚¹å‡»éªŒè¯æŒ‰é’®
</span>        <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_geetest_button</span><span class="p">()</span>
        <span class="n">button</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
        <span class="c1"># è·å–éªŒè¯ç å›¾ç‰‡
</span>        <span class="n">image1</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_geetest_image</span><span class="p">(</span><span class="s">'captcha1.png'</span><span class="p">)</span>
        <span class="c1"># ç‚¹æŒ‰å‘¼å‡ºç¼ºå£
</span>        <span class="n">slider</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_slider</span><span class="p">()</span>
        <span class="n">slider</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
        <span class="c1"># è·å–å¸¦ç¼ºå£çš„éªŒè¯ç å›¾ç‰‡
</span>        <span class="n">image2</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_geetest_image</span><span class="p">(</span><span class="s">'captcha2.png'</span><span class="p">)</span>
        <span class="c1"># è·å–ç¼ºå£ä½ç½®
</span>        <span class="n">gap</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_gap</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span> <span class="n">image2</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'ç¼ºå£ä½ç½®'</span><span class="p">,</span> <span class="n">gap</span><span class="p">)</span>
        <span class="c1"># å‡å»ç¼ºå£ä½ç§»
</span>        <span class="n">gap</span> <span class="o">-=</span> <span class="n">BORDER</span>
        <span class="c1"># è·å–ç§»åŠ¨è½¨è¿¹
</span>        <span class="n">track</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_track</span><span class="p">(</span><span class="n">gap</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'æ»‘åŠ¨è½¨è¿¹'</span><span class="p">,</span> <span class="n">track</span><span class="p">)</span>
        <span class="c1"># æ‹–åŠ¨æ»‘å—
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">move_to_gap</span><span class="p">(</span><span class="n">slider</span><span class="p">,</span> <span class="n">track</span><span class="p">)</span>

        <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="p">.</span><span class="n">text_to_be_present_in_element</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s">'geetest_success_radar_tip_content'</span><span class="p">),</span> <span class="s">'éªŒè¯æˆåŠŸ'</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">success</span><span class="p">)</span>

        <span class="c1"># å¤±è´¥åé‡è¯•
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">crack</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">login</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">crack</span> <span class="o">=</span> <span class="n">CrackGeetest</span><span class="p">()</span>
    <span class="n">crack</span><span class="p">.</span><span class="n">crack</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="ç‚¹è§¦éªŒè¯ç çš„è¯†åˆ«-1">ç‚¹è§¦éªŒè¯ç çš„è¯†åˆ«</h2>
<h3 id="è¯†åˆ«æ€è·¯-3">è¯†åˆ«æ€è·¯</h3>

<p>äº’è”ç½‘ä¸Šæœ‰å¾ˆå¤šéªŒè¯ç æœåŠ¡å¹³å°ï¼Œè¿™é‡Œä½¿ç”¨ <a href="http://www.chaojiying.com">è¶…çº§é¹°</a> å…¶æä¾›çš„æœåŠ¡ç§ç±»éå¸¸å¹¿æ³›ã€‚</p>

<h3 id="æ³¨å†Œè´¦å·-1"><a href="https://www.chaojiying.com/user/reg">æ³¨å†Œè´¦å·</a></h3>

<h3 id="è·å–-api-1">è·å– API</h3>

<p>ä¸‹è½½å¯¹åº”çš„ <a href="https://www.chaojiying.com/api-14.html">API</a></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">md5</span>
 
 
<span class="k">class</span> <span class="nc">Chaojiying</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
 
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">soft_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">md5</span><span class="p">(</span><span class="n">password</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)).</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">soft_id</span> <span class="o">=</span> <span class="n">soft_id</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">base_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">'user'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">username</span><span class="p">,</span>
            <span class="s">'pass2'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">password</span><span class="p">,</span>
            <span class="s">'softid'</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">soft_id</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">'Connection'</span><span class="p">:</span> <span class="s">'Keep-Alive'</span><span class="p">,</span>
            <span class="s">'User-Agent'</span><span class="p">:</span> <span class="s">'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)'</span><span class="p">,</span>
        <span class="p">}</span>
 
    <span class="k">def</span> <span class="nf">post_pic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">im</span><span class="p">,</span> <span class="n">codetype</span><span class="p">):</span>
        <span class="s">"""
        im: å›¾ç‰‡å­—èŠ‚
        codetype: é¢˜ç›®ç±»å‹ å‚è€ƒ http://www.chaojiying.com/price.html
        """</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">'codetype'</span><span class="p">:</span> <span class="n">codetype</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">params</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">base_params</span><span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s">'userfile'</span><span class="p">:</span> <span class="p">(</span><span class="s">'ccc.jpg'</span><span class="p">,</span> <span class="n">im</span><span class="p">)}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">'http://upload.chaojiying.net/Upload/Processing.php'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
                          <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
 
    <span class="k">def</span> <span class="nf">report_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">im_id</span><span class="p">):</span>
        <span class="s">"""
        im_id:æŠ¥é”™é¢˜ç›®çš„å›¾ç‰‡ID
        """</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">'id'</span><span class="p">:</span> <span class="n">im_id</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">params</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">base_params</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">'http://upload.chaojiying.net/Upload/ReportError.php'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="åˆå§‹åŒ–-3">åˆå§‹åŒ–</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># http://admin.touclick.com/login.htmlçš„é‚®ç®±
</span><span class="n">EMAIL</span> <span class="o">=</span> <span class="s">'787549184@qq.com'</span>
<span class="c1"># http://admin.touclick.com/login.htmlçš„å¯†ç 
</span><span class="n">PASSWORD</span> <span class="o">=</span> <span class="s">''</span>

<span class="n">CHAOJIYING_USERNAME</span> <span class="o">=</span> <span class="s">'787549184'</span>
<span class="n">CHAOJIYING_PASSWORD</span> <span class="o">=</span> <span class="s">''</span>
<span class="n">CHAOJIYING_SOFT_ID</span> <span class="o">=</span> <span class="mi">898551</span>
<span class="n">CHAOJIYING_KIND</span> <span class="o">=</span> <span class="mi">9102</span>

<span class="k">class</span> <span class="nc">CrackTouClick</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">url</span> <span class="o">=</span> <span class="s">'http://admin.touclick.com/login.html'</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">wait</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">EMAIL</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">PASSWORD</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">chaojiying</span> <span class="o">=</span> <span class="n">Chaojiying</span><span class="p">(</span><span class="n">CHAOJIYING_USERNAME</span><span class="p">,</span> <span class="n">CHAOJIYING_PASSWORD</span><span class="p">,</span> <span class="n">CHAOJIYING_SOFT_ID</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="è·å–éªŒè¯ç -3">è·å–éªŒè¯ç </h3>

<p>å®Œå–„ç›¸å…³è¡¨å•ï¼Œæ¨¡æ‹Ÿç‚¹å‡»å‘¼å‡ºéªŒè¯ç </p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        æ‰“å¼€ç½‘é¡µè¾“å…¥ç”¨æˆ·åå¯†ç 
        :return: None
        """</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">email</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">'email'</span><span class="p">)))</span>
        <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">'password'</span><span class="p">)))</span>
        <span class="n">email</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">email</span><span class="p">)</span>
        <span class="n">password</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">password</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_touclick_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        è·å–åˆå§‹éªŒè¯æŒ‰é’®
        :return:
        """</span>
        <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s">'touclick-hod-wrap'</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">button</span>
</code></pre></div></div>
<p>è·å–éªŒè¯ç å›¾ç‰‡ä½ç½®å’Œå¤§å°</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">get_touclick_element</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        è·å–éªŒè¯å›¾ç‰‡å¯¹è±¡
        :return: å›¾ç‰‡å¯¹è±¡
        """</span>
        <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s">'touclick-pub-content'</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">element</span>

    <span class="k">def</span> <span class="nf">get_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        è·å–éªŒè¯ç ä½ç½®
        :return: éªŒè¯ç ä½ç½®å…ƒç»„
        """</span>
        <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_touclick_element</span><span class="p">()</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">location</span> <span class="o">=</span> <span class="n">element</span><span class="p">.</span><span class="n">location</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">element</span><span class="p">.</span><span class="n">size</span>
        <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">location</span><span class="p">[</span><span class="s">'y'</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span> <span class="o">+</span> <span class="n">size</span><span class="p">[</span><span class="s">'height'</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="s">'x'</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="s">'x'</span><span class="p">]</span> <span class="o">+</span> <span class="n">size</span><span class="p">[</span>
            <span class="s">'width'</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_screenshot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        è·å–ç½‘é¡µæˆªå›¾
        :return: æˆªå›¾å¯¹è±¡
        """</span>
        <span class="n">screenshot</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">.</span><span class="n">get_screenshot_as_png</span><span class="p">()</span>
        <span class="n">screenshot</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">screenshot</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">screenshot</span>

    <span class="k">def</span> <span class="nf">get_touclick_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'captcha.png'</span><span class="p">):</span>
        <span class="s">"""
        è·å–éªŒè¯ç å›¾ç‰‡
        :return: å›¾ç‰‡å¯¹è±¡
        """</span>
        <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_position</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'éªŒè¯ç ä½ç½®'</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
        <span class="n">screenshot</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_screenshot</span><span class="p">()</span>
        <span class="n">captcha</span> <span class="o">=</span> <span class="n">screenshot</span><span class="p">.</span><span class="n">crop</span><span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">bottom</span><span class="p">))</span>
        <span class="n">captcha</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">captcha</span>
</code></pre></div></div>

<h3 id="è¯†åˆ«éªŒè¯ç -1">è¯†åˆ«éªŒè¯ç </h3>
<p>è°ƒç”¨ Chaojiying å¯¹è±¡çš„ post_pic() æ–¹æ³•ï¼Œå³å¯æŠŠå›¾ç‰‡å‘ç”Ÿåˆ°è¶…çº§é¹°åå°</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="c1"># è·å–éªŒè¯ç å›¾ç‰‡
</span>        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_touclick_image</span><span class="p">()</span>
        <span class="n">bytes_array</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">image</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">bytes_array</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s">'PNG'</span><span class="p">)</span>
        <span class="c1"># è¯†åˆ«éªŒè¯ç 
</span>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">chaojiying</span><span class="p">.</span><span class="n">post_pic</span><span class="p">(</span><span class="n">bytes_array</span><span class="p">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">CHAOJIYING_KIND</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div></div>
<p>å°† pic_str() è¯†åˆ«çš„æ–‡å­—åæ ‡ è§£æï¼Œç„¶åæ¨¡æ‹Ÿç‚¹å‡»</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">get_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">captcha_result</span><span class="p">):</span>
        <span class="s">"""
        è§£æè¯†åˆ«ç»“æœ
        :param captcha_result: è¯†åˆ«ç»“æœ
        :return: è½¬åŒ–åçš„ç»“æœ
        """</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="n">captcha_result</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'pic_str'</span><span class="p">).</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)</span>
        <span class="n">locations</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">group</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">','</span><span class="p">)]</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">locations</span>

    <span class="k">def</span> <span class="nf">touch_click_words</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locations</span><span class="p">):</span>
        <span class="s">"""
        ç‚¹å‡»éªŒè¯å›¾ç‰‡
        :param locations: ç‚¹å‡»ä½ç½®
        :return: None
        """</span>
        <span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">locations</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
            <span class="n">ActionChains</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">).</span><span class="n">move_to_element_with_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">get_touclick_element</span><span class="p">(),</span> <span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                   <span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">]).</span><span class="n">click</span><span class="p">().</span><span class="n">perform</span><span class="p">()</span>
            <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="å®Œå–„è¡¨å•æ¨¡æ‹Ÿç™»å½•-3">å®Œå–„è¡¨å•ï¼Œæ¨¡æ‹Ÿç™»å½•</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">touch_click_verify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        ç‚¹å‡»éªŒè¯æŒ‰é’®
        :return: None
        """</span>
        <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s">'touclick-pub-submit'</span><span class="p">)))</span>
        <span class="n">button</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        ç™»å½•
        :return: None
        """</span>
        <span class="n">submit</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">'_submit'</span><span class="p">)))</span>
        <span class="n">submit</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'ç™»å½•æˆåŠŸ'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">crack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        ç ´è§£å…¥å£
        :return: None
        """</span>
        <span class="bp">self</span><span class="p">.</span><span class="nb">open</span><span class="p">()</span>
        <span class="c1"># ç‚¹å‡»éªŒè¯æŒ‰é’®
</span>        <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_touclick_button</span><span class="p">()</span>
        <span class="n">button</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
        <span class="c1"># è·å–éªŒè¯ç å›¾ç‰‡
</span>        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_touclick_image</span><span class="p">()</span>
        <span class="n">bytes_array</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">image</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">bytes_array</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s">'PNG'</span><span class="p">)</span>
        <span class="c1"># è¯†åˆ«éªŒè¯ç 
</span>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">chaojiying</span><span class="p">.</span><span class="n">post_pic</span><span class="p">(</span><span class="n">bytes_array</span><span class="p">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">CHAOJIYING_KIND</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="n">locations</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_points</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">touch_click_words</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">touch_click_verify</span><span class="p">()</span>
        <span class="c1"># åˆ¤å®šæ˜¯å¦æˆåŠŸ
</span>        <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="p">.</span><span class="n">text_to_be_present_in_element</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s">'touclick-hod-note'</span><span class="p">),</span> <span class="s">'éªŒè¯æˆåŠŸ'</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">success</span><span class="p">)</span>

        <span class="c1"># å¤±è´¥åé‡è¯•
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">crack</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">login</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">crack</span> <span class="o">=</span> <span class="n">CrackTouClick</span><span class="p">()</span>
    <span class="n">crack</span><span class="p">.</span><span class="n">crack</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="å¾®åšå®«æ ¼éªŒè¯ç çš„è¯†åˆ«-1">å¾®åšå®«æ ¼éªŒè¯ç çš„è¯†åˆ«</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="kn">import</span> <span class="n">TimeoutException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver</span> <span class="kn">import</span> <span class="n">ActionChains</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="kn">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="kn">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span>

<span class="n">USERNAME</span> <span class="o">=</span> <span class="s">'xxxxxx'</span>
<span class="n">PASSWORD</span> <span class="o">=</span> <span class="s">'xxxxxxx'</span>

<span class="n">TEMPLATES_FOLDER</span> <span class="o">=</span> <span class="s">'templates/'</span>


<span class="k">class</span> <span class="nc">CrackWeiboSlide</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">url</span> <span class="o">=</span> <span class="s">'https://passport.weibo.cn/signin/login?entry=mweibo&amp;r=https://m.weibo.cn/'</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="n">Chrome</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">wait</span> <span class="o">=</span> <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">USERNAME</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">PASSWORD</span>
    
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        æ‰“å¼€ç½‘é¡µè¾“å…¥ç”¨æˆ·åå¯†ç å¹¶ç‚¹å‡»
        :return: None
        """</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">'loginName'</span><span class="p">)))</span>
        <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">'loginPassword'</span><span class="p">)))</span>
        <span class="n">submit</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">element_to_be_clickable</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">ID</span><span class="p">,</span> <span class="s">'loginAction'</span><span class="p">)))</span>
        <span class="n">username</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">username</span><span class="p">)</span>
        <span class="n">password</span><span class="p">.</span><span class="n">send_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">password</span><span class="p">)</span>
        <span class="n">submit</span><span class="p">.</span><span class="n">click</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">get_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        è·å–éªŒè¯ç ä½ç½®
        :return: éªŒè¯ç ä½ç½®å…ƒç»„
        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">wait</span><span class="p">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="p">.</span><span class="n">presence_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="p">.</span><span class="n">CLASS_NAME</span><span class="p">,</span> <span class="s">'patt-shadow'</span><span class="p">)))</span>
        <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'æœªå‡ºç°éªŒè¯ç '</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="nb">open</span><span class="p">()</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">location</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">location</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">size</span>
        <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">location</span><span class="p">[</span><span class="s">'y'</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span> <span class="o">+</span> <span class="n">size</span><span class="p">[</span><span class="s">'height'</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="s">'x'</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="s">'x'</span><span class="p">]</span> <span class="o">+</span> <span class="n">size</span><span class="p">[</span>
            <span class="s">'width'</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_screenshot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        è·å–ç½‘é¡µæˆªå›¾
        :return: æˆªå›¾å¯¹è±¡
        """</span>
        <span class="n">screenshot</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">.</span><span class="n">get_screenshot_as_png</span><span class="p">()</span>
        <span class="n">screenshot</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">screenshot</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">screenshot</span>
    
    <span class="k">def</span> <span class="nf">get_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'captcha.png'</span><span class="p">):</span>
        <span class="s">"""
        è·å–éªŒè¯ç å›¾ç‰‡
        :return: å›¾ç‰‡å¯¹è±¡
        """</span>
        <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_position</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'éªŒè¯ç ä½ç½®'</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
        <span class="n">screenshot</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_screenshot</span><span class="p">()</span>
        <span class="n">captcha</span> <span class="o">=</span> <span class="n">screenshot</span><span class="p">.</span><span class="n">crop</span><span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">bottom</span><span class="p">))</span>
        <span class="n">captcha</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">captcha</span>
    
    <span class="k">def</span> <span class="nf">is_pixel_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">image1</span><span class="p">,</span><span class="n">image2</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span><span class="c1">#åˆ¤æ–­åˆ·æ–°å‡ºæ¥çš„éªŒè¯ç å›¾ç‰‡å’Œå·²ç»å­˜å‚¨å¥½çš„éªŒè¯ç æ¨¡æ¿æ˜¯å¦åŒ¹é…
</span>        <span class="n">pixel1</span><span class="o">=</span><span class="n">image1</span><span class="p">.</span><span class="n">load</span><span class="p">()[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span><span class="c1">#è¿”å›çš„æ˜¯RGBå½¢å¼çš„å…ƒç»„
</span>        <span class="n">pixel2</span><span class="o">=</span><span class="n">image2</span><span class="p">.</span><span class="n">load</span><span class="p">()[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span>
        <span class="n">threshold</span><span class="o">=</span><span class="mi">20</span><span class="c1">#è®¾å®šä¸€ä¸ªé˜ˆå€¼
</span>        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pixel1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pixel2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pixel1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pixel2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">threshold</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span>
                <span class="n">pixel1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">pixel2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        
    <span class="k">def</span> <span class="nf">same_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">image</span><span class="p">,</span><span class="n">template</span><span class="p">):</span><span class="c1">#ç¬¬ä¸€ä¸ªä¸ºå¾…è¯†åˆ«çš„éªŒè¯ç ï¼Œç¬¬äºŒä¸ªä¸ºå­˜å‚¨çš„æ¨¡æ¿ï¼Œåªè¦æ˜¯æ¯”å¯¹ä¸€ä¸‹å„ä¸ªç‚¹çš„åƒç´ 
</span>            <span class="n">count</span><span class="o">=</span><span class="mi">0</span><span class="c1">#ç”¨äºå­˜å‚¨åƒç´ ç›¸åŒç‚¹çš„ä¸ªæ•°
</span>            <span class="n">threshold</span><span class="o">=</span><span class="mf">0.99</span><span class="c1">#é˜ˆå€¼ï¼Œç”¨äºæ ‡å®šä¸¤å¼ å›¾è¡¨æ˜¯å¦ç›¸åŒ
</span>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">width</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">height</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">is_pixel_equal</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">template</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">):</span><span class="c1">#å¦‚æœåƒç´ ç›¸åŒ
</span>                        <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">result</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">width</span><span class="o">*</span><span class="n">image</span><span class="p">.</span><span class="n">height</span><span class="p">)</span><span class="c1">#åˆ¤æ–­ç›¸åŒçš„åƒç´ ç‚¹çš„å æ¯”
</span>            <span class="k">if</span> <span class="n">result</span><span class="o">&gt;</span><span class="n">threshold</span><span class="p">:</span>
                <span class="k">print</span> <span class="p">(</span><span class="s">'æˆåŠŸåŒ¹é…'</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">True</span> 
            <span class="k">else</span><span class="err">ï¼š</span>
                <span class="k">return</span> <span class="bp">False</span>
        
    
     <span class="k">def</span> <span class="nf">detect_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">image</span><span class="p">):</span>
         <span class="k">for</span> <span class="n">template_name</span> <span class="ow">in</span> <span class="n">listdir</span><span class="p">(</span><span class="n">TEMPLATES_FOLDER</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'æ­£åœ¨åŒ¹é…'</span><span class="p">,</span> <span class="n">template_name</span><span class="p">)</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="nb">open</span><span class="p">(</span><span class="n">TEMPLATES_FOLDER</span> <span class="o">+</span> <span class="n">template_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">same_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">template</span><span class="p">):</span>
                <span class="c1"># è¿”å›é¡ºåº
</span>                <span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">template_name</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)[</span><span class="mi">0</span><span class="p">])]</span>
                <span class="k">print</span><span class="p">(</span><span class="s">'æ‹–åŠ¨é¡ºåº'</span><span class="p">,</span> <span class="n">numbers</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">numbers</span>
    
    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">numbers</span><span class="p">):</span>
        <span class="n">circles</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s">'.patt-wrap .patt-circ'</span><span class="p">)</span><span class="c1">#è·å¾—çš„æ˜¯å››ä¸ªæŒ‰é’®çš„åˆ—è¡¨
</span>        <span class="n">dx</span><span class="o">=</span><span class="n">dy</span><span class="o">=</span><span class="mi">0</span><span class="c1">#åˆå§‹ä¸€ä¸ªåŸå§‹çš„åˆå§‹ç§»åŠ¨ä½ç½®
</span>        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">circle</span><span class="o">=</span><span class="n">circles</span><span class="p">[</span><span class="n">numbers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="c1">#numbersæ˜¯1-4çš„ä¸€ä¸ªåˆ—è¡¨
</span>            <span class="c1"># å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å¾ªç¯
</span>            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># ç‚¹å‡»ç¬¬ä¸€ä¸ªæŒ‰ç‚¹
</span>                <span class="n">ActionChains</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">)</span> \
                    <span class="p">.</span><span class="n">move_to_element_with_offset</span><span class="p">(</span><span class="n">circle</span><span class="p">,</span> <span class="n">circle</span><span class="p">.</span><span class="n">size</span><span class="p">[</span><span class="s">'width'</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">circle</span><span class="p">.</span><span class="n">size</span><span class="p">[</span><span class="s">'height'</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> \
                    <span class="p">.</span><span class="n">click_and_hold</span><span class="p">().</span><span class="n">perform</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># å°å¹…ç§»åŠ¨æ¬¡æ•°
</span>                <span class="n">times</span> <span class="o">=</span> <span class="mi">30</span>
                <span class="c1"># æ‹–åŠ¨
</span>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">times</span><span class="p">):</span>
                    <span class="n">ActionChains</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">).</span><span class="n">move_by_offset</span><span class="p">(</span><span class="n">dx</span> <span class="o">/</span> <span class="n">times</span><span class="p">,</span> <span class="n">dy</span> <span class="o">/</span> <span class="n">times</span><span class="p">).</span><span class="n">perform</span><span class="p">()</span><span class="c1">#å½“dx=dy=0çš„æ—¶å€™ï¼Œindex=0ï¼Œä¸ä¼šæ‰§è¡Œè¿™ä¸€å¥
</span>                    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">times</span><span class="p">)</span>
            <span class="c1"># å¦‚æœæ˜¯æœ€åä¸€æ¬¡å¾ªç¯
</span>            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="c1"># æ¾å¼€é¼ æ ‡
</span>                <span class="n">ActionChains</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">browser</span><span class="p">).</span><span class="n">release</span><span class="p">().</span><span class="n">perform</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># è®¡ç®—ä¸‹ä¸€æ¬¡åç§»
</span>                <span class="n">dx</span> <span class="o">=</span> <span class="n">circles</span><span class="p">[</span><span class="n">numbers</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">location</span><span class="p">[</span><span class="s">'x'</span><span class="p">]</span> <span class="o">-</span> <span class="n">circle</span><span class="p">.</span><span class="n">location</span><span class="p">[</span><span class="s">'x'</span><span class="p">]</span>
                <span class="n">dy</span> <span class="o">=</span> <span class="n">circles</span><span class="p">[</span><span class="n">numbers</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">location</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span> <span class="o">-</span> <span class="n">circle</span><span class="p">.</span><span class="n">location</span><span class="p">[</span><span class="s">'y'</span><span class="p">]</span>
                
    <span class="k">def</span> <span class="nf">crack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        ç ´è§£å…¥å£
        :return:
        """</span>
        <span class="bp">self</span><span class="p">.</span><span class="nb">open</span><span class="p">()</span>
        <span class="c1"># è·å–éªŒè¯ç å›¾ç‰‡
</span>        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_image</span><span class="p">(</span><span class="s">'captcha.png'</span><span class="p">)</span>
        <span class="n">numbers</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">detect_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'è¯†åˆ«ç»“æŸ'</span><span class="p">)</span>
            
                    
            
        
    
     <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">count</span><span class="o">=</span><span class="mi">0</span> 
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="nb">open</span><span class="p">()</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">get_image</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">+</span><span class="s">'.png'</span><span class="p">)</span>
            <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
            
            
<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">crack</span><span class="o">=</span> <span class="n">CrackWeiboSlide</span><span class="p">()</span>
    <span class="n">crack</span><span class="p">.</span><span class="n">crack</span><span class="p">()</span>
<span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span> <span class="n">HEAD</span>
</code></pre></div></div>
<blockquote>
  <blockquote>
    <blockquote>
      <blockquote>
        <blockquote>
          <blockquote>
            <blockquote>
              <h1 id="f0bfe13-new-update_postsçŸ¥è¯†ç‚¹2019-11-25-verification-codemd">f0bfe13 (new update):_posts/çŸ¥è¯†ç‚¹/2019-11-25-verification-code.md</h1>
              <p>```
e5c77ca (æ–°é¡µé¢)</p>
            </blockquote>
          </blockquote>
        </blockquote>
      </blockquote>
    </blockquote>
  </blockquote>
</blockquote>
:ET